<!DOCTYPE html>
<!-- saved from url=(0046)https://beej.us/guide/bgc/html/index-wide.html -->
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang=""><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  
  <meta name="generator" content="pandoc">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
  <title>Beej's Guide to C Programming</title>
  <style>
    html {
      color: #1a1a1a;
      background-color: #fdfdfd;
    }
    body {
      margin: 0 auto;
      max-width: 36em;
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 50px;
      padding-bottom: 50px;
      hyphens: auto;
      overflow-wrap: break-word;
      text-rendering: optimizeLegibility;
      font-kerning: normal;
    }
    @media (max-width: 600px) {
      body {
        font-size: 0.9em;
        padding: 12px;
      }
      h1 {
        font-size: 1.8em;
      }
    }
    @media print {
      html {
        background-color: white;
      }
      body {
        background-color: transparent;
        color: black;
        font-size: 12pt;
      }
      p, h2, h3 {
        orphans: 3;
        widows: 3;
      }
      h2, h3, h4 {
        page-break-after: avoid;
      }
    }
    p {
      margin: 1em 0;
    }
    a {
      color: #1a1a1a;
    }
    a:visited {
      color: #1a1a1a;
    }
    img {
      max-width: 100%;
    }
    h1, h2, h3, h4, h5, h6 {
      margin-top: 1.4em;
    }
    h5, h6 {
      font-size: 1em;
      font-style: italic;
    }
    h6 {
      font-weight: normal;
    }
    ol, ul {
      padding-left: 1.7em;
      margin-top: 1em;
    }
    li > ol, li > ul {
      margin-top: 0;
    }
    blockquote {
      margin: 1em 0 1em 1.7em;
      padding-left: 1em;
      border-left: 2px solid #e6e6e6;
      color: #606060;
    }
    code {
      font-family: Menlo, Monaco, Consolas, 'Lucida Console', monospace;
      font-size: 85%;
      margin: 0;
      hyphens: manual;
    }
    pre {
      margin: 1em 0;
      overflow: auto;
    }
    pre code {
      padding: 0;
      overflow: visible;
      overflow-wrap: normal;
    }
    .sourceCode {
     background-color: transparent;
     overflow: visible;
    }
    hr {
      background-color: #1a1a1a;
      border: none;
      height: 1px;
      margin: 1em 0;
    }
    table {
      margin: 1em 0;
      border-collapse: collapse;
      width: 100%;
      overflow-x: auto;
      display: block;
      font-variant-numeric: lining-nums tabular-nums;
    }
    table caption {
      margin-bottom: 0.75em;
    }
    tbody {
      margin-top: 0.5em;
      border-top: 1px solid #1a1a1a;
      border-bottom: 1px solid #1a1a1a;
    }
    th {
      border-top: 1px solid #1a1a1a;
      padding: 0.25em 0.5em 0.25em 0.5em;
    }
    td {
      padding: 0.125em 0.5em 0.25em 0.5em;
    }
    header {
      margin-bottom: 4em;
      text-align: center;
    }
    #TOC li {
      list-style: none;
    }
    #TOC ul {
      padding-left: 1.3em;
    }
    #TOC > ul {
      padding-left: 0;
    }
    #TOC a:not(:hover) {
      text-decoration: none;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {   }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ff0000; font-weight: bold; } /* Alert */
    code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #7d9029; } /* Attribute */
    code span.bn { color: #40a070; } /* BaseN */
    code span.bu { color: #008000; } /* BuiltIn */
    code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4070a0; } /* Char */
    code span.cn { color: #880000; } /* Constant */
    code span.co { color: #60a0b0; font-style: italic; } /* Comment */
    code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #ba2121; font-style: italic; } /* Documentation */
    code span.dt { color: #902000; } /* DataType */
    code span.dv { color: #40a070; } /* DecVal */
    code span.er { color: #ff0000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #40a070; } /* Float */
    code span.fu { color: #06287e; } /* Function */
    code span.im { color: #008000; font-weight: bold; } /* Import */
    code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #007020; font-weight: bold; } /* Keyword */
    code span.op { color: #666666; } /* Operator */
    code span.ot { color: #007020; } /* Other */
    code span.pp { color: #bc7a00; } /* Preprocessor */
    code span.sc { color: #4070a0; } /* SpecialChar */
    code span.ss { color: #bb6688; } /* SpecialString */
    code span.st { color: #4070a0; } /* String */
    code span.va { color: #19177c; } /* Variable */
    code span.vs { color: #4070a0; } /* VerbatimString */
    code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link href="./Beej&#39;s Guide to C Programming_files/css" rel="stylesheet"> 

  <!-- BG custom styling -->
  <style type="text/css">
  /* Fix for line numbers not visible */
  pre.numberSource code > span {
      left: -1em;
  }
  pre.numberSource {
      margin-left: initial;
  }

  /* Put some space after the section numbers */
  span.toc-section-number::after {
      content: "\a0\a0\a0";  /* non-breaking whitespace */
  }

  /* Hide underlines on code number links */
  pre > code.sourceCode > span > a:first-child::before {
      text-decoration: none;
  }

  /* Color the source blocks */
  div.sourceCode {
      background-color: #f0f0f0;
  }

  /* Fix iOS big text rendering issue */
  pre > code.sourceCode > span {
      display: initial;
  }


  /* Color the inline code */
  code:not(.sourceCode) {
      background: #f0f0f0;
      padding-left: 0.2em;
      padding-right: 0.2em;
      border-radius: 0.2em;
  }

  /* Keep code tags from wrapping in tables */
  tbody code {
      white-space: nowrap;
  }

  td {
      vertical-align: top;
  }

  body {
      font-size: 12pt;
      max-width: 43em;
  }
  </style>
  <!-- BG custom styling for the wide body variant -->
  <!-- Gets appended after bg-css.html -->

  <style type="text/css">
  body {
      max-width: inherit;
  }
  </style>
  <script src="./Beej&#39;s Guide to C Programming_files/polyfill.min.js"></script>
  <script src="./Beej&#39;s Guide to C Programming_files/tex-chtml-full.js" type="text/javascript"></script><style type="text/css">.CtxtMenu_InfoClose {  top:.2em; right:.2em;}
.CtxtMenu_InfoContent {  overflow:auto; text-align:left; font-size:80%;  padding:.4em .6em; border:1px inset; margin:1em 0px;  max-height:20em; max-width:30em; background-color:#EEEEEE;  white-space:normal;}
.CtxtMenu_Info.CtxtMenu_MousePost {outline:none;}
.CtxtMenu_Info {  position:fixed; left:50%; width:auto; text-align:center;  border:3px outset; padding:1em 2em; background-color:#DDDDDD;  color:black;  cursor:default; font-family:message-box; font-size:120%;  font-style:normal; text-indent:0; text-transform:none;  line-height:normal; letter-spacing:normal; word-spacing:normal;  word-wrap:normal; white-space:nowrap; float:none; z-index:201;  border-radius: 15px;                     /* Opera 10.5 and IE9 */  -webkit-border-radius:15px;               /* Safari and Chrome */  -moz-border-radius:15px;                  /* Firefox */  -khtml-border-radius:15px;                /* Konqueror */  box-shadow:0px 10px 20px #808080;         /* Opera 10.5 and IE9 */  -webkit-box-shadow:0px 10px 20px #808080; /* Safari 3 & Chrome */  -moz-box-shadow:0px 10px 20px #808080;    /* Forefox 3.5 */  -khtml-box-shadow:0px 10px 20px #808080;  /* Konqueror */  filter:progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color="gray", Positive="true"); /* IE */}
</style><style type="text/css">.CtxtMenu_MenuClose {  position:absolute;  cursor:pointer;  display:inline-block;  border:2px solid #AAA;  border-radius:18px;  -webkit-border-radius: 18px;             /* Safari and Chrome */  -moz-border-radius: 18px;                /* Firefox */  -khtml-border-radius: 18px;              /* Konqueror */  font-family: "Courier New", Courier;  font-size:24px;  color:#F0F0F0}
.CtxtMenu_MenuClose span {  display:block; background-color:#AAA; border:1.5px solid;  border-radius:18px;  -webkit-border-radius: 18px;             /* Safari and Chrome */  -moz-border-radius: 18px;                /* Firefox */  -khtml-border-radius: 18px;              /* Konqueror */  line-height:0;  padding:8px 0 6px     /* may need to be browser-specific */}
.CtxtMenu_MenuClose:hover {  color:white!important;  border:2px solid #CCC!important}
.CtxtMenu_MenuClose:hover span {  background-color:#CCC!important}
.CtxtMenu_MenuClose:hover:focus {  outline:none}
</style><style type="text/css">.CtxtMenu_Menu {  position:absolute;  background-color:white;  color:black;  width:auto; padding:5px 0px;  border:1px solid #CCCCCC; margin:0; cursor:default;  font: menu; text-align:left; text-indent:0; text-transform:none;  line-height:normal; letter-spacing:normal; word-spacing:normal;  word-wrap:normal; white-space:nowrap; float:none; z-index:201;  border-radius: 5px;                     /* Opera 10.5 and IE9 */  -webkit-border-radius: 5px;             /* Safari and Chrome */  -moz-border-radius: 5px;                /* Firefox */  -khtml-border-radius: 5px;              /* Konqueror */  box-shadow:0px 10px 20px #808080;         /* Opera 10.5 and IE9 */  -webkit-box-shadow:0px 10px 20px #808080; /* Safari 3 & Chrome */  -moz-box-shadow:0px 10px 20px #808080;    /* Forefox 3.5 */  -khtml-box-shadow:0px 10px 20px #808080;  /* Konqueror */}
.CtxtMenu_MenuItem {  padding: 1px 2em;  background:transparent;}
.CtxtMenu_MenuArrow {  position:absolute; right:.5em; padding-top:.25em; color:#666666;  font-family: null; font-size: .75em}
.CtxtMenu_MenuActive .CtxtMenu_MenuArrow {color:white}
.CtxtMenu_MenuArrow.CtxtMenu_RTL {left:.5em; right:auto}
.CtxtMenu_MenuCheck {  position:absolute; left:.7em;  font-family: null}
.CtxtMenu_MenuCheck.CtxtMenu_RTL { right:.7em; left:auto }
.CtxtMenu_MenuRadioCheck {  position:absolute; left: .7em;}
.CtxtMenu_MenuRadioCheck.CtxtMenu_RTL {  right: .7em; left:auto}
.CtxtMenu_MenuInputBox {  padding-left: 1em; right:.5em; color:#666666;  font-family: null;}
.CtxtMenu_MenuInputBox.CtxtMenu_RTL {  left: .1em;}
.CtxtMenu_MenuComboBox {  left:.1em; padding-bottom:.5em;}
.CtxtMenu_MenuSlider {  left: .1em;}
.CtxtMenu_SliderValue {  position:absolute; right:.1em; padding-top:.25em; color:#333333;  font-size: .75em}
.CtxtMenu_SliderBar {  outline: none; background: #d3d3d3}
.CtxtMenu_MenuLabel {  padding: 1px 2em 3px 1.33em;  font-style:italic}
.CtxtMenu_MenuRule {  border-top: 1px solid #DDDDDD;  margin: 4px 3px;}
.CtxtMenu_MenuDisabled {  color:GrayText}
.CtxtMenu_MenuActive {  background-color: #606872;  color: white;}
.CtxtMenu_MenuDisabled:focus {  background-color: #E8E8E8}
.CtxtMenu_MenuLabel:focus {  background-color: #E8E8E8}
.CtxtMenu_ContextMenu:focus {  outline:none}
.CtxtMenu_ContextMenu .CtxtMenu_MenuItem:focus {  outline:none}
.CtxtMenu_SelectionMenu {  position:relative; float:left;  border-bottom: none; -webkit-box-shadow:none; -webkit-border-radius:0px; }
.CtxtMenu_SelectionItem {  padding-right: 1em;}
.CtxtMenu_Selection {  right: 40%; width:50%; }
.CtxtMenu_SelectionBox {  padding: 0em; max-height:20em; max-width: none;  background-color:#FFFFFF;}
.CtxtMenu_SelectionDivider {  clear: both; border-top: 2px solid #000000;}
.CtxtMenu_Menu .CtxtMenu_MenuClose {  top:-10px; left:-10px}
</style>
  <!--[if lt IE 9]>
    <script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv-printshiv.min.js"></script>
  <![endif]-->
<style id="MJX-CHTML-styles">
mjx-container[jax="CHTML"] {
  line-height: 0;
}

mjx-container [space="1"] {
  margin-left: .111em;
}

mjx-container [space="2"] {
  margin-left: .167em;
}

mjx-container [space="3"] {
  margin-left: .222em;
}

mjx-container [space="4"] {
  margin-left: .278em;
}

mjx-container [space="5"] {
  margin-left: .333em;
}

mjx-container [rspace="1"] {
  margin-right: .111em;
}

mjx-container [rspace="2"] {
  margin-right: .167em;
}

mjx-container [rspace="3"] {
  margin-right: .222em;
}

mjx-container [rspace="4"] {
  margin-right: .278em;
}

mjx-container [rspace="5"] {
  margin-right: .333em;
}

mjx-container [size="s"] {
  font-size: 70.7%;
}

mjx-container [size="ss"] {
  font-size: 50%;
}

mjx-container [size="Tn"] {
  font-size: 60%;
}

mjx-container [size="sm"] {
  font-size: 85%;
}

mjx-container [size="lg"] {
  font-size: 120%;
}

mjx-container [size="Lg"] {
  font-size: 144%;
}

mjx-container [size="LG"] {
  font-size: 173%;
}

mjx-container [size="hg"] {
  font-size: 207%;
}

mjx-container [size="HG"] {
  font-size: 249%;
}

mjx-container [width="full"] {
  width: 100%;
}

mjx-box {
  display: inline-block;
}

mjx-block {
  display: block;
}

mjx-itable {
  display: inline-table;
}

mjx-row {
  display: table-row;
}

mjx-row > * {
  display: table-cell;
}

mjx-mtext {
  display: inline-block;
}

mjx-mstyle {
  display: inline-block;
}

mjx-merror {
  display: inline-block;
  color: red;
  background-color: yellow;
}

mjx-mphantom {
  visibility: hidden;
}

_::-webkit-full-page-media, _:future, :root mjx-container {
  will-change: opacity;
}

mjx-assistive-mml {
  position: absolute !important;
  top: 0px;
  left: 0px;
  clip: rect(1px, 1px, 1px, 1px);
  padding: 1px 0px 0px 0px !important;
  border: 0px !important;
  display: block !important;
  width: auto !important;
  overflow: hidden !important;
  -webkit-touch-callout: none;
  -webkit-user-select: none;
  -khtml-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}

mjx-assistive-mml[display="block"] {
  width: 100% !important;
}

mjx-math {
  display: inline-block;
  text-align: left;
  line-height: 0;
  text-indent: 0;
  font-style: normal;
  font-weight: normal;
  font-size: 100%;
  font-size-adjust: none;
  letter-spacing: normal;
  border-collapse: collapse;
  word-wrap: normal;
  word-spacing: normal;
  white-space: nowrap;
  direction: ltr;
  padding: 1px 0;
}

mjx-container[jax="CHTML"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="CHTML"][display="true"][width="full"] {
  display: flex;
}

mjx-container[jax="CHTML"][display="true"] mjx-math {
  padding: 0;
}

mjx-container[jax="CHTML"][justify="left"] {
  text-align: left;
}

mjx-container[jax="CHTML"][justify="right"] {
  text-align: right;
}

mjx-mfrac {
  display: inline-block;
  text-align: left;
}

mjx-frac {
  display: inline-block;
  vertical-align: 0.17em;
  padding: 0 .22em;
}

mjx-frac[type="d"] {
  vertical-align: .04em;
}

mjx-frac[delims] {
  padding: 0 .1em;
}

mjx-frac[atop] {
  padding: 0 .12em;
}

mjx-frac[atop][delims] {
  padding: 0;
}

mjx-dtable {
  display: inline-table;
  width: 100%;
}

mjx-dtable > * {
  font-size: 2000%;
}

mjx-dbox {
  display: block;
  font-size: 5%;
}

mjx-num {
  display: block;
  text-align: center;
}

mjx-den {
  display: block;
  text-align: center;
}

mjx-mfrac[bevelled] > mjx-num {
  display: inline-block;
}

mjx-mfrac[bevelled] > mjx-den {
  display: inline-block;
}

mjx-den[align="right"], mjx-num[align="right"] {
  text-align: right;
}

mjx-den[align="left"], mjx-num[align="left"] {
  text-align: left;
}

mjx-nstrut {
  display: inline-block;
  height: .054em;
  width: 0;
  vertical-align: -.054em;
}

mjx-nstrut[type="d"] {
  height: .217em;
  vertical-align: -.217em;
}

mjx-dstrut {
  display: inline-block;
  height: .505em;
  width: 0;
}

mjx-dstrut[type="d"] {
  height: .726em;
}

mjx-line {
  display: block;
  box-sizing: border-box;
  min-height: 1px;
  height: .06em;
  border-top: .06em solid;
  margin: .06em -.1em;
  overflow: hidden;
}

mjx-line[type="d"] {
  margin: .18em -.1em;
}

mjx-mn {
  display: inline-block;
  text-align: left;
}

mjx-c {
  display: inline-block;
}

mjx-utext {
  display: inline-block;
  padding: .75em 0 .2em 0;
}

mjx-mi {
  display: inline-block;
  text-align: left;
}

mjx-mo {
  display: inline-block;
  text-align: left;
}

mjx-stretchy-h {
  display: inline-table;
  width: 100%;
}

mjx-stretchy-h > * {
  display: table-cell;
  width: 0;
}

mjx-stretchy-h > * > mjx-c {
  display: inline-block;
  transform: scalex(1.0000001);
}

mjx-stretchy-h > * > mjx-c::before {
  display: inline-block;
  width: initial;
}

mjx-stretchy-h > mjx-ext {
  /* IE */ overflow: hidden;
  /* others */ overflow: clip visible;
  width: 100%;
}

mjx-stretchy-h > mjx-ext > mjx-c::before {
  transform: scalex(500);
}

mjx-stretchy-h > mjx-ext > mjx-c {
  width: 0;
}

mjx-stretchy-h > mjx-beg > mjx-c {
  margin-right: -.1em;
}

mjx-stretchy-h > mjx-end > mjx-c {
  margin-left: -.1em;
}

mjx-stretchy-v {
  display: inline-block;
}

mjx-stretchy-v > * {
  display: block;
}

mjx-stretchy-v > mjx-beg {
  height: 0;
}

mjx-stretchy-v > mjx-end > mjx-c {
  display: block;
}

mjx-stretchy-v > * > mjx-c {
  transform: scaley(1.0000001);
  transform-origin: left center;
  overflow: hidden;
}

mjx-stretchy-v > mjx-ext {
  display: block;
  height: 100%;
  box-sizing: border-box;
  border: 0px solid transparent;
  /* IE */ overflow: hidden;
  /* others */ overflow: visible clip;
}

mjx-stretchy-v > mjx-ext > mjx-c::before {
  width: initial;
  box-sizing: border-box;
}

mjx-stretchy-v > mjx-ext > mjx-c {
  transform: scaleY(500) translateY(.075em);
  overflow: visible;
}

mjx-mark {
  display: inline-block;
  height: 0px;
}

mjx-msub {
  display: inline-block;
  text-align: left;
}

mjx-TeXAtom {
  display: inline-block;
  text-align: left;
}

mjx-msup {
  display: inline-block;
  text-align: left;
}

mjx-munderover {
  display: inline-block;
  text-align: left;
}

mjx-munderover:not([limits="false"]) {
  padding-top: .1em;
}

mjx-munderover:not([limits="false"]) > * {
  display: block;
}

mjx-msubsup {
  display: inline-block;
  text-align: left;
}

mjx-script {
  display: inline-block;
  padding-right: .05em;
  padding-left: .033em;
}

mjx-script > mjx-spacer {
  display: block;
}

mjx-mrow {
  display: inline-block;
  text-align: left;
}

mjx-msqrt {
  display: inline-block;
  text-align: left;
}

mjx-root {
  display: inline-block;
  white-space: nowrap;
}

mjx-surd {
  display: inline-block;
  vertical-align: top;
}

mjx-sqrt {
  display: inline-block;
  padding-top: .07em;
}

mjx-sqrt > mjx-box {
  border-top: .07em solid;
}

mjx-sqrt.mjx-tall > mjx-box {
  padding-left: .3em;
  margin-left: -.3em;
}

mjx-c::before {
  display: block;
  width: 0;
}

.MJX-TEX {
  font-family: MJXZERO, MJXTEX;
}

.TEX-B {
  font-family: MJXZERO, MJXTEX-B;
}

.TEX-I {
  font-family: MJXZERO, MJXTEX-I;
}

.TEX-MI {
  font-family: MJXZERO, MJXTEX-MI;
}

.TEX-BI {
  font-family: MJXZERO, MJXTEX-BI;
}

.TEX-S1 {
  font-family: MJXZERO, MJXTEX-S1;
}

.TEX-S2 {
  font-family: MJXZERO, MJXTEX-S2;
}

.TEX-S3 {
  font-family: MJXZERO, MJXTEX-S3;
}

.TEX-S4 {
  font-family: MJXZERO, MJXTEX-S4;
}

.TEX-A {
  font-family: MJXZERO, MJXTEX-A;
}

.TEX-C {
  font-family: MJXZERO, MJXTEX-C;
}

.TEX-CB {
  font-family: MJXZERO, MJXTEX-CB;
}

.TEX-FR {
  font-family: MJXZERO, MJXTEX-FR;
}

.TEX-FRB {
  font-family: MJXZERO, MJXTEX-FRB;
}

.TEX-SS {
  font-family: MJXZERO, MJXTEX-SS;
}

.TEX-SSB {
  font-family: MJXZERO, MJXTEX-SSB;
}

.TEX-SSI {
  font-family: MJXZERO, MJXTEX-SSI;
}

.TEX-SC {
  font-family: MJXZERO, MJXTEX-SC;
}

.TEX-T {
  font-family: MJXZERO, MJXTEX-T;
}

.TEX-V {
  font-family: MJXZERO, MJXTEX-V;
}

.TEX-VB {
  font-family: MJXZERO, MJXTEX-VB;
}

mjx-stretchy-v mjx-c, mjx-stretchy-h mjx-c {
  font-family: MJXZERO, MJXTEX-S1, MJXTEX-S4, MJXTEX, MJXTEX-A ! important;
}

@font-face /* 0 */ {
  font-family: MJXZERO;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Zero.woff") format("woff");
}

@font-face /* 1 */ {
  font-family: MJXTEX;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Main-Regular.woff") format("woff");
}

@font-face /* 2 */ {
  font-family: MJXTEX-B;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Main-Bold.woff") format("woff");
}

@font-face /* 3 */ {
  font-family: MJXTEX-I;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Math-Italic.woff") format("woff");
}

@font-face /* 4 */ {
  font-family: MJXTEX-MI;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Main-Italic.woff") format("woff");
}

@font-face /* 5 */ {
  font-family: MJXTEX-BI;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Math-BoldItalic.woff") format("woff");
}

@font-face /* 6 */ {
  font-family: MJXTEX-S1;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Size1-Regular.woff") format("woff");
}

@font-face /* 7 */ {
  font-family: MJXTEX-S2;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Size2-Regular.woff") format("woff");
}

@font-face /* 8 */ {
  font-family: MJXTEX-S3;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Size3-Regular.woff") format("woff");
}

@font-face /* 9 */ {
  font-family: MJXTEX-S4;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Size4-Regular.woff") format("woff");
}

@font-face /* 10 */ {
  font-family: MJXTEX-A;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_AMS-Regular.woff") format("woff");
}

@font-face /* 11 */ {
  font-family: MJXTEX-C;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Calligraphic-Regular.woff") format("woff");
}

@font-face /* 12 */ {
  font-family: MJXTEX-CB;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Calligraphic-Bold.woff") format("woff");
}

@font-face /* 13 */ {
  font-family: MJXTEX-FR;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Fraktur-Regular.woff") format("woff");
}

@font-face /* 14 */ {
  font-family: MJXTEX-FRB;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Fraktur-Bold.woff") format("woff");
}

@font-face /* 15 */ {
  font-family: MJXTEX-SS;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_SansSerif-Regular.woff") format("woff");
}

@font-face /* 16 */ {
  font-family: MJXTEX-SSB;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_SansSerif-Bold.woff") format("woff");
}

@font-face /* 17 */ {
  font-family: MJXTEX-SSI;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_SansSerif-Italic.woff") format("woff");
}

@font-face /* 18 */ {
  font-family: MJXTEX-SC;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Script-Regular.woff") format("woff");
}

@font-face /* 19 */ {
  font-family: MJXTEX-T;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Typewriter-Regular.woff") format("woff");
}

@font-face /* 20 */ {
  font-family: MJXTEX-V;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Vector-Regular.woff") format("woff");
}

@font-face /* 21 */ {
  font-family: MJXTEX-VB;
  src: url("https://cdn.jsdelivr.net/npm/mathjax@3/es5/output/chtml/fonts/woff-v2/MathJax_Vector-Bold.woff") format("woff");
}

mjx-c.mjx-c33::before {
  padding: 0.665em 0.5em 0.022em 0;
  content: "3";
}

mjx-c.mjx-c32::before {
  padding: 0.666em 0.5em 0 0;
  content: "2";
}

mjx-c.mjx-c34::before {
  padding: 0.677em 0.5em 0 0;
  content: "4";
}

mjx-c.mjx-c38::before {
  padding: 0.666em 0.5em 0.022em 0;
  content: "8";
}

mjx-c.mjx-c1D460.TEX-I::before {
  padding: 0.442em 0.469em 0.01em 0;
  content: "s";
}

mjx-c.mjx-cB1::before {
  padding: 0.666em 0.778em 0 0;
  content: "\B1";
}

mjx-c.mjx-c31::before {
  padding: 0.666em 0.5em 0 0;
  content: "1";
}

mjx-c.mjx-c1D44F.TEX-I::before {
  padding: 0.694em 0.429em 0.011em 0;
  content: "b";
}

mjx-c.mjx-c3E::before {
  padding: 0.54em 0.778em 0.04em 0;
  content: ">";
}

mjx-c.mjx-c1D452.TEX-I::before {
  padding: 0.442em 0.466em 0.011em 0;
  content: "e";
}

mjx-c.mjx-c1D45A.TEX-I::before {
  padding: 0.442em 0.878em 0.011em 0;
  content: "m";
}

mjx-c.mjx-c1D456.TEX-I::before {
  padding: 0.661em 0.345em 0.011em 0;
  content: "i";
}

mjx-c.mjx-c1D45B.TEX-I::before {
  padding: 0.442em 0.6em 0.011em 0;
  content: "n";
}

mjx-c.mjx-c1D44E.TEX-I::before {
  padding: 0.441em 0.529em 0.01em 0;
  content: "a";
}

mjx-c.mjx-c1D465.TEX-I::before {
  padding: 0.442em 0.572em 0.011em 0;
  content: "x";
}

mjx-c.mjx-c1D45D.TEX-I::before {
  padding: 0.442em 0.503em 0.194em 0;
  content: "p";
}

mjx-c.mjx-c1D453.TEX-I::before {
  padding: 0.705em 0.55em 0.205em 0;
  content: "f";
}

mjx-c.mjx-c1D458.TEX-I::before {
  padding: 0.694em 0.521em 0.011em 0;
  content: "k";
}

mjx-c.mjx-c3D::before {
  padding: 0.583em 0.778em 0.082em 0;
  content: "=";
}

mjx-c.mjx-c2211.TEX-S1::before {
  padding: 0.75em 1.056em 0.25em 0;
  content: "\2211";
}

mjx-c.mjx-c2212::before {
  padding: 0.583em 0.778em 0.082em 0;
  content: "\2212";
}

mjx-c.mjx-c2C::before {
  padding: 0.121em 0.278em 0.194em 0;
  content: ",";
}

mjx-c.mjx-c2264::before {
  padding: 0.636em 0.778em 0.138em 0;
  content: "\2264";
}

mjx-c.mjx-c30::before {
  padding: 0.666em 0.5em 0.022em 0;
  content: "0";
}

mjx-c.mjx-c35::before {
  padding: 0.666em 0.5em 0.022em 0;
  content: "5";
}

mjx-c.mjx-cD7::before {
  padding: 0.491em 0.778em 0 0;
  content: "\D7";
}

mjx-c.mjx-c2E::before {
  padding: 0.12em 0.278em 0 0;
  content: ".";
}

mjx-c.mjx-c36::before {
  padding: 0.666em 0.5em 0.022em 0;
  content: "6";
}

mjx-c.mjx-c2B::before {
  padding: 0.583em 0.778em 0.082em 0;
  content: "+";
}

mjx-c.mjx-c37::before {
  padding: 0.676em 0.5em 0.022em 0;
  content: "7";
}

mjx-c.mjx-c39::before {
  padding: 0.666em 0.5em 0.022em 0;
  content: "9";
}

mjx-c.mjx-c1D450.TEX-I::before {
  padding: 0.442em 0.433em 0.011em 0;
  content: "c";
}

mjx-c.mjx-c221A::before {
  padding: 0.8em 0.853em 0.2em 0;
  content: "\221A";
}

mjx-c.mjx-c2248::before {
  padding: 0.483em 0.778em 0 0;
  content: "\2248";
}

mjx-c.mjx-c28::before {
  padding: 0.75em 0.389em 0.25em 0;
  content: "(";
}

mjx-c.mjx-c1D466.TEX-I::before {
  padding: 0.442em 0.49em 0.205em 0;
  content: "y";
}

mjx-c.mjx-c29::before {
  padding: 0.75em 0.389em 0.25em 0;
  content: ")";
}

mjx-c.mjx-c1D462.TEX-I::before {
  padding: 0.442em 0.572em 0.011em 0;
  content: "u";
}

mjx-c.mjx-c1D463.TEX-I::before {
  padding: 0.443em 0.485em 0.011em 0;
  content: "v";
}

mjx-c.mjx-c2F::before {
  padding: 0.75em 0.5em 0.25em 0;
  content: "/";
}

mjx-c.mjx-c5B::before {
  padding: 0.75em 0.278em 0.25em 0;
  content: "[";
}

mjx-c.mjx-c5D::before {
  padding: 0.75em 0.278em 0.25em 0;
  content: "]";
}

mjx-c.mjx-c7C::before {
  padding: 0.75em 0.278em 0.249em 0;
  content: "|";
}

mjx-c.mjx-c221A.TEX-S1::before {
  padding: 0.85em 1.02em 0.35em 0;
  content: "\221A";
}
</style></head>
<body>
<header id="title-block-header">
<h1 class="title">Beej's Guide to C Programming</h1>
<p class="author">Brian “Beej Jorgensen” Hall</p>
<p class="date">v0.9.13, Copyright © March 29, 2023</p>
</header>
<nav id="TOC" role="doc-toc">
<ul>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#foreword" id="toc-foreword"><span class="toc-section-number">1</span> Foreword</a>
<ul>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#audience" id="toc-audience"><span class="toc-section-number">1.1</span> Audience</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#how-to-read-this-book" id="toc-how-to-read-this-book"><span class="toc-section-number">1.2</span> How to Read This Book</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#platform-and-compiler" id="toc-platform-and-compiler"><span class="toc-section-number">1.3</span> Platform and Compiler</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#official-homepage" id="toc-official-homepage"><span class="toc-section-number">1.4</span> Official Homepage</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#email-policy" id="toc-email-policy"><span class="toc-section-number">1.5</span> Email Policy</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#mirroring" id="toc-mirroring"><span class="toc-section-number">1.6</span> Mirroring</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#note-for-translators" id="toc-note-for-translators"><span class="toc-section-number">1.7</span> Note for Translators</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#copyright-and-distribution" id="toc-copyright-and-distribution"><span class="toc-section-number">1.8</span> Copyright and Distribution</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#dedication" id="toc-dedication"><span class="toc-section-number">1.9</span> Dedication</a></li>
</ul></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#hello-world" id="toc-hello-world"><span class="toc-section-number">2</span> Hello, World!</a>
<ul>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#what-to-expect-from-c" id="toc-what-to-expect-from-c"><span class="toc-section-number">2.1</span> What to Expect from C</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#hello-world-1" id="toc-hello-world-1"><span class="toc-section-number">2.2</span> Hello, World!</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#compilation-details" id="toc-compilation-details"><span class="toc-section-number">2.3</span> Compilation Details</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#building-with-gcc" id="toc-building-with-gcc"><span class="toc-section-number">2.4</span> Building with <code>gcc</code></a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#building-with-clang" id="toc-building-with-clang"><span class="toc-section-number">2.5</span> Building with <code>clang</code></a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#building-from-ides" id="toc-building-from-ides"><span class="toc-section-number">2.6</span> Building from IDEs</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#c-versions" id="toc-c-versions"><span class="toc-section-number">2.7</span> C Versions</a></li>
</ul></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#variables-and-statements" id="toc-variables-and-statements"><span class="toc-section-number">3</span> Variables and Statements</a>
<ul>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#variables" id="toc-variables"><span class="toc-section-number">3.1</span> Variables</a>
<ul>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#variable-names" id="toc-variable-names"><span class="toc-section-number">3.1.1</span> Variable Names</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#variable-types" id="toc-variable-types"><span class="toc-section-number">3.1.2</span> Variable Types</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#boolean-types" id="toc-boolean-types"><span class="toc-section-number">3.1.3</span> Boolean Types</a></li>
</ul></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#operators" id="toc-operators"><span class="toc-section-number">3.2</span> Operators and Expressions</a>
<ul>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#arithmetic" id="toc-arithmetic"><span class="toc-section-number">3.2.1</span> Arithmetic</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#ternary-operator" id="toc-ternary-operator"><span class="toc-section-number">3.2.2</span> Ternary Operator</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#pre-and-post-increment-and-decrement" id="toc-pre-and-post-increment-and-decrement"><span class="toc-section-number">3.2.3</span> Pre-and-Post Increment-and-Decrement</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#the-comma-operator" id="toc-the-comma-operator"><span class="toc-section-number">3.2.4</span> The Comma Operator</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#conditional-operators" id="toc-conditional-operators"><span class="toc-section-number">3.2.5</span> Conditional Operators</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#boolean-operators" id="toc-boolean-operators"><span class="toc-section-number">3.2.6</span> Boolean Operators</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#sizeof-operator" id="toc-sizeof-operator"><span class="toc-section-number">3.2.7</span> The <code>sizeof</code> Operator</a></li>
</ul></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#flow-control" id="toc-flow-control"><span class="toc-section-number">3.3</span> Flow Control</a>
<ul>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#ifstat" id="toc-ifstat"><span class="toc-section-number">3.3.1</span> The <code>if</code>-<code>else</code> statement</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#whilestat" id="toc-whilestat"><span class="toc-section-number">3.3.2</span> The <code>while</code> statement</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#dowhilestat" id="toc-dowhilestat"><span class="toc-section-number">3.3.3</span> The <code>do-while</code> statement</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#forstat" id="toc-forstat"><span class="toc-section-number">3.3.4</span> The <code>for</code> statement</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#switch-statement" id="toc-switch-statement"><span class="toc-section-number">3.3.5</span> The <code>switch</code> Statement</a></li>
</ul></li>
</ul></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#functions" id="toc-functions"><span class="toc-section-number">4</span> Functions</a>
<ul>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#passvalue" id="toc-passvalue"><span class="toc-section-number">4.1</span> Passing by Value</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#prototypes" id="toc-prototypes"><span class="toc-section-number">4.2</span> Function Prototypes</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#empty-parameter-lists" id="toc-empty-parameter-lists"><span class="toc-section-number">4.3</span> Empty Parameter Lists</a></li>
</ul></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#pointers" id="toc-pointers"><span class="toc-section-number">5</span> Pointers—Cower In Fear!</a>
<ul>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#ptmem" id="toc-ptmem"><span class="toc-section-number">5.1</span> Memory and Variables</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#pttypes" id="toc-pttypes"><span class="toc-section-number">5.2</span> Pointer Types</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#deref" id="toc-deref"><span class="toc-section-number">5.3</span> Dereferencing</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#ptpass" id="toc-ptpass"><span class="toc-section-number">5.4</span> Passing Pointers as Arguments</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#the-null-pointer" id="toc-the-null-pointer"><span class="toc-section-number">5.5</span> The <code>NULL</code> Pointer</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#a-note-on-declaring-pointers" id="toc-a-note-on-declaring-pointers"><span class="toc-section-number">5.6</span> A Note on Declaring Pointers</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#sizeof-and-pointers" id="toc-sizeof-and-pointers"><span class="toc-section-number">5.7</span> <code>sizeof</code> and Pointers</a></li>
</ul></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#arrays" id="toc-arrays"><span class="toc-section-number">6</span> Arrays</a>
<ul>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#easy-example" id="toc-easy-example"><span class="toc-section-number">6.1</span> Easy Example</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#getting-the-length-of-an-array" id="toc-getting-the-length-of-an-array"><span class="toc-section-number">6.2</span> Getting the Length of an Array</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#array-initializers" id="toc-array-initializers"><span class="toc-section-number">6.3</span> Array Initializers</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#out-of-bounds" id="toc-out-of-bounds"><span class="toc-section-number">6.4</span> Out of Bounds!</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#multidimensional-arrays" id="toc-multidimensional-arrays"><span class="toc-section-number">6.5</span> Multidimensional Arrays</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#arrays-and-pointers" id="toc-arrays-and-pointers"><span class="toc-section-number">6.6</span> Arrays and Pointers</a>
<ul>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#getting-a-pointer-to-an-array" id="toc-getting-a-pointer-to-an-array"><span class="toc-section-number">6.6.1</span> Getting a Pointer to an Array</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#passing1darrays" id="toc-passing1darrays"><span class="toc-section-number">6.6.2</span> Passing Single Dimensional Arrays to Functions</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#changing-arrays-in-functions" id="toc-changing-arrays-in-functions"><span class="toc-section-number">6.6.3</span> Changing Arrays in Functions</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#passing-multidimensional-arrays-to-functions" id="toc-passing-multidimensional-arrays-to-functions"><span class="toc-section-number">6.6.4</span> Passing Multidimensional Arrays to Functions</a></li>
</ul></li>
</ul></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#strings" id="toc-strings"><span class="toc-section-number">7</span> Strings</a>
<ul>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#string-literals" id="toc-string-literals"><span class="toc-section-number">7.1</span> String Literals</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#string-variables" id="toc-string-variables"><span class="toc-section-number">7.2</span> String Variables</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#string-variables-as-arrays" id="toc-string-variables-as-arrays"><span class="toc-section-number">7.3</span> String Variables as Arrays</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#string-initializers" id="toc-string-initializers"><span class="toc-section-number">7.4</span> String Initializers</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#getting-string-length" id="toc-getting-string-length"><span class="toc-section-number">7.5</span> Getting String Length</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#string-termination" id="toc-string-termination"><span class="toc-section-number">7.6</span> String Termination</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#copying-a-string" id="toc-copying-a-string"><span class="toc-section-number">7.7</span> Copying a String</a></li>
</ul></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#structs" id="toc-structs"><span class="toc-section-number">8</span> Structs</a>
<ul>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#declaring-a-struct" id="toc-declaring-a-struct"><span class="toc-section-number">8.1</span> Declaring a Struct</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#struct-initializers" id="toc-struct-initializers"><span class="toc-section-number">8.2</span> Struct Initializers</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#passing-structs-to-functions" id="toc-passing-structs-to-functions"><span class="toc-section-number">8.3</span> Passing Structs to Functions</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#the-arrow-operator" id="toc-the-arrow-operator"><span class="toc-section-number">8.4</span> The Arrow Operator</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#copying-and-returning-structs" id="toc-copying-and-returning-structs"><span class="toc-section-number">8.5</span> Copying and Returning <code>struct</code>s</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#comparing-structs" id="toc-comparing-structs"><span class="toc-section-number">8.6</span> Comparing <code>struct</code>s</a></li>
</ul></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#file-inputoutput" id="toc-file-inputoutput"><span class="toc-section-number">9</span> File Input/Output</a>
<ul>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#the-file-data-type" id="toc-the-file-data-type"><span class="toc-section-number">9.1</span> The <code>FILE*</code> Data Type</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#reading-text-files" id="toc-reading-text-files"><span class="toc-section-number">9.2</span> Reading Text Files</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#end-of-file-eof" id="toc-end-of-file-eof"><span class="toc-section-number">9.3</span> End of File: <code>EOF</code></a>
<ul>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#reading-a-line-at-a-time" id="toc-reading-a-line-at-a-time"><span class="toc-section-number">9.3.1</span> Reading a Line at a Time</a></li>
</ul></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#formatted-input" id="toc-formatted-input"><span class="toc-section-number">9.4</span> Formatted Input</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#writing-text-files" id="toc-writing-text-files"><span class="toc-section-number">9.5</span> Writing Text Files</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#binary-file-io" id="toc-binary-file-io"><span class="toc-section-number">9.6</span> Binary File I/O</a>
<ul>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#struct-and-number-caveats" id="toc-struct-and-number-caveats"><span class="toc-section-number">9.6.1</span> <code>struct</code> and Number Caveats</a></li>
</ul></li>
</ul></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#typedef-making-new-types" id="toc-typedef-making-new-types"><span class="toc-section-number">10</span> <code>typedef</code>: Making New Types</a>
<ul>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#typedef-in-theory" id="toc-typedef-in-theory"><span class="toc-section-number">10.1</span> <code>typedef</code> in Theory</a>
<ul>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#scoping" id="toc-scoping"><span class="toc-section-number">10.1.1</span> Scoping</a></li>
</ul></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#typedef-in-practice" id="toc-typedef-in-practice"><span class="toc-section-number">10.2</span> <code>typedef</code> in Practice</a>
<ul>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#typedef-struct" id="toc-typedef-struct"><span class="toc-section-number">10.2.1</span> <code>typedef</code> and <code>struct</code>s</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#typedef-and-other-types" id="toc-typedef-and-other-types"><span class="toc-section-number">10.2.2</span> <code>typedef</code> and Other Types</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#typedef-and-pointers" id="toc-typedef-and-pointers"><span class="toc-section-number">10.2.3</span> <code>typedef</code> and Pointers</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#typedef-and-capitalization" id="toc-typedef-and-capitalization"><span class="toc-section-number">10.2.4</span> <code>typedef</code> and Capitalization</a></li>
</ul></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#arrays-and-typedef" id="toc-arrays-and-typedef"><span class="toc-section-number">10.3</span> Arrays and <code>typedef</code></a></li>
</ul></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#pointers2" id="toc-pointers2"><span class="toc-section-number">11</span> Pointers II: Arithmetic</a>
<ul>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#pointer-arithmetic" id="toc-pointer-arithmetic"><span class="toc-section-number">11.1</span> Pointer Arithmetic</a>
<ul>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#adding-to-pointers" id="toc-adding-to-pointers"><span class="toc-section-number">11.1.1</span> Adding to Pointers</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#changing-pointers" id="toc-changing-pointers"><span class="toc-section-number">11.1.2</span> Changing Pointers</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#subtracting-pointers" id="toc-subtracting-pointers"><span class="toc-section-number">11.1.3</span> Subtracting Pointers</a></li>
</ul></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#arraypointerequiv" id="toc-arraypointerequiv"><span class="toc-section-number">11.2</span> Array/Pointer Equivalence</a>
<ul>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#arraypointer-equivalence-in-function-calls" id="toc-arraypointer-equivalence-in-function-calls"><span class="toc-section-number">11.2.1</span> Array/Pointer Equivalence in Function Calls</a></li>
</ul></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#void-pointers" id="toc-void-pointers"><span class="toc-section-number">11.3</span> <code>void</code> Pointers</a></li>
</ul></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#manual-memory-allocation" id="toc-manual-memory-allocation"><span class="toc-section-number">12</span> Manual Memory Allocation</a>
<ul>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#allocating-and-deallocating-malloc-and-free" id="toc-allocating-and-deallocating-malloc-and-free"><span class="toc-section-number">12.1</span> Allocating and Deallocating, <code>malloc()</code> and <code>free()</code></a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#error-checking" id="toc-error-checking"><span class="toc-section-number">12.2</span> Error Checking</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#allocating-space-for-an-array" id="toc-allocating-space-for-an-array"><span class="toc-section-number">12.3</span> Allocating Space for an Array</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#an-alternative-calloc" id="toc-an-alternative-calloc"><span class="toc-section-number">12.4</span> An Alternative: <code>calloc()</code></a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#changing-allocated-size-with-realloc" id="toc-changing-allocated-size-with-realloc"><span class="toc-section-number">12.5</span> Changing Allocated Size with <code>realloc()</code></a>
<ul>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#reading-in-lines-of-arbitrary-length" id="toc-reading-in-lines-of-arbitrary-length"><span class="toc-section-number">12.5.1</span> Reading in Lines of Arbitrary Length</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#realloc-with-null" id="toc-realloc-with-null"><span class="toc-section-number">12.5.2</span> <code>realloc()</code> with <code>NULL</code></a></li>
</ul></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#aligned-allocations" id="toc-aligned-allocations"><span class="toc-section-number">12.6</span> Aligned Allocations</a></li>
</ul></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#scope" id="toc-scope"><span class="toc-section-number">13</span> Scope</a>
<ul>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#block-scope" id="toc-block-scope"><span class="toc-section-number">13.1</span> Block Scope</a>
<ul>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#where-to-define-variables" id="toc-where-to-define-variables"><span class="toc-section-number">13.1.1</span> Where To Define Variables</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#variable-hiding" id="toc-variable-hiding"><span class="toc-section-number">13.1.2</span> Variable Hiding</a></li>
</ul></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#file-scope" id="toc-file-scope"><span class="toc-section-number">13.2</span> File Scope</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#for-loop-scope" id="toc-for-loop-scope"><span class="toc-section-number">13.3</span> <code>for</code>-loop Scope</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#a-note-on-function-scope" id="toc-a-note-on-function-scope"><span class="toc-section-number">13.4</span> A Note on Function Scope</a></li>
</ul></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#types-ii-way-more-types" id="toc-types-ii-way-more-types"><span class="toc-section-number">14</span> Types II: Way More Types!</a>
<ul>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#signed-and-unsigned-integers" id="toc-signed-and-unsigned-integers"><span class="toc-section-number">14.1</span> Signed and Unsigned Integers</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#character-types" id="toc-character-types"><span class="toc-section-number">14.2</span> Character Types</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#more-integer-types-short-long-long-long" id="toc-more-integer-types-short-long-long-long"><span class="toc-section-number">14.3</span> More Integer Types: <code>short</code>, <code>long</code>, <code>long long</code></a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#more-float-double-and-long-double" id="toc-more-float-double-and-long-double"><span class="toc-section-number">14.4</span> More Float: <code>double</code> and <code>long double</code></a>
<ul>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#how-many-decimal-digits" id="toc-how-many-decimal-digits"><span class="toc-section-number">14.4.1</span> How Many Decimal Digits?</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#converting-to-decimal-and-back" id="toc-converting-to-decimal-and-back"><span class="toc-section-number">14.4.2</span> Converting to Decimal and Back</a></li>
</ul></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#constant-numeric-types" id="toc-constant-numeric-types"><span class="toc-section-number">14.5</span> Constant Numeric Types</a>
<ul>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#hexadecimal-and-octal" id="toc-hexadecimal-and-octal"><span class="toc-section-number">14.5.1</span> Hexadecimal and Octal</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#integer-constants" id="toc-integer-constants"><span class="toc-section-number">14.5.2</span> Integer Constants</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#floating-point-constants" id="toc-floating-point-constants"><span class="toc-section-number">14.5.3</span> Floating Point Constants</a></li>
</ul></li>
</ul></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#types-iii-conversions" id="toc-types-iii-conversions"><span class="toc-section-number">15</span> Types III: Conversions</a>
<ul>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#string-conversions" id="toc-string-conversions"><span class="toc-section-number">15.1</span> String Conversions</a>
<ul>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#numeric-value-to-string" id="toc-numeric-value-to-string"><span class="toc-section-number">15.1.1</span> Numeric Value to String</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#string-to-numeric-value" id="toc-string-to-numeric-value"><span class="toc-section-number">15.1.2</span> String to Numeric Value</a></li>
</ul></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#char-conversions" id="toc-char-conversions"><span class="toc-section-number">15.2</span> <code>char</code> Conversions</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#numeric-conversions" id="toc-numeric-conversions"><span class="toc-section-number">15.3</span> Numeric Conversions</a>
<ul>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#boolean" id="toc-boolean"><span class="toc-section-number">15.3.1</span> Boolean</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#integer-to-integer-conversions" id="toc-integer-to-integer-conversions"><span class="toc-section-number">15.3.2</span> Integer to Integer Conversions</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#integer-and-floating-point-conversions" id="toc-integer-and-floating-point-conversions"><span class="toc-section-number">15.3.3</span> Integer and Floating Point Conversions</a></li>
</ul></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#implicit-conversions" id="toc-implicit-conversions"><span class="toc-section-number">15.4</span> Implicit Conversions</a>
<ul>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#integer-promotions" id="toc-integer-promotions"><span class="toc-section-number">15.4.1</span> The Integer Promotions</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#usual-arithmetic-conversions" id="toc-usual-arithmetic-conversions"><span class="toc-section-number">15.4.2</span> The Usual Arithmetic Conversions</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#void" id="toc-void"><span class="toc-section-number">15.4.3</span> <code>void*</code></a></li>
</ul></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#explicit-conversions" id="toc-explicit-conversions"><span class="toc-section-number">15.5</span> Explicit Conversions</a>
<ul>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#casting" id="toc-casting"><span class="toc-section-number">15.5.1</span> Casting</a></li>
</ul></li>
</ul></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#types-iv-qualifiers-and-specifiers" id="toc-types-iv-qualifiers-and-specifiers"><span class="toc-section-number">16</span> Types IV: Qualifiers and Specifiers</a>
<ul>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#type-qualifiers" id="toc-type-qualifiers"><span class="toc-section-number">16.1</span> Type Qualifiers</a>
<ul>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#const" id="toc-const"><span class="toc-section-number">16.1.1</span> <code>const</code></a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#restrict" id="toc-restrict"><span class="toc-section-number">16.1.2</span> <code>restrict</code></a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#volatile" id="toc-volatile"><span class="toc-section-number">16.1.3</span> <code>volatile</code></a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#atomic" id="toc-atomic"><span class="toc-section-number">16.1.4</span> <code>_Atomic</code></a></li>
</ul></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#storage-class-specifiers" id="toc-storage-class-specifiers"><span class="toc-section-number">16.2</span> Storage-Class Specifiers</a>
<ul>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#auto" id="toc-auto"><span class="toc-section-number">16.2.1</span> <code>auto</code></a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#static" id="toc-static"><span class="toc-section-number">16.2.2</span> <code>static</code></a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#extern" id="toc-extern"><span class="toc-section-number">16.2.3</span> <code>extern</code></a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#register" id="toc-register"><span class="toc-section-number">16.2.4</span> <code>register</code></a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#thread_local" id="toc-thread_local"><span class="toc-section-number">16.2.5</span> <code>_Thread_local</code></a></li>
</ul></li>
</ul></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#multifile-projects" id="toc-multifile-projects"><span class="toc-section-number">17</span> Multifile Projects</a>
<ul>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#includes-func-protos" id="toc-includes-func-protos"><span class="toc-section-number">17.1</span> Includes and Function Prototypes</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#dealing-with-repeated-includes" id="toc-dealing-with-repeated-includes"><span class="toc-section-number">17.2</span> Dealing with Repeated Includes</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#static-and-extern" id="toc-static-and-extern"><span class="toc-section-number">17.3</span> <code>static</code> and <code>extern</code></a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#compiling-with-object-files" id="toc-compiling-with-object-files"><span class="toc-section-number">17.4</span> Compiling with Object Files</a></li>
</ul></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#the-outside-environment" id="toc-the-outside-environment"><span class="toc-section-number">18</span> The Outside Environment</a>
<ul>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#command-line-arguments" id="toc-command-line-arguments"><span class="toc-section-number">18.1</span> Command Line Arguments</a>
<ul>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#the-last-argv-is-null" id="toc-the-last-argv-is-null"><span class="toc-section-number">18.1.1</span> The Last <code>argv</code> is <code>NULL</code></a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#the-alternate-char-argv" id="toc-the-alternate-char-argv"><span class="toc-section-number">18.1.2</span> The Alternate: <code>char **argv</code></a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#fun-facts" id="toc-fun-facts"><span class="toc-section-number">18.1.3</span> Fun Facts</a></li>
</ul></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#exit-status" id="toc-exit-status"><span class="toc-section-number">18.2</span> Exit Status</a>
<ul>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#other-exit-status-values" id="toc-other-exit-status-values"><span class="toc-section-number">18.2.1</span> Other Exit Status Values</a></li>
</ul></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#env-var" id="toc-env-var"><span class="toc-section-number">18.3</span> Environment Variables</a>
<ul>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#setting-environment-variables" id="toc-setting-environment-variables"><span class="toc-section-number">18.3.1</span> Setting Environment Variables</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#unix-like-alternative-environment-variables" id="toc-unix-like-alternative-environment-variables"><span class="toc-section-number">18.3.2</span> Unix-like Alternative Environment Variables</a></li>
</ul></li>
</ul></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#the-c-preprocessor" id="toc-the-c-preprocessor"><span class="toc-section-number">19</span> The C Preprocessor</a>
<ul>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#include" id="toc-include"><span class="toc-section-number">19.1</span> <code>#include</code></a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#simple-macros" id="toc-simple-macros"><span class="toc-section-number">19.2</span> Simple Macros</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#conditional-compilation" id="toc-conditional-compilation"><span class="toc-section-number">19.3</span> Conditional Compilation</a>
<ul>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#if-defined-ifdef-and-endif" id="toc-if-defined-ifdef-and-endif"><span class="toc-section-number">19.3.1</span> If Defined, <code>#ifdef</code> and <code>#endif</code></a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#if-not-defined-ifndef" id="toc-if-not-defined-ifndef"><span class="toc-section-number">19.3.2</span> If Not Defined, <code>#ifndef</code></a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#else" id="toc-else"><span class="toc-section-number">19.3.3</span> <code>#else</code></a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#general-conditional-if-elif" id="toc-general-conditional-if-elif"><span class="toc-section-number">19.3.4</span> General Conditional: <code>#if</code>, <code>#elif</code></a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#losing-a-macro-undef" id="toc-losing-a-macro-undef"><span class="toc-section-number">19.3.5</span> Losing a Macro: <code>#undef</code></a></li>
</ul></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#built-in-macros" id="toc-built-in-macros"><span class="toc-section-number">19.4</span> Built-in Macros</a>
<ul>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#mandatory-macros" id="toc-mandatory-macros"><span class="toc-section-number">19.4.1</span> Mandatory Macros</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#optional-macros" id="toc-optional-macros"><span class="toc-section-number">19.4.2</span> Optional Macros</a></li>
</ul></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#macros-with-arguments" id="toc-macros-with-arguments"><span class="toc-section-number">19.5</span> Macros with Arguments</a>
<ul>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#macros-with-one-argument" id="toc-macros-with-one-argument"><span class="toc-section-number">19.5.1</span> Macros with One Argument</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#macros-with-more-than-one-argument" id="toc-macros-with-more-than-one-argument"><span class="toc-section-number">19.5.2</span> Macros with More than One Argument</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#macros-with-variable-arguments" id="toc-macros-with-variable-arguments"><span class="toc-section-number">19.5.3</span> Macros with Variable Arguments</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#stringification" id="toc-stringification"><span class="toc-section-number">19.5.4</span> Stringification</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#concatenation" id="toc-concatenation"><span class="toc-section-number">19.5.5</span> Concatenation</a></li>
</ul></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#multiline-macros" id="toc-multiline-macros"><span class="toc-section-number">19.6</span> Multiline Macros</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#my-assert" id="toc-my-assert"><span class="toc-section-number">19.7</span> Example: An Assert Macro</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#the-error-directive" id="toc-the-error-directive"><span class="toc-section-number">19.8</span> The <code>#error</code> Directive</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#pragma" id="toc-pragma"><span class="toc-section-number">19.9</span> The <code>#pragma</code> Directive</a>
<ul>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#non-standard-pragmas" id="toc-non-standard-pragmas"><span class="toc-section-number">19.9.1</span> Non-Standard Pragmas</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#standard-pragmas" id="toc-standard-pragmas"><span class="toc-section-number">19.9.2</span> Standard Pragmas</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#pragma-operator" id="toc-pragma-operator"><span class="toc-section-number">19.9.3</span> <code>_Pragma</code> Operator</a></li>
</ul></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#the-line-directive" id="toc-the-line-directive"><span class="toc-section-number">19.10</span> The <code>#line</code> Directive</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#the-null-directive" id="toc-the-null-directive"><span class="toc-section-number">19.11</span> The Null Directive</a></li>
</ul></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#structs-ii-more-fun-with-structs" id="toc-structs-ii-more-fun-with-structs"><span class="toc-section-number">20</span> <code>struct</code>s II: More Fun with <code>struct</code>s</a>
<ul>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#initializers-of-nested-structs-and-arrays" id="toc-initializers-of-nested-structs-and-arrays"><span class="toc-section-number">20.1</span> Initializers of Nested <code>struct</code>s and Arrays</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#anonymous-structs" id="toc-anonymous-structs"><span class="toc-section-number">20.2</span> Anonymous <code>struct</code>s</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#self-referential-structs" id="toc-self-referential-structs"><span class="toc-section-number">20.3</span> Self-Referential <code>struct</code>s</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#flexible-array-members" id="toc-flexible-array-members"><span class="toc-section-number">20.4</span> Flexible Array Members</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#struct-padding-bytes" id="toc-struct-padding-bytes"><span class="toc-section-number">20.5</span> Padding Bytes</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#offsetof" id="toc-offsetof"><span class="toc-section-number">20.6</span> <code>offsetof</code></a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#fake-oop" id="toc-fake-oop"><span class="toc-section-number">20.7</span> Fake OOP</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#bit-fields" id="toc-bit-fields"><span class="toc-section-number">20.8</span> Bit-Fields</a>
<ul>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#non-adjacent-bit-fields" id="toc-non-adjacent-bit-fields"><span class="toc-section-number">20.8.1</span> Non-Adjacent Bit-Fields</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#signed-or-unsigned-ints" id="toc-signed-or-unsigned-ints"><span class="toc-section-number">20.8.2</span> Signed or Unsigned <code>int</code>s</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#unnamed-bit-fields" id="toc-unnamed-bit-fields"><span class="toc-section-number">20.8.3</span> Unnamed Bit-Fields</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#zero-width-unnamed-bit-fields" id="toc-zero-width-unnamed-bit-fields"><span class="toc-section-number">20.8.4</span> Zero-Width Unnamed Bit-Fields</a></li>
</ul></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#unions" id="toc-unions"><span class="toc-section-number">20.9</span> Unions</a>
<ul>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#union-type-punning" id="toc-union-type-punning"><span class="toc-section-number">20.9.1</span> Unions and Type Punning</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#pointers-to-unions" id="toc-pointers-to-unions"><span class="toc-section-number">20.9.2</span> Pointers to <code>union</code>s</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#common-initial-sequences-in-unions" id="toc-common-initial-sequences-in-unions"><span class="toc-section-number">20.9.3</span> Common Initial Sequences in Unions</a></li>
</ul></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#unions-and-unnamed-structs" id="toc-unions-and-unnamed-structs"><span class="toc-section-number">20.10</span> Unions and Unnamed Structs</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#passing-and-returning-structs-and-unions" id="toc-passing-and-returning-structs-and-unions"><span class="toc-section-number">20.11</span> Passing and Returning <code>struct</code>s and <code>union</code>s</a></li>
</ul></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#characters-and-strings-ii" id="toc-characters-and-strings-ii"><span class="toc-section-number">21</span> Characters and Strings II</a>
<ul>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#escape-sequences" id="toc-escape-sequences"><span class="toc-section-number">21.1</span> Escape Sequences</a>
<ul>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#frequently-used-escapes" id="toc-frequently-used-escapes"><span class="toc-section-number">21.1.1</span> Frequently-used Escapes</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#rarely-used-escapes" id="toc-rarely-used-escapes"><span class="toc-section-number">21.1.2</span> Rarely-used Escapes</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#numeric-escapes" id="toc-numeric-escapes"><span class="toc-section-number">21.1.3</span> Numeric Escapes</a></li>
</ul></li>
</ul></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#enumerated-types-enum" id="toc-enumerated-types-enum"><span class="toc-section-number">22</span> Enumerated Types: <code>enum</code></a>
<ul>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#behavior-of-enum" id="toc-behavior-of-enum"><span class="toc-section-number">22.1</span> Behavior of <code>enum</code></a>
<ul>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#numbering" id="toc-numbering"><span class="toc-section-number">22.1.1</span> Numbering</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#trailing-commas" id="toc-trailing-commas"><span class="toc-section-number">22.1.2</span> Trailing Commas</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#scope-1" id="toc-scope-1"><span class="toc-section-number">22.1.3</span> Scope</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#style" id="toc-style"><span class="toc-section-number">22.1.4</span> Style</a></li>
</ul></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#your-enum-is-a-type" id="toc-your-enum-is-a-type"><span class="toc-section-number">22.2</span> Your <code>enum</code> is a Type</a></li>
</ul></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#pointers-iii-pointers-to-pointers-and-more" id="toc-pointers-iii-pointers-to-pointers-and-more"><span class="toc-section-number">23</span> Pointers III: Pointers to Pointers and More</a>
<ul>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#pointers-to-pointers" id="toc-pointers-to-pointers"><span class="toc-section-number">23.1</span> Pointers to Pointers</a>
<ul>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#pointer-pointers-and-const" id="toc-pointer-pointers-and-const"><span class="toc-section-number">23.1.1</span> Pointer Pointers and <code>const</code></a></li>
</ul></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#multibyte-values" id="toc-multibyte-values"><span class="toc-section-number">23.2</span> Multibyte Values</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#the-null-pointer-and-zero" id="toc-the-null-pointer-and-zero"><span class="toc-section-number">23.3</span> The <code>NULL</code> Pointer and Zero</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#pointers-as-integers" id="toc-pointers-as-integers"><span class="toc-section-number">23.4</span> Pointers as Integers</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#casting-pointers-to-other-pointers" id="toc-casting-pointers-to-other-pointers"><span class="toc-section-number">23.5</span> Casting Pointers to other Pointers</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#ptr_differences" id="toc-ptr_differences"><span class="toc-section-number">23.6</span> Pointer Differences</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#pointers-to-functions" id="toc-pointers-to-functions"><span class="toc-section-number">23.7</span> Pointers to Functions</a></li>
</ul></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#bitwise-operations" id="toc-bitwise-operations"><span class="toc-section-number">24</span> Bitwise Operations</a>
<ul>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#bitwise-and-or-xor-and-not" id="toc-bitwise-and-or-xor-and-not"><span class="toc-section-number">24.1</span> Bitwise AND, OR, XOR, and NOT</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#bitwise-shift" id="toc-bitwise-shift"><span class="toc-section-number">24.2</span> Bitwise Shift</a></li>
</ul></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#variadic-functions" id="toc-variadic-functions"><span class="toc-section-number">25</span> Variadic Functions</a>
<ul>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#ellipses-in-function-signatures" id="toc-ellipses-in-function-signatures"><span class="toc-section-number">25.1</span> Ellipses in Function Signatures</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#getting-the-extra-arguments" id="toc-getting-the-extra-arguments"><span class="toc-section-number">25.2</span> Getting the Extra Arguments</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#va_list-functionality" id="toc-va_list-functionality"><span class="toc-section-number">25.3</span> <code>va_list</code> Functionality</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#library-functions-that-use-va_lists" id="toc-library-functions-that-use-va_lists"><span class="toc-section-number">25.4</span> Library Functions That Use <code>va_list</code>s</a></li>
</ul></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#locale-and-internationalization" id="toc-locale-and-internationalization"><span class="toc-section-number">26</span> Locale and Internationalization</a>
<ul>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#setting-the-localization-quick-and-dirty" id="toc-setting-the-localization-quick-and-dirty"><span class="toc-section-number">26.1</span> Setting the Localization, Quick and Dirty</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#getting-the-monetary-locale-settings" id="toc-getting-the-monetary-locale-settings"><span class="toc-section-number">26.2</span> Getting the Monetary Locale Settings</a>
<ul>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#monetary-digit-grouping" id="toc-monetary-digit-grouping"><span class="toc-section-number">26.2.1</span> Monetary Digit Grouping</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#separators-and-sign-position" id="toc-separators-and-sign-position"><span class="toc-section-number">26.2.2</span> Separators and Sign Position</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#example-values" id="toc-example-values"><span class="toc-section-number">26.2.3</span> Example Values</a></li>
</ul></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#localization-specifics" id="toc-localization-specifics"><span class="toc-section-number">26.3</span> Localization Specifics</a></li>
</ul></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#unicode-wide-characters-and-all-that" id="toc-unicode-wide-characters-and-all-that"><span class="toc-section-number">27</span> Unicode, Wide Characters, and All That</a>
<ul>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#what-is-unicode" id="toc-what-is-unicode"><span class="toc-section-number">27.1</span> What is Unicode?</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#code-points" id="toc-code-points"><span class="toc-section-number">27.2</span> Code Points</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#encoding" id="toc-encoding"><span class="toc-section-number">27.3</span> Encoding</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#src-exec-charset" id="toc-src-exec-charset"><span class="toc-section-number">27.4</span> Source and Execution Character Sets</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#unicode-in-c" id="toc-unicode-in-c"><span class="toc-section-number">27.5</span> Unicode in C</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#utf8-quick" id="toc-utf8-quick"><span class="toc-section-number">27.6</span> A Quick Note on UTF-8 Before We Swerve into the Weeds</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#different-character-types" id="toc-different-character-types"><span class="toc-section-number">27.7</span> Different Character Types</a>
<ul>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#multibyte-characters" id="toc-multibyte-characters"><span class="toc-section-number">27.7.1</span> Multibyte Characters</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#wide-characters" id="toc-wide-characters"><span class="toc-section-number">27.7.2</span> Wide Characters</a></li>
</ul></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#using-wide-characters-and-wchar_t" id="toc-using-wide-characters-and-wchar_t"><span class="toc-section-number">27.8</span> Using Wide Characters and <code>wchar_t</code></a>
<ul>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#multibyte-to-wchar_t-conversions" id="toc-multibyte-to-wchar_t-conversions"><span class="toc-section-number">27.8.1</span> Multibyte to <code>wchar_t</code> Conversions</a></li>
</ul></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#wide-character-functionality" id="toc-wide-character-functionality"><span class="toc-section-number">27.9</span> Wide Character Functionality</a>
<ul>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#wint_t" id="toc-wint_t"><span class="toc-section-number">27.9.1</span> <code>wint_t</code></a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#io-stream-orientation" id="toc-io-stream-orientation"><span class="toc-section-number">27.9.2</span> I/O Stream Orientation</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#io-functions" id="toc-io-functions"><span class="toc-section-number">27.9.3</span> I/O Functions</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#type-conversion-functions" id="toc-type-conversion-functions"><span class="toc-section-number">27.9.4</span> Type Conversion Functions</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#string-and-memory-copying-functions" id="toc-string-and-memory-copying-functions"><span class="toc-section-number">27.9.5</span> String and Memory Copying Functions</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#string-and-memory-comparing-functions" id="toc-string-and-memory-comparing-functions"><span class="toc-section-number">27.9.6</span> String and Memory Comparing Functions</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#string-searching-functions" id="toc-string-searching-functions"><span class="toc-section-number">27.9.7</span> String Searching Functions</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#lengthmiscellaneous-functions" id="toc-lengthmiscellaneous-functions"><span class="toc-section-number">27.9.8</span> Length/Miscellaneous Functions</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#character-classification-functions" id="toc-character-classification-functions"><span class="toc-section-number">27.9.9</span> Character Classification Functions</a></li>
</ul></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#parse-state-restartable-functions" id="toc-parse-state-restartable-functions"><span class="toc-section-number">27.10</span> Parse State, Restartable Functions</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#unicode-encodings-and-c" id="toc-unicode-encodings-and-c"><span class="toc-section-number">27.11</span> Unicode Encodings and C</a>
<ul>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#utf-8" id="toc-utf-8"><span class="toc-section-number">27.11.1</span> UTF-8</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#utf-16-utf-32-char16_t-and-char32_t" id="toc-utf-16-utf-32-char16_t-and-char32_t"><span class="toc-section-number">27.11.2</span> UTF-16, UTF-32, <code>char16_t</code>, and <code>char32_t</code></a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#multibyte-conversions" id="toc-multibyte-conversions"><span class="toc-section-number">27.11.3</span> Multibyte Conversions</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#utf-3rd-party" id="toc-utf-3rd-party"><span class="toc-section-number">27.11.4</span> Third-Party Libraries</a></li>
</ul></li>
</ul></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#exiting-a-program" id="toc-exiting-a-program"><span class="toc-section-number">28</span> Exiting a Program</a>
<ul>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#normal-exits" id="toc-normal-exits"><span class="toc-section-number">28.1</span> Normal Exits</a>
<ul>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#returning-from-main" id="toc-returning-from-main"><span class="toc-section-number">28.1.1</span> Returning From <code>main()</code></a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#exit" id="toc-exit"><span class="toc-section-number">28.1.2</span> <code>exit()</code></a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#setting-up-exit-handlers-with-atexit" id="toc-setting-up-exit-handlers-with-atexit"><span class="toc-section-number">28.1.3</span> Setting Up Exit Handlers with <code>atexit()</code></a></li>
</ul></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#quicker-exits-with-quick_exit" id="toc-quicker-exits-with-quick_exit"><span class="toc-section-number">28.2</span> Quicker Exits with <code>quick_exit()</code></a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#nuke-it-from-orbit-_exit" id="toc-nuke-it-from-orbit-_exit"><span class="toc-section-number">28.3</span> Nuke it from Orbit: <code>_Exit()</code></a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#exiting-sometimes-assert" id="toc-exiting-sometimes-assert"><span class="toc-section-number">28.4</span> Exiting Sometimes: <code>assert()</code></a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#abnormal-exit-abort" id="toc-abnormal-exit-abort"><span class="toc-section-number">28.5</span> Abnormal Exit: <code>abort()</code></a></li>
</ul></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#signal-handling" id="toc-signal-handling"><span class="toc-section-number">29</span> Signal Handling</a>
<ul>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#what-are-signals" id="toc-what-are-signals"><span class="toc-section-number">29.1</span> What Are Signals?</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#handling-signals-with-signal" id="toc-handling-signals-with-signal"><span class="toc-section-number">29.2</span> Handling Signals with <code>signal()</code></a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#writing-signal-handlers" id="toc-writing-signal-handlers"><span class="toc-section-number">29.3</span> Writing Signal Handlers</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#what-can-we-actually-do" id="toc-what-can-we-actually-do"><span class="toc-section-number">29.4</span> What Can We Actually Do?</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#friends-dont-let-friends-signal" id="toc-friends-dont-let-friends-signal"><span class="toc-section-number">29.5</span> Friends Don’t Let Friends <code>signal()</code></a></li>
</ul></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#variable-length-arrays-vlas" id="toc-variable-length-arrays-vlas"><span class="toc-section-number">30</span> Variable-Length Arrays (VLAs)</a>
<ul>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#the-basics" id="toc-the-basics"><span class="toc-section-number">30.1</span> The Basics</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#sizeof-and-vlas" id="toc-sizeof-and-vlas"><span class="toc-section-number">30.2</span> <code>sizeof</code> and VLAs</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#multidimensional-vlas" id="toc-multidimensional-vlas"><span class="toc-section-number">30.3</span> Multidimensional VLAs</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#passing-one-dimensional-vlas-to-functions" id="toc-passing-one-dimensional-vlas-to-functions"><span class="toc-section-number">30.4</span> Passing One-Dimensional VLAs to Functions</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#passing-multi-dimensional-vlas-to-functions" id="toc-passing-multi-dimensional-vlas-to-functions"><span class="toc-section-number">30.5</span> Passing Multi-Dimensional VLAs to Functions</a>
<ul>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#partial-multidimensional-vlas" id="toc-partial-multidimensional-vlas"><span class="toc-section-number">30.5.1</span> Partial Multidimensional VLAs</a></li>
</ul></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#compatibility-with-regular-arrays" id="toc-compatibility-with-regular-arrays"><span class="toc-section-number">30.6</span> Compatibility with Regular Arrays</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#typedef-and-vlas" id="toc-typedef-and-vlas"><span class="toc-section-number">30.7</span> <code>typedef</code> and VLAs</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#jumping-pitfalls" id="toc-jumping-pitfalls"><span class="toc-section-number">30.8</span> Jumping Pitfalls</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#vla-general-issues" id="toc-vla-general-issues"><span class="toc-section-number">30.9</span> General Issues</a></li>
</ul></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#goto" id="toc-goto"><span class="toc-section-number">31</span> <code>goto</code></a>
<ul>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#a-simple-example" id="toc-a-simple-example"><span class="toc-section-number">31.1</span> A Simple Example</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#labeled-continue" id="toc-labeled-continue"><span class="toc-section-number">31.2</span> Labeled <code>continue</code></a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#bailing-out" id="toc-bailing-out"><span class="toc-section-number">31.3</span> Bailing Out</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#labeled-break" id="toc-labeled-break"><span class="toc-section-number">31.4</span> Labeled <code>break</code></a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#multi-level-cleanup" id="toc-multi-level-cleanup"><span class="toc-section-number">31.5</span> Multi-level Cleanup</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#tail-call-optimization" id="toc-tail-call-optimization"><span class="toc-section-number">31.6</span> Tail Call Optimization</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#restarting-interrupted-system-calls" id="toc-restarting-interrupted-system-calls"><span class="toc-section-number">31.7</span> Restarting Interrupted System Calls</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#goto-and-thread-preemption" id="toc-goto-and-thread-preemption"><span class="toc-section-number">31.8</span> <code>goto</code> and Thread Preemption</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#goto-and-variable-scope" id="toc-goto-and-variable-scope"><span class="toc-section-number">31.9</span> <code>goto</code> and Variable Scope</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#goto-and-variable-length-arrays" id="toc-goto-and-variable-length-arrays"><span class="toc-section-number">31.10</span> <code>goto</code> and Variable-Length Arrays</a></li>
</ul></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#types-part-v-compound-literals-and-generic-selections" id="toc-types-part-v-compound-literals-and-generic-selections"><span class="toc-section-number">32</span> Types Part V: Compound Literals and Generic Selections</a>
<ul>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#compound-literals" id="toc-compound-literals"><span class="toc-section-number">32.1</span> Compound Literals</a>
<ul>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#passing-unnamed-objects-to-functions" id="toc-passing-unnamed-objects-to-functions"><span class="toc-section-number">32.1.1</span> Passing Unnamed Objects to Functions</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#unnamed-structs" id="toc-unnamed-structs"><span class="toc-section-number">32.1.2</span> Unnamed <code>struct</code>s</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#pointers-to-unnamed-objects" id="toc-pointers-to-unnamed-objects"><span class="toc-section-number">32.1.3</span> Pointers to Unnamed Objects</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#unnamed-objects-and-scope" id="toc-unnamed-objects-and-scope"><span class="toc-section-number">32.1.4</span> Unnamed Objects and Scope</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#silly-unnamed-object-example" id="toc-silly-unnamed-object-example"><span class="toc-section-number">32.1.5</span> Silly Unnamed Object Example</a></li>
</ul></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#type-generics" id="toc-type-generics"><span class="toc-section-number">32.2</span> Generic Selections</a></li>
</ul></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#arrays-part-ii" id="toc-arrays-part-ii"><span class="toc-section-number">33</span> Arrays Part II</a>
<ul>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#type-qualifiers-for-arrays-in-parameter-lists" id="toc-type-qualifiers-for-arrays-in-parameter-lists"><span class="toc-section-number">33.1</span> Type Qualifiers for Arrays in Parameter Lists</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#static-for-arrays-in-parameter-lists" id="toc-static-for-arrays-in-parameter-lists"><span class="toc-section-number">33.2</span> <code>static</code> for Arrays in Parameter Lists</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#equivalent-initializers" id="toc-equivalent-initializers"><span class="toc-section-number">33.3</span> Equivalent Initializers</a></li>
</ul></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#setjmp-longjmp" id="toc-setjmp-longjmp"><span class="toc-section-number">34</span> Long Jumps with <code>setjmp</code>, <code>longjmp</code></a>
<ul>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#using-setjmp-and-longjmp" id="toc-using-setjmp-and-longjmp"><span class="toc-section-number">34.1</span> Using <code>setjmp</code> and <code>longjmp</code></a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#pitfalls" id="toc-pitfalls"><span class="toc-section-number">34.2</span> Pitfalls</a>
<ul>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#the-values-of-local-variables" id="toc-the-values-of-local-variables"><span class="toc-section-number">34.2.1</span> The Values of Local Variables</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#how-much-state-is-saved" id="toc-how-much-state-is-saved"><span class="toc-section-number">34.2.2</span> How Much State is Saved?</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#you-cant-name-anything-setjmp" id="toc-you-cant-name-anything-setjmp"><span class="toc-section-number">34.2.3</span> You Can’t Name Anything <code>setjmp</code></a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#you-cant-setjmp-in-a-larger-expression" id="toc-you-cant-setjmp-in-a-larger-expression"><span class="toc-section-number">34.2.4</span> You Can’t <code>setjmp()</code> in a Larger Expression</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#when-cant-you-longjmp" id="toc-when-cant-you-longjmp"><span class="toc-section-number">34.2.5</span> When Can’t You <code>longjmp()</code>?</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#you-cant-pass-0-to-longjmp" id="toc-you-cant-pass-0-to-longjmp"><span class="toc-section-number">34.2.6</span> You Can’t Pass <code>0</code> to <code>longjmp()</code></a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#longjmp-and-variable-length-arrays" id="toc-longjmp-and-variable-length-arrays"><span class="toc-section-number">34.2.7</span> <code>longjmp()</code> and Variable Length Arrays</a></li>
</ul></li>
</ul></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#incomplete-types" id="toc-incomplete-types"><span class="toc-section-number">35</span> Incomplete Types</a>
<ul>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#use-case-self-referential-structures" id="toc-use-case-self-referential-structures"><span class="toc-section-number">35.1</span> Use Case: Self-Referential Structures</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#incomplete-type-error-messages" id="toc-incomplete-type-error-messages"><span class="toc-section-number">35.2</span> Incomplete Type Error Messages</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#other-incomplete-types" id="toc-other-incomplete-types"><span class="toc-section-number">35.3</span> Other Incomplete Types</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#use-case-arrays-in-header-files" id="toc-use-case-arrays-in-header-files"><span class="toc-section-number">35.4</span> Use Case: Arrays in Header Files</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#completing-incomplete-types" id="toc-completing-incomplete-types"><span class="toc-section-number">35.5</span> Completing Incomplete Types</a></li>
</ul></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#complex-numbers" id="toc-complex-numbers"><span class="toc-section-number">36</span> Complex Numbers</a>
<ul>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#complex-types" id="toc-complex-types"><span class="toc-section-number">36.1</span> Complex Types</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#assigning-complex-numbers" id="toc-assigning-complex-numbers"><span class="toc-section-number">36.2</span> Assigning Complex Numbers</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#constructing-deconstructing-and-printing" id="toc-constructing-deconstructing-and-printing"><span class="toc-section-number">36.3</span> Constructing, Deconstructing, and Printing</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#complex-arithmetic-and-comparisons" id="toc-complex-arithmetic-and-comparisons"><span class="toc-section-number">36.4</span> Complex Arithmetic and Comparisons</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#complex-math" id="toc-complex-math"><span class="toc-section-number">36.5</span> Complex Math</a>
<ul>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#trigonometry-functions" id="toc-trigonometry-functions"><span class="toc-section-number">36.5.1</span> Trigonometry Functions</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#exponential-and-logarithmic-functions" id="toc-exponential-and-logarithmic-functions"><span class="toc-section-number">36.5.2</span> Exponential and Logarithmic Functions</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#power-and-absolute-value-functions" id="toc-power-and-absolute-value-functions"><span class="toc-section-number">36.5.3</span> Power and Absolute Value Functions</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#manipulation-functions" id="toc-manipulation-functions"><span class="toc-section-number">36.5.4</span> Manipulation Functions</a></li>
</ul></li>
</ul></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#fixed-width-integer-types" id="toc-fixed-width-integer-types"><span class="toc-section-number">37</span> Fixed Width Integer Types</a>
<ul>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#the-bit-sized-types" id="toc-the-bit-sized-types"><span class="toc-section-number">37.1</span> The Bit-Sized Types</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#maximum-integer-size-type" id="toc-maximum-integer-size-type"><span class="toc-section-number">37.2</span> Maximum Integer Size Type</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#using-fixed-size-constants" id="toc-using-fixed-size-constants"><span class="toc-section-number">37.3</span> Using Fixed Size Constants</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#limits-of-fixed-size-integers" id="toc-limits-of-fixed-size-integers"><span class="toc-section-number">37.4</span> Limits of Fixed Size Integers</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#format-specifiers" id="toc-format-specifiers"><span class="toc-section-number">37.5</span> Format Specifiers</a></li>
</ul></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#date-and-time-functionality" id="toc-date-and-time-functionality"><span class="toc-section-number">38</span> Date and Time Functionality</a>
<ul>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#quick-terminology-and-information" id="toc-quick-terminology-and-information"><span class="toc-section-number">38.1</span> Quick Terminology and Information</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#date-types" id="toc-date-types"><span class="toc-section-number">38.2</span> Date Types</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#initialization-and-conversion-between-types" id="toc-initialization-and-conversion-between-types"><span class="toc-section-number">38.3</span> Initialization and Conversion Between Types</a>
<ul>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#converting-time_t-to-struct-tm" id="toc-converting-time_t-to-struct-tm"><span class="toc-section-number">38.3.1</span> Converting <code>time_t</code> to <code>struct tm</code></a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#converting-struct-tm-to-time_t" id="toc-converting-struct-tm-to-time_t"><span class="toc-section-number">38.3.2</span> Converting <code>struct tm</code> to <code>time_t</code></a></li>
</ul></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#formatted-date-output" id="toc-formatted-date-output"><span class="toc-section-number">38.4</span> Formatted Date Output</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#more-resolution-with-timespec_get" id="toc-more-resolution-with-timespec_get"><span class="toc-section-number">38.5</span> More Resolution with <code>timespec_get()</code></a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#differences-between-times" id="toc-differences-between-times"><span class="toc-section-number">38.6</span> Differences Between Times</a></li>
</ul></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#multithreading" id="toc-multithreading"><span class="toc-section-number">39</span> Multithreading</a>
<ul>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#background" id="toc-background"><span class="toc-section-number">39.1</span> Background</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#things-you-can-do" id="toc-things-you-can-do"><span class="toc-section-number">39.2</span> Things You Can Do</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#data-races-and-the-standard-library" id="toc-data-races-and-the-standard-library"><span class="toc-section-number">39.3</span> Data Races and the Standard Library</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#creating-and-waiting-for-threads" id="toc-creating-and-waiting-for-threads"><span class="toc-section-number">39.4</span> Creating and Waiting for Threads</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#detaching-threads" id="toc-detaching-threads"><span class="toc-section-number">39.5</span> Detaching Threads</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#thread-local-data" id="toc-thread-local-data"><span class="toc-section-number">39.6</span> Thread Local Data</a>
<ul>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#thread-local" id="toc-thread-local"><span class="toc-section-number">39.6.1</span> <code>_Thread_local</code> Storage-Class</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#another-option-thread-specific-storage" id="toc-another-option-thread-specific-storage"><span class="toc-section-number">39.6.2</span> Another Option: Thread-Specific Storage</a></li>
</ul></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#mutex" id="toc-mutex"><span class="toc-section-number">39.7</span> Mutexes</a>
<ul>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#different-mutex-types" id="toc-different-mutex-types"><span class="toc-section-number">39.7.1</span> Different Mutex Types</a></li>
</ul></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#condition-variables" id="toc-condition-variables"><span class="toc-section-number">39.8</span> Condition Variables</a>
<ul>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#timed-condition-wait" id="toc-timed-condition-wait"><span class="toc-section-number">39.8.1</span> Timed Condition Wait</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#broadcast-wake-up-all-waiting-threads" id="toc-broadcast-wake-up-all-waiting-threads"><span class="toc-section-number">39.8.2</span> Broadcast: Wake Up All Waiting Threads</a></li>
</ul></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#running-a-function-one-time" id="toc-running-a-function-one-time"><span class="toc-section-number">39.9</span> Running a Function One Time</a></li>
</ul></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#chapter-atomics" id="toc-chapter-atomics"><span class="toc-section-number">40</span> Atomics</a>
<ul>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#testing-for-atomic-support" id="toc-testing-for-atomic-support"><span class="toc-section-number">40.1</span> Testing for Atomic Support</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#atomic-variables" id="toc-atomic-variables"><span class="toc-section-number">40.2</span> Atomic Variables</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#synchronization" id="toc-synchronization"><span class="toc-section-number">40.3</span> Synchronization</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#acquire-and-release" id="toc-acquire-and-release"><span class="toc-section-number">40.4</span> Acquire and Release</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#sequential-consistency" id="toc-sequential-consistency"><span class="toc-section-number">40.5</span> Sequential Consistency</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#atomic-assignments-and-operators" id="toc-atomic-assignments-and-operators"><span class="toc-section-number">40.6</span> Atomic Assignments and Operators</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#library-functions-that-automatically-synchronize" id="toc-library-functions-that-automatically-synchronize"><span class="toc-section-number">40.7</span> Library Functions that Automatically Synchronize</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#atomic-type-specifier-qualifier" id="toc-atomic-type-specifier-qualifier"><span class="toc-section-number">40.8</span> Atomic Type Specifier, Qualifier</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#lock-free-atomic" id="toc-lock-free-atomic"><span class="toc-section-number">40.9</span> Lock-Free Atomic Variables</a>
<ul>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#signal-handlers-and-lock-free-atomics" id="toc-signal-handlers-and-lock-free-atomics"><span class="toc-section-number">40.9.1</span> Signal Handlers and Lock-Free Atomics</a></li>
</ul></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#atomic-flags" id="toc-atomic-flags"><span class="toc-section-number">40.10</span> Atomic Flags</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#atomic-structs-and-unions" id="toc-atomic-structs-and-unions"><span class="toc-section-number">40.11</span> Atomic <code>struct</code>s and <code>union</code>s</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#atomic-pointers" id="toc-atomic-pointers"><span class="toc-section-number">40.12</span> Atomic Pointers</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#memory-order" id="toc-memory-order"><span class="toc-section-number">40.13</span> Memory Order</a>
<ul>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#sequential-consistency-1" id="toc-sequential-consistency-1"><span class="toc-section-number">40.13.1</span> Sequential Consistency</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#acquire" id="toc-acquire"><span class="toc-section-number">40.13.2</span> Acquire</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#release" id="toc-release"><span class="toc-section-number">40.13.3</span> Release</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#consume" id="toc-consume"><span class="toc-section-number">40.13.4</span> Consume</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#acquirerelease" id="toc-acquirerelease"><span class="toc-section-number">40.13.5</span> Acquire/Release</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#relaxed" id="toc-relaxed"><span class="toc-section-number">40.13.6</span> Relaxed</a></li>
</ul></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#fences" id="toc-fences"><span class="toc-section-number">40.14</span> Fences</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#references" id="toc-references"><span class="toc-section-number">40.15</span> References</a></li>
</ul></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#function-specifiers-alignment-specifiersoperators" id="toc-function-specifiers-alignment-specifiersoperators"><span class="toc-section-number">41</span> Function Specifiers, Alignment Specifiers/Operators</a>
<ul>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#function-specifiers" id="toc-function-specifiers"><span class="toc-section-number">41.1</span> Function Specifiers</a>
<ul>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#inline-for-speedmaybe" id="toc-inline-for-speedmaybe"><span class="toc-section-number">41.1.1</span> <code>inline</code> for Speed—Maybe</a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#noreturn" id="toc-noreturn"><span class="toc-section-number">41.1.2</span> <code>noreturn</code> and <code>_Noreturn</code></a></li>
</ul></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#alignment-specifiers-and-operators" id="toc-alignment-specifiers-and-operators"><span class="toc-section-number">41.2</span> Alignment Specifiers and Operators</a>
<ul>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#alignas-and-_alignas" id="toc-alignas-and-_alignas"><span class="toc-section-number">41.2.1</span> <code>alignas</code> and <code>_Alignas</code></a></li>
<li><a href="https://beej.us/guide/bgc/html/index-wide.html#alignof-and-_alignof" id="toc-alignof-and-_alignof"><span class="toc-section-number">41.2.2</span> <code>alignof</code> and <code>_Alignof</code></a></li>
</ul></li>
</ul></li>
</ul>
</nav>
<!-- Beej's guide to C

# vim: ts=4:sw=4:nosi:et:tw=72
-->
<!-- No hyphenation -->
<!-- Can't do things that aren't letters
\hyphenation{atan2}
\hyphenation{atan2f}
\hyphenation{atan2l}
-->
<!-- Index see alsos -->
<p> </p>
<h1 data-number="1" id="foreword"><span class="header-section-number">1</span> Foreword</h1>
<blockquote>
<p><em>C is not a big language, and it is not well served by a big book.</em></p>
<p>–Brian W. Kernighan, Dennis M. Ritchie</p>
</blockquote>
<p>No point in wasting words here, folks, let’s jump straight into the C code:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb1-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb1-1" aria-hidden="true" tabindex="-1"></a>E<span class="op">((</span>ck<span class="op">?</span>main<span class="op">((</span>z<span class="op">?(</span>stat<span class="op">(</span>M<span class="op">,&amp;</span>t<span class="op">)?</span>P<span class="op">+=</span>a<span class="op">+</span><span class="ch">'{'</span><span class="op">?</span><span class="dv">0</span><span class="op">:</span><span class="dv">3</span><span class="op">:</span></span>
<span id="cb1-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb1-2" aria-hidden="true" tabindex="-1"></a>execv<span class="op">(</span>M<span class="op">,</span>k<span class="op">),</span>a<span class="op">=</span>G<span class="op">,</span>i<span class="op">=</span>P<span class="op">,</span>y<span class="op">=</span>G<span class="op">&amp;</span><span class="dv">255</span><span class="op">,</span></span>
<span id="cb1-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb1-3" aria-hidden="true" tabindex="-1"></a>sprintf<span class="op">(</span>Q<span class="op">,</span>y<span class="op">/</span><span class="ch">'@'</span><span class="op">-</span><span class="dv">3</span><span class="op">?</span>A<span class="op">(*</span>L<span class="op">(</span>V<span class="op">(%</span>d<span class="op">+%</span>d<span class="op">)+%</span>d<span class="op">,</span><span class="dv">0</span><span class="op">)</span></span></code></pre></div>
<p>And they lived happily ever after. The End.</p>
<p>What’s this? You say something’s still not clear about this whole C programming language thing?</p>
<p>Well, to be quite honest, I’m not even sure what the above code does. It’s a snippet from one of the entries in the 2001 <a href="https://www.ioccc.org/">International Obfuscated C Code Contest</a><a href="https://beej.us/guide/bgc/html/index-wide.html#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>, a wonderful competition wherein the entrants attempt to write the most unreadable C code possible, with often surprising results.</p>
<p>The bad news is that if you’re a beginner in this whole thing, all C code you see probably looks obfuscated! The good news is, it’s not going to be that way for long.</p>
<p>What we’ll try to do over the course of this guide is lead you from complete and utter sheer lost confusion on to the sort of enlightened bliss that can only be obtained through pure C programming. Right on.</p>
<p>In the old days, C was a simpler language. A good number of the features contained in this book and a <em>lot</em> of the features in the Library Reference volume didn’t exist when K&amp;R wrote the famous second edition of their book in 1988. Nevertheless, the language remains small at its core, and I hope I’ve presented it here in a way that starts with that simple core and builds outward.</p>
<p>And that’s my excuse for writing such a hilariously large book for such a small, concise language.</p>
<h2 data-number="1.1" id="audience"><span class="header-section-number">1.1</span> Audience</h2>
<p>This guide assumes that you’ve already got some programming knowledge under your belt from another language, such as <a href="https://en.wikipedia.org/wiki/Python_(programming_language)">Python</a><a href="https://beej.us/guide/bgc/html/index-wide.html#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>, <a href="https://en.wikipedia.org/wiki/JavaScript">JavaScript</a><a href="https://beej.us/guide/bgc/html/index-wide.html#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>, <a href="https://en.wikipedia.org/wiki/Java_(programming_language)">Java</a><a href="https://beej.us/guide/bgc/html/index-wide.html#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a>, <a href="https://en.wikipedia.org/wiki/Rust_(programming_language)">Rust</a><a href="https://beej.us/guide/bgc/html/index-wide.html#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a>, <a href="https://en.wikipedia.org/wiki/Go_(programming_language)">Go</a><a href="https://beej.us/guide/bgc/html/index-wide.html#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a>, <a href="https://en.wikipedia.org/wiki/Swift_(programming_language)">Swift</a><a href="https://beej.us/guide/bgc/html/index-wide.html#fn7" class="footnote-ref" id="fnref7" role="doc-noteref"><sup>7</sup></a>, etc. (<a href="https://en.wikipedia.org/wiki/Objective-C">Objective-C</a><a href="https://beej.us/guide/bgc/html/index-wide.html#fn8" class="footnote-ref" id="fnref8" role="doc-noteref"><sup>8</sup></a> devs will have a particularly easy time of it!)</p>
<p>We’re going to assume you know what variables are, what loops do, how functions work, and so on.</p>
<p>If that’s not you for whatever reason the best I can hope to provide is some honest entertainment for your reading pleasure. The only thing I can reasonably promise is that this guide won’t end on a cliffhanger… or <em>will</em> it?</p>
<h2 data-number="1.2" id="how-to-read-this-book"><span class="header-section-number">1.2</span> How to Read This Book</h2>
<p>The guide is in two volumes, and this is the first: the tutorial volume!</p>
<p>The second volume is the <a href="https://beej.us/guide/bgclr/">library reference</a><a href="https://beej.us/guide/bgc/html/index-wide.html#fn9" class="footnote-ref" id="fnref9" role="doc-noteref"><sup>9</sup></a>, and it’s far more reference than tutorial.</p>
<p>If you’re new, go through the tutorial part in order, generally. The higher you get in chapters, the less important it is to go in order.</p>
<p>And no matter your skill level, the reference part is there with complete examples of the standard library function calls to help refresh your memory whenever needed. Good for reading over a bowl of cereal or other time.</p>
<p>Finally, glancing at the index (if you’re reading the print version), the reference section entries are italicized.</p>
<h2 data-number="1.3" id="platform-and-compiler"><span class="header-section-number">1.3</span> Platform and Compiler</h2>
<p>I’ll try to stick to Plain Ol’-Fashioned <a href="https://en.wikipedia.org/wiki/ANSI_C">ISO-standard C</a><a href="https://beej.us/guide/bgc/html/index-wide.html#fn10" class="footnote-ref" id="fnref10" role="doc-noteref"><sup>10</sup></a>. Well, for the most part. Here and there I might go crazy and start talking about <a href="https://en.wikipedia.org/wiki/POSIX">POSIX</a><a href="https://beej.us/guide/bgc/html/index-wide.html#fn11" class="footnote-ref" id="fnref11" role="doc-noteref"><sup>11</sup></a> or something, but we’ll see.</p>
<p><strong>Unix</strong> users (e.g.&nbsp;Linux, BSD, etc.) try running <code>cc</code> or <code>gcc</code> from the command line–you might already have a compiler installed. If you don’t, search your distribution for installing <code>gcc</code> or <code>clang</code>.</p>
<p><strong>Windows</strong> users should check out <a href="https://visualstudio.microsoft.com/vs/community/">Visual Studio Community</a><a href="https://beej.us/guide/bgc/html/index-wide.html#fn12" class="footnote-ref" id="fnref12" role="doc-noteref"><sup>12</sup></a>. Or, if you’re looking for a more Unix-like experience (recommended!), install <a href="https://docs.microsoft.com/en-us/windows/wsl/install-win10">WSL</a><a href="https://beej.us/guide/bgc/html/index-wide.html#fn13" class="footnote-ref" id="fnref13" role="doc-noteref"><sup>13</sup></a> and <code>gcc</code>.</p>
<p><strong>Mac</strong> users will want to install <a href="https://developer.apple.com/xcode/">XCode</a><a href="https://beej.us/guide/bgc/html/index-wide.html#fn14" class="footnote-ref" id="fnref14" role="doc-noteref"><sup>14</sup></a>, and in particular the command line tools.</p>
<p>There are a lot of compilers out there, and virtually all of them will work for this book. And a C++ compiler will compile a lot of (but not all!) C code. Best use a proper C compiler if you can.</p>
<h2 data-number="1.4" id="official-homepage"><span class="header-section-number">1.4</span> Official Homepage</h2>
<p>This official location of this document is <a href="https://beej.us/guide/bgc/">https://beej.us/guide/bgc/</a><a href="https://beej.us/guide/bgc/html/index-wide.html#fn15" class="footnote-ref" id="fnref15" role="doc-noteref"><sup>15</sup></a>. Maybe this’ll change in the future, but it’s more likely that all the other guides are migrated off Chico State computers.</p>
<h2 data-number="1.5" id="email-policy"><span class="header-section-number">1.5</span> Email Policy</h2>
<p>I’m generally available to help out with email questions so feel free to write in, but I can’t guarantee a response. I lead a pretty busy life and there are times when I just can’t answer a question you have. When that’s the case, I usually just delete the message. It’s nothing personal; I just won’t ever have the time to give the detailed answer you require.</p>
<p>As a rule, the more complex the question, the less likely I am to respond. If you can narrow down your question before mailing it and be sure to include any pertinent information (like platform, compiler, error messages you’re getting, and anything else you think might help me troubleshoot), you’re much more likely to get a response.</p>
<p>If you don’t get a response, hack on it some more, try to find the answer, and if it’s still elusive, then write me again with the information you’ve found and hopefully it will be enough for me to help out.</p>
<p>Now that I’ve badgered you about how to write and not write me, I’d just like to let you know that I <em>fully</em> appreciate all the praise the guide has received over the years. It’s a real morale boost, and it gladdens me to hear that it is being used for good! <code>:-)</code> Thank you!</p>
<h2 data-number="1.6" id="mirroring"><span class="header-section-number">1.6</span> Mirroring</h2>
<p>You are more than welcome to mirror this site, whether publicly or privately. If you publicly mirror the site and want me to link to it from the main page, drop me a line at <a href="mailto:beej@beej.us"><code>beej@beej.us</code></a>.</p>
<h2 data-number="1.7" id="note-for-translators"><span class="header-section-number">1.7</span> Note for Translators</h2>
<p>If you want to translate the guide into another language, write me at <a href="https://beej.us/guide/bgc/html/beej@beej.us"><code>beej@beej.us</code></a> and I’ll link to your translation from the main page. Feel free to add your name and contact info to the translation.</p>
<p>Please note the license restrictions in the Copyright and Distribution section, below.</p>
<h2 data-number="1.8" id="copyright-and-distribution"><span class="header-section-number">1.8</span> Copyright and Distribution</h2>
<p>Beej’s Guide to C is Copyright © 2021 Brian “Beej Jorgensen” Hall.</p>
<p>With specific exceptions for source code and translations, below, this work is licensed under the Creative Commons Attribution-Noncommercial-No Derivative Works 3.0 License. To view a copy of this license, visit <a href="https://creativecommons.org/licenses/by-nc-nd/3.0/"><code>https://creativecommons.org/licenses/by-nc-nd/3.0/</code></a> or send a letter to Creative Commons, 171 Second Street, Suite 300, San Francisco, California, 94105, USA.</p>
<p>One specific exception to the “No Derivative Works” portion of the license is as follows: this guide may be freely translated into any language, provided the translation is accurate, and the guide is reprinted in its entirety. The same license restrictions apply to the translation as to the original guide. The translation may also include the name and contact information for the translator.</p>
<p>The C source code presented in this document is hereby granted to the public domain, and is completely free of any license restriction.</p>
<p>Educators are freely encouraged to recommend or supply copies of this guide to their students.</p>
<p>Contact <a href="https://beej.us/guide/bgc/html/beej@beej.us"><code>beej@beej.us</code></a> for more information.</p>
<h2 data-number="1.9" id="dedication"><span class="header-section-number">1.9</span> Dedication</h2>
<p>The hardest things about writing these guides are:</p>
<ul>
<li>Learning the material in enough detail to be able to explain it</li>
<li>Figuring out the best way to explain it clearly, a seemingly-endless iterative process</li>
<li>Putting myself out there as a so-called <em>authority</em>, when really I’m just a regular human trying to make sense of it all, just like everyone else</li>
<li>Keeping at it when so many other things draw my attention</li>
</ul>
<p>A lot of people have helped me through this process, and I want to acknowledge those who have made this book possible.</p>
<ul>
<li>Everyone on the Internet who decided to help share their knowledge in one form or another. The free sharing of instructive information is what makes the Internet the great place that it is.</li>
<li>The volunteers at <a href="https://en.cppreference.com/">cppreference.com</a><a href="https://beej.us/guide/bgc/html/index-wide.html#fn16" class="footnote-ref" id="fnref16" role="doc-noteref"><sup>16</sup></a> who provide the bridge that leads from the spec to the real world.</li>
<li>The helpful and knowledgeable folks on <a href="https://groups.google.com/g/comp.lang.c">comp.lang.c</a><a href="https://beej.us/guide/bgc/html/index-wide.html#fn17" class="footnote-ref" id="fnref17" role="doc-noteref"><sup>17</sup></a> and <a href="https://www.reddit.com/r/C_Programming/">r/C_Programming</a><a href="https://beej.us/guide/bgc/html/index-wide.html#fn18" class="footnote-ref" id="fnref18" role="doc-noteref"><sup>18</sup></a> who got me through the tougher parts of the language.</li>
<li>Everyone who submitted corrections and pull-requests on everything from misleading instructions to typos.</li>
</ul>
<p>Thank you! ♥</p>
<!-- Beej's guide to C

# vim: ts=4:sw=4:nosi:et:tw=72
-->
<h1 data-number="2" id="hello-world"><span class="header-section-number">2</span> Hello, World!</h1>
<h2 data-number="2.1" id="what-to-expect-from-c"><span class="header-section-number">2.1</span> What to Expect from C</h2>
<blockquote>
<p><em>“Where do these stairs go?”</em><br>
<em>“They go up.”</em></p>
<p>—Ray Stantz and Peter Venkman, Ghostbusters</p>
</blockquote>
<p>C is a low-level language.</p>
<p>It didn’t use to be. Back in the day when people carved punch cards out of granite, C was an incredible way to be free of the drudgery of lower-level languages like <a href="https://en.wikipedia.org/wiki/Assembly_language">assembly</a><a href="https://beej.us/guide/bgc/html/index-wide.html#fn19" class="footnote-ref" id="fnref19" role="doc-noteref"><sup>19</sup></a>.</p>
<p>But now in these modern times, current-generation languages offer all kinds of features that didn’t exist in 1972 when C was invented. This means C is a pretty basic language with not a lot of features. It can do <em>anything</em>, but it can make you work for it.</p>
<p>So why would we even use it today?</p>
<ul>
<li><p>As a learning tool: not only is C a venerable piece of computing history, but it is connected to the <a href="https://en.wikipedia.org/wiki/Bare_machine">bare metal</a><a href="https://beej.us/guide/bgc/html/index-wide.html#fn20" class="footnote-ref" id="fnref20" role="doc-noteref"><sup>20</sup></a> in a way that present-day languages are not. When you learn C, you learn about how software interfaces with computer memory at a low level. There are no seatbelts. You’ll write software that crashes, I assure you. And that’s all part of the fun!</p></li>
<li><p>As a useful tool: C still is used for certain applications, such as building <a href="https://en.wikipedia.org/wiki/Operating_system">operating systems</a><a href="https://beej.us/guide/bgc/html/index-wide.html#fn21" class="footnote-ref" id="fnref21" role="doc-noteref"><sup>21</sup></a> or in <a href="https://en.wikipedia.org/wiki/Embedded_system">embedded systems</a><a href="https://beej.us/guide/bgc/html/index-wide.html#fn22" class="footnote-ref" id="fnref22" role="doc-noteref"><sup>22</sup></a>. (Though the <a href="https://en.wikipedia.org/wiki/Rust_(programming_language)">Rust</a><a href="https://beej.us/guide/bgc/html/index-wide.html#fn23" class="footnote-ref" id="fnref23" role="doc-noteref"><sup>23</sup></a> programming language is eyeing both these fields!)</p></li>
</ul>
<p>If you’re familiar with another language, a lot of things about C are easy. C inspired many other languages, and you’ll see bits of it in Go, Rust, Swift, Python, JavaScript, Java, and all kinds of other languages. Those parts will be familiar.</p>
<p>The one thing about C that hangs people up is <em>pointers</em>. Virtually everything else is familiar, but pointers are the weird one. The concept behind pointers is likely one you already know, but C forces you to be explicit about it, using operators you’ve likely never seen before.</p>
<p>It’s especially insidious because once you <a href="https://en.wikipedia.org/wiki/Grok"><em>grok</em></a><a href="https://beej.us/guide/bgc/html/index-wide.html#fn24" class="footnote-ref" id="fnref24" role="doc-noteref"><sup>24</sup></a> pointers, they’re suddenly easy. But up until that moment, they’re slippery eels.</p>
<p>Everything else in C is just memorizing another way (or sometimes the same way!) of doing something you’ve done already. Pointers are the weird bit. And, arguably, even pointers are variations on a theme you’re probably familiar with.</p>
<p>So get ready for a rollicking adventure as close to the core of the computer as you can get without assembly, in the most influential computer language of all time<a href="https://beej.us/guide/bgc/html/index-wide.html#fn25" class="footnote-ref" id="fnref25" role="doc-noteref"><sup>25</sup></a>. Hang on!</p>
<h2 data-number="2.2" id="hello-world-1"><span class="header-section-number">2.2</span> Hello, World!</h2>
<p>This is the canonical example of a C program. Everyone uses it. (Note that the numbers to the left are for reader reference only, and are not part of the source code.)</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb2-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb2-1"></a><span class="co">/* Hello world program */</span></span>
<span id="cb2-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb2-2"></a></span>
<span id="cb2-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb2-3"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb2-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb2-4"></a></span>
<span id="cb2-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb2-5"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb2-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb2-6"></a><span class="op">{</span></span>
<span id="cb2-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb2-7"></a>    printf<span class="op">(</span><span class="st">"Hello, World!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span>  <span class="co">// Actually do the work here</span></span>
<span id="cb2-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb2-8"></a><span class="op">}</span></span></code></pre></div>
<p>We’re going to don our long-sleeved heavy-duty rubber gloves, grab a scalpel, and rip into this thing to see what makes it tick. So, scrub up, because here we go. Cutting very gently…</p>
<p>Let’s get the easy thing out of the way: anything between the digraphs <code>/*</code> and <code>*/</code> is a comment and will be completely ignored by the compiler. Same goes for anything on a line after a <code>//</code>. This allows you to leave messages to yourself and others, so that when you come back and read your code in the distant future, you’ll know what the heck it was you were trying to do. Believe me, you will forget; it happens.</p>
<p>Now, what is this <code>#include</code>? GROSS! Well, it tells the C Preprocessor to pull the contents of another file and insert it into the code right <em>there</em>.</p>
<p>Wait—what’s a C Preprocessor? Good question. There are two stages<a href="https://beej.us/guide/bgc/html/index-wide.html#fn26" class="footnote-ref" id="fnref26" role="doc-noteref"><sup>26</sup></a> to compilation: the preprocessor and the compiler. Anything that starts with pound sign, or “octothorpe”, (<code>#</code>) is something the preprocessor operates on before the compiler even gets started. Common <em>preprocessor directives</em>, as they’re called, are <code>#include</code> and <code>#define</code>. More on that later.</p>
<p>Before we go on, why would I even begin to bother pointing out that a pound sign is called an octothorpe? The answer is simple: I think the word octothorpe is so excellently funny, I have to gratuitously spread its name around whenever I get the opportunity. Octothorpe. Octothorpe, octothorpe, octothorpe.</p>
<p>So <em>anyway</em>. After the C preprocessor has finished preprocessing everything, the results are ready for the compiler to take them and produce <a href="https://en.wikipedia.org/wiki/Assembly_language">assembly code</a><a href="https://beej.us/guide/bgc/html/index-wide.html#fn27" class="footnote-ref" id="fnref27" role="doc-noteref"><sup>27</sup></a>, <a href="https://en.wikipedia.org/wiki/Machine_code">machine code</a><a href="https://beej.us/guide/bgc/html/index-wide.html#fn28" class="footnote-ref" id="fnref28" role="doc-noteref"><sup>28</sup></a>, or whatever it’s about to do. Machine code is the “language” the CPU understands, and it can understand it <em>very rapidly</em>. This is one of the reasons C programs tend to be quick.</p>
<p>Don’t worry about the technical details of compilation for now; just know that your source runs through the preprocessor, then the output of that runs through the compiler, then that produces an executable for you to run.</p>
<p>What about the rest of the line? What’s <code>&lt;stdio.h&gt;</code>? That is what is known as a <em>header file</em>. It’s the dot-h at the end that gives it away. In fact it’s the “Standard I/O” (<code>stdio</code>) header file that you will grow to know and love. It gives us access to a bunch of I/O functionality<a href="https://beej.us/guide/bgc/html/index-wide.html#fn29" class="footnote-ref" id="fnref29" role="doc-noteref"><sup>29</sup></a>. For our demo program, we’re outputting the string “Hello, World!”, so we in particular need access to the <code>printf()</code> function to do this. The <code>&lt;stdio.h&gt;</code> file gives us this access. Basically, if we tried to use <code>printf()</code> without <code>#include &lt;stdio.h&gt;</code>, the compiler would have complained to us about it.</p>
<p>How did I know I needed to <code>#include &lt;stdio.h&gt;</code> for <code>printf()</code>? Answer: it’s in the documentation. If you’re on a Unix system, <code>man 3 printf</code> and it’ll tell you right at the top of the man page what header files are required. Or see the reference section in this book. <code>:-)</code> </p>
<p>Holy moly. That was all to cover the first line! But, let’s face it, it has been completely dissected. No mystery shall remain!</p>
<p>So take a breather…look back over the sample code. Only a couple easy lines to go.</p>
<p>Welcome back from your break! I know you didn’t really take a break; I was just humoring you.</p>
<p>The next line is <code>main()</code>. This is the definition of the function <code>main()</code>; everything between the squirrelly braces (<code>{</code> and <code>}</code>) is part of the function definition.</p>
<p>(How do you <em>call</em> a different function, anyway? The answer lies in the <code>printf()</code> line, but we’ll get to that in a minute.)</p>
<p>Now, the main function is a special one in many ways, but one way stands above the rest: it is the function that will be called automatically when your program starts executing. Nothing of yours gets called before <code>main()</code>. In the case of our example, this works fine since all we want to do is print a line and exit.</p>
<p>Oh, that’s another thing: once the program executes past the end of <code>main()</code>, down there at the closing squirrelly brace, the program will exit, and you’ll be back at your command prompt.</p>
<p>So now we know that that program has brought in a header file, <code>stdio.h</code>, and declared a <code>main()</code> function that will execute when the program is started. What are the goodies in <code>main()</code>?</p>
<p>I am so happy you asked. Really! We only have the one goodie: a call to the function <code>printf()</code>. You can tell this is a function call and not a function definition in a number of ways, but one indicator is the lack of squirrelly braces after it. And you end the function call with a semicolon so the compiler knows it’s the end of the expression. You’ll be putting semicolons after almost everything, as you’ll see.</p>
<p>You’re passing one argument to the function <code>printf()</code>: a string to be printed when you call it. Oh, yeah—we’re calling a function! We rock! Wait, wait—don’t get cocky. What’s that crazy <code>\n</code> at the end of the string? Well, most characters in the string will print out just like they are stored. But there are certain characters that you can’t print on screen well that are embedded as two-character backslash codes. One of the most popular is <code>\n</code> (read “backslash-N” or simply “newline”) that corresponds to the <em>newline</em> character. This is the character that causes further printing to continue at the beginning of the next line instead of the current. It’s like hitting return at the end of the line.</p>
<p>So copy that code into a file called <code>hello.c</code> and build it. On a Unix-like platform (e.g.&nbsp;Linux, BSD, Mac, or WSL), from the command line you’ll build with a command like so:</p>
<p></p>
<div class="sourceCode" id="cb3"><pre class="sourceCode zsh"><code class="sourceCode zsh"><span id="cb3-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-o</span> hello hello.c</span></code></pre></div>
<p>(This means “compile <code>hello.c</code>, and output an executable called <code>hello</code>”.)</p>
<p>After that’s done, you should have a file called <code>hello</code> that you can run with this command:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb4-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb4-1" aria-hidden="true" tabindex="-1"></a>./hello</span></code></pre></div>
<p>(The leading <code>./</code> tells the shell to “run from the current directory”.)</p>
<p>And see what happens:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb5-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb5-1" aria-hidden="true" tabindex="-1"></a>Hello, World! </span></code></pre></div>
<p>It’s done and tested! Ship it!</p>
<h2 data-number="2.3" id="compilation-details"><span class="header-section-number">2.3</span> Compilation Details</h2>
<p>Let’s talk a bit more about how to build C programs, and what happens behind the scenes there.</p>
<p>Like other languages, C has <em>source code</em>. But, depending on what language you’re coming from, you might never have had to <em>compile</em> your source code into an <em>executable</em>.</p>
<p>Compilation is the process of taking your C source code and turning it into a program that your operating system can execute.</p>
<p>JavaScript and Python devs aren’t used to a separate compilation step at all–though behind the scenes it’s happening! Python compiles your source code into something called <em>bytecode</em> that the Python virtual machine can execute. Java devs are used to compilation, but that produces bytecode for the Java Virtual Machine.</p>
<p>When compiling C, <em>machine code</em> is generated. This is the 1s and 0s that can be executed directly and speedily by the CPU.</p>
<blockquote>
<p>Languages that typically aren’t compiled are called <em>interpreted</em> languages. But as we mentioned with Java and Python, they also have a compilation step. And there’s no rule saying that C can’t be interpreted. (There are C interpreters out there!) In short, it’s a bunch of gray areas. Compilation in general is just taking source code and turning it into another, more easily-executed form.</p>
</blockquote>
<p>The C compiler is the program that does the compilation.</p>
<p>As we’ve already said, <code>gcc</code> is a compiler that’s installed on a lot of <a href="https://en.wikipedia.org/wiki/Unix">Unix-like operating systems</a><a href="https://beej.us/guide/bgc/html/index-wide.html#fn30" class="footnote-ref" id="fnref30" role="doc-noteref"><sup>30</sup></a>. And it’s commonly run from the command line in a terminal, but not always. You can run it from your IDE, as well.</p>
<p>So how do we do command line builds?</p>
<h2 data-number="2.4" id="building-with-gcc"><span class="header-section-number">2.4</span> Building with <code>gcc</code></h2>
<p>If you have a source file called <code>hello.c</code> in the current directory, you can build that into a program called <code>hello</code> with this command typed in a terminal:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode zsh"><code class="sourceCode zsh"><span id="cb6-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-o</span> hello hello.c</span></code></pre></div>
<p>The <code>-o</code> means “output to this file”<a href="https://beej.us/guide/bgc/html/index-wide.html#fn31" class="footnote-ref" id="fnref31" role="doc-noteref"><sup>31</sup></a>. And there’s <code>hello.c</code> at the end, the name of the file we want to compile.</p>
<p>If your source is broken up into multiple files, you can compile them all together (almost as if they were one file, but the rules are actually more complex than that) by putting all the <code>.c</code> files on the command line:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode zsh"><code class="sourceCode zsh"><span id="cb7-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-o</span> awesomegame ui.c characters.c npc.c items.c</span></code></pre></div>
<p></p>
<p>and they’ll all get built together into a big executable.</p>
<p>That’s enough to get started—later we’ll talk details about multiple source files, object files, and all kinds of fun stuff.</p>
<h2 data-number="2.5" id="building-with-clang"><span class="header-section-number">2.5</span> Building with <code>clang</code></h2>
<p>On Macs, the stock compiler isn’t <code>gcc</code>—it’s <code>clang</code>. But a wrapper is also installed so you can run <code>gcc</code> and have it still work.</p>
<p>You can also install the <code>gcc</code> compiler proper through <a href="https://formulae.brew.sh/formula/gcc">Homebrew</a><a href="https://beej.us/guide/bgc/html/index-wide.html#fn32" class="footnote-ref" id="fnref32" role="doc-noteref"><sup>32</sup></a> or some other means.</p>
<h2 data-number="2.6" id="building-from-ides"><span class="header-section-number">2.6</span> Building from IDEs</h2>
<p>If you’re using an <em>Integrated Development Environment</em> (IDE), you probably don’t have to build from the command line.</p>
<p>With Visual Studio, <code>CTRL-F7</code> will build, and <code>CTRL-F5</code> will run.</p>
<p>With VS Code, you can hit <code>F5</code> to run via the debugger. (You’ll have to install the C/C++ Extension.)</p>
<p>With XCode, you can build with <code>COMMAND-B</code> and run with <code>COMMAND-R</code>. To get the command line tools, Google for “XCode command line tools” and you’ll find instructions for installing them.</p>
<p>For getting started, I encourage you to also try to build from the command line—it’s history!</p>
<h2 data-number="2.7" id="c-versions"><span class="header-section-number">2.7</span> C Versions</h2>
<p>C has come a long way over the years, and it had many named version numbers to describe which dialect of the language you’re using.</p>
<p>These generally refer to the year of the specification.</p>
<p>The most famous are C89, C99, C11, and C2x. We’ll focus on the latter in this book.</p>
<p>But here’s a more complete table:</p>
<table>
<colgroup>
<col style="width: 26%">
<col style="width: 73%">
</colgroup>
<thead>
<tr class="header">
<th>Version</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>K&amp;R C</td>
<td>1978, the original. Named after Brian Kernighan and Dennis Ritchie. Ritchie designed and coded the language, and Kernighan co-authored the book on it. You rarely see original K&amp;R code today. If you do, it’ll look odd, like Middle English looks odd to modern English readers.</td>
</tr>
<tr class="even">
<td><strong>C89</strong>, ANSI C, C90</td>
<td>In 1989, the American National Standards Institute (ANSI) produced a C language specification that set the tone for C that persists to this day. A year later, the reins were handed to the International Organization for Standardization (ISO) that produced the identical C90.</td>
</tr>
<tr class="odd">
<td>C95</td>
<td>A rarely-mentioned addition to C89 that included wide character support.</td>
</tr>
<tr class="even">
<td><strong>C99</strong></td>
<td>The first big overhaul with lots of language additions. The thing most people remember is the addition of <code>//</code>-style comments. This is the most popular version of C in use as of this writing.</td>
</tr>
<tr class="odd">
<td><strong>C11</strong></td>
<td>This major version update includes Unicode support and multi-threading. Be advised that if you start using these language features, you might be sacrificing portability with places that are stuck in C99 land. But, honestly, 1999 is getting to be a while back now.</td>
</tr>
<tr class="even">
<td>C17, C18</td>
<td>Bugfix update to C11. C17 seems to be the official name, but the publication was delayed until 2018. As far as I can tell, these two are interchangeable, with C17 being preferred.</td>
</tr>
<tr class="odd">
<td>C2x</td>
<td>What’s coming next! Expected to eventually become C23.</td>
</tr>
</tbody>
</table>
<p>You can force GCC to use one of these standards with the <code>-std=</code> command line argument. If you want it to be picky about the standard, add <code>-pedantic</code>.</p>
<p>For example:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode zsh"><code class="sourceCode zsh"><span id="cb8-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-std</span><span class="op">=</span>c11 <span class="at">-pedantic</span> foo.c</span></code></pre></div>
<p>For this book, I compile programs for C2x with all warnings set:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode zsh"><code class="sourceCode zsh"><span id="cb9-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-Wall</span> <span class="at">-Wextra</span> <span class="at">-std</span><span class="op">=</span>c2x <span class="at">-pedantic</span> foo.c</span></code></pre></div>
<p></p>
<!-- Beej's guide to C

# vim: ts=4:sw=4:nosi:et:tw=72
-->
<h1 data-number="3" id="variables-and-statements"><span class="header-section-number">3</span> Variables and Statements</h1>
<blockquote>
<p><em>“It takes all kinds to make a world, does it not, Padre?”</em><br>
<em>“So it does, my son, so it does.”</em></p>
<p>—Pirate Captain Thomas Bartholomew Red to the Padre, Pirates</p>
</blockquote>
<p>There sure can be lotsa stuff in a C program.</p>
<p>Yup.</p>
<p>And for various reasons, it’ll be easier for all of us if we classify some of the types of things you can find in a program, so we can be clear what we’re talking about.</p>
<h2 data-number="3.1" id="variables"><span class="header-section-number">3.1</span> Variables</h2>
<p>It’s said that “variables hold values”. But another way to think about it is that a variable is a human-readable name that refers to some data in memory.</p>
<p>We’re going to take a second here and take a peek down the rabbit hole that is pointers. Don’t worry about it.</p>
<p>You can think of memory as a big array of bytes<a href="https://beej.us/guide/bgc/html/index-wide.html#fn33" class="footnote-ref" id="fnref33" role="doc-noteref"><sup>33</sup></a>. Data is stored in this “array”<a href="https://beej.us/guide/bgc/html/index-wide.html#fn34" class="footnote-ref" id="fnref34" role="doc-noteref"><sup>34</sup></a>. If a number is larger than a single byte, it is stored in multiple bytes. Because memory is like an array, each byte of memory can be referred to by its index. This index into memory is also called an <em>address</em>, or a <em>location</em>, or a <em>pointer</em>.</p>
<p>When you have a variable in C, the value of that variable is in memory <em>somewhere</em>, at some address. Of course. After all, where else would it be? But it’s a pain to refer to a value by its numeric address, so we make a name for it instead, and that’s what the variable is.</p>
<p>The reason I’m bringing all this up is twofold:</p>
<ol type="1">
<li>It’s going to make it easier to understand pointer variables later—they’re variables that hold the address of other variables!</li>
<li>Also, it’s going to make it easier to understand pointers later.</li>
</ol>
<p>So a variable is a name for some data that’s stored in memory at some address.</p>
<h3 data-number="3.1.1" id="variable-names"><span class="header-section-number">3.1.1</span> Variable Names</h3>
<p>You can use any characters in the range 0-9, A-Z, a-z, and underscore for variable names, with the following rules:</p>
<ul>
<li>You can’t start a variable with a digit 0-9.</li>
<li>You can’t start a variable name with two underscores.</li>
<li>You can’t start a variable name with an underscore followed by a capital A-Z.</li>
</ul>
<p>For Unicode, just try it. There are some rules in the spec in §D.2 that talk about which Unicode codepoint ranges are allowed in which parts of identifiers, but that’s too much to write about here and is probably something you’ll never have to think about anyway.</p>
<h3 data-number="3.1.2" id="variable-types"><span class="header-section-number">3.1.2</span> Variable Types</h3>
<p>Depending on which languages you already have in your toolkit, you might or might not be familiar with the idea of types. But C’s kinda picky about them, so we should do a refresher.</p>
<p>Some example types, some of the most basic:</p>
<p></p>
<table>
<colgroup>
<col style="width: 23%">
<col style="width: 41%">
<col style="width: 35%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Type</th>
<th style="text-align: right;">Example</th>
<th style="text-align: left;">C Type</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Integer</td>
<td style="text-align: right;"><code>3490</code></td>
<td style="text-align: left;"><code>int</code></td>
</tr>
<tr class="even">
<td style="text-align: left;">Floating point</td>
<td style="text-align: right;"><code>3.14159</code></td>
<td style="text-align: left;"><code>float</code><a href="https://beej.us/guide/bgc/html/index-wide.html#fn35" class="footnote-ref" id="fnref35" role="doc-noteref"><sup>35</sup></a></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Character (single)</td>
<td style="text-align: right;"><code>'c'</code></td>
<td style="text-align: left;"><code>char</code></td>
</tr>
<tr class="even">
<td style="text-align: left;">String</td>
<td style="text-align: right;"><code>"Hello, world!"</code></td>
<td style="text-align: left;"><code>char *</code><a href="https://beej.us/guide/bgc/html/index-wide.html#fn36" class="footnote-ref" id="fnref36" role="doc-noteref"><sup>36</sup></a></td>
</tr>
</tbody>
</table>
<p>C makes an effort to convert automatically between most numeric types when you ask it to. But other than that, all conversions are manual, notably between string and numeric.</p>
<p>Almost all of the types in C are variants on these types.</p>
<p>Before you can use a variable, you have to <em>declare</em> that variable and tell C what type the variable holds. Once declared, the type of variable cannot be changed later at runtime. What you set it to is what it is until it falls out of scope and is reabsorbed into the universe.</p>
<p>Let’s take our previous “Hello, world” code and add a couple variables to it:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb10-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb10-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb10-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb10-2"></a></span>
<span id="cb10-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb10-3"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb10-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb10-4"></a><span class="op">{</span></span>
<span id="cb10-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb10-5"></a>    <span class="dt">int</span> i<span class="op">;</span>    <span class="co">// Holds signed integers, e.g. -3, -2, 0, 1, 10</span></span>
<span id="cb10-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb10-6"></a>    <span class="dt">float</span> f<span class="op">;</span>  <span class="co">// Holds signed floating point numbers, e.g. -3.1416</span></span>
<span id="cb10-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb10-7"></a></span>
<span id="cb10-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb10-8"></a>    printf<span class="op">(</span><span class="st">"Hello, World!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span>  <span class="co">// Ah, blessed familiarity</span></span>
<span id="cb10-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb10-9"></a><span class="op">}</span></span></code></pre></div>
<p>There! We’ve declared a couple of variables. We haven’t used them yet, and they’re both uninitialized. One holds an integer number, and the other holds a floating point number (a real number, basically, if you have a math background).</p>
<p>Uninitialized variables have indeterminate value<a href="https://beej.us/guide/bgc/html/index-wide.html#fn37" class="footnote-ref" id="fnref37" role="doc-noteref"><sup>37</sup></a>. They have to be initialized or else you must assume they contain some nonsense number.</p>
<blockquote>
<p>This is one of the places C can “get you”. Much of the time, in my experience, the indeterminate value is zero… but it can vary from run to run! Never assume the value will be zero, even if you see it is. <em>Always</em> explicitly initialize variables to some value before you use them<a href="https://beej.us/guide/bgc/html/index-wide.html#fn38" class="footnote-ref" id="fnref38" role="doc-noteref"><sup>38</sup></a>.</p>
</blockquote>
<p>What’s this? You want to store some numbers in those variables? Insanity!</p>
<p>Let’s go ahead and do that: </p>
<div class="sourceCode" id="cb11"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb11-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb11-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb11-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb11-2"></a><span class="op">{</span></span>
<span id="cb11-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb11-3"></a>    <span class="dt">int</span> i<span class="op">;</span></span>
<span id="cb11-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb11-4"></a></span>
<span id="cb11-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb11-5"></a>    i <span class="op">=</span> <span class="dv">2</span><span class="op">;</span> <span class="co">// Assign the value 2 into the variable i</span></span>
<span id="cb11-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb11-6"></a></span>
<span id="cb11-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb11-7"></a>    printf<span class="op">(</span><span class="st">"Hello, World!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb11-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb11-8"></a><span class="op">}</span></span></code></pre></div>
<p>Killer. We’ve stored a value. Let’s print it.</p>
<p>We’re going to do that by passing <em>two</em> amazing arguments to the <code>printf()</code> function. The first argument is a string that describes what to print and how to print it (called the <em>format string</em>), and the second is the value to print, namely whatever is in the variable <code>i</code>.</p>
<p><code>printf()</code> hunts through the format string for a variety of special sequences which start with a percent sign (<code>%</code>) that tell it what to print. For example, if it finds a <code>%d</code>, it looks to the next parameter that was passed, and prints it out as an integer. If it finds a <code>%f</code>, it prints the value out as a float. If it finds a <code>%s</code>, it prints a string.</p>
<p>As such, we can print out the value of various types like so:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb12-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb12-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb12-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb12-2"></a></span>
<span id="cb12-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb12-3"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb12-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb12-4"></a><span class="op">{</span></span>
<span id="cb12-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb12-5"></a>    <span class="dt">int</span> i <span class="op">=</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb12-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb12-6"></a>    <span class="dt">float</span> f <span class="op">=</span> <span class="fl">3.14</span><span class="op">;</span></span>
<span id="cb12-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb12-7"></a>    <span class="dt">char</span> <span class="op">*</span>s <span class="op">=</span> <span class="st">"Hello, world!"</span><span class="op">;</span>  <span class="co">// char * ("char pointer") is the string type</span></span>
<span id="cb12-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb12-8"></a></span>
<span id="cb12-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb12-9"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%s</span><span class="st">  i = </span><span class="sc">%d</span><span class="st"> and f = </span><span class="sc">%f</span><span class="st">!</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> s<span class="op">,</span> i<span class="op">,</span> f<span class="op">);</span></span>
<span id="cb12-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb12-10"></a><span class="op">}</span></span></code></pre></div>
<p>And the output will be:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb13-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb13-1" aria-hidden="true" tabindex="-1"></a>Hello, world!  i = 2 and f = 3.14!</span></code></pre></div>
<p>In this way, <code>printf()</code> might be similar to various types of format strings or parameterized strings in other languages you’re familiar with. </p>
<h3 data-number="3.1.3" id="boolean-types"><span class="header-section-number">3.1.3</span> Boolean Types</h3>
<p>C has Boolean types, true or false?</p>
<p><code>1</code>!</p>
<p>Historically, C didn’t have a Boolean type, and some might argue it still doesn’t.</p>
<p>In C, <code>0</code> means “false”, and non-zero means “true”.</p>
<p>So <code>1</code> is true. And <code>-37</code> is true. And <code>0</code> is false.</p>
<p>You can just declare Boolean types as <code>int</code>s:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb14-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> x <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb14-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>x<span class="op">)</span> <span class="op">{</span></span>
<span id="cb14-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb14-4" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"x is true!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb14-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb14-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>If you <code>#include &lt;stdbool.h&gt;</code>, you also get access to some symbolic names that might make things look more familiar, namely a <code>bool</code> type and <code>true</code> and <code>false</code> values:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb15-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb15-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb15-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb15-2"></a><span class="pp">#include </span><span class="im">&lt;stdbool.h&gt;</span></span>
<span id="cb15-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb15-3"></a></span>
<span id="cb15-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb15-4"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb15-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb15-5"></a>    <span class="dt">bool</span> x <span class="op">=</span> true<span class="op">;</span></span>
<span id="cb15-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb15-6"></a></span>
<span id="cb15-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb15-7"></a>    <span class="cf">if</span> <span class="op">(</span>x<span class="op">)</span> <span class="op">{</span></span>
<span id="cb15-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb15-8"></a>        printf<span class="op">(</span><span class="st">"x is true!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb15-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb15-9"></a>    <span class="op">}</span></span>
<span id="cb15-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb15-10"></a><span class="op">}</span></span></code></pre></div>
<p>But these are identical to using integer values for true and false. They’re just a facade to make things look nice.</p>
<h2 data-number="3.2" id="operators"><span class="header-section-number">3.2</span> Operators and Expressions</h2>
<p>C operators should be familiar to you from other languages. Let’s blast through some of them here.</p>
<p>(There are a bunch more details than this, but we’re going to do enough in this section to get started.)</p>
<h3 data-number="3.2.1" id="arithmetic"><span class="header-section-number">3.2.1</span> Arithmetic</h3>
<p>Hopefully these are familiar: </p>
<div class="sourceCode" id="cb16"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb16-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb16-1" aria-hidden="true" tabindex="-1"></a>i <span class="op">=</span> i <span class="op">+</span> <span class="dv">3</span><span class="op">;</span>  <span class="co">// Addition (+) and assignment (=) operators, add 3 to i</span></span>
<span id="cb16-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb16-2" aria-hidden="true" tabindex="-1"></a>i <span class="op">=</span> i <span class="op">-</span> <span class="dv">8</span><span class="op">;</span>  <span class="co">// Subtraction, subtract 8 from i</span></span>
<span id="cb16-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb16-3" aria-hidden="true" tabindex="-1"></a>i <span class="op">=</span> i <span class="op">*</span> <span class="dv">9</span><span class="op">;</span>  <span class="co">// Multiplication</span></span>
<span id="cb16-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb16-4" aria-hidden="true" tabindex="-1"></a>i <span class="op">=</span> i <span class="op">/</span> <span class="dv">2</span><span class="op">;</span>  <span class="co">// Division</span></span>
<span id="cb16-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb16-5" aria-hidden="true" tabindex="-1"></a>i <span class="op">=</span> i <span class="op">%</span> <span class="dv">5</span><span class="op">;</span>  <span class="co">// Modulo (division remainder)</span></span></code></pre></div>
<p>There are shorthand variants for all of the above. Each of those lines could more tersely be written as: </p>
<div class="sourceCode" id="cb17"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb17-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb17-1" aria-hidden="true" tabindex="-1"></a>i <span class="op">+=</span> <span class="dv">3</span><span class="op">;</span>  <span class="co">// Same as "i = i + 3", add 3 to i</span></span>
<span id="cb17-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb17-2" aria-hidden="true" tabindex="-1"></a>i <span class="op">-=</span> <span class="dv">8</span><span class="op">;</span>  <span class="co">// Same as "i = i - 8"</span></span>
<span id="cb17-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb17-3" aria-hidden="true" tabindex="-1"></a>i <span class="op">*=</span> <span class="dv">9</span><span class="op">;</span>  <span class="co">// Same as "i = i * 9"</span></span>
<span id="cb17-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb17-4" aria-hidden="true" tabindex="-1"></a>i <span class="op">/=</span> <span class="dv">2</span><span class="op">;</span>  <span class="co">// Same as "i = i / 2"</span></span>
<span id="cb17-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb17-5" aria-hidden="true" tabindex="-1"></a>i <span class="op">%=</span> <span class="dv">5</span><span class="op">;</span>  <span class="co">// Same as "i = i % 5"</span></span></code></pre></div>
<p>There is no exponentiation. You’ll have to use one of the <code>pow()</code> function variants from <code>math.h</code>.</p>
<p>Let’s get into some of the weirder stuff you might not have in your other languages!</p>
<h3 data-number="3.2.2" id="ternary-operator"><span class="header-section-number">3.2.2</span> Ternary Operator</h3>
<p>C also includes the <em>ternary operator</em>. This is an expression whose value depends on the result of a conditional embedded in it.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb18-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co">// If x &gt; 10, add 17 to y. Otherwise add 37 to y.</span></span>
<span id="cb18-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb18-3" aria-hidden="true" tabindex="-1"></a>y <span class="op">+=</span> x <span class="op">&gt;</span> <span class="dv">10</span><span class="op">?</span> <span class="dv">17</span><span class="op">:</span> <span class="dv">37</span><span class="op">;</span></span></code></pre></div>
<p>What a mess! You’ll get used to it the more you read it. To help out a bit, I’ll rewrite the above expression using <code>if</code> statements:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb19-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co">// This expression:</span></span>
<span id="cb19-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb19-3" aria-hidden="true" tabindex="-1"></a>y <span class="op">+=</span> x <span class="op">&gt;</span> <span class="dv">10</span><span class="op">?</span> <span class="dv">17</span><span class="op">:</span> <span class="dv">37</span><span class="op">;</span></span>
<span id="cb19-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="co">// is equivalent to this non-expression:</span></span>
<span id="cb19-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb19-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>x <span class="op">&gt;</span> <span class="dv">10</span><span class="op">)</span></span>
<span id="cb19-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb19-8" aria-hidden="true" tabindex="-1"></a>    y <span class="op">+=</span> <span class="dv">17</span><span class="op">;</span></span>
<span id="cb19-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span></span>
<span id="cb19-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb19-10" aria-hidden="true" tabindex="-1"></a>    y <span class="op">+=</span> <span class="dv">37</span><span class="op">;</span></span></code></pre></div>
<p>Compare those two until you see each of the components of the ternary operator.</p>
<p>Or, another example that prints if a number stored in <code>x</code> is odd or even:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb20-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb20-1" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"The number </span><span class="sc">%d</span><span class="st"> is </span><span class="sc">%s</span><span class="st">.</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> x<span class="op">,</span> x <span class="op">%</span> <span class="dv">2</span> <span class="op">==</span> <span class="dv">0</span><span class="op">?</span> <span class="st">"even"</span><span class="op">:</span> <span class="st">"odd"</span><span class="op">)</span></span></code></pre></div>
<p>The <code>%s</code> format specifier in <code>printf()</code> means print a string. If the expression <code>x % 2</code> evaluates to <code>0</code>, the value of the entire ternary expression evaluates to the string <code>"even"</code>. Otherwise it evaluates to the string <code>"odd"</code>. Pretty cool!</p>
<p>It’s important to note that the ternary operator isn’t flow control like the <code>if</code> statement is. It’s just an expression that evaluates to a value. </p>
<h3 data-number="3.2.3" id="pre-and-post-increment-and-decrement"><span class="header-section-number">3.2.3</span> Pre-and-Post Increment-and-Decrement</h3>
<p> Now, let’s mess with another thing that you might not have seen.</p>
<p>These are the legendary post-increment and post-decrement operators:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb21-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb21-1" aria-hidden="true" tabindex="-1"></a>i<span class="op">++;</span>        <span class="co">// Add one to i (post-increment)</span></span>
<span id="cb21-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb21-2" aria-hidden="true" tabindex="-1"></a>i<span class="op">--;</span>        <span class="co">// Subtract one from i (post-decrement)</span></span></code></pre></div>
<p>Very commonly, these are just used as shorter versions of:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb22-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb22-1" aria-hidden="true" tabindex="-1"></a>i <span class="op">+=</span> <span class="dv">1</span><span class="op">;</span>        <span class="co">// Add one to i</span></span>
<span id="cb22-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb22-2" aria-hidden="true" tabindex="-1"></a>i <span class="op">-=</span> <span class="dv">1</span><span class="op">;</span>        <span class="co">// Subtract one from i</span></span></code></pre></div>
<p>but they’re more subtly different than that, the clever scoundrels.</p>
<p>Let’s take a look at this variant, pre-increment and pre-decrement:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb23-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="op">++</span>i<span class="op">;</span>        <span class="co">// Add one to i (pre-increment)</span></span>
<span id="cb23-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="op">--</span>i<span class="op">;</span>        <span class="co">// Subtract one from i (pre-decrement)</span></span></code></pre></div>
<p>With pre-increment and pre-decrement, the value of the variable is incremented or decremented <em>before</em> the expression is evaluated. Then the expression is evaluated with the new value.</p>
<p>With post-increment and post-decrement, the value of the expression is first computed with the value as-is, and <em>then</em> the value is incremented or decremented after the value of the expression has been determined.</p>
<p>You can actually embed them in expressions, like this:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb24-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb24-1" aria-hidden="true" tabindex="-1"></a>i <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb24-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb24-2" aria-hidden="true" tabindex="-1"></a>j <span class="op">=</span> <span class="dv">5</span> <span class="op">+</span> i<span class="op">++;</span>  <span class="co">// Compute 5 + i, _then_ increment i</span></span>
<span id="cb24-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb24-4" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">%d</span><span class="st">, </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> i<span class="op">,</span> j<span class="op">);</span>  <span class="co">// Prints 11, 15</span></span></code></pre></div>
<p>Let’s compare this to the pre-increment operator:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb25-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb25-1" aria-hidden="true" tabindex="-1"></a>i <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb25-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb25-2" aria-hidden="true" tabindex="-1"></a>j <span class="op">=</span> <span class="dv">5</span> <span class="op">+</span> <span class="op">++</span>i<span class="op">;</span>  <span class="co">// Increment i, _then_ compute 5 + i</span></span>
<span id="cb25-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb25-4" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">%d</span><span class="st">, </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> i<span class="op">,</span> j<span class="op">);</span>  <span class="co">// Prints 11, 16</span></span></code></pre></div>
<p>This technique is used frequently with array and pointer access and manipulation. It gives you a way to use the value in a variable, and also increment or decrement that value before or after it is used.</p>
<p>But by far the most common place you’ll see this is in a <code>for</code> loop:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb26-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="op">(</span>i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">10</span><span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb26-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb26-2" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"i is </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> i<span class="op">);</span></span></code></pre></div>
<p>But more on that later. </p>
<h3 data-number="3.2.4" id="the-comma-operator"><span class="header-section-number">3.2.4</span> The Comma Operator</h3>
<p> This is an uncommonly-used way to separate expressions that will run left to right:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb27-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb27-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> <span class="dv">10</span><span class="op">,</span> y <span class="op">=</span> <span class="dv">20</span><span class="op">;</span>  <span class="co">// First assign 10 to x, then 20 to y</span></span></code></pre></div>
<p>Seems a bit silly, since you could just replace the comma with a semicolon, right?</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb28-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb28-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> <span class="dv">10</span><span class="op">;</span> y <span class="op">=</span> <span class="dv">20</span><span class="op">;</span>  <span class="co">// First assign 10 to x, then 20 to y</span></span></code></pre></div>
<p>But that’s a little different. The latter is two separate expressions, while the former is a single expression!</p>
<p>With the comma operator, the value of the comma expression is the value of the rightmost expression:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb29-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb29-1" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> <span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">3</span><span class="op">);</span></span>
<span id="cb29-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb29-3" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"x is </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> x<span class="op">);</span>  <span class="co">// Prints 3, because 3 is rightmost in the comma list</span></span></code></pre></div>
<p>But even that’s pretty contrived. One common place the comma operator is used is in <code>for</code> loops to do multiple things in each section of the statement:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb30-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="op">(</span>i <span class="op">=</span> <span class="dv">0</span><span class="op">,</span> j <span class="op">=</span> <span class="dv">10</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">100</span><span class="op">;</span> i<span class="op">++,</span> j<span class="op">++)</span></span>
<span id="cb30-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb30-2" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%d</span><span class="st">, </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> i<span class="op">,</span> j<span class="op">);</span></span></code></pre></div>
<p>We’ll revisit that later. </p>
<h3 data-number="3.2.5" id="conditional-operators"><span class="header-section-number">3.2.5</span> Conditional Operators</h3>
<p> For Boolean values, we have a raft of standard operators: </p>
<div class="sourceCode" id="cb31"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb31-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb31-1" aria-hidden="true" tabindex="-1"></a>a <span class="op">==</span> b<span class="op">;</span>  <span class="co">// True if a is equivalent to b</span></span>
<span id="cb31-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb31-2" aria-hidden="true" tabindex="-1"></a>a <span class="op">!=</span> b<span class="op">;</span>  <span class="co">// True if a is not equivalent to b</span></span>
<span id="cb31-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb31-3" aria-hidden="true" tabindex="-1"></a>a <span class="op">&lt;</span> b<span class="op">;</span>   <span class="co">// True if a is less than b</span></span>
<span id="cb31-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb31-4" aria-hidden="true" tabindex="-1"></a>a <span class="op">&gt;</span> b<span class="op">;</span>   <span class="co">// True if a is greater than b</span></span>
<span id="cb31-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb31-5" aria-hidden="true" tabindex="-1"></a>a <span class="op">&lt;=</span> b<span class="op">;</span>  <span class="co">// True if a is less than or equal to b</span></span>
<span id="cb31-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb31-6" aria-hidden="true" tabindex="-1"></a>a <span class="op">&gt;=</span> b<span class="op">;</span>  <span class="co">// True if a is greater than or equal to b</span></span></code></pre></div>
<p>Don’t mix up assignment <code>=</code> with comparison <code>==</code>! Use two equals to compare, one to assign.</p>
<p>We can use the comparison expressions with <code>if</code> statements:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb32-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>a <span class="op">&lt;=</span> <span class="dv">10</span><span class="op">)</span></span>
<span id="cb32-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb32-2" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Success!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span></code></pre></div>
<p></p>
<h3 data-number="3.2.6" id="boolean-operators"><span class="header-section-number">3.2.6</span> Boolean Operators</h3>
<p> We can chain together or alter conditional expressions with Boolean operators for <em>and</em>, <em>or</em>, and <em>not</em>. </p>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">Operator</th>
<th style="text-align: center;">Boolean meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><code>&amp;&amp;</code></td>
<td style="text-align: center;">and</td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>||</code></td>
<td style="text-align: center;">or</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code>!</code></td>
<td style="text-align: center;">not</td>
</tr>
</tbody>
</table>
<p>An example of Boolean “and”:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb33-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Do something if x less than 10 and y greater than 20:</span></span>
<span id="cb33-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb33-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>x <span class="op">&lt;</span> <span class="dv">10</span> <span class="op">&amp;&amp;</span> y <span class="op">&gt;</span> <span class="dv">20</span><span class="op">)</span></span>
<span id="cb33-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb33-4" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Doing something!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span></code></pre></div>
<p>An example of Boolean “not”:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb34-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(!(</span>x <span class="op">&lt;</span> <span class="dv">12</span><span class="op">))</span></span>
<span id="cb34-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb34-2" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"x is not less than 12</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span></code></pre></div>
<p><code>!</code> has higher precedence than the other Boolean operators, so we have to use parentheses in that case.</p>
<p>Of course, that’s just the same as:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb35-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>x <span class="op">&gt;=</span> <span class="dv">12</span><span class="op">)</span></span>
<span id="cb35-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb35-2" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"x is not less than 12</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span></code></pre></div>
<p>but I needed the example! </p>
<h3 data-number="3.2.7" id="sizeof-operator"><span class="header-section-number">3.2.7</span> The <code>sizeof</code> Operator</h3>
<p> This operator tells you the size (in bytes) that a particular variable or data type uses in memory.</p>
<p>More particularly, it tells you the size (in bytes) that the <em>type of a particular expression</em> (which might be just a single variable) uses in memory.</p>
<p>This can be different on different systems, except for <code>char</code> and its variants (which are always 1 byte).</p>
<p>And this might not seem very useful now, but we’ll be making references to it here and there, so it’s worth covering.</p>
<p>Since this computes the number of bytes needed to store a type, you might think it would return an <code>int</code>. Or… since the size can’t be negative, maybe an <code>unsigned</code>?</p>
<p> But it turns out C has a special type to represent the return value from <code>sizeof</code>. It’s <code>size_t</code>, pronounced “<em>size tee</em>”<a href="https://beej.us/guide/bgc/html/index-wide.html#fn39" class="footnote-ref" id="fnref39" role="doc-noteref"><sup>39</sup></a>. All we know is that it’s an unsigned integer type that can hold the size in bytes of anything you can give to <code>sizeof</code>.</p>
<p><code>size_t</code> shows up a lot of different places where counts of things are passed or returned. Think of it as a value that represents a count. </p>
<p>You can take the <code>sizeof</code> a variable or expression:</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb36-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> a <span class="op">=</span> <span class="dv">999</span><span class="op">;</span></span>
<span id="cb36-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb36-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="co">// %zu is the format specifier for type size_t</span></span>
<span id="cb36-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb36-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb36-5" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">%zu\n</span><span class="st">"</span><span class="op">,</span> <span class="kw">sizeof</span> a<span class="op">);</span>      <span class="co">// Prints 4 on my system</span></span>
<span id="cb36-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb36-6" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">%zu\n</span><span class="st">"</span><span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dv">2</span> <span class="op">+</span> <span class="dv">7</span><span class="op">));</span> <span class="co">// Prints 4 on my system</span></span>
<span id="cb36-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb36-7" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">%zu\n</span><span class="st">"</span><span class="op">,</span> <span class="kw">sizeof</span> <span class="fl">3.14</span><span class="op">);</span>   <span class="co">// Prints 8 on my system</span></span>
<span id="cb36-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb36-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb36-9" aria-hidden="true" tabindex="-1"></a><span class="co">// If you need to print out negative size_t values, use %zd</span></span></code></pre></div>
<p>Remember: it’s the size in bytes of the <em>type</em> of the expression, not the size of the expression itself. That’s why the size of <code>2+7</code> is the same as the size of <code>a</code>—they’re both type <code>int</code>. We’ll revisit this number <code>4</code> in the very next block of code…</p>
<p>…Where we’ll see you can take the <code>sizeof</code> a type (note the parentheses are required around a type name, unlike an expression):</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb37-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb37-1" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">%zu\n</span><span class="st">"</span><span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">int</span><span class="op">));</span>   <span class="co">// Prints 4 on my system</span></span>
<span id="cb37-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb37-2" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">%zu\n</span><span class="st">"</span><span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">char</span><span class="op">));</span>  <span class="co">// Prints 1 on all systems</span></span></code></pre></div>
<p>It’s important to note that <code>sizeof</code> is a <em>compile-time</em> operation<a href="https://beej.us/guide/bgc/html/index-wide.html#fn40" class="footnote-ref" id="fnref40" role="doc-noteref"><sup>40</sup></a>. The result of the expression is determined entirely at compile-time, not at runtime.</p>
<p>We’ll make use of this later on. </p>
<h2 data-number="3.3" id="flow-control"><span class="header-section-number">3.3</span> Flow Control</h2>
<p> Booleans are all good, but of course we’re nowhere if we can’t control program flow. Let’s take a look at a number of constructs: <code>if</code>, <code>for</code>, <code>while</code>, and <code>do-while</code>.</p>
<p>First, a general forward-looking note about statements and blocks of statements brought to you by your local friendly C developer:</p>
<p>After something like an <code>if</code> or <code>while</code> statement, you can either put a single statement to be executed, or a block of statements to all be executed in sequence.</p>
<p> Let’s start with a single statement:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb38-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>x <span class="op">==</span> <span class="dv">10</span><span class="op">)</span> printf<span class="op">(</span><span class="st">"x is 10</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span></code></pre></div>
<p>This is also sometimes written on a separate line. (Whitespace is largely irrelevant in C—it’s not like Python.)</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb39-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>x <span class="op">==</span> <span class="dv">10</span><span class="op">)</span></span>
<span id="cb39-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb39-2" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"x is 10</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span></code></pre></div>
<p>But what if you want multiple things to happen due to the conditional? You can use squirrelly braces to mark a <em>block</em> or <em>compound statement</em>.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb40-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>x <span class="op">==</span> <span class="dv">10</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb40-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb40-2" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"x is 10</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb40-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb40-3" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"And also this happens when x is 10</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb40-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>It’s a really common style to <em>always</em> use squirrelly braces even if they aren’t necessary:</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb41-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>x <span class="op">==</span> <span class="dv">10</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb41-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb41-2" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"x is 10</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb41-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Some devs feel the code is easier to read and avoids errors like this where things visually look like they’re in the <code>if</code> block, but actually they aren’t.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb42-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="co">// BAD ERROR EXAMPLE</span></span>
<span id="cb42-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb42-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>x <span class="op">==</span> <span class="dv">10</span><span class="op">)</span></span>
<span id="cb42-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb42-4" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"This happens if x is 10</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb42-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb42-5" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"This happens ALWAYS</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span>  <span class="co">// Surprise!! Unconditional!</span></span></code></pre></div>
<p><code>while</code> and <code>for</code> and the other looping constructs work the same way as the examples above. If you want to do multiple things in a loop or after an <code>if</code>, wrap them up in squirrelly braces.</p>
<p>In other words, the <code>if</code> is going to run the one thing after the <code>if</code>. And that one thing can be a single statement or a block of statements. </p>
<h3 data-number="3.3.1" id="ifstat"><span class="header-section-number">3.3.1</span> The <code>if</code>-<code>else</code> statement</h3>
<p> We’ve already been using <code>if</code> for multiple examples, since it’s likely you’ve seen it in a language before, but here’s another:</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb43-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> i <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb43-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb43-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>i <span class="op">&gt;</span> <span class="dv">10</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb43-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb43-4" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Yes, i is greater than 10.</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb43-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb43-5" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"And this will also print if i is greater than 10.</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb43-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb43-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb43-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb43-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb43-8" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>i <span class="op">&lt;=</span> <span class="dv">10</span><span class="op">)</span> printf<span class="op">(</span><span class="st">"i is less than or equal to 10.</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span></code></pre></div>
<p>In the example code, the message will print if <code>i</code> is greater than 10, otherwise execution continues to the next line. Notice the squirrley braces after the <code>if</code> statement; if the condition is true, either the first statement or expression right after the if will be executed, or else the collection of code in the squirlley braces after the <code>if</code> will be executed. This sort of <em>code block</em> behavior is common to all statements.</p>
<p>Of course, because C is fun this way, you can also do something if the condition is false with an <code>else</code> clause on your <code>if</code>:</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb44-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> i <span class="op">=</span> <span class="dv">99</span><span class="op">;</span></span>
<span id="cb44-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb44-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb44-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>i <span class="op">==</span> <span class="dv">10</span><span class="op">)</span></span>
<span id="cb44-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb44-4" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"i is 10!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb44-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb44-5" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span> <span class="op">{</span></span>
<span id="cb44-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb44-6" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"i is decidedly not 10.</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb44-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb44-7" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Which irritates me a little, frankly.</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb44-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb44-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>And you can even cascade these to test a variety of conditions, like this:</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb45-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> i <span class="op">=</span> <span class="dv">99</span><span class="op">;</span></span>
<span id="cb45-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb45-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>i <span class="op">==</span> <span class="dv">10</span><span class="op">)</span></span>
<span id="cb45-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb45-4" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"i is 10!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb45-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb45-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb45-6" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>i <span class="op">==</span> <span class="dv">20</span><span class="op">)</span></span>
<span id="cb45-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb45-7" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"i is 20!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb45-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb45-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb45-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb45-9" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>i <span class="op">==</span> <span class="dv">99</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb45-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb45-10" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"i is 99! My favorite</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb45-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb45-11" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"I can't tell you how happy I am.</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb45-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb45-12" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Really.</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb45-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb45-13" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb45-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb45-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb45-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb45-15" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span></span>
<span id="cb45-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb45-16" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"i is some crazy number I've never heard of.</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span></code></pre></div>
<p>Though if you’re going that route, be sure to check out the <a href="https://beej.us/guide/bgc/html/index-wide.html#switch-statement"><code>switch</code></a> statement for a potentially better solution. The catch is <code>switch</code> only works with equality comparisons with constant numbers. The above <code>if</code>-<code>else</code> cascade could check inequality, ranges, variables, or anything else you can craft in a conditional expression. </p>
<h3 data-number="3.3.2" id="whilestat"><span class="header-section-number">3.3.2</span> The <code>while</code> statement</h3>
<p> <code>while</code> is your average run-of-the-mill looping construct. Do a thing while a condition expression is true.</p>
<p>Let’s do one!</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb46-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Print the following output:</span></span>
<span id="cb46-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="co">//</span></span>
<span id="cb46-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="co">//   i is now 0!</span></span>
<span id="cb46-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="co">//   i is now 1!</span></span>
<span id="cb46-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb46-5" aria-hidden="true" tabindex="-1"></a><span class="co">//   [ more of the same between 2 and 7 ]</span></span>
<span id="cb46-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb46-6" aria-hidden="true" tabindex="-1"></a><span class="co">//   i is now 8!</span></span>
<span id="cb46-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb46-7" aria-hidden="true" tabindex="-1"></a><span class="co">//   i is now 9!</span></span>
<span id="cb46-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb46-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb46-9" aria-hidden="true" tabindex="-1"></a>i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb46-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb46-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb46-11" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="op">(</span>i <span class="op">&lt;</span> <span class="dv">10</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb46-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb46-12" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"i is now </span><span class="sc">%d</span><span class="st">!</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> i<span class="op">);</span></span>
<span id="cb46-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb46-13" aria-hidden="true" tabindex="-1"></a>    i<span class="op">++;</span></span>
<span id="cb46-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb46-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb46-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb46-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb46-16" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"All done!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span></code></pre></div>
<p>That gets you a basic loop. C also has a <code>for</code> loop which would have been cleaner for that example.</p>
<p>A not-uncommon use of <code>while</code> is for infinite loops where you repeat while true:</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb47-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="op">(</span><span class="dv">1</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb47-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb47-2" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"1 is always true, so this repeats forever.</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb47-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb47-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p></p>
<h3 data-number="3.3.3" id="dowhilestat"><span class="header-section-number">3.3.3</span> The <code>do-while</code> statement</h3>
<p> So now that we’ve gotten the <code>while</code> statement under control, let’s take a look at its closely related cousin, <code>do-while</code>.</p>
<p>They are basically the same, except if the loop condition is false on the first pass, <code>do-while</code> will execute once, but <code>while</code> won’t execute at all. In other words, the test to see whether or not to execute the block happens at the <em>end</em> of the block with <code>do-while</code>. It happens at the <em>beginning</em> of the block with <code>while</code>.</p>
<p>Let’s see by example:</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb48-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Using a while statement:</span></span>
<span id="cb48-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb48-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb48-3" aria-hidden="true" tabindex="-1"></a>i <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb48-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb48-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb48-5" aria-hidden="true" tabindex="-1"></a><span class="co">// this is not executed because i is not less than 10:</span></span>
<span id="cb48-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb48-6" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span><span class="op">(</span>i <span class="op">&lt;</span> <span class="dv">10</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb48-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb48-7" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"while: i is </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> i<span class="op">);</span></span>
<span id="cb48-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb48-8" aria-hidden="true" tabindex="-1"></a>    i<span class="op">++;</span></span>
<span id="cb48-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb48-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb48-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb48-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb48-11" aria-hidden="true" tabindex="-1"></a><span class="co">// Using a do-while statement:</span></span>
<span id="cb48-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb48-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb48-13" aria-hidden="true" tabindex="-1"></a>i <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb48-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb48-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb48-15" aria-hidden="true" tabindex="-1"></a><span class="co">// this is executed once, because the loop condition is not checked until</span></span>
<span id="cb48-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb48-16" aria-hidden="true" tabindex="-1"></a><span class="co">// after the body of the loop runs:</span></span>
<span id="cb48-17"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb48-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-18"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb48-18" aria-hidden="true" tabindex="-1"></a><span class="cf">do</span> <span class="op">{</span></span>
<span id="cb48-19"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb48-19" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"do-while: i is </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> i<span class="op">);</span></span>
<span id="cb48-20"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb48-20" aria-hidden="true" tabindex="-1"></a>    i<span class="op">++;</span></span>
<span id="cb48-21"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb48-21" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> <span class="cf">while</span> <span class="op">(</span>i <span class="op">&lt;</span> <span class="dv">10</span><span class="op">);</span></span>
<span id="cb48-22"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb48-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-23"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb48-23" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"All done!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span></code></pre></div>
<p>Notice that in both cases, the loop condition is false right away. So in the <code>while</code>, the loop fails, and the following block of code is never executed. With the <code>do-while</code>, however, the condition is checked <em>after</em> the block of code executes, so it always executes at least once. In this case, it prints the message, increments <code>i</code>, then fails the condition, and continues to the “All done!” output.</p>
<p>The moral of the story is this: if you want the loop to execute at least once, no matter what the loop condition, use <code>do-while</code>.</p>
<p>All these examples might have been better done with a <code>for</code> loop. Let’s do something less deterministic—repeat until a certain random number comes up!</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb49-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb49-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span><span class="pp">   </span><span class="co">// For printf</span></span>
<span id="cb49-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb49-2"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span><span class="pp">  </span><span class="co">// For rand</span></span>
<span id="cb49-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb49-3"></a></span>
<span id="cb49-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb49-4"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb49-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb49-5"></a><span class="op">{</span></span>
<span id="cb49-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb49-6"></a>    <span class="dt">int</span> r<span class="op">;</span></span>
<span id="cb49-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb49-7"></a></span>
<span id="cb49-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb49-8"></a>    <span class="cf">do</span> <span class="op">{</span></span>
<span id="cb49-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb49-9"></a>        r <span class="op">=</span> rand<span class="op">()</span> <span class="op">%</span> <span class="dv">100</span><span class="op">;</span> <span class="co">// Get a random number between 0 and 99</span></span>
<span id="cb49-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb49-10"></a>        printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> r<span class="op">);</span></span>
<span id="cb49-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb49-11"></a>    <span class="op">}</span> <span class="cf">while</span> <span class="op">(</span>r <span class="op">!=</span> <span class="dv">37</span><span class="op">);</span>    <span class="co">// Repeat until 37 comes up</span></span>
<span id="cb49-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb49-12"></a><span class="op">}</span></span></code></pre></div>
<p>Side note: did you run that more than once? If you did, did you notice the same sequence of numbers came up again. And again. And again? This is because <code>rand()</code> is a pseudorandom number generator that must be <em>seeded</em> with a different number in order to generate a different sequence. Look up the <a href="https://beej.us/guide/bgclr/html/split/stdlib.html#man-srand"><code>srand()</code></a><a href="https://beej.us/guide/bgc/html/index-wide.html#fn41" class="footnote-ref" id="fnref41" role="doc-noteref"><sup>41</sup></a> function for more details. </p>
<h3 data-number="3.3.4" id="forstat"><span class="header-section-number">3.3.4</span> The <code>for</code> statement</h3>
<p> Welcome to one of the most popular loops in the world! The <code>for</code> loop!</p>
<p>This is a great loop if you know the number of times you want to loop in advance.</p>
<p>You could do the same thing using just a <code>while</code> loop, but the <code>for</code> loop can help keep the code cleaner.</p>
<p>Here are two pieces of equivalent code—note how the <code>for</code> loop is just a more compact representation:</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb50-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Print numbers between 0 and 9, inclusive...</span></span>
<span id="cb50-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb50-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="co">// Using a while statement:</span></span>
<span id="cb50-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb50-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb50-5" aria-hidden="true" tabindex="-1"></a>i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb50-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb50-6" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="op">(</span>i <span class="op">&lt;</span> <span class="dv">10</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb50-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb50-7" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"i is </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> i<span class="op">);</span></span>
<span id="cb50-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb50-8" aria-hidden="true" tabindex="-1"></a>    i<span class="op">++;</span></span>
<span id="cb50-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb50-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb50-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb50-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb50-11" aria-hidden="true" tabindex="-1"></a><span class="co">// Do the exact same thing with a for-loop:</span></span>
<span id="cb50-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb50-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb50-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="op">(</span>i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">10</span><span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb50-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb50-14" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"i is </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> i<span class="op">);</span></span>
<span id="cb50-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb50-15" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>That’s right, folks—they do exactly the same thing. But you can see how the <code>for</code> statement is a little more compact and easy on the eyes. (JavaScript users will fully appreciate its C origins at this point.)</p>
<p>It’s split into three parts, separated by semicolons. The first is the initialization, the second is the loop condition, and the third is what should happen at the end of the block if the loop condition is true. All three of these parts are optional.</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb51-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="op">(</span>initialize things<span class="op">;</span> loop <span class="cf">if</span> this is true<span class="op">;</span> <span class="cf">do</span> this after each loop<span class="op">)</span></span></code></pre></div>
<p>Note that the loop will not execute even a single time if the loop condition starts off false.</p>
<blockquote>
<p><strong><code>for</code>-loop fun fact!</strong></p>
<p>You can use the comma operator to do multiple things in each clause of the <code>for</code> loop!</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb52-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="op">(</span>i <span class="op">=</span> <span class="dv">0</span><span class="op">,</span> j <span class="op">=</span> <span class="dv">999</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">10</span><span class="op">;</span> i<span class="op">++,</span> j<span class="op">--)</span> <span class="op">{</span></span>
<span id="cb52-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb52-2" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%d</span><span class="st">, </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> i<span class="op">,</span> j<span class="op">);</span></span>
<span id="cb52-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
</blockquote>
<p>An empty <code>for</code> will run forever:</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb53-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span><span class="op">(;;)</span> <span class="op">{</span>  <span class="co">// "forever"</span></span>
<span id="cb53-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb53-2" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"I will print this again and again and again</span><span class="sc">\n</span><span class="st">"</span> <span class="op">);</span></span>
<span id="cb53-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb53-3" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"for all eternity until the heat-death of the universe.</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb53-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb53-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb53-5" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Or until you hit CTRL-C.</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb53-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb53-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p></p>
<h3 data-number="3.3.5" id="switch-statement"><span class="header-section-number">3.3.5</span> The <code>switch</code> Statement</h3>
<p> Depending on what languages you’re coming from, you might or might not be familiar with <code>switch</code>, or C’s version might even be more restrictive than you’re used to. This is a statement that allows you to take a variety of actions depending on the value of an integer expression.</p>
<p>Basically, it evaluates an expression to an integer value, jumps to the <code>case</code> that corresponds to that value. Execution resumes from that point. If a <code>break</code> statement is encountered, then execution jumps out of the <code>switch</code>.</p>
<p>Let’s do an example where the user enters a number of goats and we print out a gut-feel of how many goats that is.</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb54-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb54-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb54-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb54-2"></a></span>
<span id="cb54-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb54-3"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb54-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb54-4"></a><span class="op">{</span></span>
<span id="cb54-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb54-5"></a>    <span class="dt">int</span> goat_count<span class="op">;</span></span>
<span id="cb54-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb54-6"></a></span>
<span id="cb54-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb54-7"></a>    printf<span class="op">(</span><span class="st">"Enter a goat count: "</span><span class="op">);</span></span>
<span id="cb54-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb54-8"></a>    scanf<span class="op">(</span><span class="st">"</span><span class="sc">%d</span><span class="st">"</span><span class="op">,</span> <span class="op">&amp;</span>goat_count<span class="op">);</span>       <span class="co">// Read an integer from the keyboard</span></span>
<span id="cb54-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb54-9"></a></span>
<span id="cb54-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb54-10"></a>    <span class="cf">switch</span> <span class="op">(</span>goat_count<span class="op">)</span> <span class="op">{</span></span>
<span id="cb54-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb54-11"></a>        <span class="cf">case</span> <span class="dv">0</span><span class="op">:</span></span>
<span id="cb54-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb54-12"></a>            printf<span class="op">(</span><span class="st">"You have no goats.</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb54-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb54-13"></a>            <span class="cf">break</span><span class="op">;</span></span>
<span id="cb54-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb54-14"></a></span>
<span id="cb54-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb54-15"></a>        <span class="cf">case</span> <span class="dv">1</span><span class="op">:</span></span>
<span id="cb54-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb54-16"></a>            printf<span class="op">(</span><span class="st">"You have a singular goat.</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb54-17"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb54-17"></a>            <span class="cf">break</span><span class="op">;</span></span>
<span id="cb54-18"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb54-18"></a></span>
<span id="cb54-19"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb54-19"></a>        <span class="cf">case</span> <span class="dv">2</span><span class="op">:</span></span>
<span id="cb54-20"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb54-20"></a>            printf<span class="op">(</span><span class="st">"You have a brace of goats.</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb54-21"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb54-21"></a>            <span class="cf">break</span><span class="op">;</span></span>
<span id="cb54-22"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb54-22"></a></span>
<span id="cb54-23"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb54-23"></a>        <span class="cf">default</span><span class="op">:</span></span>
<span id="cb54-24"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb54-24"></a>            printf<span class="op">(</span><span class="st">"You have a bona fide plethora of goats!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb54-25"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb54-25"></a>            <span class="cf">break</span><span class="op">;</span></span>
<span id="cb54-26"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb54-26"></a>    <span class="op">}</span></span>
<span id="cb54-27"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb54-27"></a><span class="op">}</span></span></code></pre></div>
<p>In that example, if the user enters, say, <code>2</code>, the <code>switch</code> will jump to the <code>case 2</code> and execute from there. When (if) it hits a <code>break</code>, it jumps out of the <code>switch</code>. </p>
<p>Also, you might see that <code>default</code> label there at the bottom. This is what happens when no cases match.</p>
<p>Every <code>case</code>, including <code>default</code>, is optional. And they can occur in any order, but it’s really typical for <code>default</code>, if any, to be listed last.</p>
<p>So the whole thing acts like an <code>if</code>-<code>else</code> cascade:</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb55-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>goat_count <span class="op">==</span> <span class="dv">0</span><span class="op">)</span></span>
<span id="cb55-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb55-2" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"You have no goats.</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb55-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb55-3" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>goat_count <span class="op">==</span> <span class="dv">1</span><span class="op">)</span></span>
<span id="cb55-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb55-4" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"You have a singular goat.</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb55-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb55-5" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span> <span class="cf">if</span> <span class="op">(</span>goat_count <span class="op">==</span> <span class="dv">2</span><span class="op">)</span></span>
<span id="cb55-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb55-6" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"You have a brace of goats.</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb55-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb55-7" aria-hidden="true" tabindex="-1"></a><span class="cf">else</span></span>
<span id="cb55-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb55-8" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"You have a bona fide plethora of goats!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span></code></pre></div>
<p>With some key differences:</p>
<ul>
<li><code>switch</code> is often faster to jump to the correct code (though the spec makes no such guarantee).</li>
<li><code>if</code>-<code>else</code> can do things like relational conditionals like <code>&lt;</code> and <code>&gt;=</code> and floating point and other types, while <code>switch</code> cannot.</li>
</ul>
<p>There’s one more neat thing about switch that you sometimes see that is quite interesting: <em>fall through</em>.</p>
<p> Remember how <code>break</code> causes us to jump out of the switch?</p>
<p> Well, what happens if we <em>don’t</em> <code>break</code>?</p>
<p>Turns out we just keep on going into the next <code>case</code>! Demo!</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb56-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="cf">switch</span> <span class="op">(</span>x<span class="op">)</span> <span class="op">{</span></span>
<span id="cb56-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb56-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="dv">1</span><span class="op">:</span></span>
<span id="cb56-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb56-3" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"1</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb56-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb56-4" aria-hidden="true" tabindex="-1"></a>        <span class="co">// Fall through!</span></span>
<span id="cb56-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb56-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="dv">2</span><span class="op">:</span></span>
<span id="cb56-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb56-6" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"2</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb56-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb56-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span><span class="op">;</span></span>
<span id="cb56-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb56-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="dv">3</span><span class="op">:</span></span>
<span id="cb56-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb56-9" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"3</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb56-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb56-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span><span class="op">;</span></span>
<span id="cb56-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb56-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>If <code>x == 1</code>, this <code>switch</code> will first hit <code>case 1</code>, it’ll print the <code>1</code>, but then it just continues on to the next line of code… which prints <code>2</code>!</p>
<p>And then, at last, we hit a <code>break</code> so we jump out of the <code>switch</code>.</p>
<p>if <code>x == 2</code>, then we just hit the <code>case 2</code>, print <code>2</code>, and <code>break</code> as normal.</p>
<p>Not having a <code>break</code> is called <em>fall through</em>.</p>
<p>ProTip: <em>ALWAYS</em> put a comment in the code where you intend to fall through, like I did above. It will save other programmers from wondering if you meant to do that. </p>
<p>In fact, this is one of the common places to introduce bugs in C programs: forgetting to put a <code>break</code> in your <code>case</code>. You gotta do it if you don’t want to just roll into the next case<a href="https://beej.us/guide/bgc/html/index-wide.html#fn42" class="footnote-ref" id="fnref42" role="doc-noteref"><sup>42</sup></a>. </p>
<p>Earlier I said that <code>switch</code> works with integer types—keep it that way. Don’t use floating point or string types in there. One loophole-ish thing here is that you can use character types because those are secretly integers themselves. So this is perfectly acceptable:</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb57-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span> c <span class="op">=</span> <span class="ch">'b'</span><span class="op">;</span></span>
<span id="cb57-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb57-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="cf">switch</span> <span class="op">(</span>c<span class="op">)</span> <span class="op">{</span></span>
<span id="cb57-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb57-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="ch">'a'</span><span class="op">:</span></span>
<span id="cb57-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb57-5" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"It's 'a'!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb57-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb57-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span><span class="op">;</span></span>
<span id="cb57-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb57-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb57-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="ch">'b'</span><span class="op">:</span></span>
<span id="cb57-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb57-9" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"It's 'b'!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb57-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb57-10" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span><span class="op">;</span></span>
<span id="cb57-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb57-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb57-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">case</span> <span class="ch">'c'</span><span class="op">:</span></span>
<span id="cb57-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb57-13" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"It's 'c'!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb57-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb57-14" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span><span class="op">;</span></span>
<span id="cb57-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb57-15" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Finally, you can use <code>enum</code>s in <code>switch</code> since they are also integer types. But more on that in the <code>enum</code> chapter.</p>
<p> </p>
<!-- Beej's guide to C

# vim: ts=4:sw=4:nosi:et:tw=72
-->
<h1 data-number="4" id="functions"><span class="header-section-number">4</span> Functions</h1>
<blockquote>
<p><em>“Sir, not in an environment such as this. That’s why I’ve also been programmed for over thirty secondary functions that—”</em></p>
<p>—C3PO, before being rudely interrupted, reporting a now-unimpressive number of additional functions, <em>Star Wars</em> script</p>
</blockquote>
<p> Very much like other languages you’re used to, C has the concept of <em>functions</em>.</p>
<p>Functions can accept a variety of <em>arguments</em> and return a value. One important thing, though: the arguments and return value types are predeclared—because that’s how C likes it!</p>
<p>Let’s take a look at a function. This is a function that takes an <code>int</code> as an argument, and returns an <code>int</code>.</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb58-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb58-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb58-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb58-2"></a></span>
<span id="cb58-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb58-3"></a><span class="dt">int</span> plus_one<span class="op">(</span><span class="dt">int</span> n<span class="op">)</span>  <span class="co">// The "definition"</span></span>
<span id="cb58-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb58-4"></a><span class="op">{</span></span>
<span id="cb58-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb58-5"></a>    <span class="cf">return</span> n <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb58-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb58-6"></a><span class="op">}</span></span>
<span id="cb58-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb58-7"></a> </span></code></pre></div>
<p>The <code>int</code> before the <code>plus_one</code> indicates the return type.</p>
<p>The <code>int n</code> indicates that this function takes one <code>int</code> argument, stored in <em>parameter</em> <code>n</code>. A parameter is a special type of local variable into which the arguments are copied.</p>
<p>I’m going to drive home the point that the arguments are copied into the parameters, here. Lots of things in C are easier to understand if you know that the parameter is a <em>copy</em> of the argument, not the argument itself. More on that in a minute.</p>
<p>Continuing the program down into <code>main()</code>, we can see the call to the function, where we assign the return value into local variable <code>j</code>:</p>
<div class="sourceCode" id="cb59" data-startfrom="8"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c" style="counter-reset: source-line 7;"><span id="cb59-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb59-8"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb59-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb59-9"></a><span class="op">{</span></span>
<span id="cb59-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb59-10"></a>    <span class="dt">int</span> i <span class="op">=</span> <span class="dv">10</span><span class="op">,</span> j<span class="op">;</span></span>
<span id="cb59-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb59-11"></a>    </span>
<span id="cb59-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb59-12"></a>    j <span class="op">=</span> plus_one<span class="op">(</span>i<span class="op">);</span>  <span class="co">// The "call"</span></span>
<span id="cb59-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb59-13"></a></span>
<span id="cb59-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb59-14"></a>    printf<span class="op">(</span><span class="st">"i + 1 is </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> j<span class="op">);</span></span>
<span id="cb59-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb59-15"></a><span class="op">}</span></span></code></pre></div>
<blockquote>
<p>Before I forget, notice that I defined the function before I used it. If I hadn’t done that, the compiler wouldn’t know about it yet when it compiles <code>main()</code> and it would have given an unknown function call error. There is a more proper way to do the above code with <em>function prototypes</em>, but we’ll talk about that later.</p>
</blockquote>
<p>Also notice that <code>main()</code> is a function!</p>
<p>It returns an <code>int</code>.</p>
<p>But what’s this <code>void</code> thing? This is a keyword that’s used to indicate that the function accepts no arguments.</p>
<p>You can also return <code>void</code> to indicate that you don’t return a value:</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb60-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb60-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb60-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb60-2"></a></span>
<span id="cb60-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb60-3"></a><span class="co">// This function takes no arguments and returns no value:</span></span>
<span id="cb60-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb60-4"></a></span>
<span id="cb60-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb60-5"></a><span class="dt">void</span> hello<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb60-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb60-6"></a><span class="op">{</span></span>
<span id="cb60-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb60-7"></a>    printf<span class="op">(</span><span class="st">"Hello, world!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb60-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb60-8"></a><span class="op">}</span></span>
<span id="cb60-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb60-9"></a></span>
<span id="cb60-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb60-10"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb60-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb60-11"></a><span class="op">{</span></span>
<span id="cb60-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb60-12"></a>    hello<span class="op">();</span>  <span class="co">// Prints "Hello, world!"</span></span>
<span id="cb60-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb60-13"></a><span class="op">}</span></span></code></pre></div>
<h2 data-number="4.1" id="passvalue"><span class="header-section-number">4.1</span> Passing by Value</h2>
<p>I’d mentioned earlier that when you pass an argument to a function, a copy of that argument gets made and stored in the corresponding parameter.</p>
<p>If the argument is a variable, a copy of the value of that variable gets made and stored in the parameter.</p>
<p>More generally, the entire argument expression is evaluated and its value determined. That value is copied to the parameter.</p>
<p>In any case, the value in the parameter is its own thing. It is independent of whatever values or variables you used as arguments when you made the function call.</p>
<p>So let’s look at an example here. Study it and see if you can determine the output before running it:</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb61-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb61-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb61-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb61-2"></a></span>
<span id="cb61-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb61-3"></a><span class="dt">void</span> increment<span class="op">(</span><span class="dt">int</span> a<span class="op">)</span></span>
<span id="cb61-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb61-4"></a><span class="op">{</span></span>
<span id="cb61-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb61-5"></a>    a<span class="op">++;</span></span>
<span id="cb61-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb61-6"></a><span class="op">}</span></span>
<span id="cb61-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb61-7"></a></span>
<span id="cb61-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb61-8"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb61-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb61-9"></a><span class="op">{</span></span>
<span id="cb61-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb61-10"></a>    <span class="dt">int</span> i <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb61-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb61-11"></a></span>
<span id="cb61-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb61-12"></a>    increment<span class="op">(</span>i<span class="op">);</span></span>
<span id="cb61-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb61-13"></a></span>
<span id="cb61-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb61-14"></a>    printf<span class="op">(</span><span class="st">"i == </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> i<span class="op">);</span>  <span class="co">// What does this print?</span></span>
<span id="cb61-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb61-15"></a><span class="op">}</span></span></code></pre></div>
<p>At first glance, it looks like <code>i</code> is <code>10</code>, and we pass it to the function <code>increment()</code>. There the value gets incremented, so when we print it, it must be <code>11</code>, right?</p>
<blockquote>
<p><em>“Get used to disappointment.”</em></p>
<p>—Dread Pirate Roberts, <em>The Princess Bride</em></p>
</blockquote>
<p>But it’s not <code>11</code>—it prints <code>10</code>! How?</p>
<p>It’s all about the fact that the expressions you pass to functions get <em>copied</em> onto their corresponding parameters. The parameter is a copy, not the original.</p>
<p>So <code>i</code> is <code>10</code> out in <code>main()</code>. And we pass it to <code>increment()</code>. The corresponding parameter is called <code>a</code> in that function.</p>
<p>And the copy happens, as if by assignment. Loosely, <code>a = i</code>. So at that point, <code>a</code> is <code>10</code>. And out in <code>main()</code>, <code>i</code> is also <code>10</code>.</p>
<p>Then we increment <code>a</code> to <code>11</code>. But we’re not touching <code>i</code> at all! It remains <code>10</code>.</p>
<p>Finally, the function is complete. All its local variables are discarded (bye, <code>a</code>!) and we return to <code>main()</code>, where <code>i</code> is still <code>10</code>.</p>
<p>And we print it, getting <code>10</code>, and we’re done.</p>
<p>This is why in the previous example with the <code>plus_one()</code> function, we <code>return</code>ed the locally modified value so that we could see it again in <code>main()</code>.</p>
<p>Seems a little bit restrictive, huh? Like you can only get one piece of data back from a function, is what you’re thinking. There is, however, another way to get data back; C folks call it <em>passing by reference</em> and that’s a story we’ll tell another time.</p>
<p>But no fancy-schmancy name will distract you from the fact that <em>EVERYTHING</em> you pass to a function <em>WITHOUT EXCEPTION</em> is copied into its corresponding parameter, and the function operates on that local copy, <em>NO MATTER WHAT</em>. Remember that, even when we’re talking about this so-called passing by reference. </p>
<h2 data-number="4.2" id="prototypes"><span class="header-section-number">4.2</span> Function Prototypes</h2>
<p>So if you recall back in the ice age a few sections ago, I mentioned that you had to define the function before you used it, otherwise the compiler wouldn’t know about it ahead of time, and would bomb out with an error.</p>
<p>This isn’t quite strictly true. You can notify the compiler in advance that you’ll be using a function of a certain type that has a certain parameter list. That way the function can be defined anywhere (even in a different file), as long as the <em>function prototype</em> has been declared before you call that function.</p>
<p>Fortunately, the function prototype is really quite easy. It’s merely a copy of the first line of the function definition with a semicolon tacked on the end for good measure. For example, this code calls a function that is defined later, because a prototype has been declared first:</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb62-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb62-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb62-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb62-2"></a></span>
<span id="cb62-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb62-3"></a><span class="dt">int</span> foo<span class="op">(</span><span class="dt">void</span><span class="op">);</span>  <span class="co">// This is the prototype!</span></span>
<span id="cb62-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb62-4"></a></span>
<span id="cb62-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb62-5"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb62-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb62-6"></a><span class="op">{</span></span>
<span id="cb62-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb62-7"></a>    <span class="dt">int</span> i<span class="op">;</span></span>
<span id="cb62-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb62-8"></a>    </span>
<span id="cb62-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb62-9"></a>    <span class="co">// We can call foo() here before it's definition because the</span></span>
<span id="cb62-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb62-10"></a>    <span class="co">// prototype has already been declared, above!</span></span>
<span id="cb62-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb62-11"></a></span>
<span id="cb62-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb62-12"></a>    i <span class="op">=</span> foo<span class="op">();</span></span>
<span id="cb62-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb62-13"></a>    </span>
<span id="cb62-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb62-14"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> i<span class="op">);</span>  <span class="co">// 3490</span></span>
<span id="cb62-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb62-15"></a><span class="op">}</span></span>
<span id="cb62-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb62-16"></a></span>
<span id="cb62-17"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb62-17"></a><span class="dt">int</span> foo<span class="op">(</span><span class="dt">void</span><span class="op">)</span>  <span class="co">// This is the definition, just like the prototype!</span></span>
<span id="cb62-18"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb62-18"></a><span class="op">{</span></span>
<span id="cb62-19"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb62-19"></a>    <span class="cf">return</span> <span class="dv">3490</span><span class="op">;</span></span>
<span id="cb62-20"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb62-20"></a><span class="op">}</span></span></code></pre></div>
<p>If you don’t declare your function before you use it (either with a prototype or its definition), you’re performing something called an <em>implicit declaration</em>. This was allowed in the first C standard (C89), and that standard has rules about it, but is no longer allowed today. And there is no legitimate reason to rely on it in new code.</p>
<p>You might notice something about the sample code we’ve been using… That is, we’ve been using the good old <code>printf()</code> function without defining it or declaring a prototype! How do we get away with this lawlessness? We don’t, actually. There is a prototype; it’s in that header file <code>stdio.h</code> that we included with <code>#include</code>, remember? So we’re still legit, officer!</p>
<h2 data-number="4.3" id="empty-parameter-lists"><span class="header-section-number">4.3</span> Empty Parameter Lists</h2>
<p> You might see these from time to time in older code, but you shouldn’t ever code one up in new code. Always use <code>void</code> to indicate that a function takes no parameters. There’s never<a href="https://beej.us/guide/bgc/html/index-wide.html#fn43" class="footnote-ref" id="fnref43" role="doc-noteref"><sup>43</sup></a> a reason to do this in modern code.</p>
<p>If you’re good at just remembering to put <code>void</code> in for empty parameter lists in functions and prototypes, you can skip the rest of this section.</p>
<p>There are two contexts for this:</p>
<ul>
<li>Omitting all parameters where the function is defined</li>
<li>Omitting all parameters in a prototype</li>
</ul>
<p>Let’s look at a potential function definition first:</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb63-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> foo<span class="op">()</span>  <span class="co">// Should really have a `void` in there</span></span>
<span id="cb63-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb63-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb63-3" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Hello, world!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb63-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb63-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>While the spec spells out that the behavior in this instance is <em>as-if</em> you’d indicated <code>void</code> (C11 §6.7.6.3¶14), the <code>void</code> type is there for a reason. Use it.</p>
<p>But in the case of a function prototype, there is a <em>significant</em> difference between using <code>void</code> and not:</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb64-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> foo<span class="op">();</span></span>
<span id="cb64-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> foo<span class="op">(</span><span class="dt">void</span><span class="op">);</span>  <span class="co">// Not the same!</span></span></code></pre></div>
<p>Leaving <code>void</code> out of the prototype indicates to the compiler that there is no additional information about the parameters to the function. It effectively turns off all that type checking.</p>
<p>With a prototype <strong>definitely</strong> use <code>void</code> when you have an empty parameter list.</p>
<p></p>
<!-- Beej's guide to C

# vim: ts=4:sw=4:nosi:et:tw=72
-->
<h1 data-number="5" id="pointers"><span class="header-section-number">5</span> Pointers—Cower In Fear!</h1>
<blockquote>
<p><em>“How do you get to Carnegie Hall?”</em><br>
<em>“Practice!”</em></p>
<p>—20th-century joke of unknown origin</p>
</blockquote>
<p>Pointers are one of the most feared things in the C language. In fact, they are the one thing that makes this language challenging at all. But why?</p>
<p>Because they, quite honestly, can cause electric shocks to come up through the keyboard and physically <em>weld</em> your arms permanently in place, cursing you to a life at the keyboard in this language from the 70s!</p>
<p>Really? Well, not really. I’m just trying to set you up for success.</p>
<p>Depending on what language you came from, you might already understand the concept of <em>references</em>, where a variable refers to an object of some type.</p>
<p>This is very much the same, except we have to be more explicit with C about when we’re talking about the reference or the thing it refers to.</p>
<h2 data-number="5.1" id="ptmem"><span class="header-section-number">5.1</span> Memory and Variables</h2>
<p>Computer memory holds data of all kinds, right? It’ll hold <code>float</code>s, <code>int</code>s, or whatever you have. To make memory easy to cope with, each byte of memory is identified by an integer. These integers increase sequentially as you move up through memory<a href="https://beej.us/guide/bgc/html/index-wide.html#fn44" class="footnote-ref" id="fnref44" role="doc-noteref"><sup>44</sup></a>. You can think of it as a bunch of numbered boxes, where each box holds a byte<a href="https://beej.us/guide/bgc/html/index-wide.html#fn45" class="footnote-ref" id="fnref45" role="doc-noteref"><sup>45</sup></a> of data. Or like a big array where each element holds a byte, if you come from a language with arrays. The number that represents each box is called its <em>address</em>.</p>
<p>Now, not all data types use just a byte. For instance, an <code>int</code> is often four bytes, as is a <code>float</code>, but it really depends on the system. You can use the <code>sizeof</code> operator to determine how many bytes of memory a certain type uses.</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb65-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb65-1" aria-hidden="true" tabindex="-1"></a><span class="co">// %zu is the format specifier for type size_t</span></span>
<span id="cb65-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb65-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb65-3" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"an int uses </span><span class="sc">%zu</span><span class="st"> bytes of memory</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">int</span><span class="op">));</span></span>
<span id="cb65-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb65-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb65-5" aria-hidden="true" tabindex="-1"></a><span class="co">// That prints "4" for me, but can vary by system.</span></span></code></pre></div>
<blockquote>
<p><strong>Memory Fun Facts</strong>: When you have a data type (like your typical <code>int</code>) that uses more than a byte of memory, the bytes that make up the data are always adjacent to one another in memory. Sometimes they’re in the order that you expect, and sometimes they’re not<a href="https://beej.us/guide/bgc/html/index-wide.html#fn46" class="footnote-ref" id="fnref46" role="doc-noteref"><sup>46</sup></a>. While C doesn’t guarantee any particular memory order (it’s platform-dependent), it’s still generally possible to write code in a way that’s platform-independent where you don’t have to even consider these pesky byte orderings.</p>
</blockquote>
<p>So <em>anyway</em>, if we can get on with it and get a drum roll and some foreboding music playing for the definition of a pointer, <em>a pointer is a variable that holds an address</em>. Imagine the classical score from 2001: A Space Odyssey at this point. Ba bum ba bum ba bum BAAAAH!</p>
<p>Ok, so maybe a bit overwrought here, yes? There’s not a lot of mystery about pointers. They are the address of data. Just like an <code>int</code> variable can hold the value <code>12</code>, a pointer variable can hold the address of data.</p>
<p>This means that all these things mean the same thing, i.e.&nbsp;a number that represents a point in memory:</p>
<ul>
<li>Index into memory (if you’re thinking of memory like a big array)</li>
<li>Address</li>
<li>Location</li>
</ul>
<p>I’m going to use these interchangeably. And yes, I just threw <em>location</em> in there because you can never have enough words that mean the same thing.</p>
<p>And a pointer variable holds that address number. Just like a <code>float</code> variable might hold <code>3.14159</code>.</p>
<p>Imagine you have a bunch of Post-it® notes all numbered in sequence with their address. (The first one is at index numbered <code>0</code>, the next at index <code>1</code>, and so on.)</p>
<p>In addition to the number representing their positions, you can also write another number of your choice on each. It could be the number of dogs you have. Or the number of moons around Mars…</p>
<p>…Or, <em>it could be the index of another Post-it note!</em></p>
<p>If you have written the number of dogs you have, that’s just a regular variable. But if you wrote the index of another Post-it in there, <em>that’s a pointer</em>. It points to the other note!</p>
<p>Another analogy might be with house addresses. You can have a house with certain qualities, yard, metal roof, solar, etc. Or you could have the address of that house. The address isn’t the same as the house itself. One’s a full-blown house, and the other is just a few lines of text. But the address of the house is a <em>pointer</em> to that house. It’s not the house itself, but it tells you where to find it.</p>
<p>And we can do the same thing in the computer with data. You can have a data variable that’s holding some value. And that value is in memory at some address. And you could have a different <em>pointer variable</em> hold the address of that data variable.</p>
<p>It’s not the data variable itself, but, like with a house address, it tells us where to find it.</p>
<p>When we have that, we say we have a “pointer to” that data. And we can follow the pointer to access the data itself.</p>
<p>(Though it doesn’t seem particularly useful yet, this all becomes indispensable when used with function calls. Bear with me until we get there.)</p>
<p>So if we have an <code>int</code>, say, and we want a pointer to it, what we want is some way to get the address of that <code>int</code>, right? After all, the pointer just holds the <em>address of</em> the data. What operator do you suppose we’d use to find the <em>address of</em> the <code>int</code>?</p>
<p>Well, by a shocking surprise that must come as something of a shock to you, gentle reader, we use the <code>address-of</code> operator (which happens to be an ampersand: “<code>&amp;</code>”)to find the address of the data. Ampersand.</p>
<p>So for a quick example, we’ll introduce a new <em>format specifier</em> for <code>printf()</code> so you can print a pointer. You know already how <code>%d</code> prints a decimal integer, yes? Well, <code>%p</code> prints a pointer. Now, this pointer is going to look like a garbage number (and it might be printed in hexadecimal<a href="https://beej.us/guide/bgc/html/index-wide.html#fn47" class="footnote-ref" id="fnref47" role="doc-noteref"><sup>47</sup></a> instead of decimal), but it is merely the index into memory the data is stored in. (Or the index into memory that the first byte of data is stored in, if the data is multi-byte.) In virtually all circumstances, including this one, the actual value of the number printed is unimportant to you, and I show it here only for demonstration of the <code>address-of</code> operator.</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb66-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb66-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb66-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb66-2"></a></span>
<span id="cb66-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb66-3"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb66-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb66-4"></a><span class="op">{</span></span>
<span id="cb66-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb66-5"></a>    <span class="dt">int</span> i <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb66-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb66-6"></a></span>
<span id="cb66-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb66-7"></a>    printf<span class="op">(</span><span class="st">"The value of i is </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> i<span class="op">);</span></span>
<span id="cb66-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb66-8"></a>    printf<span class="op">(</span><span class="st">"And its address is </span><span class="sc">%p\n</span><span class="st">"</span><span class="op">,</span> <span class="op">(</span><span class="dt">void</span> <span class="op">*)&amp;</span>i<span class="op">);</span></span>
<span id="cb66-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb66-9"></a></span>
<span id="cb66-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb66-10"></a>    <span class="co">// %p expects the argument to be a pointer to void</span></span>
<span id="cb66-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb66-11"></a>    <span class="co">// so we cast it to make the compiler happy.</span></span>
<span id="cb66-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb66-12"></a><span class="op">}</span></span></code></pre></div>
<p>On my computer, this prints:</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb67-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb67-1" aria-hidden="true" tabindex="-1"></a>The value of i is 10</span>
<span id="cb67-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb67-2" aria-hidden="true" tabindex="-1"></a>And its address is 0x7ffddf7072a4</span></code></pre></div>
<p></p>
<p>If you’re curious, that hexadecimal number is 140,727,326,896,068 in decimal (base 10 just like Grandma used to use). That’s the index into memory where the variable <code>i</code>’s data is stored. It’s the address of <code>i</code>. It’s the location of <code>i</code>. It’s a pointer to <code>i</code>.</p>
<p>It’s a pointer because it lets you know where <code>i</code> is in memory. Like a home address written on a scrap of paper tells you where you can find a particular house, this number indicates to us where in memory we can find the value of <code>i</code>. It points to <code>i</code>.</p>
<p>Again, we don’t really care what the address’s exact number is, generally. We just care that it’s a pointer to <code>i</code>.</p>
<h2 data-number="5.2" id="pttypes"><span class="header-section-number">5.2</span> Pointer Types</h2>
<p>So… this is all well and good. You can now successfully take the address of a variable and print it on the screen. There’s a little something for the ol’ resume, right? Here’s where you grab me by the scruff of the neck and ask politely what the frick pointers are good for.</p>
<p>Excellent question, and we’ll get to that right after these messages from our sponsor.</p>
<blockquote>
<p><code>ACME ROBOTIC HOUSING UNIT CLEANING SERVICES. YOUR HOMESTEAD WILL BE DRAMATICALLY IMPROVED OR YOU WILL BE TERMINATED. MESSAGE ENDS.</code></p>
</blockquote>
<p>Welcome back to another installment of Beej’s Guide. When we met last we were talking about how to make use of pointers. Well, what we’re going to do is store a pointer off in a variable so that we can use it later. You can identify the <em>pointer type</em> because there’s an asterisk (<code>*</code>) before the variable name and after its type:</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb68-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb68-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb68-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb68-2"></a><span class="op">{</span></span>
<span id="cb68-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb68-3"></a>    <span class="dt">int</span> i<span class="op">;</span>  <span class="co">// i's type is "int"</span></span>
<span id="cb68-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb68-4"></a>    <span class="dt">int</span> <span class="op">*</span>p<span class="op">;</span> <span class="co">// p's type is "pointer to an int", or "int-pointer"</span></span>
<span id="cb68-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb68-5"></a><span class="op">}</span></span></code></pre></div>
<p>Hey, so we have here a variable that is a pointer type, and it can point to other <code>int</code>s. That is, it can hold the address of other <code>int</code>s. We know it points to <code>int</code>s, since it’s of type <code>int*</code> (read “int-pointer”).</p>
<p>When you do an assignment into a pointer variable, the type of the right hand side of the assignment has to be the same type as the pointer variable. Fortunately for us, when you take the <code>address-of</code> a variable, the resultant type is a pointer to that variable type, so assignments like the following are perfect:</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb69-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> i<span class="op">;</span></span>
<span id="cb69-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> <span class="op">*</span>p<span class="op">;</span>  <span class="co">// p is a pointer, but is uninitialized and points to garbage</span></span>
<span id="cb69-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb69-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb69-4" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> <span class="op">&amp;</span>i<span class="op">;</span>  <span class="co">// p is assigned the address of i--p now "points to" i</span></span></code></pre></div>
<p>On the left of the assignment, we have a variable of type pointer-to-<code>int</code> (<code>int*</code>), and on the right side, we have expression of type pointer-to-<code>int</code> since <code>i</code> is an <code>int</code> (because address-of <code>int</code> gives you a pointer to <code>int</code>). The address of a thing can be stored in a pointer to that thing.</p>
<p>Get it? I know it still doesn’t quite make much sense since you haven’t seen an actual use for the pointer variable, but we’re taking small steps here so that no one gets lost. So now, let’s introduce you to the anti-address-of operator. It’s kind of like what <code>address-of</code> would be like in Bizarro World.</p>
<h2 data-number="5.3" id="deref"><span class="header-section-number">5.3</span> Dereferencing</h2>
<p>A pointer variable can be thought of as <em>referring</em> to another variable by pointing to it. It’s rare you’ll hear anyone in C land talking about “referring” or “references”, but I bring it up just so that the name of this operator will make a little more sense.</p>
<p>When you have a pointer to a variable (roughly “a reference to a variable”), you can use the original variable through the pointer by <em>dereferencing</em> the pointer. (You can think of this as “de-pointering” the pointer, but no one ever says “de-pointering”.)</p>
<p>Back to our analogy, this is vaguely like looking at a home address and then going to that house.</p>
<p>Now, what do I mean by “get access to the original variable”? Well, if you have a variable called <code>i</code>, and you have a pointer to <code>i</code> called <code>p</code>, you can use the dereferenced pointer <code>p</code> <em>exactly as if it were the original variable <code>i</code></em>!</p>
<p>You almost have enough knowledge to handle an example. The last tidbit you need to know is actually this: what is the dereference operator? It’s actually called the <em>indirection operator</em>, because you’re accessing values indirectly via the pointer. And it is the asterisk, again: <code>*</code>. Now, don’t get this confused with the asterisk you used in the pointer declaration, earlier. They are the same character, but they have different meanings in different contexts<a href="https://beej.us/guide/bgc/html/index-wide.html#fn48" class="footnote-ref" id="fnref48" role="doc-noteref"><sup>48</sup></a>.</p>
<p>Here’s a full-blown example:</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb70-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb70-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb70-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb70-2"></a></span>
<span id="cb70-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb70-3"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb70-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb70-4"></a><span class="op">{</span></span>
<span id="cb70-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb70-5"></a>    <span class="dt">int</span> i<span class="op">;</span></span>
<span id="cb70-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb70-6"></a>    <span class="dt">int</span> <span class="op">*</span>p<span class="op">;</span>  <span class="co">// this is NOT a dereference--this is a type "int*"</span></span>
<span id="cb70-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb70-7"></a></span>
<span id="cb70-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb70-8"></a>    p <span class="op">=</span> <span class="op">&amp;</span>i<span class="op">;</span>  <span class="co">// p now points to i, p holds address of i</span></span>
<span id="cb70-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb70-9"></a></span>
<span id="cb70-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb70-10"></a>    i <span class="op">=</span> <span class="dv">10</span><span class="op">;</span>  <span class="co">// i is now 10</span></span>
<span id="cb70-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb70-11"></a>    <span class="op">*</span>p <span class="op">=</span> <span class="dv">20</span><span class="op">;</span> <span class="co">// the thing p points to (namely i!) is now 20!!</span></span>
<span id="cb70-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb70-12"></a></span>
<span id="cb70-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb70-13"></a>    printf<span class="op">(</span><span class="st">"i is </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> i<span class="op">);</span>   <span class="co">// prints "20"</span></span>
<span id="cb70-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb70-14"></a>    printf<span class="op">(</span><span class="st">"i is </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> <span class="op">*</span>p<span class="op">);</span>  <span class="co">// "20"! dereference-p is the same as i!</span></span>
<span id="cb70-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb70-15"></a><span class="op">}</span></span></code></pre></div>
<p>Remember that <code>p</code> holds the address of <code>i</code>, as you can see where we did the assignment to <code>p</code> on line 8. What the indirection operator does is tells the computer to <em>use the object the pointer points to</em> instead of using the pointer itself. In this way, we have turned <code>*p</code> into an alias of sorts for <code>i</code>.</p>
<p>Great, but <em>why</em>? Why do any of this?</p>
<h2 data-number="5.4" id="ptpass"><span class="header-section-number">5.4</span> Passing Pointers as Arguments</h2>
<p>Right about now, you’re thinking that you have an awful lot of knowledge about pointers, but absolutely zero application, right? I mean, what use is <code>*p</code> if you could just simply say <code>i</code> instead?</p>
<p>Well, my friend, the real power of pointers comes into play when you start passing them to functions. Why is this a big deal? You might recall from before that you could pass all kinds of arguments to functions and they’d be dutifully copied into parameters, and then you could manipulate local copies of those variables from within the function, and then you could return a single value.</p>
<p>What if you wanted to bring back more than one single piece of data from the function? I mean, you can only return one thing, right? What if I answered that question with another question? …Er, two questions?</p>
<p>What happens when you pass a pointer as an argument to a function? Does a copy of the pointer get put into its corresponding parameter? <em>You bet your sweet peas it does.</em> Remember how earlier I rambled on and on about how <em>EVERY SINGLE ARGUMENT</em> gets copied into parameters and the function uses a copy of the argument? Well, the same is true here. The function will get a copy of the pointer.</p>
<p>But, and this is the clever part: we will have set up the pointer in advance to point at a variable… and then the function can dereference its copy of the pointer to get back to the original variable! The function can’t see the variable itself, but it can certainly dereference a pointer to that variable!</p>
<p>This is analogous to writing a home address on a piece of paper, and then copying that onto another piece of paper. You now have <em>two</em> pointers to that house, and both are equally good at getting you to the house itself.</p>
<p>In the case of a function call. one of the copies is stored in a pointer variable out in the calling scope, and the other is stored in a pointer variable that is the parameter of the function.</p>
<p>Example! Let’s revisit our old <code>increment()</code> function, but this time let’s make it so that it actually increments the value out in the caller.</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb71-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb71-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb71-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb71-2"></a></span>
<span id="cb71-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb71-3"></a><span class="dt">void</span> increment<span class="op">(</span><span class="dt">int</span> <span class="op">*</span>p<span class="op">)</span>  <span class="co">// note that it accepts a pointer to an int</span></span>
<span id="cb71-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb71-4"></a><span class="op">{</span></span>
<span id="cb71-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb71-5"></a>    <span class="op">*</span>p <span class="op">=</span> <span class="op">*</span>p <span class="op">+</span> <span class="dv">1</span><span class="op">;</span>        <span class="co">// add one to the thing p points to</span></span>
<span id="cb71-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb71-6"></a><span class="op">}</span></span>
<span id="cb71-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb71-7"></a></span>
<span id="cb71-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb71-8"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb71-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb71-9"></a><span class="op">{</span></span>
<span id="cb71-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb71-10"></a>    <span class="dt">int</span> i <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb71-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb71-11"></a>    <span class="dt">int</span> <span class="op">*</span>j <span class="op">=</span> <span class="op">&amp;</span>i<span class="op">;</span>  <span class="co">// note the address-of; turns it into a pointer to i</span></span>
<span id="cb71-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb71-12"></a></span>
<span id="cb71-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb71-13"></a>    printf<span class="op">(</span><span class="st">"i is </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> i<span class="op">);</span>        <span class="co">// prints "10"</span></span>
<span id="cb71-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb71-14"></a>    printf<span class="op">(</span><span class="st">"i is also </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> <span class="op">*</span>j<span class="op">);</span>  <span class="co">// prints "10"</span></span>
<span id="cb71-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb71-15"></a></span>
<span id="cb71-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb71-16"></a>    increment<span class="op">(</span>j<span class="op">);</span>                  <span class="co">// j is an int*--to i</span></span>
<span id="cb71-17"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb71-17"></a></span>
<span id="cb71-18"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb71-18"></a>    printf<span class="op">(</span><span class="st">"i is </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> i<span class="op">);</span>        <span class="co">// prints "11"!</span></span>
<span id="cb71-19"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb71-19"></a><span class="op">}</span></span></code></pre></div>
<p>Ok! There are a couple things to see here… not the least of which is that the <code>increment()</code> function takes an <code>int*</code> as an argument. We pass it an <code>int*</code> in the call by changing the <code>int</code> variable <code>i</code> to an <code>int*</code> using the <code>address-of</code> operator. (Remember, a pointer holds an address, so we make pointers to variables by running them through the <code>address-of</code> operator.)</p>
<p>The <code>increment()</code> function gets a copy of the pointer. Both the original pointer <code>j</code> (in <code>main()</code>) and the copy of that pointer <code>p</code> (the parameter in <code>increment()</code>) point to the same address, namely the one holding the value <code>i</code>. (Again, by analogy, like two pieces of paper with the same home address written on them.) Dereferencing either will allow you to modify the original variable <code>i</code>! The function can modify a variable in another scope! Rock on!</p>
<p>The above example is often more concisely written in the call just by using address-of right in the argument list:</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb72-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb72-1" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"i is </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> i<span class="op">);</span>  <span class="co">// prints "10"</span></span>
<span id="cb72-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb72-2" aria-hidden="true" tabindex="-1"></a>increment<span class="op">(&amp;</span>i<span class="op">);</span></span>
<span id="cb72-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb72-3" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"i is </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> i<span class="op">);</span>  <span class="co">// prints "11"!</span></span></code></pre></div>
<p>Pointer enthusiasts will recall from early on in the guide, we used a function to read from the keyboard, <code>scanf()</code>… and, although you might not have recognized it at the time, we used the <code>address-of</code> to pass a pointer to a value to <code>scanf()</code>. We had to pass a pointer, see, because <code>scanf()</code> reads from the keyboard (typically) and stores the result in a variable. The only way it can see that variable out in the calling function’s scope is if we pass a pointer to that variable:</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb73-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb73-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb73-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb73-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb73-3" aria-hidden="true" tabindex="-1"></a>scanf<span class="op">(</span><span class="st">"</span><span class="sc">%d</span><span class="st">"</span><span class="op">,</span> <span class="op">&amp;</span>i<span class="op">);</span>         <span class="co">// pretend you typed "12"</span></span>
<span id="cb73-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb73-4" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"i is </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> i<span class="op">);</span>  <span class="co">// prints "i is 12"</span></span></code></pre></div>
<p>See, <code>scanf()</code> dereferences the pointer we pass it in order to modify the variable it points to. And now you know why you have to put that pesky ampersand in there!</p>
<h2 data-number="5.5" id="the-null-pointer"><span class="header-section-number">5.5</span> The <code>NULL</code> Pointer</h2>
<p>Any pointer variable of any pointer type can be set to a special value called <code>NULL</code>. This indicates that this pointer doesn’t point to anything.</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb74-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> <span class="op">*</span>p<span class="op">;</span></span>
<span id="cb74-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb74-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb74-3" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> NULL<span class="op">;</span></span></code></pre></div>
<p>Since it doesn’t point to a value, dereferencing it is undefined behavior, and probably will result in a crash:</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb75-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb75-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> <span class="op">*</span>p <span class="op">=</span> NULL<span class="op">;</span></span>
<span id="cb75-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb75-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb75-3" aria-hidden="true" tabindex="-1"></a><span class="op">*</span>p <span class="op">=</span> <span class="dv">12</span><span class="op">;</span>  <span class="co">// CRASH or SOMETHING PROBABLY BAD. BEST AVOIDED.</span></span></code></pre></div>
<p>Despite being called <a href="https://en.wikipedia.org/wiki/Null_pointer#History">the billion dollar mistake by its creator</a><a href="https://beej.us/guide/bgc/html/index-wide.html#fn49" class="footnote-ref" id="fnref49" role="doc-noteref"><sup>49</sup></a>, the <code>NULL</code> pointer is a good <a href="https://en.wikipedia.org/wiki/Sentinel_value">sentinel value</a><a href="https://beej.us/guide/bgc/html/index-wide.html#fn50" class="footnote-ref" id="fnref50" role="doc-noteref"><sup>50</sup></a> and general indicator that a pointer hasn’t yet been initialized.</p>
<p>(Of course, like other variables, the pointer points to garbage unless you explicitly assign it to point to an address or <code>NULL</code>.) </p>
<h2 data-number="5.6" id="a-note-on-declaring-pointers"><span class="header-section-number">5.6</span> A Note on Declaring Pointers</h2>
<p>The syntax for declaring a pointer can get a little weird. Let’s look at this example:</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb76-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> a<span class="op">;</span></span>
<span id="cb76-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> b<span class="op">;</span></span></code></pre></div>
<p>We can condense that into a single line, right?</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb77-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> a<span class="op">,</span> b<span class="op">;</span>  <span class="co">// Same thing</span></span></code></pre></div>
<p>So <code>a</code> and <code>b</code> are both <code>int</code>s. No problem.</p>
<p>But what about this?</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb78-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> a<span class="op">;</span></span>
<span id="cb78-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> <span class="op">*</span>p<span class="op">;</span></span></code></pre></div>
<p>Can we make that into one line? We can. But where does the <code>*</code> go?</p>
<p>The rule is that the <code>*</code> goes in front of any variable that is a pointer type. That is. the <code>*</code> is <em>not</em> part of the <code>int</code> in this example. it’s a part of variable <code>p</code>.</p>
<p>With that in mind, we can write this:</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb79-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> a<span class="op">,</span> <span class="op">*</span>p<span class="op">;</span>  <span class="co">// Same thing</span></span></code></pre></div>
<p>It’s important to note that the following line does <em>not</em> declare two pointers:</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb80-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> <span class="op">*</span>p<span class="op">,</span> q<span class="op">;</span>  <span class="co">// p is a pointer to an int; q is just an int.</span></span></code></pre></div>
<p>This can be particularly insidious-looking if the programmer writes this following (valid) line of code which is functionally identical to the one above.</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb81-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb81-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span><span class="op">*</span> p<span class="op">,</span> q<span class="op">;</span>  <span class="co">// p is a pointer to an int; q is just an int.</span></span></code></pre></div>
<p>So take a look at this and determine which variables are pointers and which are not:</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb82-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> <span class="op">*</span>a<span class="op">,</span> b<span class="op">,</span> c<span class="op">,</span> <span class="op">*</span>d<span class="op">,</span> e<span class="op">,</span> <span class="op">*</span>f<span class="op">,</span> g<span class="op">,</span> h<span class="op">,</span> <span class="op">*</span>i<span class="op">;</span></span></code></pre></div>
<p>I’ll drop the answer in a footnote<a href="https://beej.us/guide/bgc/html/index-wide.html#fn51" class="footnote-ref" id="fnref51" role="doc-noteref"><sup>51</sup></a>.</p>
<h2 data-number="5.7" id="sizeof-and-pointers"><span class="header-section-number">5.7</span> <code>sizeof</code> and Pointers</h2>
<p>Just a little bit of syntax here that might be confusing and you might see from time to time.</p>
<p>Recall that <code>sizeof</code> operates on the <em>type</em> of the expression.</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb83-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> <span class="op">*</span>p<span class="op">;</span></span>
<span id="cb83-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb83-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb83-3" aria-hidden="true" tabindex="-1"></a><span class="co">// Prints size of an 'int'</span></span>
<span id="cb83-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb83-4" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">%zu\n</span><span class="st">"</span><span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">int</span><span class="op">));</span></span>
<span id="cb83-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb83-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb83-6" aria-hidden="true" tabindex="-1"></a><span class="co">// p is type 'int *', so prints size of 'int*'</span></span>
<span id="cb83-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb83-7" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">%zu\n</span><span class="st">"</span><span class="op">,</span> <span class="kw">sizeof</span> p<span class="op">);</span></span>
<span id="cb83-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb83-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb83-9" aria-hidden="true" tabindex="-1"></a><span class="co">// *p is type 'int', so prints size of 'int'</span></span>
<span id="cb83-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb83-10" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">%zu\n</span><span class="st">"</span><span class="op">,</span> <span class="kw">sizeof</span> <span class="op">*</span>p<span class="op">);</span></span></code></pre></div>
<p>You might see code in the wild with that last <code>sizeof</code> in there. Just remember that <code>sizeof</code> is all about the type of the expression, not the variables in the expression themselves.</p>
<!-- Beej's guide to C

# vim: ts=4:sw=4:nosi:et:tw=72
-->
<h1 data-number="6" id="arrays"><span class="header-section-number">6</span> Arrays</h1>
<blockquote>
<p><em>“Should array indices start at 0 or 1? My compromise of 0.5 was rejected without, I thought, proper consideration.”</em></p>
<p>—Stan Kelly-Bootle, computer scientist</p>
</blockquote>
<p> Luckily, C has arrays. I mean, I know it’s considered a low-level language<a href="https://beej.us/guide/bgc/html/index-wide.html#fn52" class="footnote-ref" id="fnref52" role="doc-noteref"><sup>52</sup></a> but it does at least have the concept of arrays built-in. And since a great many languages drew inspiration from C’s syntax, you’re probably already familiar with using <code>[</code> and <code>]</code> for declaring and using arrays.</p>
<p>But C only <em>barely</em> has arrays! As we’ll find out later, arrays are just syntactic sugar in C—they’re actually all pointers and stuff deep down. <em>Freak out!</em> But for now, let’s just use them as arrays. <em>Phew</em>.</p>
<h2 data-number="6.1" id="easy-example"><span class="header-section-number">6.1</span> Easy Example</h2>
<p>Let’s just crank out an example:</p>
<p></p>
<div class="sourceCode" id="cb84"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb84-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb84-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb84-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb84-2"></a></span>
<span id="cb84-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb84-3"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb84-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb84-4"></a><span class="op">{</span></span>
<span id="cb84-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb84-5"></a>    <span class="dt">int</span> i<span class="op">;</span></span>
<span id="cb84-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb84-6"></a>    <span class="dt">float</span> f<span class="op">[</span><span class="dv">4</span><span class="op">];</span>  <span class="co">// Declare an array of 4 floats</span></span>
<span id="cb84-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb84-7"></a></span>
<span id="cb84-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb84-8"></a>    f<span class="op">[</span><span class="dv">0</span><span class="op">]</span> <span class="op">=</span> <span class="fl">3.14159</span><span class="op">;</span>  <span class="co">// Indexing starts at 0, of course.</span></span>
<span id="cb84-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb84-9"></a>    f<span class="op">[</span><span class="dv">1</span><span class="op">]</span> <span class="op">=</span> <span class="fl">1.41421</span><span class="op">;</span></span>
<span id="cb84-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb84-10"></a>    f<span class="op">[</span><span class="dv">2</span><span class="op">]</span> <span class="op">=</span> <span class="fl">1.61803</span><span class="op">;</span></span>
<span id="cb84-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb84-11"></a>    f<span class="op">[</span><span class="dv">3</span><span class="op">]</span> <span class="op">=</span> <span class="fl">2.71828</span><span class="op">;</span></span>
<span id="cb84-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb84-12"></a></span>
<span id="cb84-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb84-13"></a>    <span class="co">// Print them all out:</span></span>
<span id="cb84-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb84-14"></a></span>
<span id="cb84-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb84-15"></a>    <span class="cf">for</span> <span class="op">(</span>i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">4</span><span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb84-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb84-16"></a>        printf<span class="op">(</span><span class="st">"</span><span class="sc">%f\n</span><span class="st">"</span><span class="op">,</span> f<span class="op">[</span>i<span class="op">]);</span></span>
<span id="cb84-17"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb84-17"></a>    <span class="op">}</span></span>
<span id="cb84-18"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb84-18"></a><span class="op">}</span></span></code></pre></div>
<p>When you declare an array, you have to give it a size. And the size has to be fixed<a href="https://beej.us/guide/bgc/html/index-wide.html#fn53" class="footnote-ref" id="fnref53" role="doc-noteref"><sup>53</sup></a>.</p>
<p>In the above example, we made an array of 4 <code>float</code>s. The value in the square brackets in the declaration lets us know that.</p>
<p>Later on in subsequent lines, we access the values in the array, setting them or getting them, again with square brackets. </p>
<p>Hopefully this looks familiar from languages you already know!</p>
<h2 data-number="6.2" id="getting-the-length-of-an-array"><span class="header-section-number">6.2</span> Getting the Length of an Array</h2>
<p> You can’t…ish. C doesn’t record this information<a href="https://beej.us/guide/bgc/html/index-wide.html#fn54" class="footnote-ref" id="fnref54" role="doc-noteref"><sup>54</sup></a>. You have to manage it separately in another variable.</p>
<p>When I say “can’t”, I actually mean there are some circumstances when you <em>can</em>. There is a trick to get the number of elements in an array in the scope in which an array is declared. But, generally speaking, this won’t work the way you want if you pass the array to a function<a href="https://beej.us/guide/bgc/html/index-wide.html#fn55" class="footnote-ref" id="fnref55" role="doc-noteref"><sup>55</sup></a>.</p>
<p>Let’s take a look at this trick. The basic idea is that you take the <code>sizeof</code> the array, and then divide that by the size of each element to get the length. For example, if an <code>int</code> is 4 bytes, and the array is 32 bytes long, there must be room for <span class="math inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="0" style="font-size: 101.6%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mfrac><mjx-frac><mjx-num><mjx-nstrut></mjx-nstrut><mjx-mn class="mjx-n" size="s"><mjx-c class="mjx-c33"></mjx-c><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-num><mjx-dbox><mjx-dtable><mjx-line></mjx-line><mjx-row><mjx-den><mjx-dstrut></mjx-dstrut><mjx-mn class="mjx-n" size="s"><mjx-c class="mjx-c34"></mjx-c></mjx-mn></mjx-den></mjx-row></mjx-dtable></mjx-dbox></mjx-frac></mjx-mfrac></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mfrac><mn>32</mn><mn>4</mn></mfrac></math></mjx-assistive-mml></mjx-container></span> or <span class="math inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="1" style="font-size: 101.6%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c38"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>8</mn></math></mjx-assistive-mml></mjx-container></span> <code>int</code>s in there.</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb85-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> x<span class="op">[</span><span class="dv">12</span><span class="op">];</span>  <span class="co">// 12 ints</span></span>
<span id="cb85-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb85-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb85-3" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">%zu\n</span><span class="st">"</span><span class="op">,</span> <span class="kw">sizeof</span> x<span class="op">);</span>     <span class="co">// 48 total bytes</span></span>
<span id="cb85-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb85-4" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">%zu\n</span><span class="st">"</span><span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">int</span><span class="op">));</span>  <span class="co">// 4 bytes per int</span></span>
<span id="cb85-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb85-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb85-6" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">%zu\n</span><span class="st">"</span><span class="op">,</span> <span class="kw">sizeof</span> x <span class="op">/</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">int</span><span class="op">));</span>  <span class="co">// 48/4 = 12 ints!</span></span></code></pre></div>
<p>If it’s an array of <code>char</code>s, then <code>sizeof</code> the array <em>is</em> the number of elements, since <code>sizeof(char)</code> is defined to be 1. For anything else, you have to divide by the size of each element.</p>
<p>But this trick only works in the scope in which the array was defined. If you pass the array to a function, it doesn’t work. Even if you make it “big” in the function signature:</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb86-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> foo<span class="op">(</span><span class="dt">int</span> x<span class="op">[</span><span class="dv">12</span><span class="op">])</span></span>
<span id="cb86-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb86-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb86-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb86-3" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%zu\n</span><span class="st">"</span><span class="op">,</span> <span class="kw">sizeof</span> x<span class="op">);</span>     <span class="co">// 8?! What happened to 48?</span></span>
<span id="cb86-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb86-4" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%zu\n</span><span class="st">"</span><span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">int</span><span class="op">));</span>  <span class="co">// 4 bytes per int</span></span>
<span id="cb86-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb86-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb86-6" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%zu\n</span><span class="st">"</span><span class="op">,</span> <span class="kw">sizeof</span> x <span class="op">/</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">int</span><span class="op">));</span>  <span class="co">// 8/4 = 2 ints?? WRONG.</span></span>
<span id="cb86-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb86-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>This is because when you “pass” arrays to functions, you’re only passing a pointer to the first element, and that’s what <code>sizeof</code> measures. More on this in the <a href="https://beej.us/guide/bgc/html/index-wide.html#passing1darrays">Passing Single Dimensional Arrays to Functions</a> section, below.</p>
<p>One more thing you can do with <code>sizeof</code> and arrays is get the size of an array of a fixed number of elements without declaring the array. This is like how you can get the size of an <code>int</code> with <code>sizeof(int)</code>.</p>
<p>For example, to see how many bytes would be needed for an array of 48 <code>double</code>s, you can do this:</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb87-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="kw">sizeof</span><span class="op">(</span><span class="dt">double</span> <span class="op">[</span><span class="dv">48</span><span class="op">]);</span></span></code></pre></div>
<p> </p>
<h2 data-number="6.3" id="array-initializers"><span class="header-section-number">6.3</span> Array Initializers</h2>
<p> You can initialize an array with constants ahead of time:</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb88-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb88-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb88-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb88-2"></a></span>
<span id="cb88-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb88-3"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb88-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb88-4"></a><span class="op">{</span></span>
<span id="cb88-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb88-5"></a>    <span class="dt">int</span> i<span class="op">;</span></span>
<span id="cb88-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb88-6"></a>    <span class="dt">int</span> a<span class="op">[</span><span class="dv">5</span><span class="op">]</span> <span class="op">=</span> <span class="op">{</span><span class="dv">22</span><span class="op">,</span> <span class="dv">37</span><span class="op">,</span> <span class="dv">3490</span><span class="op">,</span> <span class="dv">18</span><span class="op">,</span> <span class="dv">95</span><span class="op">};</span>  <span class="co">// Initialize with these values</span></span>
<span id="cb88-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb88-7"></a></span>
<span id="cb88-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb88-8"></a>    <span class="cf">for</span> <span class="op">(</span>i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">5</span><span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb88-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb88-9"></a>        printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> a<span class="op">[</span>i<span class="op">]);</span></span>
<span id="cb88-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb88-10"></a>    <span class="op">}</span></span>
<span id="cb88-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb88-11"></a><span class="op">}</span></span></code></pre></div>
<p>Catch: initializer values must be constant terms. Can’t throw variables in there. Sorry, Illinois!</p>
<p>You should never have more items in your initializer than there is room for in the array, or the compiler will get cranky:</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode zsh"><code class="sourceCode zsh"><span id="cb89-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="ex">foo.c:</span> In function ‘main’:</span>
<span id="cb89-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb89-2" aria-hidden="true" tabindex="-1"></a><span class="ex">foo.c:6:39:</span> warning: excess elements in array initializer</span>
<span id="cb89-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb89-3" aria-hidden="true" tabindex="-1"></a>    <span class="ex">6</span> <span class="kw">|</span>     <span class="ex">int</span> a<span class="pp">[</span><span class="st">5</span><span class="pp">]</span> <span class="kw">=</span> {22, 37, 3490, 18, 95, 999<span class="er">}</span><span class="kw">;</span></span>
<span id="cb89-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb89-4" aria-hidden="true" tabindex="-1"></a>      <span class="kw">|</span>                                       <span class="ex">^~~</span></span>
<span id="cb89-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb89-5" aria-hidden="true" tabindex="-1"></a><span class="ex">foo.c:6:39:</span> note: <span class="pp">(</span><span class="ss">near initialization for ‘a’</span><span class="pp">)</span></span></code></pre></div>
<p>But (fun fact!) you can have <em>fewer</em> items in your initializer than there is room for in the array. The remaining elements in the array will be automatically initialized with zero. This is true in general for all types of array initializers: if you have an initializer, anything not explicitly set to a value will be set to zero.</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb90-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> a<span class="op">[</span><span class="dv">5</span><span class="op">]</span> <span class="op">=</span> <span class="op">{</span><span class="dv">22</span><span class="op">,</span> <span class="dv">37</span><span class="op">,</span> <span class="dv">3490</span><span class="op">};</span></span>
<span id="cb90-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb90-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb90-3" aria-hidden="true" tabindex="-1"></a><span class="co">// is the same as:</span></span>
<span id="cb90-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb90-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb90-5" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> a<span class="op">[</span><span class="dv">5</span><span class="op">]</span> <span class="op">=</span> <span class="op">{</span><span class="dv">22</span><span class="op">,</span> <span class="dv">37</span><span class="op">,</span> <span class="dv">3490</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">0</span><span class="op">};</span></span></code></pre></div>
<p>It’s a common shortcut to see this in an initializer when you want to set an entire array to zero:</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb91-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> a<span class="op">[</span><span class="dv">100</span><span class="op">]</span> <span class="op">=</span> <span class="op">{</span><span class="dv">0</span><span class="op">};</span></span></code></pre></div>
<p>Which means, “Make the first element zero, and then automatically make the rest zero, as well.”</p>
<p>You can set specific array elements in the initializer, as well, by specifying an index for the value! When you do this, C will happily keep initializing subsequent values for you until the initializer runs out, filling everything else with <code>0</code>.</p>
<p>To do this, put the index in square brackets with an <code>=</code> after, and then set the value.</p>
<p>Here’s an example where we build an array:</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb92-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> a<span class="op">[</span><span class="dv">10</span><span class="op">]</span> <span class="op">=</span> <span class="op">{</span><span class="dv">0</span><span class="op">,</span> <span class="dv">11</span><span class="op">,</span> <span class="dv">22</span><span class="op">,</span> <span class="op">[</span><span class="dv">5</span><span class="op">]=</span><span class="dv">55</span><span class="op">,</span> <span class="dv">66</span><span class="op">,</span> <span class="dv">77</span><span class="op">};</span></span></code></pre></div>
<p>Because we listed index 5 as the start for <code>55</code>, the resulting data in the array is:</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb93-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb93-1" aria-hidden="true" tabindex="-1"></a>0 11 22 0 0 55 66 77 0 0</span></code></pre></div>
<p>You can put simple constant expressions in there, as well.</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb94-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb94-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#define COUNT </span><span class="dv">5</span></span>
<span id="cb94-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb94-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb94-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb94-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> a<span class="op">[</span>COUNT<span class="op">]</span> <span class="op">=</span> <span class="op">{[</span>COUNT<span class="op">-</span><span class="dv">3</span><span class="op">]=</span><span class="dv">3</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">1</span><span class="op">};</span></span></code></pre></div>
<p>which gives us:</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb95-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb95-1" aria-hidden="true" tabindex="-1"></a>0 0 3 2 1</span></code></pre></div>
<p>Lastly, you can also have C compute the size of the array from the initializer, just by leaving the size off:</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb96-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb96-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> a<span class="op">[</span><span class="dv">3</span><span class="op">]</span> <span class="op">=</span> <span class="op">{</span><span class="dv">22</span><span class="op">,</span> <span class="dv">37</span><span class="op">,</span> <span class="dv">3490</span><span class="op">};</span></span>
<span id="cb96-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb96-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb96-3" aria-hidden="true" tabindex="-1"></a><span class="co">// is the same as:</span></span>
<span id="cb96-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb96-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb96-5" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> a<span class="op">[]</span> <span class="op">=</span> <span class="op">{</span><span class="dv">22</span><span class="op">,</span> <span class="dv">37</span><span class="op">,</span> <span class="dv">3490</span><span class="op">};</span>  <span class="co">// Left the size off!</span></span></code></pre></div>
<p></p>
<h2 data-number="6.4" id="out-of-bounds"><span class="header-section-number">6.4</span> Out of Bounds!</h2>
<p> C doesn’t stop you from accessing arrays out of bounds. It might not even warn you.</p>
<p>Let’s steal the example from above and keep printing off the end of the array. It only has 5 elements, but let’s try to print 10 and see what happens:</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb97-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb97-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb97-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb97-2"></a></span>
<span id="cb97-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb97-3"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb97-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb97-4"></a><span class="op">{</span></span>
<span id="cb97-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb97-5"></a>    <span class="dt">int</span> i<span class="op">;</span></span>
<span id="cb97-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb97-6"></a>    <span class="dt">int</span> a<span class="op">[</span><span class="dv">5</span><span class="op">]</span> <span class="op">=</span> <span class="op">{</span><span class="dv">22</span><span class="op">,</span> <span class="dv">37</span><span class="op">,</span> <span class="dv">3490</span><span class="op">,</span> <span class="dv">18</span><span class="op">,</span> <span class="dv">95</span><span class="op">};</span></span>
<span id="cb97-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb97-7"></a></span>
<span id="cb97-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb97-8"></a>    <span class="cf">for</span> <span class="op">(</span>i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">10</span><span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span>  <span class="co">// BAD NEWS: printing too many elements!</span></span>
<span id="cb97-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb97-9"></a>        printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> a<span class="op">[</span>i<span class="op">]);</span></span>
<span id="cb97-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb97-10"></a>    <span class="op">}</span></span>
<span id="cb97-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb97-11"></a><span class="op">}</span></span></code></pre></div>
<p>Running it on my computer prints:</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb98-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb98-1" aria-hidden="true" tabindex="-1"></a>22</span>
<span id="cb98-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb98-2" aria-hidden="true" tabindex="-1"></a>37</span>
<span id="cb98-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb98-3" aria-hidden="true" tabindex="-1"></a>3490</span>
<span id="cb98-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb98-4" aria-hidden="true" tabindex="-1"></a>18</span>
<span id="cb98-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb98-5" aria-hidden="true" tabindex="-1"></a>95</span>
<span id="cb98-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb98-6" aria-hidden="true" tabindex="-1"></a>32765</span>
<span id="cb98-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb98-7" aria-hidden="true" tabindex="-1"></a>1847052032</span>
<span id="cb98-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb98-8" aria-hidden="true" tabindex="-1"></a>1780534144</span>
<span id="cb98-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb98-9" aria-hidden="true" tabindex="-1"></a>-56487472</span>
<span id="cb98-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb98-10" aria-hidden="true" tabindex="-1"></a>21890</span></code></pre></div>
<p>Yikes! What’s that? Well, turns out printing off the end of an array results in what C developers call <em>undefined behavior</em>. We’ll talk more about this beast later, but for now it means, “You’ve done something bad, and anything could happen during your program run.”</p>
<p>And by anything, I mean typically things like finding zeroes, finding garbage numbers, or crashing. But really the C spec says in this circumstance the compiler is allowed to emit code that does <em>anything</em><a href="https://beej.us/guide/bgc/html/index-wide.html#fn56" class="footnote-ref" id="fnref56" role="doc-noteref"><sup>56</sup></a>.</p>
<p>Short version: don’t do anything that causes undefined behavior. Ever<a href="https://beej.us/guide/bgc/html/index-wide.html#fn57" class="footnote-ref" id="fnref57" role="doc-noteref"><sup>57</sup></a>. </p>
<h2 data-number="6.5" id="multidimensional-arrays"><span class="header-section-number">6.5</span> Multidimensional Arrays</h2>
<p> You can add as many dimensions as you want to your arrays.</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb99-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> a<span class="op">[</span><span class="dv">10</span><span class="op">];</span></span>
<span id="cb99-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb99-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> b<span class="op">[</span><span class="dv">2</span><span class="op">][</span><span class="dv">7</span><span class="op">];</span></span>
<span id="cb99-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb99-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> c<span class="op">[</span><span class="dv">4</span><span class="op">][</span><span class="dv">5</span><span class="op">][</span><span class="dv">6</span><span class="op">];</span></span></code></pre></div>
<p>These are stored in memory in <a href="https://en.wikipedia.org/wiki/Row-_and_column-major_order">row-major order</a><a href="https://beej.us/guide/bgc/html/index-wide.html#fn58" class="footnote-ref" id="fnref58" role="doc-noteref"><sup>58</sup></a>. This means with a 2D array, the first index listed indicates the row, and the second the column.</p>
<p>You can also use initializers on multidimensional arrays by nesting them:</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb100-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb100-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb100-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb100-2"></a></span>
<span id="cb100-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb100-3"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb100-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb100-4"></a><span class="op">{</span></span>
<span id="cb100-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb100-5"></a>    <span class="dt">int</span> row<span class="op">,</span> col<span class="op">;</span></span>
<span id="cb100-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb100-6"></a></span>
<span id="cb100-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb100-7"></a>    <span class="dt">int</span> a<span class="op">[</span><span class="dv">2</span><span class="op">][</span><span class="dv">5</span><span class="op">]</span> <span class="op">=</span> <span class="op">{</span>      <span class="co">// Initialize a 2D array</span></span>
<span id="cb100-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb100-8"></a>        <span class="op">{</span><span class="dv">0</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> <span class="dv">4</span><span class="op">},</span></span>
<span id="cb100-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb100-9"></a>        <span class="op">{</span><span class="dv">5</span><span class="op">,</span> <span class="dv">6</span><span class="op">,</span> <span class="dv">7</span><span class="op">,</span> <span class="dv">8</span><span class="op">,</span> <span class="dv">9</span><span class="op">}</span></span>
<span id="cb100-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb100-10"></a>    <span class="op">};</span></span>
<span id="cb100-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb100-11"></a></span>
<span id="cb100-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb100-12"></a>    <span class="cf">for</span> <span class="op">(</span>row <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> row <span class="op">&lt;</span> <span class="dv">2</span><span class="op">;</span> row<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb100-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb100-13"></a>        <span class="cf">for</span> <span class="op">(</span>col <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> col <span class="op">&lt;</span> <span class="dv">5</span><span class="op">;</span> col<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb100-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb100-14"></a>            printf<span class="op">(</span><span class="st">"(</span><span class="sc">%d</span><span class="st">,</span><span class="sc">%d</span><span class="st">) = </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> row<span class="op">,</span> col<span class="op">,</span> a<span class="op">[</span>row<span class="op">][</span>col<span class="op">]);</span></span>
<span id="cb100-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb100-15"></a>        <span class="op">}</span></span>
<span id="cb100-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb100-16"></a>    <span class="op">}</span></span>
<span id="cb100-17"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb100-17"></a><span class="op">}</span></span></code></pre></div>
<p>For output of:</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb101-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb101-1" aria-hidden="true" tabindex="-1"></a>(0,0) = 0</span>
<span id="cb101-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb101-2" aria-hidden="true" tabindex="-1"></a>(0,1) = 1</span>
<span id="cb101-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb101-3" aria-hidden="true" tabindex="-1"></a>(0,2) = 2</span>
<span id="cb101-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb101-4" aria-hidden="true" tabindex="-1"></a>(0,3) = 3</span>
<span id="cb101-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb101-5" aria-hidden="true" tabindex="-1"></a>(0,4) = 4</span>
<span id="cb101-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb101-6" aria-hidden="true" tabindex="-1"></a>(1,0) = 5</span>
<span id="cb101-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb101-7" aria-hidden="true" tabindex="-1"></a>(1,1) = 6</span>
<span id="cb101-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb101-8" aria-hidden="true" tabindex="-1"></a>(1,2) = 7</span>
<span id="cb101-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb101-9" aria-hidden="true" tabindex="-1"></a>(1,3) = 8</span>
<span id="cb101-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb101-10" aria-hidden="true" tabindex="-1"></a>(1,4) = 9</span></code></pre></div>
<p>And you can initialize with explicit indexes:</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb102-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Make a 3x3 identity matrix</span></span>
<span id="cb102-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb102-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb102-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> a<span class="op">[</span><span class="dv">3</span><span class="op">][</span><span class="dv">3</span><span class="op">]</span> <span class="op">=</span> <span class="op">{[</span><span class="dv">0</span><span class="op">][</span><span class="dv">0</span><span class="op">]=</span><span class="dv">1</span><span class="op">,</span> <span class="op">[</span><span class="dv">1</span><span class="op">][</span><span class="dv">1</span><span class="op">]=</span><span class="dv">1</span><span class="op">,</span> <span class="op">[</span><span class="dv">2</span><span class="op">][</span><span class="dv">2</span><span class="op">]=</span><span class="dv">1</span><span class="op">};</span></span></code></pre></div>
<p>which builds a 2D array like this:</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb103-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb103-1" aria-hidden="true" tabindex="-1"></a>1 0 0</span>
<span id="cb103-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb103-2" aria-hidden="true" tabindex="-1"></a>0 1 0</span>
<span id="cb103-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb103-3" aria-hidden="true" tabindex="-1"></a>0 0 1</span></code></pre></div>
<p></p>
<h2 data-number="6.6" id="arrays-and-pointers"><span class="header-section-number">6.6</span> Arrays and Pointers</h2>
<p> [<em>Casually</em>] So… I kinda might have mentioned up there that arrays were pointers, deep down? We should take a shallow dive into that now so that things aren’t completely confusing. Later on, we’ll look at what the real relationship between arrays and pointers is, but for now I just want to look at passing arrays to functions.</p>
<h3 data-number="6.6.1" id="getting-a-pointer-to-an-array"><span class="header-section-number">6.6.1</span> Getting a Pointer to an Array</h3>
<p>I want to tell you a secret. Generally speaking, when a C programmer talks about a pointer to an array, they’re talking about a pointer <em>to the first element</em> of the array<a href="https://beej.us/guide/bgc/html/index-wide.html#fn59" class="footnote-ref" id="fnref59" role="doc-noteref"><sup>59</sup></a>.</p>
<p>So let’s get a pointer to the first element of an array.</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb104-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb104-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb104-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb104-2"></a></span>
<span id="cb104-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb104-3"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb104-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb104-4"></a><span class="op">{</span></span>
<span id="cb104-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb104-5"></a>    <span class="dt">int</span> a<span class="op">[</span><span class="dv">5</span><span class="op">]</span> <span class="op">=</span> <span class="op">{</span><span class="dv">11</span><span class="op">,</span> <span class="dv">22</span><span class="op">,</span> <span class="dv">33</span><span class="op">,</span> <span class="dv">44</span><span class="op">,</span> <span class="dv">55</span><span class="op">};</span></span>
<span id="cb104-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb104-6"></a>    <span class="dt">int</span> <span class="op">*</span>p<span class="op">;</span></span>
<span id="cb104-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb104-7"></a></span>
<span id="cb104-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb104-8"></a>    p <span class="op">=</span> <span class="op">&amp;</span>a<span class="op">[</span><span class="dv">0</span><span class="op">];</span>  <span class="co">// p points to the array</span></span>
<span id="cb104-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb104-9"></a>                <span class="co">// Well, to the first element, actually</span></span>
<span id="cb104-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb104-10"></a></span>
<span id="cb104-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb104-11"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> <span class="op">*</span>p<span class="op">);</span>  <span class="co">// Prints "11"</span></span>
<span id="cb104-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb104-12"></a><span class="op">}</span></span></code></pre></div>
<p>This is so common to do in C that the language allows us a shorthand:</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb105-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb105-1"></a>p <span class="op">=</span> <span class="op">&amp;</span>a<span class="op">[</span><span class="dv">0</span><span class="op">];</span>  <span class="co">// p points to the array</span></span>
<span id="cb105-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb105-2"></a></span>
<span id="cb105-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb105-3"></a><span class="co">// is the same as:</span></span>
<span id="cb105-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb105-4"></a></span>
<span id="cb105-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb105-5"></a>p <span class="op">=</span> a<span class="op">;</span>      <span class="co">// p points to the array, but much nicer-looking!</span></span></code></pre></div>
<p>Just referring to the array name in isolation is the same as getting a pointer to the first element of the array! We’re going to use this extensively in the upcoming examples.</p>
<p>But hold on a second—isn’t <code>p</code> an <code>int*</code>? And <code>*p</code> gives us <code>11</code>, same as <code>a[0]</code>? Yessss. You’re starting to get a glimpse of how arrays and pointers are related in C. </p>
<h3 data-number="6.6.2" id="passing1darrays"><span class="header-section-number">6.6.2</span> Passing Single Dimensional Arrays to Functions</h3>
<p> Let’s do an example with a single dimensional array. I’m going to write a couple functions that we can pass the array to that do different things.</p>
<p>Prepare for some mind-blowing function signatures!</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb106-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb106-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb106-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb106-2"></a></span>
<span id="cb106-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb106-3"></a><span class="co">// Passing as a pointer to the first element</span></span>
<span id="cb106-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb106-4"></a><span class="dt">void</span> times2<span class="op">(</span><span class="dt">int</span> <span class="op">*</span>a<span class="op">,</span> <span class="dt">int</span> len<span class="op">)</span></span>
<span id="cb106-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb106-5"></a><span class="op">{</span></span>
<span id="cb106-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb106-6"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> len<span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb106-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb106-7"></a>        printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> a<span class="op">[</span>i<span class="op">]</span> <span class="op">*</span> <span class="dv">2</span><span class="op">);</span></span>
<span id="cb106-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb106-8"></a><span class="op">}</span></span>
<span id="cb106-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb106-9"></a></span>
<span id="cb106-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb106-10"></a><span class="co">// Same thing, but using array notation</span></span>
<span id="cb106-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb106-11"></a><span class="dt">void</span> times3<span class="op">(</span><span class="dt">int</span> a<span class="op">[],</span> <span class="dt">int</span> len<span class="op">)</span></span>
<span id="cb106-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb106-12"></a><span class="op">{</span></span>
<span id="cb106-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb106-13"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> len<span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb106-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb106-14"></a>        printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> a<span class="op">[</span>i<span class="op">]</span> <span class="op">*</span> <span class="dv">3</span><span class="op">);</span></span>
<span id="cb106-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb106-15"></a><span class="op">}</span></span>
<span id="cb106-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb106-16"></a></span>
<span id="cb106-17"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb106-17"></a><span class="co">// Same thing, but using array notation with size</span></span>
<span id="cb106-18"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb106-18"></a><span class="dt">void</span> times4<span class="op">(</span><span class="dt">int</span> a<span class="op">[</span><span class="dv">5</span><span class="op">],</span> <span class="dt">int</span> len<span class="op">)</span></span>
<span id="cb106-19"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb106-19"></a><span class="op">{</span></span>
<span id="cb106-20"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb106-20"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> len<span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb106-21"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb106-21"></a>        printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> a<span class="op">[</span>i<span class="op">]</span> <span class="op">*</span> <span class="dv">4</span><span class="op">);</span></span>
<span id="cb106-22"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb106-22"></a><span class="op">}</span></span>
<span id="cb106-23"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb106-23"></a></span>
<span id="cb106-24"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb106-24"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb106-25"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb106-25"></a><span class="op">{</span></span>
<span id="cb106-26"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb106-26"></a>    <span class="dt">int</span> x<span class="op">[</span><span class="dv">5</span><span class="op">]</span> <span class="op">=</span> <span class="op">{</span><span class="dv">11</span><span class="op">,</span> <span class="dv">22</span><span class="op">,</span> <span class="dv">33</span><span class="op">,</span> <span class="dv">44</span><span class="op">,</span> <span class="dv">55</span><span class="op">};</span></span>
<span id="cb106-27"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb106-27"></a></span>
<span id="cb106-28"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb106-28"></a>    times2<span class="op">(</span>x<span class="op">,</span> <span class="dv">5</span><span class="op">);</span></span>
<span id="cb106-29"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb106-29"></a>    times3<span class="op">(</span>x<span class="op">,</span> <span class="dv">5</span><span class="op">);</span></span>
<span id="cb106-30"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb106-30"></a>    times4<span class="op">(</span>x<span class="op">,</span> <span class="dv">5</span><span class="op">);</span></span>
<span id="cb106-31"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb106-31"></a><span class="op">}</span></span></code></pre></div>
<p>All those methods of listing the array as a parameter in the function are identical.</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb107-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> times2<span class="op">(</span><span class="dt">int</span> <span class="op">*</span>a<span class="op">,</span> <span class="dt">int</span> len<span class="op">)</span></span>
<span id="cb107-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb107-2" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> times3<span class="op">(</span><span class="dt">int</span> a<span class="op">[],</span> <span class="dt">int</span> len<span class="op">)</span></span>
<span id="cb107-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb107-3" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> times4<span class="op">(</span><span class="dt">int</span> a<span class="op">[</span><span class="dv">5</span><span class="op">],</span> <span class="dt">int</span> len<span class="op">)</span></span></code></pre></div>
<p>In usage by C regulars, the first is the most common, by far.</p>
<p>And, in fact, in the latter situation, the compiler doesn’t even care what number you pass in (other than it has to be greater than zero<a href="https://beej.us/guide/bgc/html/index-wide.html#fn60" class="footnote-ref" id="fnref60" role="doc-noteref"><sup>60</sup></a>). It doesn’t enforce anything at all.</p>
<p>Now that I’ve said that, the size of the array in the function declaration actually <em>does</em> matter when you’re passing multidimensional arrays into functions, but let’s come back to that. </p>
<h3 data-number="6.6.3" id="changing-arrays-in-functions"><span class="header-section-number">6.6.3</span> Changing Arrays in Functions</h3>
<p> We’ve said that arrays are just pointers in disguise. This means that if you pass an array to a function, you’re likely passing a pointer to the first element in the array.</p>
<p>But if the function has a pointer to the data, it is able to manipulate that data! So changes that a function makes to an array will be visible back out in the caller.</p>
<p>Here’s an example where we pass a pointer to an array to a function, the function manipulates the values in that array, and those changes are visible out in the caller.</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb108-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb108-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb108-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb108-2"></a></span>
<span id="cb108-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb108-3"></a><span class="dt">void</span> double_array<span class="op">(</span><span class="dt">int</span> <span class="op">*</span>a<span class="op">,</span> <span class="dt">int</span> len<span class="op">)</span></span>
<span id="cb108-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb108-4"></a><span class="op">{</span></span>
<span id="cb108-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb108-5"></a>    <span class="co">// Multiply each element by 2</span></span>
<span id="cb108-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb108-6"></a>    <span class="co">//</span></span>
<span id="cb108-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb108-7"></a>    <span class="co">// This doubles the values in x in main() since x and a both point</span></span>
<span id="cb108-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb108-8"></a>    <span class="co">// to the same array in memory!</span></span>
<span id="cb108-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb108-9"></a></span>
<span id="cb108-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb108-10"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> len<span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb108-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb108-11"></a>        a<span class="op">[</span>i<span class="op">]</span> <span class="op">*=</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb108-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb108-12"></a><span class="op">}</span></span>
<span id="cb108-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb108-13"></a></span>
<span id="cb108-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb108-14"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb108-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb108-15"></a><span class="op">{</span></span>
<span id="cb108-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb108-16"></a>    <span class="dt">int</span> x<span class="op">[</span><span class="dv">5</span><span class="op">]</span> <span class="op">=</span> <span class="op">{</span><span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> <span class="dv">4</span><span class="op">,</span> <span class="dv">5</span><span class="op">};</span></span>
<span id="cb108-17"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb108-17"></a></span>
<span id="cb108-18"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb108-18"></a>    double_array<span class="op">(</span>x<span class="op">,</span> <span class="dv">5</span><span class="op">);</span></span>
<span id="cb108-19"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb108-19"></a></span>
<span id="cb108-20"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb108-20"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">5</span><span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb108-21"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb108-21"></a>        printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> x<span class="op">[</span>i<span class="op">]);</span>  <span class="co">// 2, 4, 6, 8, 10!</span></span>
<span id="cb108-22"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb108-22"></a><span class="op">}</span></span></code></pre></div>
<p>Even though we passed the array in as parameter <code>a</code> which is type <code>int*</code>, look at how we access it using array notation with <code>a[i]</code>! Whaaaat. This is totally allowed.</p>
<p>Later when we talk about the equivalence between arrays and pointers, we’ll see how this makes a lot more sense. For now, it’s enough to know that functions can make changes to arrays that are visible out in the caller. </p>
<h3 data-number="6.6.4" id="passing-multidimensional-arrays-to-functions"><span class="header-section-number">6.6.4</span> Passing Multidimensional Arrays to Functions</h3>
<p> The story changes a little when we’re talking about multidimensional arrays. C needs to know all the dimensions (except the first one) so it has enough information to know where in memory to look to find a value.</p>
<p>Here’s an example where we’re explicit with all the dimensions:</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb109-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb109-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb109-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb109-2"></a></span>
<span id="cb109-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb109-3"></a><span class="dt">void</span> print_2D_array<span class="op">(</span><span class="dt">int</span> a<span class="op">[</span><span class="dv">2</span><span class="op">][</span><span class="dv">3</span><span class="op">])</span></span>
<span id="cb109-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb109-4"></a><span class="op">{</span></span>
<span id="cb109-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb109-5"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> row <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> row <span class="op">&lt;</span> <span class="dv">2</span><span class="op">;</span> row<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb109-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb109-6"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> col <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> col <span class="op">&lt;</span> <span class="dv">3</span><span class="op">;</span> col<span class="op">++)</span></span>
<span id="cb109-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb109-7"></a>            printf<span class="op">(</span><span class="st">"</span><span class="sc">%d</span><span class="st"> "</span><span class="op">,</span> a<span class="op">[</span>row<span class="op">][</span>col<span class="op">]);</span></span>
<span id="cb109-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb109-8"></a>        printf<span class="op">(</span><span class="st">"</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb109-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb109-9"></a>    <span class="op">}</span></span>
<span id="cb109-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb109-10"></a><span class="op">}</span></span>
<span id="cb109-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb109-11"></a></span>
<span id="cb109-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb109-12"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb109-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb109-13"></a><span class="op">{</span></span>
<span id="cb109-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb109-14"></a>    <span class="dt">int</span> x<span class="op">[</span><span class="dv">2</span><span class="op">][</span><span class="dv">3</span><span class="op">]</span> <span class="op">=</span> <span class="op">{</span></span>
<span id="cb109-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb109-15"></a>        <span class="op">{</span><span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">3</span><span class="op">},</span></span>
<span id="cb109-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb109-16"></a>        <span class="op">{</span><span class="dv">4</span><span class="op">,</span> <span class="dv">5</span><span class="op">,</span> <span class="dv">6</span><span class="op">}</span></span>
<span id="cb109-17"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb109-17"></a>    <span class="op">};</span></span>
<span id="cb109-18"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb109-18"></a></span>
<span id="cb109-19"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb109-19"></a>    print_2D_array<span class="op">(</span>x<span class="op">);</span></span>
<span id="cb109-20"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb109-20"></a><span class="op">}</span></span></code></pre></div>
<p>But in this case, these two<a href="https://beej.us/guide/bgc/html/index-wide.html#fn61" class="footnote-ref" id="fnref61" role="doc-noteref"><sup>61</sup></a> are equivalent:</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb110-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> print_2D_array<span class="op">(</span><span class="dt">int</span> a<span class="op">[</span><span class="dv">2</span><span class="op">][</span><span class="dv">3</span><span class="op">])</span></span>
<span id="cb110-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb110-2" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> print_2D_array<span class="op">(</span><span class="dt">int</span> a<span class="op">[][</span><span class="dv">3</span><span class="op">])</span></span></code></pre></div>
<p>The compiler really only needs the second dimension so it can figure out how far in memory to skip for each increment of the first dimension. In general, it needs to know all the dimensions except the first one.</p>
<p>Also, remember that the compiler does minimal compile-time bounds checking (if you’re lucky), and C does zero runtime checking of bounds. No seat belts! Don’t crash by accessing array elements out of bounds! </p>
<!-- Beej's guide to C

# vim: ts=4:sw=4:nosi:et:tw=72
-->
<h1 data-number="7" id="strings"><span class="header-section-number">7</span> Strings</h1>
<p>Finally! Strings! What could be simpler?</p>
<p>Well, turns out strings aren’t actually strings in C. That’s right! They’re pointers! Of course they are!</p>
<p>Much like arrays, strings in C <em>barely exist</em>.</p>
<p>But let’s check it out—it’s not really such a big deal.</p>
<h2 data-number="7.1" id="string-literals"><span class="header-section-number">7.1</span> String Literals</h2>
<p>Before we start, let’s talk about string literals in C. These are sequences of characters in <em>double</em> quotes (<code>"</code>). (Single quotes enclose characters, and are a different animal entirely.)</p>
<p>Examples:</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb111-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="st">"Hello, world!</span><span class="sc">\n</span><span class="st">"</span></span>
<span id="cb111-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb111-2" aria-hidden="true" tabindex="-1"></a><span class="st">"This is a test."</span></span>
<span id="cb111-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb111-3" aria-hidden="true" tabindex="-1"></a><span class="st">"When asked if this string had quotes in it, she replied, </span><span class="sc">\"</span><span class="st">It does.</span><span class="sc">\"</span><span class="st">"</span></span></code></pre></div>
<p>The first one has a newline at the end—quite a common thing to see.</p>
<p>The last one has quotes embedded within it, but you see each is preceded by (we say “escaped by”) a backslash (<code>\</code>) indicating that a literal quote belongs in the string at this point. This is how the C compiler can tell the difference between printing a double quote and the double quote at the end of the string.</p>
<h2 data-number="7.2" id="string-variables"><span class="header-section-number">7.2</span> String Variables</h2>
<p>Now that we know how to make a string literal, let’s assign it to a variable so we can do something with it.</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb112-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span> <span class="op">*</span>s <span class="op">=</span> <span class="st">"Hello, world!"</span><span class="op">;</span></span></code></pre></div>
<p>Check out that type: pointer to a <code>char</code>. The string variable <code>s</code> is actually a pointer to the first character in that string, namely the <code>H</code>.</p>
<p>And we can print it with the <code>%s</code> (for “string”) format specifier:</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb113-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span> <span class="op">*</span>s <span class="op">=</span> <span class="st">"Hello, world!"</span><span class="op">;</span></span>
<span id="cb113-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb113-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb113-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb113-3" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> s<span class="op">);</span>  <span class="co">// "Hello, world!"</span></span></code></pre></div>
<p></p>
<h2 data-number="7.3" id="string-variables-as-arrays"><span class="header-section-number">7.3</span> String Variables as Arrays</h2>
<p> Another option is this, nearly equivalent to the above <code>char*</code> usage:</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb114-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span> s<span class="op">[</span><span class="dv">14</span><span class="op">]</span> <span class="op">=</span> <span class="st">"Hello, world!"</span><span class="op">;</span></span>
<span id="cb114-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb114-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb114-3" aria-hidden="true" tabindex="-1"></a><span class="co">// or, if we were properly lazy and have the compiler</span></span>
<span id="cb114-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb114-4" aria-hidden="true" tabindex="-1"></a><span class="co">// figure the length for us:</span></span>
<span id="cb114-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb114-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb114-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb114-6" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span> s<span class="op">[]</span> <span class="op">=</span> <span class="st">"Hello, world!"</span><span class="op">;</span></span></code></pre></div>
<p>This means you can use array notation to access characters in a string. Let’s do exactly that to print all the characters in a string on the same line:</p>
<div class="sourceCode" id="cb115"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb115-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb115-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb115-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb115-2"></a></span>
<span id="cb115-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb115-3"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb115-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb115-4"></a><span class="op">{</span></span>
<span id="cb115-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb115-5"></a>    <span class="dt">char</span> s<span class="op">[]</span> <span class="op">=</span> <span class="st">"Hello, world!"</span><span class="op">;</span></span>
<span id="cb115-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb115-6"></a></span>
<span id="cb115-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb115-7"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">13</span><span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb115-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb115-8"></a>        printf<span class="op">(</span><span class="st">"</span><span class="sc">%c\n</span><span class="st">"</span><span class="op">,</span> s<span class="op">[</span>i<span class="op">]);</span></span>
<span id="cb115-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb115-9"></a><span class="op">}</span></span></code></pre></div>
<p>Note that we’re using the format specifier <code>%c</code> to print a single character.</p>
<p>Also, check this out. The program will still work fine if we change the definition of <code>s</code> to be a <code>char*</code> type:</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb116-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb116-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb116-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb116-2"></a></span>
<span id="cb116-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb116-3"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb116-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb116-4"></a><span class="op">{</span></span>
<span id="cb116-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb116-5"></a>    <span class="dt">char</span> <span class="op">*</span>s <span class="op">=</span> <span class="st">"Hello, world!"</span><span class="op">;</span>   <span class="co">// char* here</span></span>
<span id="cb116-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb116-6"></a></span>
<span id="cb116-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb116-7"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">13</span><span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb116-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb116-8"></a>        printf<span class="op">(</span><span class="st">"</span><span class="sc">%c\n</span><span class="st">"</span><span class="op">,</span> s<span class="op">[</span>i<span class="op">]);</span>    <span class="co">// But still use arrays here...?</span></span>
<span id="cb116-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb116-9"></a><span class="op">}</span></span></code></pre></div>
<p>And we still can use array notation to get the job done when printing it out! This is surprising, but is still only because we haven’t talked about array/pointer equivalence yet. But this is yet another hint that arrays and pointers are the same thing, deep down. </p>
<h2 data-number="7.4" id="string-initializers"><span class="header-section-number">7.4</span> String Initializers</h2>
<p> We’ve already seen some examples with initializing string variables with string literals:</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb117-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span> <span class="op">*</span>s <span class="op">=</span> <span class="st">"Hello, world!"</span><span class="op">;</span></span>
<span id="cb117-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb117-2" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span> t<span class="op">[]</span> <span class="op">=</span> <span class="st">"Hello, again!"</span><span class="op">;</span></span></code></pre></div>
<p>But these two are subtly different.</p>
<p>This one is a pointer to a string literal (i.e.&nbsp;a pointer to the first character in a string):</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb118-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb118-1" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span> <span class="op">*</span>s <span class="op">=</span> <span class="st">"Hello, world!"</span><span class="op">;</span></span></code></pre></div>
<p>If you try to mutate that string with this:</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb119-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span> <span class="op">*</span>s <span class="op">=</span> <span class="st">"Hello, world!"</span><span class="op">;</span></span>
<span id="cb119-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb119-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb119-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb119-3" aria-hidden="true" tabindex="-1"></a>s<span class="op">[</span><span class="dv">0</span><span class="op">]</span> <span class="op">=</span> <span class="ch">'z'</span><span class="op">;</span>  <span class="co">// BAD NEWS: tried to mutate a string literal!</span></span></code></pre></div>
<p>The behavior is undefined. Probably, depending on your system, a crash will result.</p>
<p>But declaring it as an array is different. This one is a mutable <em>copy</em> of the string that we can change at will:</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb120-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb120-1" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span> t<span class="op">[]</span> <span class="op">=</span> <span class="st">"Hello, again!"</span><span class="op">;</span>  <span class="co">// t is an array copy of the string </span></span>
<span id="cb120-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb120-2" aria-hidden="true" tabindex="-1"></a>t<span class="op">[</span><span class="dv">0</span><span class="op">]</span> <span class="op">=</span> <span class="ch">'z'</span><span class="op">;</span> <span class="co">//  No problem</span></span>
<span id="cb120-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb120-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb120-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb120-4" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> t<span class="op">);</span>  <span class="co">// "zello, again!"</span></span></code></pre></div>
<p>So remember: if you have a pointer to a string literal, don’t try to change it! And if you use a string in double quotes to initialize an array, that’s not actually a string literal. </p>
<h2 data-number="7.5" id="getting-string-length"><span class="header-section-number">7.5</span> Getting String Length</h2>
<p> You can’t, since C doesn’t track it for you. And when I say “can’t”, I actually mean “can”<a href="https://beej.us/guide/bgc/html/index-wide.html#fn62" class="footnote-ref" id="fnref62" role="doc-noteref"><sup>62</sup></a>. There’s a function in <code>&lt;string.h&gt;</code> called <code>strlen()</code> that can be used to compute the length of any string in bytes<a href="https://beej.us/guide/bgc/html/index-wide.html#fn63" class="footnote-ref" id="fnref63" role="doc-noteref"><sup>63</sup></a>.</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb121-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb121-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb121-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb121-2"></a><span class="pp">#include </span><span class="im">&lt;string.h&gt;</span></span>
<span id="cb121-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb121-3"></a></span>
<span id="cb121-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb121-4"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb121-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb121-5"></a><span class="op">{</span></span>
<span id="cb121-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb121-6"></a>    <span class="dt">char</span> <span class="op">*</span>s <span class="op">=</span> <span class="st">"Hello, world!"</span><span class="op">;</span></span>
<span id="cb121-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb121-7"></a></span>
<span id="cb121-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb121-8"></a>    printf<span class="op">(</span><span class="st">"The string is </span><span class="sc">%zu</span><span class="st"> bytes long.</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> strlen<span class="op">(</span>s<span class="op">));</span></span>
<span id="cb121-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb121-9"></a><span class="op">}</span></span></code></pre></div>
<p>The <code>strlen()</code> function returns type <code>size_t</code>, which is an integer type so you can use it for integer math. We print <code>size_t</code> with <code>%zu</code>.</p>
<p>The above program prints:</p>
<div class="sourceCode" id="cb122"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb122-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb122-1" aria-hidden="true" tabindex="-1"></a>The string is 13 bytes long.</span></code></pre></div>
<p>Great! So it <em>is</em> possible to get the string length! </p>
<p>But… if C doesn’t track the length of the string anywhere, how does it know how long the string is?</p>
<h2 data-number="7.6" id="string-termination"><span class="header-section-number">7.6</span> String Termination</h2>
<p> C does strings a little differently than many programming languages, and in fact differently than almost every modern programming language.</p>
<p>When you’re making a new language, you have basically two options for storing a string in memory:</p>
<ol type="1">
<li><p>Store the bytes of the string along with a number indicating the length of the string.</p></li>
<li><p>Store the bytes of the string, and mark the end of the string with a special byte called the <em>terminator</em>.</p></li>
</ol>
<p>If you want strings longer than 255 characters, option 1 requires at least two bytes to store the length. Whereas option 2 only requires one byte to terminate the string. So a bit of savings there.</p>
<p>Of course, these days it seems ridiculous to worry about saving a byte (or 3—lots of languages will happily let you have strings that are 4 gigabytes in length). But back in the day, it was a bigger deal.</p>
<p>So C took approach #2. In C, a “string” is defined by two basic characteristics:</p>
<ul>
<li>A pointer to the first character in the string.</li>
<li>A zero-valued byte (or <code>NUL</code> character<a href="https://beej.us/guide/bgc/html/index-wide.html#fn64" class="footnote-ref" id="fnref64" role="doc-noteref"><sup>64</sup></a>) somewhere in memory after the pointer that indicates the end of the string.</li>
</ul>
<p>A <code>NUL</code> character can be written in C code as <code>\0</code>, though you don’t often have to do this.</p>
<p>When you include a string in double quotes in your code, the <code>NUL</code> character is automatically, implicitly included.</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb123-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span> <span class="op">*</span>s <span class="op">=</span> <span class="st">"Hello!"</span><span class="op">;</span>  <span class="co">// Actually "Hello!\0" behind the scenes</span></span></code></pre></div>
<p>So with this in mind, let’s write our own <code>strlen()</code> function that counts <code>char</code>s in a string until it finds a <code>NUL</code>.</p>
<p>The procedure is to look down the string for a single <code>NUL</code> character, counting as we go<a href="https://beej.us/guide/bgc/html/index-wide.html#fn65" class="footnote-ref" id="fnref65" role="doc-noteref"><sup>65</sup></a>:</p>
<div class="sourceCode" id="cb124"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb124-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> my_strlen<span class="op">(</span><span class="dt">char</span> <span class="op">*</span>s<span class="op">)</span></span>
<span id="cb124-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb124-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb124-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb124-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> count <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb124-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb124-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb124-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span>s<span class="op">[</span>count<span class="op">]</span> <span class="op">!=</span> <span class="ch">'</span><span class="sc">\0</span><span class="ch">'</span><span class="op">)</span>  <span class="co">// Single quotes for single char</span></span>
<span id="cb124-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb124-6" aria-hidden="true" tabindex="-1"></a>        count<span class="op">++;</span></span>
<span id="cb124-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb124-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb124-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> count<span class="op">;</span></span>
<span id="cb124-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb124-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>And that’s basically how the built-in <code>strlen()</code> gets the job done. </p>
<h2 data-number="7.7" id="copying-a-string"><span class="header-section-number">7.7</span> Copying a String</h2>
<p> You can’t copy a string through the assignment operator (<code>=</code>). All that does is make a copy of the pointer to the first character… so you end up with two pointers to the same string:</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb125-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb125-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb125-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb125-2"></a></span>
<span id="cb125-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb125-3"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb125-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb125-4"></a><span class="op">{</span></span>
<span id="cb125-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb125-5"></a>    <span class="dt">char</span> s<span class="op">[]</span> <span class="op">=</span> <span class="st">"Hello, world!"</span><span class="op">;</span></span>
<span id="cb125-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb125-6"></a>    <span class="dt">char</span> <span class="op">*</span>t<span class="op">;</span></span>
<span id="cb125-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb125-7"></a></span>
<span id="cb125-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb125-8"></a>    <span class="co">// This makes a copy of the pointer, not a copy of the string!</span></span>
<span id="cb125-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb125-9"></a>    t <span class="op">=</span> s<span class="op">;</span></span>
<span id="cb125-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb125-10"></a></span>
<span id="cb125-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb125-11"></a>    <span class="co">// We modify t</span></span>
<span id="cb125-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb125-12"></a>    t<span class="op">[</span><span class="dv">0</span><span class="op">]</span> <span class="op">=</span> <span class="ch">'z'</span><span class="op">;</span></span>
<span id="cb125-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb125-13"></a></span>
<span id="cb125-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb125-14"></a>    <span class="co">// But printing s shows the modification!</span></span>
<span id="cb125-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb125-15"></a>    <span class="co">// Because t and s point to the same string!</span></span>
<span id="cb125-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb125-16"></a></span>
<span id="cb125-17"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb125-17"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> s<span class="op">);</span>  <span class="co">// "zello, world!"</span></span>
<span id="cb125-18"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb125-18"></a><span class="op">}</span></span></code></pre></div>
<p>If you want to make a copy of a string, you have to copy it a byte at a time—but this is made easier with the <code>strcpy()</code> function<a href="https://beej.us/guide/bgc/html/index-wide.html#fn66" class="footnote-ref" id="fnref66" role="doc-noteref"><sup>66</sup></a>.</p>
<p>Before you copy the string, make sure you have room to copy it into, i.e.&nbsp;the destination array that’s going to hold the characters needs to be at least as long as the string you’re copying.</p>
<div class="sourceCode" id="cb126"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb126-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb126-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb126-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb126-2"></a><span class="pp">#include </span><span class="im">&lt;string.h&gt;</span></span>
<span id="cb126-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb126-3"></a></span>
<span id="cb126-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb126-4"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb126-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb126-5"></a><span class="op">{</span></span>
<span id="cb126-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb126-6"></a>    <span class="dt">char</span> s<span class="op">[]</span> <span class="op">=</span> <span class="st">"Hello, world!"</span><span class="op">;</span></span>
<span id="cb126-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb126-7"></a>    <span class="dt">char</span> t<span class="op">[</span><span class="dv">100</span><span class="op">];</span>  <span class="co">// Each char is one byte, so plenty of room</span></span>
<span id="cb126-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb126-8"></a></span>
<span id="cb126-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb126-9"></a>    <span class="co">// This makes a copy of the string!</span></span>
<span id="cb126-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb126-10"></a>    strcpy<span class="op">(</span>t<span class="op">,</span> s<span class="op">);</span></span>
<span id="cb126-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb126-11"></a></span>
<span id="cb126-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb126-12"></a>    <span class="co">// We modify t</span></span>
<span id="cb126-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb126-13"></a>    t<span class="op">[</span><span class="dv">0</span><span class="op">]</span> <span class="op">=</span> <span class="ch">'z'</span><span class="op">;</span></span>
<span id="cb126-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb126-14"></a></span>
<span id="cb126-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb126-15"></a>    <span class="co">// And s remains unaffected because it's a different string</span></span>
<span id="cb126-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb126-16"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> s<span class="op">);</span>  <span class="co">// "Hello, world!"</span></span>
<span id="cb126-17"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb126-17"></a></span>
<span id="cb126-18"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb126-18"></a>    <span class="co">// But t has been changed</span></span>
<span id="cb126-19"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb126-19"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> t<span class="op">);</span>  <span class="co">// "zello, world!"</span></span>
<span id="cb126-20"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb126-20"></a><span class="op">}</span></span></code></pre></div>
<p>Notice with <code>strcpy()</code>, the destination pointer is the first argument, and the source pointer is the second. A mnemonic I use to remember this is that it’s the order you would have put <code>t</code> and <code>s</code> if an assignment <code>=</code> worked for strings, with the source on the right and the destination on the left. </p>
<!-- Beej's guide to C

# vim: ts=4:sw=4:nosi:et:tw=72
-->
<h1 data-number="8" id="structs"><span class="header-section-number">8</span> Structs</h1>
<p> In C, we have something called a <code>struct</code>, which is a user-definable type that holds multiple pieces of data, potentially of different types.</p>
<p>It’s a convenient way to bundle multiple variables into a single one. This can be beneficial for passing variables to functions (so you just have to pass one instead of many), and useful for organizing data and making code more readable.</p>
<p>If you’ve come from another language, you might be familiar with the idea of <em>classes</em> and <em>objects</em>. These don’t exist in C, natively<a href="https://beej.us/guide/bgc/html/index-wide.html#fn67" class="footnote-ref" id="fnref67" role="doc-noteref"><sup>67</sup></a>. You can think of a <code>struct</code> as a class with only data members, and no methods.</p>
<h2 data-number="8.1" id="declaring-a-struct"><span class="header-section-number">8.1</span> Declaring a Struct</h2>
<p> You can declare a <code>struct</code> in your code like so:</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb127-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> car <span class="op">{</span></span>
<span id="cb127-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb127-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> <span class="op">*</span>name<span class="op">;</span></span>
<span id="cb127-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb127-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> price<span class="op">;</span></span>
<span id="cb127-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb127-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> speed<span class="op">;</span></span>
<span id="cb127-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb127-5" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
<p>This is often done at the global scope outside any functions so that the <code>struct</code> is globally available.</p>
<p>When you do this, you’re making a new <em>type</em>. The full type name is <code>struct car</code>. (Not just <code>car</code>—that won’t work.)</p>
<p>There aren’t any variables of that type yet, but we can declare some:</p>
<div class="sourceCode" id="cb128"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb128-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> car saturn<span class="op">;</span>  <span class="co">// Variable "saturn" of type "struct car"</span></span></code></pre></div>
<p>And now we have an uninitialized variable <code>saturn</code><a href="https://beej.us/guide/bgc/html/index-wide.html#fn68" class="footnote-ref" id="fnref68" role="doc-noteref"><sup>68</sup></a> of type <code>struct car</code>.</p>
<p>We should initialize it! But how do we set the values of those individual fields?</p>
<p>Like in many other languages that stole it from C, we’re going to use the dot operator (<code>.</code>) to access the individual fields.</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb129-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb129-1" aria-hidden="true" tabindex="-1"></a>saturn<span class="op">.</span>name <span class="op">=</span> <span class="st">"Saturn SL/2"</span><span class="op">;</span></span>
<span id="cb129-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb129-2" aria-hidden="true" tabindex="-1"></a>saturn<span class="op">.</span>price <span class="op">=</span> <span class="fl">15999.99</span><span class="op">;</span></span>
<span id="cb129-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb129-3" aria-hidden="true" tabindex="-1"></a>saturn<span class="op">.</span>speed <span class="op">=</span> <span class="dv">175</span><span class="op">;</span></span>
<span id="cb129-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb129-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb129-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb129-5" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"Name:           </span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> saturn<span class="op">.</span>name<span class="op">);</span></span>
<span id="cb129-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb129-6" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"Price (USD):    </span><span class="sc">%f\n</span><span class="st">"</span><span class="op">,</span> saturn<span class="op">.</span>price<span class="op">);</span></span>
<span id="cb129-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb129-7" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"Top Speed (km): </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> saturn<span class="op">.</span>speed<span class="op">);</span></span></code></pre></div>
<p>There on the first lines, we set the values in the <code>struct car</code>, and then in the next bit, we print those values out. </p>
<h2 data-number="8.2" id="struct-initializers"><span class="header-section-number">8.2</span> Struct Initializers</h2>
<p> That example in the previous section was a little unwieldy. There must be a better way to initialize that <code>struct</code> variable!</p>
<p>You can do it with an initializer by putting values in for the fields <em>in the order they appear in the <code>struct</code></em> when you define the variable. (This won’t work after the variable has been defined—it has to happen in the definition).</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb130-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> car <span class="op">{</span></span>
<span id="cb130-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb130-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> <span class="op">*</span>name<span class="op">;</span></span>
<span id="cb130-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb130-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> price<span class="op">;</span></span>
<span id="cb130-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb130-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> speed<span class="op">;</span></span>
<span id="cb130-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb130-5" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb130-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb130-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb130-7" aria-hidden="true" tabindex="-1"></a><span class="co">// Now with an initializer! Same field order as in the struct declaration:</span></span>
<span id="cb130-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb130-8" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> car saturn <span class="op">=</span> <span class="op">{</span><span class="st">"Saturn SL/2"</span><span class="op">,</span> <span class="fl">16000.99</span><span class="op">,</span> <span class="dv">175</span><span class="op">};</span></span>
<span id="cb130-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb130-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb130-10" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"Name:      </span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> saturn<span class="op">.</span>name<span class="op">);</span></span>
<span id="cb130-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb130-11" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"Price:     </span><span class="sc">%f\n</span><span class="st">"</span><span class="op">,</span> saturn<span class="op">.</span>price<span class="op">);</span></span>
<span id="cb130-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb130-12" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"Top Speed: </span><span class="sc">%d</span><span class="st"> km</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> saturn<span class="op">.</span>speed<span class="op">);</span></span></code></pre></div>
<p>The fact that the fields in the initializer need to be in the same order is a little freaky. If someone changes the order in <code>struct car</code>, it could break all the other code!</p>
<p>We can be more specific with our initializers:</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb131-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> car saturn <span class="op">=</span> <span class="op">{.</span>speed<span class="op">=</span><span class="dv">175</span><span class="op">,</span> <span class="op">.</span>name<span class="op">=</span><span class="st">"Saturn SL/2"</span><span class="op">};</span></span></code></pre></div>
<p>Now it’s independent of the order in the <code>struct</code> declaration. Which is safer code, for sure.</p>
<p>Similar to array initializers, any missing field designators are initialized to zero (in this case, that would be <code>.price</code>, which I’ve omitted). </p>
<h2 data-number="8.3" id="passing-structs-to-functions"><span class="header-section-number">8.3</span> Passing Structs to Functions</h2>
<p> You can do a couple things to pass a <code>struct</code> to a function.</p>
<ol type="1">
<li>Pass the <code>struct</code>.</li>
<li>Pass a pointer to the <code>struct</code>.</li>
</ol>
<p>Recall that when you pass something to a function, a <em>copy</em> of that thing gets made for the function to operate on, whether it’s a copy of a pointer, an <code>int</code>, a <code>struct</code>, or anything.</p>
<p>There are basically two cases when you’d want to pass a pointer to the <code>struct</code>:</p>
<ol type="1">
<li>You need the function to be able to make changes to the <code>struct</code> that was passed in, and have those changes show in the caller.</li>
<li>The <code>struct</code> is somewhat large and it’s more expensive to copy that onto the stack than it is to just copy a pointer<a href="https://beej.us/guide/bgc/html/index-wide.html#fn69" class="footnote-ref" id="fnref69" role="doc-noteref"><sup>69</sup></a>.</li>
</ol>
<p>For those two reasons, it’s far more common to pass a pointer to a <code>struct</code> to a function, though its by no means illegal to pass the <code>struct</code> itself.</p>
<p>Let’s try passing in a pointer, making a function that will allow you to set the <code>.price</code> field of the <code>struct car</code>:</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb132-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb132-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb132-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb132-2"></a></span>
<span id="cb132-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb132-3"></a><span class="kw">struct</span> car <span class="op">{</span></span>
<span id="cb132-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb132-4"></a>    <span class="dt">char</span> <span class="op">*</span>name<span class="op">;</span></span>
<span id="cb132-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb132-5"></a>    <span class="dt">float</span> price<span class="op">;</span></span>
<span id="cb132-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb132-6"></a>    <span class="dt">int</span> speed<span class="op">;</span></span>
<span id="cb132-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb132-7"></a><span class="op">};</span></span>
<span id="cb132-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb132-8"></a></span>
<span id="cb132-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb132-9"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb132-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb132-10"></a><span class="op">{</span></span>
<span id="cb132-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb132-11"></a>    <span class="kw">struct</span> car saturn <span class="op">=</span> <span class="op">{.</span>speed<span class="op">=</span><span class="dv">175</span><span class="op">,</span> <span class="op">.</span>name<span class="op">=</span><span class="st">"Saturn SL/2"</span><span class="op">};</span></span>
<span id="cb132-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb132-12"></a></span>
<span id="cb132-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb132-13"></a>    <span class="co">// Pass a pointer to this struct car, along with a new,</span></span>
<span id="cb132-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb132-14"></a>    <span class="co">// more realistic, price:</span></span>
<span id="cb132-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb132-15"></a>    set_price<span class="op">(&amp;</span>saturn<span class="op">,</span> <span class="fl">799.99</span><span class="op">);</span></span>
<span id="cb132-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb132-16"></a></span>
<span id="cb132-17"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb132-17"></a>    printf<span class="op">(</span><span class="st">"Price: </span><span class="sc">%f\n</span><span class="st">"</span><span class="op">,</span> saturn<span class="op">.</span>price<span class="op">);</span></span>
<span id="cb132-18"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb132-18"></a><span class="op">}</span></span></code></pre></div>
<p>You should be able to come up with the function signature for <code>set_price()</code> just by looking at the types of the arguments we have there.</p>
<p><code>saturn</code> is a <code>struct car</code>, so <code>&amp;saturn</code> must be the address of the <code>struct car</code>, AKA a pointer to a <code>struct car</code>, namely a <code>struct car*</code>.</p>
<p>And <code>799.99</code> is a <code>float</code>.</p>
<p>So the function declaration must look like this:</p>
<div class="sourceCode" id="cb133"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb133-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> set_price<span class="op">(</span><span class="kw">struct</span> car <span class="op">*</span>c<span class="op">,</span> <span class="dt">float</span> new_price<span class="op">)</span></span></code></pre></div>
<p>We just need to write the body. One attempt might be:</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb134-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> set_price<span class="op">(</span><span class="kw">struct</span> car <span class="op">*</span>c<span class="op">,</span> <span class="dt">float</span> new_price<span class="op">)</span> <span class="op">{</span></span>
<span id="cb134-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb134-2" aria-hidden="true" tabindex="-1"></a>    c<span class="op">.</span>price <span class="op">=</span> new_price<span class="op">;</span>  <span class="co">// ERROR!!</span></span>
<span id="cb134-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb134-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>That won’t work because the dot operator only works on <code>struct</code>s… it doesn’t work on <em>pointers</em> to <code>struct</code>s.</p>
<p>Ok, so we can dereference the <code>struct</code> to de-pointer it to get to the <code>struct</code> itself. Dereferencing a <code>struct car*</code> results in the <code>struct car</code> that the pointer points to, which we should be able to use the dot operator on:</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb135-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> set_price<span class="op">(</span><span class="kw">struct</span> car <span class="op">*</span>c<span class="op">,</span> <span class="dt">float</span> new_price<span class="op">)</span> <span class="op">{</span></span>
<span id="cb135-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb135-2" aria-hidden="true" tabindex="-1"></a>    <span class="op">(*</span>c<span class="op">).</span>price <span class="op">=</span> new_price<span class="op">;</span>  <span class="co">// Works, but is ugly and non-idiomatic :(</span></span>
<span id="cb135-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb135-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>And that works! But it’s a little clunky to type all those parens and the asterisk. C has some syntactic sugar called the <em>arrow operator</em> that helps with that. </p>
<h2 data-number="8.4" id="the-arrow-operator"><span class="header-section-number">8.4</span> The Arrow Operator</h2>
<p> The arrow operator helps refer to fields in pointers to <code>struct</code>s.</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb136-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> set_price<span class="op">(</span><span class="kw">struct</span> car <span class="op">*</span>c<span class="op">,</span> <span class="dt">float</span> new_price<span class="op">)</span> <span class="op">{</span></span>
<span id="cb136-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb136-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">// (*c).price = new_price;  // Works, but non-idiomatic :(</span></span>
<span id="cb136-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb136-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">//</span></span>
<span id="cb136-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb136-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">// The line above is 100% equivalent to the one below:</span></span>
<span id="cb136-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb136-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb136-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb136-6" aria-hidden="true" tabindex="-1"></a>    c<span class="op">-&gt;</span>price <span class="op">=</span> new_price<span class="op">;</span>  <span class="co">// That's the one!</span></span>
<span id="cb136-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb136-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>So when accessing fields, when do we use dot and when do we use arrow?</p>
<ul>
<li>If you have a <code>struct</code>, use dot (<code>.</code>).</li>
<li>If you have a pointer to a <code>struct</code>, use arrow (<code>-&gt;</code>). </li>
</ul>
<h2 data-number="8.5" id="copying-and-returning-structs"><span class="header-section-number">8.5</span> Copying and Returning <code>struct</code>s</h2>
<p> Here’s an easy one for you!</p>
<p>Just assign from one to the other!</p>
<div class="sourceCode" id="cb137"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb137-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> car a<span class="op">,</span> b<span class="op">;</span></span>
<span id="cb137-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb137-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb137-3" aria-hidden="true" tabindex="-1"></a>b <span class="op">=</span> a<span class="op">;</span>  <span class="co">// Copy the struct</span></span></code></pre></div>
<p>And returning a <code>struct</code> (as opposed to a pointer to one) from a function also makes a similar copy to the receiving variable.</p>
<p>This is not a “deep copy”<a href="https://beej.us/guide/bgc/html/index-wide.html#fn70" class="footnote-ref" id="fnref70" role="doc-noteref"><sup>70</sup></a>. All fields are copied as-is, including pointers to things. </p>
<h2 data-number="8.6" id="comparing-structs"><span class="header-section-number">8.6</span> Comparing <code>struct</code>s</h2>
<p> There’s only one safe way to do it: compare each field one at a time.</p>
<p>You might think you could use <a href="https://beej.us/guide/bgclr/html/split/stringref.html#man-strcmp"><code>memcmp()</code></a><a href="https://beej.us/guide/bgc/html/index-wide.html#fn71" class="footnote-ref" id="fnref71" role="doc-noteref"><sup>71</sup></a>, but that doesn’t handle the case of the possible <a href="https://beej.us/guide/bgc/html/index-wide.html#struct-padding-bytes">padding bytes</a> that might be in there.</p>
<p>If you clear the <code>struct</code> to zero first with <a href="https://beej.us/guide/bgclr/html/split/stringref.html#man-memset"><code>memset()</code></a><a href="https://beej.us/guide/bgc/html/index-wide.html#fn72" class="footnote-ref" id="fnref72" role="doc-noteref"><sup>72</sup></a>, then it <em>might</em> work, though there could be weird elements that <a href="https://stackoverflow.com/questions/141720/how-do-you-compare-structs-for-equality-in-c">might not compare as you expect</a><a href="https://beej.us/guide/bgc/html/index-wide.html#fn73" class="footnote-ref" id="fnref73" role="doc-noteref"><sup>73</sup></a>. </p>
<!-- Beej's guide to C

# vim: ts=4:sw=4:nosi:et:tw=72
-->
<h1 data-number="9" id="file-inputoutput"><span class="header-section-number">9</span> File Input/Output</h1>
<p> We’ve already seen a couple examples of I/O with <code>scanf()</code> and <code>printf()</code> for doing I/O at the console (screen/keyboard).</p>
<p>But we’ll push those concepts a little farther this chapter.</p>
<h2 data-number="9.1" id="the-file-data-type"><span class="header-section-number">9.1</span> The <code>FILE*</code> Data Type</h2>
<p> When we do any kind of I/O in C, we do so through a piece of data that you get in the form of a <code>FILE*</code> type. This <code>FILE*</code> holds all the information needed to communicate with the I/O subsystem about which file you have open, where you are in the file, and so on.</p>
<p>The spec refers to these as <em>streams</em>, i.e.&nbsp;a stream of data from a file or from any source. I’m going to use “files” and “streams” interchangeably, but really you should think of a “file” as a special case of a “stream”. There are other ways to stream data into a program than just reading from a file.</p>
<p>We’ll see in a moment how to go from having a filename to getting an open <code>FILE*</code> for it, but first I want to mention three streams that are already open for you and ready for use.</p>
<p> </p>
<table>
<thead>
<tr class="header">
<th><code>FILE*</code> name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>stdin</code></td>
<td>Standard Input, generally the keyboard by default</td>
</tr>
<tr class="even">
<td><code>stdout</code></td>
<td>Standard Output, generally the screen by default</td>
</tr>
<tr class="odd">
<td><code>stderr</code></td>
<td>Standard Error, generally the screen by default, as well</td>
</tr>
</tbody>
</table>
<p>We’ve actually been using these implicitly already, it turns out. For example, these two calls are the same:</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb138-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb138-1" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"Hello, world!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb138-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb138-2" aria-hidden="true" tabindex="-1"></a>fprintf<span class="op">(</span>stdout<span class="op">,</span> <span class="st">"Hello, world!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span>  <span class="co">// printf to a file</span></span></code></pre></div>
<p>But more on that later.</p>
<p>Also you’ll notice that both <code>stdout</code> and <code>stderr</code> go to the screen. While this seems at first either like an oversight or redundancy, it actually isn’t. Typical operating systems allow you to <em>redirect</em> the output of either of those into different files, and it can be convenient to be able to separate error messages from regular non-error output.</p>
<p>For example, in a POSIX shell (like sh, ksh, bash, zsh, etc.) on a Unix-like system, we could run a program and send just the non-error (<code>stdout</code>) output to one file, and all the error (<code>stderr</code>) output to another file.</p>
<div class="sourceCode" id="cb139"><pre class="sourceCode zsh"><code class="sourceCode zsh"><span id="cb139-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="ex">./foo</span> <span class="op">&gt;</span> output.txt <span class="dv">2</span><span class="op">&gt;</span> errors.txt   <span class="co"># This command is Unix-specific</span></span></code></pre></div>
<p>For this reason, you should send serious error messages to <code>stderr</code> instead of <code>stdout</code>. </p>
<p>More on how to do that later. </p>
<h2 data-number="9.2" id="reading-text-files"><span class="header-section-number">9.2</span> Reading Text Files</h2>
<p> Streams are largely categorized two different ways: <em>text</em> and <em>binary</em>.</p>
<p>Text streams are allowed to do significant translation of the data, most notably translations of newlines to their different representations<a href="https://beej.us/guide/bgc/html/index-wide.html#fn74" class="footnote-ref" id="fnref74" role="doc-noteref"><sup>74</sup></a>. Text files are logically a sequence of <em>lines</em> separated by newlines. To be portable, your input data should always end with a newline.</p>
<p>But the general rule is that if you’re able to edit the file in a regular text editor, it’s a text file. Otherwise, it’s binary. More on binary later.</p>
<p>So let’s get to work—how do we open a file for reading, and pull data out of it?</p>
<p>Let’s create a file called <code>hello.txt</code> that has just this in it:</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb140-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb140-1" aria-hidden="true" tabindex="-1"></a>Hello, world!</span></code></pre></div>
<p>And let’s write a program to open the file, read a character out of it, and then close the file when we’re done. That’s the game plan!</p>
<p> </p>
<div class="sourceCode" id="cb141"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb141-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb141-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb141-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb141-2"></a></span>
<span id="cb141-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb141-3"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb141-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb141-4"></a><span class="op">{</span></span>
<span id="cb141-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb141-5"></a>    <span class="dt">FILE</span> <span class="op">*</span>fp<span class="op">;</span>                      <span class="co">// Variable to represent open file</span></span>
<span id="cb141-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb141-6"></a></span>
<span id="cb141-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb141-7"></a>    fp <span class="op">=</span> fopen<span class="op">(</span><span class="st">"hello.txt"</span><span class="op">,</span> <span class="st">"r"</span><span class="op">);</span>  <span class="co">// Open file for reading</span></span>
<span id="cb141-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb141-8"></a></span>
<span id="cb141-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb141-9"></a>    <span class="dt">int</span> c <span class="op">=</span> fgetc<span class="op">(</span>fp<span class="op">);</span>             <span class="co">// Read a single character</span></span>
<span id="cb141-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb141-10"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%c\n</span><span class="st">"</span><span class="op">,</span> c<span class="op">);</span>             <span class="co">// Print char to stdout</span></span>
<span id="cb141-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb141-11"></a></span>
<span id="cb141-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb141-12"></a>    fclose<span class="op">(</span>fp<span class="op">);</span>                    <span class="co">// Close the file when done</span></span>
<span id="cb141-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb141-13"></a><span class="op">}</span></span></code></pre></div>
<p>See how when we opened the file with <code>fopen()</code>, it returned the <code>FILE*</code> to us so we could use it later.</p>
<p>(I’m leaving it out for brevity, but <code>fopen()</code> will return <code>NULL</code> if something goes wrong, like file-not-found, so you should really error check it!)</p>
<p>Also notice the <code>"r"</code> that we passed in—this means “open a text stream for reading”. (There are various strings we can pass to <code>fopen()</code> with additional meaning, like writing, or appending, and so on.) </p>
<p>After that, we used the <code>fgetc()</code> function to get a character from the stream. You might be wondering why I’ve made <code>c</code> an <code>int</code> instead of a <code>char</code>—hold that thought! </p>
<p>Finally, we close the stream when we’re done with it. All streams are automatically closed when the program exits, but it’s good form and good housekeeping to explicitly close any files yourself when done with them. </p>
<p>The <code>FILE*</code> keeps track of our position in the file. So subsequent calls to <code>fgetc()</code> would get the next character in the file, and then the next, until the end.</p>
<p>But that sounds like a pain. Let’s see if we can make it easier. </p>
<h2 data-number="9.3" id="end-of-file-eof"><span class="header-section-number">9.3</span> End of File: <code>EOF</code></h2>
<p> There is a special character defined as a macro: <code>EOF</code>. This is what <code>fgetc()</code> will return when the end of the file has been reached and you’ve attempted to read another character.</p>
<p>How about I share that Fun Fact™, now. Turns out <code>EOF</code> is the reason why <code>fgetc()</code> and functions like it return an <code>int</code> instead of a <code>char</code>. <code>EOF</code> isn’t a character proper, and its value likely falls outside the range of <code>char</code>. Since <code>fgetc()</code> needs to be able to return any byte <strong>and</strong> <code>EOF</code>, it needs to be a wider type that can hold more values. so <code>int</code> it is. But unless you’re comparing the returned value against <code>EOF</code>, you can know, deep down, it’s a <code>char</code>.</p>
<p>All right! Back to reality! We can use this to read the whole file in a loop.</p>
<p> </p>
<div class="sourceCode" id="cb142"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb142-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb142-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb142-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb142-2"></a></span>
<span id="cb142-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb142-3"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb142-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb142-4"></a><span class="op">{</span></span>
<span id="cb142-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb142-5"></a>    <span class="dt">FILE</span> <span class="op">*</span>fp<span class="op">;</span></span>
<span id="cb142-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb142-6"></a>    <span class="dt">int</span> c<span class="op">;</span></span>
<span id="cb142-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb142-7"></a></span>
<span id="cb142-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb142-8"></a>    fp <span class="op">=</span> fopen<span class="op">(</span><span class="st">"hello.txt"</span><span class="op">,</span> <span class="st">"r"</span><span class="op">);</span></span>
<span id="cb142-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb142-9"></a></span>
<span id="cb142-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb142-10"></a>    <span class="cf">while</span> <span class="op">((</span>c <span class="op">=</span> fgetc<span class="op">(</span>fp<span class="op">))</span> <span class="op">!=</span> EOF<span class="op">)</span></span>
<span id="cb142-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb142-11"></a>        printf<span class="op">(</span><span class="st">"</span><span class="sc">%c</span><span class="st">"</span><span class="op">,</span> c<span class="op">);</span></span>
<span id="cb142-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb142-12"></a></span>
<span id="cb142-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb142-13"></a>    fclose<span class="op">(</span>fp<span class="op">);</span></span>
<span id="cb142-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb142-14"></a><span class="op">}</span></span></code></pre></div>
<p> </p>
<p>(If line 10 is too weird, just break it down starting with the innermost-nested parens. The first thing we do is assign the result of <code>fgetc()</code> into <code>c</code>, and <em>then</em> we compare <em>that</em> against <code>EOF</code>. We’ve just crammed it into a single line. This might look hard to read, but study it—it’s idiomatic C.) </p>
<p>And running this, we see:</p>
<div class="sourceCode" id="cb143"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb143-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb143-1" aria-hidden="true" tabindex="-1"></a>Hello, world!</span></code></pre></div>
<p>But still, we’re operating a character at a time, and lots of text files make more sense at the line level. Let’s switch to that. </p>
<h3 data-number="9.3.1" id="reading-a-line-at-a-time"><span class="header-section-number">9.3.1</span> Reading a Line at a Time</h3>
<p> So how can we get an entire line at once? <code>fgets()</code> to the rescue! For arguments, it takes a pointer to a <code>char</code> buffer to hold bytes, a maximum number of bytes to read, and a <code>FILE*</code> to read from. It returns <code>NULL</code> on end-of-file or error. <code>fgets()</code> is even nice enough to NUL-terminate the string when its done<a href="https://beej.us/guide/bgc/html/index-wide.html#fn75" class="footnote-ref" id="fnref75" role="doc-noteref"><sup>75</sup></a>.</p>
<p>Let’s do a similar loop as before, except let’s have a multiline file and read it in a line at a time.</p>
<p>Here’s a file <code>quote.txt</code>:</p>
<div class="sourceCode" id="cb144"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb144-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb144-1" aria-hidden="true" tabindex="-1"></a>A wise man can learn more from</span>
<span id="cb144-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb144-2" aria-hidden="true" tabindex="-1"></a>a foolish question than a fool</span>
<span id="cb144-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb144-3" aria-hidden="true" tabindex="-1"></a>can learn from a wise answer.</span>
<span id="cb144-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb144-4" aria-hidden="true" tabindex="-1"></a>                  --Bruce Lee</span></code></pre></div>
<p>And here’s some code that reads that file a line at a time and prints out a line number before each one:</p>
<p></p>
<div class="sourceCode" id="cb145"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb145-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb145-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb145-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb145-2"></a></span>
<span id="cb145-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb145-3"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb145-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb145-4"></a><span class="op">{</span></span>
<span id="cb145-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb145-5"></a>    <span class="dt">FILE</span> <span class="op">*</span>fp<span class="op">;</span></span>
<span id="cb145-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb145-6"></a>    <span class="dt">char</span> s<span class="op">[</span><span class="dv">1024</span><span class="op">];</span>  <span class="co">// Big enough for any line this program will encounter</span></span>
<span id="cb145-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb145-7"></a>    <span class="dt">int</span> linecount <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb145-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb145-8"></a></span>
<span id="cb145-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb145-9"></a>    fp <span class="op">=</span> fopen<span class="op">(</span><span class="st">"quote.txt"</span><span class="op">,</span> <span class="st">"r"</span><span class="op">);</span></span>
<span id="cb145-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb145-10"></a></span>
<span id="cb145-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb145-11"></a>    <span class="cf">while</span> <span class="op">(</span>fgets<span class="op">(</span>s<span class="op">,</span> <span class="kw">sizeof</span> s<span class="op">,</span> fp<span class="op">)</span> <span class="op">!=</span> NULL<span class="op">)</span> </span>
<span id="cb145-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb145-12"></a>        printf<span class="op">(</span><span class="st">"</span><span class="sc">%d</span><span class="st">: </span><span class="sc">%s</span><span class="st">"</span><span class="op">,</span> <span class="op">++</span>linecount<span class="op">,</span> s<span class="op">);</span></span>
<span id="cb145-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb145-13"></a></span>
<span id="cb145-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb145-14"></a>    fclose<span class="op">(</span>fp<span class="op">);</span></span>
<span id="cb145-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb145-15"></a><span class="op">}</span></span></code></pre></div>
<p></p>
<p>Which gives the output:</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb146-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb146-1" aria-hidden="true" tabindex="-1"></a>1: A wise man can learn more from</span>
<span id="cb146-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb146-2" aria-hidden="true" tabindex="-1"></a>2: a foolish question than a fool</span>
<span id="cb146-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb146-3" aria-hidden="true" tabindex="-1"></a>3: can learn from a wise answer.</span>
<span id="cb146-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb146-4" aria-hidden="true" tabindex="-1"></a>4:                   --Bruce Lee</span></code></pre></div>
<p></p>
<h2 data-number="9.4" id="formatted-input"><span class="header-section-number">9.4</span> Formatted Input</h2>
<p> You know how you can get formatted output with <code>printf()</code> (and, thus, <code>fprintf()</code> like we’ll see, below)?</p>
<p> You can do the same thing with <code>fscanf()</code>.</p>
<p>Let’s have a file with a series of data records in it. In this case, whales, with name, length in meters, and weight in tonnes. <code>whales.txt</code>:</p>
<div class="sourceCode" id="cb147"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb147-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb147-1" aria-hidden="true" tabindex="-1"></a>blue 29.9 173</span>
<span id="cb147-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb147-2" aria-hidden="true" tabindex="-1"></a>right 20.7 135</span>
<span id="cb147-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb147-3" aria-hidden="true" tabindex="-1"></a>gray 14.9 41</span>
<span id="cb147-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb147-4" aria-hidden="true" tabindex="-1"></a>humpback 16.0 30</span></code></pre></div>
<p>Yes, we could read these with <code>fgets()</code> and then parse the string with <code>sscanf()</code> (and in some ways that’s more resilient against corrupted files), but in this case, let’s just use <code>fscanf()</code> and pull it in directly.</p>
<p>The <code>fscanf()</code> function skips leading whitespace when reading, and returns <code>EOF</code> on end-of-file or error.</p>
<div class="sourceCode" id="cb148"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb148-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb148-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb148-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb148-2"></a></span>
<span id="cb148-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb148-3"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb148-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb148-4"></a><span class="op">{</span></span>
<span id="cb148-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb148-5"></a>    <span class="dt">FILE</span> <span class="op">*</span>fp<span class="op">;</span></span>
<span id="cb148-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb148-6"></a>    <span class="dt">char</span> name<span class="op">[</span><span class="dv">1024</span><span class="op">];</span>  <span class="co">// Big enough for any line this program will encounter</span></span>
<span id="cb148-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb148-7"></a>    <span class="dt">float</span> length<span class="op">;</span></span>
<span id="cb148-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb148-8"></a>    <span class="dt">int</span> mass<span class="op">;</span></span>
<span id="cb148-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb148-9"></a></span>
<span id="cb148-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb148-10"></a>    fp <span class="op">=</span> fopen<span class="op">(</span><span class="st">"whales.txt"</span><span class="op">,</span> <span class="st">"r"</span><span class="op">);</span></span>
<span id="cb148-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb148-11"></a></span>
<span id="cb148-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb148-12"></a>    <span class="cf">while</span> <span class="op">(</span>fscanf<span class="op">(</span>fp<span class="op">,</span> <span class="st">"</span><span class="sc">%s</span><span class="st"> </span><span class="sc">%f</span><span class="st"> </span><span class="sc">%d</span><span class="st">"</span><span class="op">,</span> name<span class="op">,</span> <span class="op">&amp;</span>length<span class="op">,</span> <span class="op">&amp;</span>mass<span class="op">)</span> <span class="op">!=</span> EOF<span class="op">)</span></span>
<span id="cb148-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb148-13"></a>        printf<span class="op">(</span><span class="st">"</span><span class="sc">%s</span><span class="st"> whale, </span><span class="sc">%d</span><span class="st"> tonnes, </span><span class="sc">%.1f</span><span class="st"> meters</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> name<span class="op">,</span> mass<span class="op">,</span> length<span class="op">);</span></span>
<span id="cb148-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb148-14"></a></span>
<span id="cb148-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb148-15"></a>    fclose<span class="op">(</span>fp<span class="op">);</span></span>
<span id="cb148-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb148-16"></a><span class="op">}</span></span></code></pre></div>
<p></p>
<p>Which gives the result:</p>
<div class="sourceCode" id="cb149"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb149-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb149-1" aria-hidden="true" tabindex="-1"></a>blue whale, 173 tonnes, 29.9 meters</span>
<span id="cb149-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb149-2" aria-hidden="true" tabindex="-1"></a>right whale, 135 tonnes, 20.7 meters</span>
<span id="cb149-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb149-3" aria-hidden="true" tabindex="-1"></a>gray whale, 41 tonnes, 14.9 meters</span>
<span id="cb149-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb149-4" aria-hidden="true" tabindex="-1"></a>humpback whale, 30 tonnes, 16.0 meters</span></code></pre></div>
<p></p>
<h2 data-number="9.5" id="writing-text-files"><span class="header-section-number">9.5</span> Writing Text Files</h2>
<p> In much the same way we can use <code>fgetc()</code>, <code>fgets()</code>, and <code>fscanf()</code> to read text streams, we can use <code>fputc()</code>, <code>fputs()</code>, and <code>fprintf()</code> to write text streams.</p>
<p>To do so, we have to <code>fopen()</code> the file in write mode by passing <code>"w"</code> as the second argument. Opening an existing file in <code>"w"</code> mode will instantly truncate that file to 0 bytes for a full overwrite.</p>
<p>We’ll put together a simple program that outputs a file <code>output.txt</code> using a variety of output functions.</p>
<div class="sourceCode" id="cb150"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb150-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb150-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb150-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb150-2"></a></span>
<span id="cb150-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb150-3"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb150-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb150-4"></a><span class="op">{</span></span>
<span id="cb150-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb150-5"></a>    <span class="dt">FILE</span> <span class="op">*</span>fp<span class="op">;</span></span>
<span id="cb150-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb150-6"></a>    <span class="dt">int</span> x <span class="op">=</span> <span class="dv">32</span><span class="op">;</span></span>
<span id="cb150-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb150-7"></a></span>
<span id="cb150-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb150-8"></a>    fp <span class="op">=</span> fopen<span class="op">(</span><span class="st">"output.txt"</span><span class="op">,</span> <span class="st">"w"</span><span class="op">);</span></span>
<span id="cb150-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb150-9"></a></span>
<span id="cb150-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb150-10"></a>    fputc<span class="op">(</span><span class="ch">'B'</span><span class="op">,</span> fp<span class="op">);</span></span>
<span id="cb150-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb150-11"></a>    fputc<span class="op">(</span><span class="ch">'</span><span class="sc">\n</span><span class="ch">'</span><span class="op">,</span> fp<span class="op">);</span>   <span class="co">// newline</span></span>
<span id="cb150-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb150-12"></a>    fprintf<span class="op">(</span>fp<span class="op">,</span> <span class="st">"x = </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> x<span class="op">);</span></span>
<span id="cb150-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb150-13"></a>    fputs<span class="op">(</span><span class="st">"Hello, world!</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> fp<span class="op">);</span></span>
<span id="cb150-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb150-14"></a></span>
<span id="cb150-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb150-15"></a>    fclose<span class="op">(</span>fp<span class="op">);</span></span>
<span id="cb150-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb150-16"></a><span class="op">}</span></span></code></pre></div>
<p> </p>
<p>And this produces a file, <code>output.txt</code>, with these contents:</p>
<div class="sourceCode" id="cb151"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb151-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb151-1" aria-hidden="true" tabindex="-1"></a>B</span>
<span id="cb151-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb151-2" aria-hidden="true" tabindex="-1"></a>x = 32</span>
<span id="cb151-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb151-3" aria-hidden="true" tabindex="-1"></a>Hello, world!</span></code></pre></div>
<p>Fun fact: since <code>stdout</code> is a file, you could replace line 8 with:</p>
<div class="sourceCode" id="cb152"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb152-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb152-1" aria-hidden="true" tabindex="-1"></a>fp <span class="op">=</span> stdout<span class="op">;</span></span></code></pre></div>
<p>and the program would have outputted to the console instead of to a file. Try it! </p>
<h2 data-number="9.6" id="binary-file-io"><span class="header-section-number">9.6</span> Binary File I/O</h2>
<p> So far we’ve just been talking text files. But there’s that other beast we mentioned early on called <em>binary</em> files, or binary streams.</p>
<p>These work very similarly to text files, except the I/O subsystem doesn’t perform any translations on the data like it might with a text file. With binary files, you get a raw stream of bytes, and that’s all.</p>
<p>The big difference in opening the file is that you have to add a <code>"b"</code> to the mode. That is, to read a binary file, open it in <code>"rb"</code> mode. To write a file, open it in <code>"wb"</code> mode.</p>
<p>Because it’s streams of bytes, and streams of bytes can contain NUL characters, and the NUL character is the end-of-string marker in C, it’s rare that people use the <code>fprintf()</code>-and-friends functions to operate on binary files.</p>
<p> Instead the most common functions are <code>fread()</code> and <code>fwrite()</code>. The functions read and write a specified number of bytes to the stream.</p>
<p>To demo, we’ll write a couple programs. One will write a sequence of byte values to disk all at once. And the second program will read a byte at a time and print them out<a href="https://beej.us/guide/bgc/html/index-wide.html#fn76" class="footnote-ref" id="fnref76" role="doc-noteref"><sup>76</sup></a>.</p>
<div class="sourceCode" id="cb153"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb153-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb153-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb153-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb153-2"></a></span>
<span id="cb153-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb153-3"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb153-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb153-4"></a><span class="op">{</span></span>
<span id="cb153-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb153-5"></a>    <span class="dt">FILE</span> <span class="op">*</span>fp<span class="op">;</span></span>
<span id="cb153-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb153-6"></a>    <span class="dt">unsigned</span> <span class="dt">char</span> bytes<span class="op">[</span><span class="dv">6</span><span class="op">]</span> <span class="op">=</span> <span class="op">{</span><span class="dv">5</span><span class="op">,</span> <span class="dv">37</span><span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">88</span><span class="op">,</span> <span class="dv">255</span><span class="op">,</span> <span class="dv">12</span><span class="op">};</span></span>
<span id="cb153-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb153-7"></a></span>
<span id="cb153-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb153-8"></a>    fp <span class="op">=</span> fopen<span class="op">(</span><span class="st">"output.bin"</span><span class="op">,</span> <span class="st">"wb"</span><span class="op">);</span>  <span class="co">// wb mode for "write binary"!</span></span>
<span id="cb153-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb153-9"></a></span>
<span id="cb153-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb153-10"></a>    <span class="co">// In the call to fwrite, the arguments are:</span></span>
<span id="cb153-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb153-11"></a>    <span class="co">//</span></span>
<span id="cb153-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb153-12"></a>    <span class="co">// * Pointer to data to write</span></span>
<span id="cb153-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb153-13"></a>    <span class="co">// * Size of each "piece" of data</span></span>
<span id="cb153-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb153-14"></a>    <span class="co">// * Count of each "piece" of data</span></span>
<span id="cb153-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb153-15"></a>    <span class="co">// * FILE*</span></span>
<span id="cb153-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb153-16"></a></span>
<span id="cb153-17"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb153-17"></a>    fwrite<span class="op">(</span>bytes<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">char</span><span class="op">),</span> <span class="dv">6</span><span class="op">,</span> fp<span class="op">);</span></span>
<span id="cb153-18"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb153-18"></a></span>
<span id="cb153-19"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb153-19"></a>    fclose<span class="op">(</span>fp<span class="op">);</span></span>
<span id="cb153-20"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb153-20"></a><span class="op">}</span></span></code></pre></div>
<p></p>
<p>Those two middle arguments to <code>fwrite()</code> are pretty odd. But basically what we want to tell the function is, “We have items that are <em>this</em> big, and we want to write <em>that</em> many of them.” This makes it convenient if you have a record of a fixed length, and you have a bunch of them in an array. You can just tell it the size of one record and how many to write.</p>
<p>In the example above, we tell it each record is the size of a <code>char</code>, and we have 6 of them.</p>
<p>Running the program gives us a file <code>output.bin</code>, but opening it in a text editor doesn’t show anything friendly! It’s binary data—not text. And random binary data I just made up, at that!</p>
<p>If I run it through a <a href="https://en.wikipedia.org/wiki/Hex_dump">hex dump</a><a href="https://beej.us/guide/bgc/html/index-wide.html#fn77" class="footnote-ref" id="fnref77" role="doc-noteref"><sup>77</sup></a> program, we can see the output as bytes:</p>
<div class="sourceCode" id="cb154"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb154-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb154-1" aria-hidden="true" tabindex="-1"></a>05 25 00 58 ff 0c</span></code></pre></div>
<p>And those values in hex do match up to the values (in decimal) that we wrote out.</p>
<p>But now let’s try to read them back in with a different program. This one will open the file for binary reading (<code>"rb"</code> mode) and will read the bytes one at a time in a loop.</p>
<p> <code>fread()</code> has the neat feature where it returns the number of bytes read, or <code>0</code> on EOF. So we can loop until we see that, printing numbers as we go.</p>
<div class="sourceCode" id="cb155"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb155-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb155-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb155-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb155-2"></a></span>
<span id="cb155-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb155-3"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb155-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb155-4"></a><span class="op">{</span></span>
<span id="cb155-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb155-5"></a>    <span class="dt">FILE</span> <span class="op">*</span>fp<span class="op">;</span></span>
<span id="cb155-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb155-6"></a>    <span class="dt">unsigned</span> <span class="dt">char</span> c<span class="op">;</span></span>
<span id="cb155-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb155-7"></a></span>
<span id="cb155-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb155-8"></a>    fp <span class="op">=</span> fopen<span class="op">(</span><span class="st">"output.bin"</span><span class="op">,</span> <span class="st">"rb"</span><span class="op">);</span> <span class="co">// rb for "read binary"!</span></span>
<span id="cb155-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb155-9"></a></span>
<span id="cb155-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb155-10"></a>    <span class="cf">while</span> <span class="op">(</span>fread<span class="op">(&amp;</span>c<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">char</span><span class="op">),</span> <span class="dv">1</span><span class="op">,</span> fp<span class="op">)</span> <span class="op">&gt;</span> <span class="dv">0</span><span class="op">)</span></span>
<span id="cb155-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb155-11"></a>        printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> c<span class="op">);</span></span>
<span id="cb155-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb155-12"></a><span class="op">}</span></span></code></pre></div>
<p></p>
<p>And, running it, we see our original numbers!</p>
<div class="sourceCode" id="cb156"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb156-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb156-1" aria-hidden="true" tabindex="-1"></a>5</span>
<span id="cb156-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb156-2" aria-hidden="true" tabindex="-1"></a>37</span>
<span id="cb156-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb156-3" aria-hidden="true" tabindex="-1"></a>0</span>
<span id="cb156-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb156-4" aria-hidden="true" tabindex="-1"></a>88</span>
<span id="cb156-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb156-5" aria-hidden="true" tabindex="-1"></a>255</span>
<span id="cb156-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb156-6" aria-hidden="true" tabindex="-1"></a>12</span></code></pre></div>
<p>Woo hoo! </p>
<h3 data-number="9.6.1" id="struct-and-number-caveats"><span class="header-section-number">9.6.1</span> <code>struct</code> and Number Caveats</h3>
<p> As we saw in the <code>struct</code>s section, the compiler is free to add padding to a <code>struct</code> as it sees fit. And different compilers might do this differently. And the same compiler on different architectures could do it differently. And the same compiler on the same architectures could do it differently.</p>
<p>What I’m getting at is this: it’s not portable to just <code>fwrite()</code> an entire <code>struct</code> out to a file when you don’t know where the padding will end up. </p>
<p>How do we fix this? Hold that thought—we’ll look at some ways to do this after looking at another related problem.</p>
<p> Numbers!</p>
<p>Turns out all architectures don’t represent numbers in memory the same way.</p>
<p>Let’s look at a simple <code>fwrite()</code> of a 2-byte number. We’ll write it in hex so each byte is clear. The most significant byte will have the value <code>0x12</code> and the least significant will have the value <code>0x34</code>.</p>
<div class="sourceCode" id="cb157"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb157-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb157-1" aria-hidden="true" tabindex="-1"></a><span class="dt">unsigned</span> <span class="dt">short</span> v <span class="op">=</span> <span class="bn">0x1234</span><span class="op">;</span>  <span class="co">// Two bytes, 0x12 and 0x34</span></span>
<span id="cb157-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb157-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb157-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb157-3" aria-hidden="true" tabindex="-1"></a>fwrite<span class="op">(&amp;</span>v<span class="op">,</span> <span class="kw">sizeof</span> v<span class="op">,</span> <span class="dv">1</span><span class="op">,</span> fp<span class="op">);</span></span></code></pre></div>
<p>What ends up in the stream?</p>
<p>Well, it seems like it should be <code>0x12</code> followed by <code>0x34</code>, right?</p>
<p>But if I run this on my machine and hex dump the result, I get:</p>
<div class="sourceCode" id="cb158"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb158-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb158-1" aria-hidden="true" tabindex="-1"></a>34 12</span></code></pre></div>
<p>They’re reversed! What gives?</p>
<p>This has something to do with what’s called the <a href="https://en.wikipedia.org/wiki/Endianess"><em>endianess</em></a><a href="https://beej.us/guide/bgc/html/index-wide.html#fn78" class="footnote-ref" id="fnref78" role="doc-noteref"><sup>78</sup></a> of the architecture. Some write the most significant bytes first, and some the least significant bytes first.</p>
<p>This means that if you write a multibyte number out straight from memory, you can’t do it in a portable way<a href="https://beej.us/guide/bgc/html/index-wide.html#fn79" class="footnote-ref" id="fnref79" role="doc-noteref"><sup>79</sup></a>.</p>
<p>A similar problem exists with floating point. Most systems use the same format for their floating point numbers, but some do not. No guarantees!</p>
<p> So… how can we fix all these problems with numbers and <code>struct</code>s to get our data written in a portable way?</p>
<p>The summary is to <em>serialize</em> the data, which is a general term that means to take all the data and write it out in a format that you control, that is well-known, and programmable to work the same way on all platforms.</p>
<p>As you might imagine, this is a solved problem. There are a bunch of serialization libraries you can take advantage of, such as Google’s <a href="https://en.wikipedia.org/wiki/Protocol_buffers"><em>protocol buffers</em></a><a href="https://beej.us/guide/bgc/html/index-wide.html#fn80" class="footnote-ref" id="fnref80" role="doc-noteref"><sup>80</sup></a>, out there and ready to use. They will take care of all the gritty details for you, and even will allow data from your C programs to interoperate with other languages that support the same serialization methods.</p>
<p>Do yourself and everyone a favor! Serialize your binary data when you write it to a stream! This will keep things nice and portable, even if you transfer data files from one architecture to another. </p>
<!-- Beej's guide to C

# vim: ts=4:sw=4:nosi:et:tw=72
-->
<h1 data-number="10" id="typedef-making-new-types"><span class="header-section-number">10</span> <code>typedef</code>: Making New Types</h1>
<p> Well, not so much making <em>new</em> types as getting new names for existing types. Sounds kinda pointless on the surface, but we can really use this to make our code cleaner.</p>
<h2 data-number="10.1" id="typedef-in-theory"><span class="header-section-number">10.1</span> <code>typedef</code> in Theory</h2>
<p>Basically, you take an existing type and you make an alias for it with <code>typedef</code>.</p>
<p>Like this:</p>
<div class="sourceCode" id="cb159"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb159-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb159-1" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="dt">int</span> antelope<span class="op">;</span>  <span class="co">// Make "antelope" an alias for "int"</span></span>
<span id="cb159-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb159-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb159-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb159-3" aria-hidden="true" tabindex="-1"></a>antelope x <span class="op">=</span> <span class="dv">10</span><span class="op">;</span>       <span class="co">// Type "antelope" is the same as type "int"</span></span></code></pre></div>
<p>You can take any existing type and do it. You can even make a number of types with a comma list:</p>
<div class="sourceCode" id="cb160"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb160-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb160-1" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="dt">int</span> antelope<span class="op">,</span> bagel<span class="op">,</span> mushroom<span class="op">;</span>  <span class="co">// These are all "int"</span></span></code></pre></div>
<p>That’s really useful, right? That you can type <code>mushroom</code> instead of <code>int</code>? You must be <em>super excited</em> about this feature!</p>
<p>OK, Professor Sarcasm—we’ll get to some more common applications of this in a moment.</p>
<h3 data-number="10.1.1" id="scoping"><span class="header-section-number">10.1.1</span> Scoping</h3>
<p> <code>typedef</code> follows regular <a href="https://beej.us/guide/bgc/html/index-wide.html#scope">scoping rules</a>.</p>
<p>For this reason, it’s quite common to find <code>typedef</code> at file scope (“global”) so that all functions can use the new types at will.</p>
<h2 data-number="10.2" id="typedef-in-practice"><span class="header-section-number">10.2</span> <code>typedef</code> in Practice</h2>
<p>So renaming <code>int</code> to something else isn’t that exciting. Let’s see where <code>typedef</code> commonly makes an appearance.</p>
<h3 data-number="10.2.1" id="typedef-struct"><span class="header-section-number">10.2.1</span> <code>typedef</code> and <code>struct</code>s</h3>
<p> Sometimes a <code>struct</code> will be <code>typedef</code>’d to a new name so you don’t have to type the word <code>struct</code> over and over.</p>
<div class="sourceCode" id="cb161"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb161-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb161-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> animal <span class="op">{</span></span>
<span id="cb161-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb161-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> <span class="op">*</span>name<span class="op">;</span></span>
<span id="cb161-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb161-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> leg_count<span class="op">,</span> speed<span class="op">;</span></span>
<span id="cb161-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb161-4" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb161-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb161-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb161-6" aria-hidden="true" tabindex="-1"></a><span class="co">//  original name      new name</span></span>
<span id="cb161-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb161-7" aria-hidden="true" tabindex="-1"></a><span class="co">//            |         |</span></span>
<span id="cb161-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb161-8" aria-hidden="true" tabindex="-1"></a><span class="co">//            v         v</span></span>
<span id="cb161-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb161-9" aria-hidden="true" tabindex="-1"></a><span class="co">//      |-----------| |----|</span></span>
<span id="cb161-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb161-10" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> animal animal<span class="op">;</span></span>
<span id="cb161-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb161-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb161-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb161-12" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> animal y<span class="op">;</span>  <span class="co">// This works</span></span>
<span id="cb161-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb161-13" aria-hidden="true" tabindex="-1"></a>animal z<span class="op">;</span>         <span class="co">// This also works because "animal" is an alias</span></span></code></pre></div>
<p>Personally, I don’t care for this practice. I like the clarity the code has when you add the word <code>struct</code> to the type; programmers know what they’re getting. But it’s really common so I’m including it here.</p>
<p>Now I want to run the exact same example in a way that you might commonly see. We’re going to put the <code>struct animal</code> <em>in</em> the <code>typedef</code>. You can mash it all together like this:</p>
<div class="sourceCode" id="cb162"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb162-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb162-1" aria-hidden="true" tabindex="-1"></a><span class="co">//  original name</span></span>
<span id="cb162-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb162-2" aria-hidden="true" tabindex="-1"></a><span class="co">//            |</span></span>
<span id="cb162-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb162-3" aria-hidden="true" tabindex="-1"></a><span class="co">//            v</span></span>
<span id="cb162-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb162-4" aria-hidden="true" tabindex="-1"></a><span class="co">//      |-----------|</span></span>
<span id="cb162-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb162-5" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> animal <span class="op">{</span></span>
<span id="cb162-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb162-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> <span class="op">*</span>name<span class="op">;</span></span>
<span id="cb162-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb162-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> leg_count<span class="op">,</span> speed<span class="op">;</span></span>
<span id="cb162-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb162-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> animal<span class="op">;</span>                         <span class="co">// &lt;-- new name</span></span>
<span id="cb162-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb162-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb162-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb162-10" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> animal y<span class="op">;</span>  <span class="co">// This works</span></span>
<span id="cb162-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb162-11" aria-hidden="true" tabindex="-1"></a>animal z<span class="op">;</span>         <span class="co">// This also works because "animal" is an alias</span></span></code></pre></div>
<p>That’s exactly the same as the previous example, just more concise.</p>
<p> But that’s not all! There’s another common shortcut that you might see in code using what are called <em>anonymous structures</em><a href="https://beej.us/guide/bgc/html/index-wide.html#fn81" class="footnote-ref" id="fnref81" role="doc-noteref"><sup>81</sup></a>. It turns out you don’t actually need to name the structure in a variety of places, and with <code>typedef</code> is one of them.</p>
<p>Let’s do the same example with an anonymous structure:</p>
<div class="sourceCode" id="cb163"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb163-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb163-1" aria-hidden="true" tabindex="-1"></a><span class="co">//  Anonymous struct! It has no name!</span></span>
<span id="cb163-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb163-2" aria-hidden="true" tabindex="-1"></a><span class="co">//         |</span></span>
<span id="cb163-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb163-3" aria-hidden="true" tabindex="-1"></a><span class="co">//         v</span></span>
<span id="cb163-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb163-4" aria-hidden="true" tabindex="-1"></a><span class="co">//      |----|</span></span>
<span id="cb163-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb163-5" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb163-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb163-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> <span class="op">*</span>name<span class="op">;</span></span>
<span id="cb163-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb163-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> leg_count<span class="op">,</span> speed<span class="op">;</span></span>
<span id="cb163-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb163-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> animal<span class="op">;</span>                         <span class="co">// &lt;-- new name</span></span>
<span id="cb163-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb163-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb163-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb163-10" aria-hidden="true" tabindex="-1"></a><span class="co">//struct animal y;  // ERROR: this no longer works--no such struct!</span></span>
<span id="cb163-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb163-11" aria-hidden="true" tabindex="-1"></a>animal z<span class="op">;</span>           <span class="co">// This works because "animal" is an alias</span></span></code></pre></div>
<p>As another example, we might find something like this:</p>
<div class="sourceCode" id="cb164"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb164-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb164-1" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb164-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb164-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> x<span class="op">,</span> y<span class="op">;</span></span>
<span id="cb164-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb164-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> point<span class="op">;</span></span>
<span id="cb164-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb164-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb164-5" aria-hidden="true" tabindex="-1"></a>point p <span class="op">=</span> <span class="op">{.</span>x<span class="op">=</span><span class="dv">20</span><span class="op">,</span> <span class="op">.</span>y<span class="op">=</span><span class="dv">40</span><span class="op">};</span></span>
<span id="cb164-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb164-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb164-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb164-7" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">%d</span><span class="st">, </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> p<span class="op">.</span>x<span class="op">,</span> p<span class="op">.</span>y<span class="op">);</span>  <span class="co">// 20, 40</span></span></code></pre></div>
<p> </p>
<h3 data-number="10.2.2" id="typedef-and-other-types"><span class="header-section-number">10.2.2</span> <code>typedef</code> and Other Types</h3>
<p>It’s not that using <code>typedef</code> with a simple type like <code>int</code> is completely useless… it helps you abstract the types to make it easier to change them later.</p>
<p>For example, if you have <code>float</code> all over your code in 100 zillion places, it’s going to be painful to change them all to <code>double</code> if you find you have to do that later for some reason.</p>
<p>But if you prepared a little with:</p>
<div class="sourceCode" id="cb165"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb165-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb165-1" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="dt">float</span> app_float<span class="op">;</span></span>
<span id="cb165-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb165-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb165-3" aria-hidden="true" tabindex="-1"></a><span class="co">// and</span></span>
<span id="cb165-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb165-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb165-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb165-5" aria-hidden="true" tabindex="-1"></a>app_float f1<span class="op">,</span> f2<span class="op">,</span> f3<span class="op">;</span></span></code></pre></div>
<p>Then if later you want to change to another type, like <code>long double</code>, you just need to change the <code>typedef</code>:</p>
<div class="sourceCode" id="cb166"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb166-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb166-1" aria-hidden="true" tabindex="-1"></a><span class="co">//        voila!</span></span>
<span id="cb166-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb166-2" aria-hidden="true" tabindex="-1"></a><span class="co">//      |---------|</span></span>
<span id="cb166-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb166-3" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="dt">long</span> <span class="dt">double</span> app_float<span class="op">;</span></span>
<span id="cb166-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb166-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb166-5" aria-hidden="true" tabindex="-1"></a><span class="co">// and no need to change this line:</span></span>
<span id="cb166-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb166-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb166-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb166-7" aria-hidden="true" tabindex="-1"></a>app_float f1<span class="op">,</span> f2<span class="op">,</span> f3<span class="op">;</span>  <span class="co">// Now these are all long doubles</span></span></code></pre></div>
<h3 data-number="10.2.3" id="typedef-and-pointers"><span class="header-section-number">10.2.3</span> <code>typedef</code> and Pointers</h3>
<p> You can make a type that is a pointer.</p>
<div class="sourceCode" id="cb167"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb167-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb167-1" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="dt">int</span> <span class="op">*</span>intptr<span class="op">;</span></span>
<span id="cb167-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb167-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb167-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb167-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> a <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb167-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb167-4" aria-hidden="true" tabindex="-1"></a>intptr x <span class="op">=</span> <span class="op">&amp;</span>a<span class="op">;</span>  <span class="co">// "intptr" is type "int*"</span></span></code></pre></div>
<p>I really don’t like this practice. It hides the fact that <code>x</code> is a pointer type because you don’t see a <code>*</code> in the declaration.</p>
<p>IMHO, it’s better to explicitly show that you’re declaring a pointer type so that other devs can clearly see it and don’t mistake <code>x</code> for having a non-pointer type.</p>
<p>But at last count, say, 832,007 people had a different opinion. </p>
<h3 data-number="10.2.4" id="typedef-and-capitalization"><span class="header-section-number">10.2.4</span> <code>typedef</code> and Capitalization</h3>
<p>I’ve seen all kinds of capitalization on <code>typedef</code>.</p>
<div class="sourceCode" id="cb168"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb168-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb168-1" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb168-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb168-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> x<span class="op">,</span> y<span class="op">;</span></span>
<span id="cb168-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb168-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> my_point<span class="op">;</span>          <span class="co">// lower snake case</span></span>
<span id="cb168-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb168-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb168-5" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb168-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb168-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> x<span class="op">,</span> y<span class="op">;</span></span>
<span id="cb168-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb168-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> MyPoint<span class="op">;</span>          <span class="co">// CamelCase</span></span>
<span id="cb168-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb168-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb168-9" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb168-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb168-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> x<span class="op">,</span> y<span class="op">;</span></span>
<span id="cb168-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb168-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> Mypoint<span class="op">;</span>          <span class="co">// Leading uppercase</span></span>
<span id="cb168-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb168-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb168-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb168-13" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb168-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb168-14" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> x<span class="op">,</span> y<span class="op">;</span></span>
<span id="cb168-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb168-15" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> MY_POINT<span class="op">;</span>          <span class="co">// UPPER SNAKE CASE</span></span></code></pre></div>
<p>The C11 specification doesn’t dictate one way or another, and shows examples in all uppercase and all lowercase.</p>
<p>K&amp;R2 uses leading uppercase predominantly, but show some examples in uppercase and snake case (with <code>_t</code>).</p>
<p>If you have a style guide in use, stick with it. If you don’t, grab one and stick with it.</p>
<h2 data-number="10.3" id="arrays-and-typedef"><span class="header-section-number">10.3</span> Arrays and <code>typedef</code></h2>
<p> The syntax is a little weird, and this is rarely seen in my experience, but you can <code>typedef</code> an array of some number of items.</p>
<div class="sourceCode" id="cb169"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb169-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb169-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Make type five_ints an array of 5 ints</span></span>
<span id="cb169-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb169-2" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="dt">int</span> five_ints<span class="op">[</span><span class="dv">5</span><span class="op">];</span></span>
<span id="cb169-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb169-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb169-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb169-4" aria-hidden="true" tabindex="-1"></a>five_ints x <span class="op">=</span> <span class="op">{</span><span class="dv">11</span><span class="op">,</span> <span class="dv">22</span><span class="op">,</span> <span class="dv">33</span><span class="op">,</span> <span class="dv">44</span><span class="op">,</span> <span class="dv">55</span><span class="op">};</span></span></code></pre></div>
<p>I don’t like it because it hides the array nature of the variable, but it’s possible to do. </p>
<!-- Beej's guide to C

# vim: ts=4:sw=4:nosi:et:tw=72
-->
<h1 data-number="11" id="pointers2"><span class="header-section-number">11</span> Pointers II: Arithmetic</h1>
<p> Time to get more into it with a number of new pointer topics! If you’re not up to speed with pointers, <a href="https://beej.us/guide/bgc/html/index-wide.html#pointers">check out the first section in the guide on the matter</a>.</p>
<h2 data-number="11.1" id="pointer-arithmetic"><span class="header-section-number">11.1</span> Pointer Arithmetic</h2>
<p>Turns out you can do math on pointers, notably addition and subtraction.</p>
<p>But what does it mean when you do that?</p>
<p>In short, if you have a pointer to a type, adding one to the pointer moves to the next item of that type directly after it in memory.</p>
<p>It’s <strong>important</strong> to remember that as we move pointers around and look at different places in memory, we need to make sure that we’re always pointing to a valid place in memory before we dereference. If we’re off in the weeds and we try to see what’s there, the behavior is undefined and a crash is a common result.</p>
<p>This is a little chicken-and-eggy with <a href="https://beej.us/guide/bgc/html/index-wide.html#arraypointerequiv">Array/Pointer Equivalence, below</a>, but we’re going to give it a shot, anyway.</p>
<h3 data-number="11.1.1" id="adding-to-pointers"><span class="header-section-number">11.1.1</span> Adding to Pointers</h3>
<p>First, let’s take an array of numbers.</p>
<div class="sourceCode" id="cb170"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb170-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb170-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> a<span class="op">[</span><span class="dv">5</span><span class="op">]</span> <span class="op">=</span> <span class="op">{</span><span class="dv">11</span><span class="op">,</span> <span class="dv">22</span><span class="op">,</span> <span class="dv">33</span><span class="op">,</span> <span class="dv">44</span><span class="op">,</span> <span class="dv">55</span><span class="op">};</span></span></code></pre></div>
<p>Then let’s get a pointer to the first element in that array:</p>
<div class="sourceCode" id="cb171"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb171-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb171-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> a<span class="op">[</span><span class="dv">5</span><span class="op">]</span> <span class="op">=</span> <span class="op">{</span><span class="dv">11</span><span class="op">,</span> <span class="dv">22</span><span class="op">,</span> <span class="dv">33</span><span class="op">,</span> <span class="dv">44</span><span class="op">,</span> <span class="dv">55</span><span class="op">};</span></span>
<span id="cb171-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb171-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb171-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb171-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> <span class="op">*</span>p <span class="op">=</span> <span class="op">&amp;</span>a<span class="op">[</span><span class="dv">0</span><span class="op">];</span>  <span class="co">// Or "int *p = a;" works just as well</span></span></code></pre></div>
<p>Then let’s print the value there by dereferencing the pointer:</p>
<div class="sourceCode" id="cb172"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb172-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb172-1" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> <span class="op">*</span>p<span class="op">);</span>  <span class="co">// Prints 11</span></span></code></pre></div>
<p>Now let’s use pointer arithmetic to print the next element in the array, the one at index 1:</p>
<div class="sourceCode" id="cb173"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb173-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb173-1" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> <span class="op">*(</span>p <span class="op">+</span> <span class="dv">1</span><span class="op">));</span>  <span class="co">// Prints 22!!</span></span></code></pre></div>
<p>What happened there? C knows that <code>p</code> is a pointer to an <code>int</code>. So it knows the <code>sizeof</code> an <code>int</code><a href="https://beej.us/guide/bgc/html/index-wide.html#fn82" class="footnote-ref" id="fnref82" role="doc-noteref"><sup>82</sup></a> and it knows to skip that many bytes to get to the next <code>int</code> after the first one!</p>
<p>In fact, the prior example could be written these two equivalent ways:</p>
<div class="sourceCode" id="cb174"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb174-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb174-1" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> <span class="op">*</span>p<span class="op">);</span>        <span class="co">// Prints 11</span></span>
<span id="cb174-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb174-2" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> <span class="op">*(</span>p <span class="op">+</span> <span class="dv">0</span><span class="op">));</span>  <span class="co">// Prints 11</span></span></code></pre></div>
<p>because adding <code>0</code> to a pointer results in the same pointer.</p>
<p>Let’s think of the upshot here. We can iterate over elements of an array this way instead of using an array:</p>
<div class="sourceCode" id="cb175"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb175-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb175-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> a<span class="op">[</span><span class="dv">5</span><span class="op">]</span> <span class="op">=</span> <span class="op">{</span><span class="dv">11</span><span class="op">,</span> <span class="dv">22</span><span class="op">,</span> <span class="dv">33</span><span class="op">,</span> <span class="dv">44</span><span class="op">,</span> <span class="dv">55</span><span class="op">};</span></span>
<span id="cb175-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb175-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb175-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> <span class="op">*</span>p <span class="op">=</span> <span class="op">&amp;</span>a<span class="op">[</span><span class="dv">0</span><span class="op">];</span>  <span class="co">// Or "int *p = a;" works just as well</span></span>
<span id="cb175-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb175-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb175-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb175-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">5</span><span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb175-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb175-6" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> <span class="op">*(</span>p <span class="op">+</span> i<span class="op">));</span>  <span class="co">// Same as p[i]!</span></span>
<span id="cb175-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb175-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>And that works the same as if we used array notation! Oooo! Getting closer to that array/pointer equivalence thing! More on this later in this chapter.</p>
<p>But what’s actually happening, here? How does it work?</p>
<p>Remember from early on that memory is like a big array, where a byte is stored at each array index?</p>
<p>And the array index into memory has a few names:</p>
<ul>
<li>Index into memory</li>
<li>Location</li>
<li>Address</li>
<li><em>Pointer!</em></li>
</ul>
<p>So a point is an index into memory, somewhere.</p>
<p>For a random example, say that a number 3490 was stored at address (“index”) 23,237,489,202. If we have an <code>int</code> pointer to that 3490, that value of that pointer is 23,237,489,202… because the pointer is the memory address. Different words for the same thing.</p>
<p>And now let’s say we have another number, 4096, stored right after the 3490 at address 23,237,489,210 (8 higher than the 3490 because each <code>int</code> in this example is 8 bytes long).</p>
<p>If we add <code>1</code> to that pointer, it actually jumps ahead <code>sizeof(int)</code> bytes to the next <code>int</code>. It knows to jump that far ahead because it’s an <code>int</code> pointer. If it were a <code>float</code> pointer, it’d jump <code>sizeof(float)</code> bytes ahead to get to the next float!</p>
<p>So you can look at the next <code>int</code>, by adding <code>1</code> to the pointer, the one after that by adding <code>2</code> to the pointer, and so on.</p>
<h3 data-number="11.1.2" id="changing-pointers"><span class="header-section-number">11.1.2</span> Changing Pointers</h3>
<p>We saw how we could add an integer to a pointer in the previous section. This time, let’s <em>modify the pointer, itself</em>.</p>
<p>You can just add (or subtract) integer values directly to (or from) any pointer!</p>
<p>Let’s do that example again, except with a couple changes. First, I’m going to add a <code>999</code> to the end of our numbers to act as a sentinel value. This will let us know where the end of the data is.</p>
<div class="sourceCode" id="cb176"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb176-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb176-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> a<span class="op">[]</span> <span class="op">=</span> <span class="op">{</span><span class="dv">11</span><span class="op">,</span> <span class="dv">22</span><span class="op">,</span> <span class="dv">33</span><span class="op">,</span> <span class="dv">44</span><span class="op">,</span> <span class="dv">55</span><span class="op">,</span> <span class="dv">999</span><span class="op">};</span>  <span class="co">// Add 999 here as a sentinel</span></span>
<span id="cb176-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb176-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb176-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb176-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> <span class="op">*</span>p <span class="op">=</span> <span class="op">&amp;</span>a<span class="op">[</span><span class="dv">0</span><span class="op">];</span>  <span class="co">// p points to the 11</span></span></code></pre></div>
<p>And we also have <code>p</code> pointing to the element at index <code>0</code> of <code>a</code>, namely <code>11</code>, just like before.</p>
<p>Now—let’s start <em>incrementing</em> <code>p</code> so that it points at subsequent elements of the array. We’ll do this until <code>p</code> points to the <code>999</code>; that is, we’ll do it until <code>*p == 999</code>:</p>
<div class="sourceCode" id="cb177"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb177-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb177-1" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="op">(*</span>p <span class="op">!=</span> <span class="dv">999</span><span class="op">)</span> <span class="op">{</span>       <span class="co">// While the thing p points to isn't 999</span></span>
<span id="cb177-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb177-2" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> <span class="op">*</span>p<span class="op">);</span>   <span class="co">// Print it</span></span>
<span id="cb177-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb177-3" aria-hidden="true" tabindex="-1"></a>    p<span class="op">++;</span>                  <span class="co">// Move p to point to the next int!</span></span>
<span id="cb177-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb177-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Pretty crazy, right?</p>
<p>When we give it a run, first <code>p</code> points to <code>11</code>. Then we increment <code>p</code>, and it points to <code>22</code>, and then again, it points to <code>33</code>. And so on, until it points to <code>999</code> and we quit.</p>
<h3 data-number="11.1.3" id="subtracting-pointers"><span class="header-section-number">11.1.3</span> Subtracting Pointers</h3>
<p> You can subtract a value from a pointer to get to earlier address, as well, just like we were adding to them before.</p>
<p>But we can also subtract two pointers to find the difference between them, e.g.&nbsp;we can calculate how many <code>int</code>s there are between two <code>int*</code>s. The catch is that this only works within a single array<a href="https://beej.us/guide/bgc/html/index-wide.html#fn83" class="footnote-ref" id="fnref83" role="doc-noteref"><sup>83</sup></a>—if the pointers point to anything else, you get undefined behavior.</p>
<p>Remember how strings are <code>char*</code>s in C? Let’s see if we can use this to write another variant of <code>strlen()</code> to compute the length of a string that utilizes pointer subtraction.</p>
<p>The idea is that if we have a pointer to the beginning of the string, we can find a pointer to the end of the string by scanning ahead for the <code>NUL</code> character.</p>
<p>And if we have a pointer to the beginning of the string, and we computed the pointer to the end of the string, we can just subtract the two pointers to come up with the length!</p>
<div class="sourceCode" id="cb178"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb178-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb178-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb178-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb178-2"></a></span>
<span id="cb178-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb178-3"></a><span class="dt">int</span> my_strlen<span class="op">(</span><span class="dt">char</span> <span class="op">*</span>s<span class="op">)</span></span>
<span id="cb178-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb178-4"></a><span class="op">{</span></span>
<span id="cb178-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb178-5"></a>    <span class="co">// Start scanning from the beginning of the string</span></span>
<span id="cb178-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb178-6"></a>    <span class="dt">char</span> <span class="op">*</span>p <span class="op">=</span> s<span class="op">;</span></span>
<span id="cb178-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb178-7"></a></span>
<span id="cb178-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb178-8"></a>    <span class="co">// Scan until we find the NUL character</span></span>
<span id="cb178-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb178-9"></a>    <span class="cf">while</span> <span class="op">(*</span>p <span class="op">!=</span> <span class="ch">'</span><span class="sc">\0</span><span class="ch">'</span><span class="op">)</span></span>
<span id="cb178-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb178-10"></a>        p<span class="op">++;</span></span>
<span id="cb178-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb178-11"></a></span>
<span id="cb178-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb178-12"></a>    <span class="co">// Return the difference in pointers</span></span>
<span id="cb178-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb178-13"></a>    <span class="cf">return</span> p <span class="op">-</span> s<span class="op">;</span></span>
<span id="cb178-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb178-14"></a><span class="op">}</span></span>
<span id="cb178-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb178-15"></a></span>
<span id="cb178-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb178-16"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb178-17"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb178-17"></a><span class="op">{</span></span>
<span id="cb178-18"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb178-18"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> my_strlen<span class="op">(</span><span class="st">"Hello, world!"</span><span class="op">));</span>  <span class="co">// Prints "13"</span></span>
<span id="cb178-19"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb178-19"></a><span class="op">}</span></span></code></pre></div>
<p>Remember that you can only use pointer subtraction between two pointers that point to the same array! </p>
<h2 data-number="11.2" id="arraypointerequiv"><span class="header-section-number">11.2</span> Array/Pointer Equivalence</h2>
<p> We’re finally ready to talk about this! We’ve seen plenty of examples of places where we’ve intermixed array notation, but let’s give out the <em>fundamental formula of array/pointer equivalence</em>:</p>
<div class="sourceCode" id="cb179"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb179-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb179-1" aria-hidden="true" tabindex="-1"></a>a<span class="op">[</span>b<span class="op">]</span> <span class="op">==</span> <span class="op">*(</span>a <span class="op">+</span> b<span class="op">)</span></span></code></pre></div>
<p>Study that! Those are equivalent and can be used interchangeably!</p>
<p>I’ve oversimplified a bit, because in my above example <code>a</code> and <code>b</code> can both be expressions, and we might want a few more parentheses to force order of operations in case the expressions are complex.</p>
<p>The spec is specific, as always, declaring (in C11 §6.5.2.1¶2):</p>
<blockquote>
<p><code>E1[E2]</code> is identical to <code>(*((E1)+(E2)))</code></p>
</blockquote>
<p>but that’s a little harder to grok. Just make sure you include parentheses if the expressions are complicated so all your math happens in the right order.</p>
<p>This means we can <em>decide</em> if we’re going to use array or pointer notation for any array or pointer (assuming it points to an element of an array).</p>
<p>Let’s use an array and pointer with both array and pointer notation:</p>
<div class="sourceCode" id="cb180"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb180-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb180-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb180-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb180-2"></a></span>
<span id="cb180-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb180-3"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb180-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb180-4"></a><span class="op">{</span></span>
<span id="cb180-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb180-5"></a>    <span class="dt">int</span> a<span class="op">[]</span> <span class="op">=</span> <span class="op">{</span><span class="dv">11</span><span class="op">,</span> <span class="dv">22</span><span class="op">,</span> <span class="dv">33</span><span class="op">,</span> <span class="dv">44</span><span class="op">,</span> <span class="dv">55</span><span class="op">};</span></span>
<span id="cb180-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb180-6"></a></span>
<span id="cb180-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb180-7"></a>    <span class="dt">int</span> <span class="op">*</span>p <span class="op">=</span> a<span class="op">;</span>  <span class="co">// p points to the first element of a, 11</span></span>
<span id="cb180-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb180-8"></a></span>
<span id="cb180-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb180-9"></a>    <span class="co">// Print all elements of the array a variety of ways:</span></span>
<span id="cb180-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb180-10"></a></span>
<span id="cb180-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb180-11"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">5</span><span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb180-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb180-12"></a>        printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> a<span class="op">[</span>i<span class="op">]);</span>      <span class="co">// Array notation with a</span></span>
<span id="cb180-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb180-13"></a></span>
<span id="cb180-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb180-14"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">5</span><span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb180-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb180-15"></a>        printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> p<span class="op">[</span>i<span class="op">]);</span>      <span class="co">// Array notation with p</span></span>
<span id="cb180-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb180-16"></a></span>
<span id="cb180-17"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb180-17"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">5</span><span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb180-18"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb180-18"></a>        printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> <span class="op">*(</span>a <span class="op">+</span> i<span class="op">));</span>  <span class="co">// Pointer notation with a</span></span>
<span id="cb180-19"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb180-19"></a></span>
<span id="cb180-20"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb180-20"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">5</span><span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb180-21"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb180-21"></a>        printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> <span class="op">*(</span>p <span class="op">+</span> i<span class="op">));</span>  <span class="co">// Pointer notation with p</span></span>
<span id="cb180-22"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb180-22"></a></span>
<span id="cb180-23"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb180-23"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">5</span><span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb180-24"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb180-24"></a>        printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> <span class="op">*(</span>p<span class="op">++));</span>    <span class="co">// Moving pointer p</span></span>
<span id="cb180-25"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb180-25"></a>        <span class="co">//printf("%d\n", *(a++));    // Moving array variable a--ERROR!</span></span>
<span id="cb180-26"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb180-26"></a><span class="op">}</span></span></code></pre></div>
<p>So you can see that in general, if you have an array variable, you can use pointer or array notion to access elements. Same with a pointer variable.</p>
<p>The one big difference is that you can <em>modify</em> a pointer to point to a different address, but you can’t do that with an array variable. <!--
6.3.2.1p2 --></p>
<h3 data-number="11.2.1" id="arraypointer-equivalence-in-function-calls"><span class="header-section-number">11.2.1</span> Array/Pointer Equivalence in Function Calls</h3>
<p>This is where you’ll encounter this concept the most, for sure.</p>
<p>If you have a function that takes a pointer argument, e.g.:</p>
<div class="sourceCode" id="cb181"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb181-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb181-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> my_strlen<span class="op">(</span><span class="dt">char</span> <span class="op">*</span>s<span class="op">)</span></span></code></pre></div>
<p>this means you can pass either an array or a pointer to this function and have it work!</p>
<div class="sourceCode" id="cb182"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb182-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb182-1" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span> s<span class="op">[]</span> <span class="op">=</span> <span class="st">"Antelopes"</span><span class="op">;</span></span>
<span id="cb182-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb182-2" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span> <span class="op">*</span>t <span class="op">=</span> <span class="st">"Wombats"</span><span class="op">;</span></span>
<span id="cb182-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb182-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb182-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb182-4" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> my_strlen<span class="op">(</span>s<span class="op">));</span>  <span class="co">// Works!</span></span>
<span id="cb182-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb182-5" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> my_strlen<span class="op">(</span>t<span class="op">));</span>  <span class="co">// Works, too!</span></span></code></pre></div>
<p>And it’s also why these two function signatures are equivalent:</p>
<div class="sourceCode" id="cb183"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb183-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb183-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> my_strlen<span class="op">(</span><span class="dt">char</span> <span class="op">*</span>s<span class="op">)</span>    <span class="co">// Works!</span></span>
<span id="cb183-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb183-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> my_strlen<span class="op">(</span><span class="dt">char</span> s<span class="op">[])</span>   <span class="co">// Works, too!</span></span></code></pre></div>
<p></p>
<h2 data-number="11.3" id="void-pointers"><span class="header-section-number">11.3</span> <code>void</code> Pointers</h2>
<p> You’ve already seen the <code>void</code> keyword used with functions, but this is an entirely separate, unrelated animal.</p>
<p>Sometimes it’s useful to have a pointer to a thing <em>that you don’t know the type of</em>.</p>
<p>I know. Bear with me just a second.</p>
<p>There are basically two use cases for this.</p>
<p> 1. A function is going to operate on something byte-by-byte. For example, <code>memcpy()</code> copies bytes of memory from one pointer to another, but those pointers can point to any type. <code>memcpy()</code> takes advantage of the fact that if you iterate through <code>char*</code>s, you’re iterating through the bytes of an object no matter what type the object is. More on this in the <a href="https://beej.us/guide/bgc/html/index-wide.html#multibyte-values">Multibyte Values</a> subsection.</p>
<ol start="2" type="1">
<li>Another function is calling a function you passed to it (a callback), and it’s passing you data. You know the type of the data, but the function calling you doesn’t. So it passes you <code>void*</code>s—’cause it doesn’t know the type—and you convert those to the type you need. The built-in <a href="https://beej.us/guide/bgclr/html/split/stdlib.html#man-qsort"><code>qsort()</code></a><a href="https://beej.us/guide/bgc/html/index-wide.html#fn84" class="footnote-ref" id="fnref84" role="doc-noteref"><sup>84</sup></a> and <a href="https://beej.us/guide/bgclr/html/split/stdlib.html#man-bsearch"><code>bsearch()</code></a><a href="https://beej.us/guide/bgc/html/index-wide.html#fn85" class="footnote-ref" id="fnref85" role="doc-noteref"><sup>85</sup></a> use this technique.</li>
</ol>
<p>Let’s look at an example, the built-in <code>memcpy()</code> function:</p>
<div class="sourceCode" id="cb184"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb184-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb184-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="op">*</span>memcpy<span class="op">(</span><span class="dt">void</span> <span class="op">*</span>s1<span class="op">,</span> <span class="dt">void</span> <span class="op">*</span>s2<span class="op">,</span> <span class="dt">size_t</span> n<span class="op">);</span></span></code></pre></div>
<p>This function copies <code>n</code> bytes of memory starting from address <code>s1</code> into the memory starting at address <code>s2</code>.</p>
<p>But look! <code>s1</code> and <code>s2</code> are <code>void*</code>s! Why? What does it mean? Let’s run more examples to see.</p>
<p>For instance, we could copy a string with <code>memcpy()</code> (though <code>strcpy()</code> is more appropriate for strings):</p>
<div class="sourceCode" id="cb185"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb185-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb185-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb185-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb185-2"></a><span class="pp">#include </span><span class="im">&lt;string.h&gt;</span></span>
<span id="cb185-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb185-3"></a></span>
<span id="cb185-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb185-4"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb185-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb185-5"></a><span class="op">{</span></span>
<span id="cb185-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb185-6"></a>    <span class="dt">char</span> s<span class="op">[]</span> <span class="op">=</span> <span class="st">"Goats!"</span><span class="op">;</span></span>
<span id="cb185-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb185-7"></a>    <span class="dt">char</span> t<span class="op">[</span><span class="dv">100</span><span class="op">];</span></span>
<span id="cb185-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb185-8"></a></span>
<span id="cb185-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb185-9"></a>    memcpy<span class="op">(</span>t<span class="op">,</span> s<span class="op">,</span> <span class="dv">7</span><span class="op">);</span>  <span class="co">// Copy 7 bytes--including the NUL terminator!</span></span>
<span id="cb185-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb185-10"></a></span>
<span id="cb185-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb185-11"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> t<span class="op">);</span>  <span class="co">// "Goats!"</span></span>
<span id="cb185-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb185-12"></a><span class="op">}</span></span></code></pre></div>
<p>Or we can copy some <code>int</code>s:</p>
<div class="sourceCode" id="cb186"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb186-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb186-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb186-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb186-2"></a><span class="pp">#include </span><span class="im">&lt;string.h&gt;</span></span>
<span id="cb186-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb186-3"></a></span>
<span id="cb186-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb186-4"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb186-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb186-5"></a><span class="op">{</span></span>
<span id="cb186-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb186-6"></a>    <span class="dt">int</span> a<span class="op">[]</span> <span class="op">=</span> <span class="op">{</span><span class="dv">11</span><span class="op">,</span> <span class="dv">22</span><span class="op">,</span> <span class="dv">33</span><span class="op">};</span></span>
<span id="cb186-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb186-7"></a>    <span class="dt">int</span> b<span class="op">[</span><span class="dv">3</span><span class="op">];</span></span>
<span id="cb186-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb186-8"></a></span>
<span id="cb186-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb186-9"></a>    memcpy<span class="op">(</span>b<span class="op">,</span> a<span class="op">,</span> <span class="dv">3</span> <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">int</span><span class="op">));</span>  <span class="co">// Copy 3 ints of data</span></span>
<span id="cb186-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb186-10"></a></span>
<span id="cb186-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb186-11"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> b<span class="op">[</span><span class="dv">1</span><span class="op">]);</span>  <span class="co">// 22</span></span>
<span id="cb186-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb186-12"></a><span class="op">}</span></span></code></pre></div>
<p>That one’s a little wild—you see what we did there with <code>memcpy()</code>? We copied the data from <code>a</code> to <code>b</code>, but we had to specify how many <em>bytes</em> to copy, and an <code>int</code> is more than one byte.</p>
<p>OK, then—how many bytes does an <code>int</code> take? Answer: depends on the system. But we can tell how many bytes any type takes with the <code>sizeof</code> operator.</p>
<p>So there’s the answer: an <code>int</code> takes <code>sizeof(int)</code> bytes of memory to store.</p>
<p>And if we have 3 of them in our array, like we did in that example, the entire space used for the 3 <code>int</code>s must be <code>3 * sizeof(int)</code>.</p>
<p>(In the string example, earlier, it would have been more technically accurate to copy <code>7 * sizeof(char)</code> bytes. But <code>char</code>s are always one byte large, by definition, so that just devolves into <code>7 * 1</code>.)</p>
<p>We could even copy a <code>float</code> or a <code>struct</code> with <code>memcpy()</code>! (Though this is abusive—we should just use <code>=</code> for that):</p>
<div class="sourceCode" id="cb187"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb187-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb187-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> antelope my_antelope<span class="op">;</span></span>
<span id="cb187-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb187-2" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> antelopy my_clone_antelope<span class="op">;</span></span>
<span id="cb187-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb187-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb187-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb187-4" aria-hidden="true" tabindex="-1"></a><span class="co">// ...</span></span>
<span id="cb187-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb187-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb187-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb187-6" aria-hidden="true" tabindex="-1"></a>memcpy<span class="op">(&amp;</span>my_clone_antelope<span class="op">,</span> <span class="op">&amp;</span>my_antelope<span class="op">,</span> <span class="kw">sizeof</span> my_antelope<span class="op">);</span></span></code></pre></div>
<p>Look at how versatile <code>memcpy()</code> is! If you have a pointer to a source and a pointer to a destination, and you have the number of bytes you want to copy, you can copy <em>any type of data</em>.</p>
<p>Imagine if we didn’t have <code>void*</code>. We’d have to write specialized <code>memcpy()</code> functions for each type: </p>
<div class="sourceCode" id="cb188"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb188-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb188-1" aria-hidden="true" tabindex="-1"></a>memcpy_int<span class="op">(</span><span class="dt">int</span> <span class="op">*</span>a<span class="op">,</span> <span class="dt">int</span> <span class="op">*</span>b<span class="op">,</span> <span class="dt">int</span> count<span class="op">);</span></span>
<span id="cb188-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb188-2" aria-hidden="true" tabindex="-1"></a>memcpy_float<span class="op">(</span><span class="dt">float</span> <span class="op">*</span>a<span class="op">,</span> <span class="dt">float</span> <span class="op">*</span>b<span class="op">,</span> <span class="dt">int</span> count<span class="op">);</span></span>
<span id="cb188-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb188-3" aria-hidden="true" tabindex="-1"></a>memcpy_double<span class="op">(</span><span class="dt">double</span> <span class="op">*</span>a<span class="op">,</span> <span class="dt">double</span> <span class="op">*</span>b<span class="op">,</span> <span class="dt">int</span> count<span class="op">);</span></span>
<span id="cb188-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb188-4" aria-hidden="true" tabindex="-1"></a>memcpy_char<span class="op">(</span><span class="dt">char</span> <span class="op">*</span>a<span class="op">,</span> <span class="dt">char</span> <span class="op">*</span>b<span class="op">,</span> <span class="dt">int</span> count<span class="op">);</span></span>
<span id="cb188-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb188-5" aria-hidden="true" tabindex="-1"></a>memcpy_unsigned_char<span class="op">(</span><span class="dt">unsigned</span> <span class="dt">char</span> <span class="op">*</span>a<span class="op">,</span> <span class="dt">unsigned</span> <span class="dt">char</span> <span class="op">*</span>b<span class="op">,</span> <span class="dt">int</span> count<span class="op">);</span></span>
<span id="cb188-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb188-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb188-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb188-7" aria-hidden="true" tabindex="-1"></a><span class="co">// etc... blech!</span></span></code></pre></div>
<p>Much better to just use <code>void*</code> and have one function that can do it all.</p>
<p>That’s the power of <code>void*</code>. You can write functions that don’t care about the type and is still able to do things with it.</p>
<p>But with great power comes great responsibility. Maybe not <em>that</em> great in this case, but there are some limits.</p>
<p> 1. You cannot do pointer arithmetic on a <code>void*</code>. 2. You cannot dereference a <code>void*</code>. 3. You cannot use the arrow operator on a <code>void*</code>, since it’s also a dereference. 4. You cannot use array notation on a <code>void*</code>, since it’s also a dereference, as well<a href="https://beej.us/guide/bgc/html/index-wide.html#fn86" class="footnote-ref" id="fnref86" role="doc-noteref"><sup>86</sup></a>.</p>
<p>And if you think about it, these rules make sense. All those operations rely on knowing the <code>sizeof</code> the type of data pointed to, and with <code>void*</code>, we don’t know the size of the data being pointed to—it could be anything! </p>
<p>But wait—if you can’t dereference a <code>void*</code> what good can it ever do you?</p>
<p>Like with <code>memcpy()</code>, it helps you write generic functions that can handle multiple types of data. But the secret is that, deep down, <em>you convert the <code>void*</code> to another type before you use it</em>!</p>
<p>And conversion is easy: you can just assign into a variable of the desired type<a href="https://beej.us/guide/bgc/html/index-wide.html#fn87" class="footnote-ref" id="fnref87" role="doc-noteref"><sup>87</sup></a>.</p>
<div class="sourceCode" id="cb189"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb189-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb189-1" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span> a <span class="op">=</span> <span class="ch">'X'</span><span class="op">;</span>  <span class="co">// A single char</span></span>
<span id="cb189-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb189-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb189-3" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="op">*</span>p <span class="op">=</span> <span class="op">&amp;</span>a<span class="op">;</span>  <span class="co">// p points to the 'X'</span></span>
<span id="cb189-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb189-4" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span> <span class="op">*</span>q <span class="op">=</span> p<span class="op">;</span>   <span class="co">// q also points to the 'X'</span></span>
<span id="cb189-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb189-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb189-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb189-6" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">%c\n</span><span class="st">"</span><span class="op">,</span> <span class="op">*</span>p<span class="op">);</span>  <span class="co">// ERROR--cannot dereference void*!</span></span>
<span id="cb189-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb189-7" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">%c\n</span><span class="st">"</span><span class="op">,</span> <span class="op">*</span>q<span class="op">);</span>  <span class="co">// Prints "X"</span></span></code></pre></div>
<p> Let’s write our own <code>memcpy()</code> to try this out. We can copy bytes (<code>char</code>s), and we know the number of bytes because it’s passed in.</p>
<div class="sourceCode" id="cb190"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb190-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb190-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="op">*</span>my_memcpy<span class="op">(</span><span class="dt">void</span> <span class="op">*</span>dest<span class="op">,</span> <span class="dt">void</span> <span class="op">*</span>src<span class="op">,</span> <span class="dt">int</span> byte_count<span class="op">)</span></span>
<span id="cb190-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb190-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb190-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb190-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Convert void*s to char*s</span></span>
<span id="cb190-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb190-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> <span class="op">*</span>s <span class="op">=</span> src<span class="op">,</span> <span class="op">*</span>d <span class="op">=</span> dest<span class="op">;</span></span>
<span id="cb190-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb190-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb190-6" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Now that we have char*s, we can dereference and copy them</span></span>
<span id="cb190-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb190-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span>byte_count<span class="op">--)</span> <span class="op">{</span></span>
<span id="cb190-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb190-8" aria-hidden="true" tabindex="-1"></a>        <span class="op">*</span>d<span class="op">++</span> <span class="op">=</span> <span class="op">*</span>s<span class="op">++;</span></span>
<span id="cb190-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb190-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb190-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb190-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb190-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb190-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Most of these functions return the destination, just in case</span></span>
<span id="cb190-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb190-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">// that's useful to the caller.</span></span>
<span id="cb190-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb190-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> dest<span class="op">;</span></span>
<span id="cb190-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb190-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Right there at the beginning, we copy the <code>void*</code>s into <code>char*</code>s so that we can use them as <code>char*</code>s. It’s as easy as that.</p>
<p>Then some fun in a while loop, where we decrement <code>byte_count</code> until it becomes false (<code>0</code>). Remember that with post-decrement, the value of the expression is computed (for <code>while</code> to use) and <em>then</em> the variable is decremented.</p>
<p>And some fun in the copy, where we assign <code>*d = *s</code> to copy the byte, but we do it with post-increment so that both <code>d</code> and <code>s</code> move to the next byte after the assignment is made.</p>
<p>Lastly, most memory and string functions return a copy of a pointer to the destination string just in case the caller wants to use it.</p>
<p>Now that we’ve done that, I just want to quickly point out that we can use this technique to iterate over the bytes of <em>any</em> object in C, <code>float</code>s, <code>struct</code>s, or anything! </p>
<p> <span id="qsort-example">Let’s</span> run one more real-world example with the built-in <code>qsort()</code> routine that can sort <em>anything</em> thanks to the magic of <code>void*</code>s.</p>
<p>(In the following example, you can ignore the word <code>const</code>, which we haven’t covered yet.)</p>
<div class="sourceCode" id="cb191"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb191-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb191-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb191-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb191-2"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb191-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb191-3"></a></span>
<span id="cb191-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb191-4"></a><span class="co">// The type of structure we're going to sort</span></span>
<span id="cb191-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb191-5"></a><span class="kw">struct</span> animal <span class="op">{</span></span>
<span id="cb191-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb191-6"></a>    <span class="dt">char</span> <span class="op">*</span>name<span class="op">;</span></span>
<span id="cb191-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb191-7"></a>    <span class="dt">int</span> leg_count<span class="op">;</span></span>
<span id="cb191-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb191-8"></a><span class="op">};</span></span>
<span id="cb191-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb191-9"></a></span>
<span id="cb191-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb191-10"></a><span class="co">// This is a comparison function called by qsort() to help it determine</span></span>
<span id="cb191-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb191-11"></a><span class="co">// what exactly to sort by. We'll use it to sort an array of struct</span></span>
<span id="cb191-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb191-12"></a><span class="co">// animals by leg_count.</span></span>
<span id="cb191-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb191-13"></a><span class="dt">int</span> compar<span class="op">(</span><span class="dt">const</span> <span class="dt">void</span> <span class="op">*</span>elem1<span class="op">,</span> <span class="dt">const</span> <span class="dt">void</span> <span class="op">*</span>elem2<span class="op">)</span></span>
<span id="cb191-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb191-14"></a><span class="op">{</span></span>
<span id="cb191-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb191-15"></a>    <span class="co">// We know we're sorting struct animals, so let's make both</span></span>
<span id="cb191-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb191-16"></a>    <span class="co">// arguments pointers to struct animals</span></span>
<span id="cb191-17"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb191-17"></a>    <span class="dt">const</span> <span class="kw">struct</span> animal <span class="op">*</span>animal1 <span class="op">=</span> elem1<span class="op">;</span></span>
<span id="cb191-18"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb191-18"></a>    <span class="dt">const</span> <span class="kw">struct</span> animal <span class="op">*</span>animal2 <span class="op">=</span> elem2<span class="op">;</span></span>
<span id="cb191-19"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb191-19"></a></span>
<span id="cb191-20"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb191-20"></a>    <span class="co">// Return &lt;0 =0 or &gt;0 depending on whatever we want to sort by.</span></span>
<span id="cb191-21"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb191-21"></a></span>
<span id="cb191-22"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb191-22"></a>    <span class="co">// Let's sort ascending by leg_count, so we'll return the difference</span></span>
<span id="cb191-23"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb191-23"></a>    <span class="co">// in the leg_counts</span></span>
<span id="cb191-24"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb191-24"></a>    <span class="cf">if</span> <span class="op">(</span>animal1<span class="op">-&gt;</span>leg_count <span class="op">&gt;</span> animal2<span class="op">-&gt;</span>leg_count<span class="op">)</span></span>
<span id="cb191-25"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb191-25"></a>        <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb191-26"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb191-26"></a>    </span>
<span id="cb191-27"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb191-27"></a>    <span class="cf">if</span> <span class="op">(</span>animal1<span class="op">-&gt;</span>leg_count <span class="op">&lt;</span> animal2<span class="op">-&gt;</span>leg_count<span class="op">)</span></span>
<span id="cb191-28"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb191-28"></a>        <span class="cf">return</span> <span class="op">-</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb191-29"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb191-29"></a></span>
<span id="cb191-30"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb191-30"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb191-31"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb191-31"></a><span class="op">}</span></span>
<span id="cb191-32"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb191-32"></a></span>
<span id="cb191-33"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb191-33"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb191-34"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb191-34"></a><span class="op">{</span></span>
<span id="cb191-35"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb191-35"></a>    <span class="co">// Let's build an array of 4 struct animals with different</span></span>
<span id="cb191-36"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb191-36"></a>    <span class="co">// characteristics. This array is out of order by leg_count, but</span></span>
<span id="cb191-37"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb191-37"></a>    <span class="co">// we'll sort it in a second.</span></span>
<span id="cb191-38"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb191-38"></a>    <span class="kw">struct</span> animal a<span class="op">[</span><span class="dv">4</span><span class="op">]</span> <span class="op">=</span> <span class="op">{</span></span>
<span id="cb191-39"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb191-39"></a>        <span class="op">{.</span>name<span class="op">=</span><span class="st">"Dog"</span><span class="op">,</span> <span class="op">.</span>leg_count<span class="op">=</span><span class="dv">4</span><span class="op">},</span></span>
<span id="cb191-40"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb191-40"></a>        <span class="op">{.</span>name<span class="op">=</span><span class="st">"Monkey"</span><span class="op">,</span> <span class="op">.</span>leg_count<span class="op">=</span><span class="dv">2</span><span class="op">},</span></span>
<span id="cb191-41"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb191-41"></a>        <span class="op">{.</span>name<span class="op">=</span><span class="st">"Antelope"</span><span class="op">,</span> <span class="op">.</span>leg_count<span class="op">=</span><span class="dv">4</span><span class="op">},</span></span>
<span id="cb191-42"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb191-42"></a>        <span class="op">{.</span>name<span class="op">=</span><span class="st">"Snake"</span><span class="op">,</span> <span class="op">.</span>leg_count<span class="op">=</span><span class="dv">0</span><span class="op">}</span></span>
<span id="cb191-43"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb191-43"></a>    <span class="op">};</span></span>
<span id="cb191-44"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb191-44"></a></span>
<span id="cb191-45"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb191-45"></a>    <span class="co">// Call qsort() to sort the array. qsort() needs to be told exactly</span></span>
<span id="cb191-46"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb191-46"></a>    <span class="co">// what to sort this data by, and we'll do that inside the compar()</span></span>
<span id="cb191-47"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb191-47"></a>    <span class="co">// function.</span></span>
<span id="cb191-48"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb191-48"></a>    <span class="co">//</span></span>
<span id="cb191-49"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb191-49"></a>    <span class="co">// This call is saying: qsort array a, which has 4 elements, and</span></span>
<span id="cb191-50"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb191-50"></a>    <span class="co">// each element is sizeof(struct animal) bytes big, and this is the</span></span>
<span id="cb191-51"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb191-51"></a>    <span class="co">// function that will compare any two elements.</span></span>
<span id="cb191-52"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb191-52"></a>    qsort<span class="op">(</span>a<span class="op">,</span> <span class="dv">4</span><span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span><span class="kw">struct</span> animal<span class="op">),</span> compar<span class="op">);</span></span>
<span id="cb191-53"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb191-53"></a></span>
<span id="cb191-54"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb191-54"></a>    <span class="co">// Print them all out</span></span>
<span id="cb191-55"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb191-55"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">4</span><span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb191-56"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb191-56"></a>        printf<span class="op">(</span><span class="st">"</span><span class="sc">%d</span><span class="st">: </span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> a<span class="op">[</span>i<span class="op">].</span>leg_count<span class="op">,</span> a<span class="op">[</span>i<span class="op">].</span>name<span class="op">);</span></span>
<span id="cb191-57"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb191-57"></a>    <span class="op">}</span></span>
<span id="cb191-58"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb191-58"></a><span class="op">}</span></span></code></pre></div>
<p>As long as you give <code>qsort()</code> a function that can compare two items that you have in your array to be sorted, it can sort anything. And it does this without needing to have the types of the items hardcoded in there anywhere. <code>qsort()</code> just rearranges blocks of bytes based on the results of the <code>compar()</code> function you passed in. </p>
<!-- Beej's guide to C

# vim: ts=4:sw=4:nosi:et:tw=72
-->
<h1 data-number="12" id="manual-memory-allocation"><span class="header-section-number">12</span> Manual Memory Allocation</h1>
<p> This is one of the big areas where C likely diverges from languages you already know: <em>manual memory management</em>.</p>
<p>Other languages uses reference counting, garbage collection, or other means to determine when to allocate new memory for some data—and when to deallocate it when no variables refer to it.</p>
<p>And that’s nice. It’s nice to be able to not worry about it, to just drop all the references to an item and trust that at some point the memory associated with it will be freed.</p>
<p>But C’s not like that, entirely.</p>
<p> Of course, in C, some variables are automatically allocated and deallocated when they come into scope and leave scope. We call these automatic variables. They’re your average run-of-the-mill block scope “local” variables. No problem. </p>
<p>But what if you want something to persist longer than a particular block? This is where manual memory management comes into play.</p>
<p>You can tell C explicitly to allocate for you a certain number of bytes that you can use as you please. And these bytes will remain allocated until you explicitly free that memory<a href="https://beej.us/guide/bgc/html/index-wide.html#fn88" class="footnote-ref" id="fnref88" role="doc-noteref"><sup>88</sup></a>.</p>
<p>It’s important to free the memory you’re done with! If you don’t, we call that a <em>memory leak</em> and your process will continue to reserve that memory until it exits.</p>
<p><em>If you manually allocated it, you have to manually free it when you’re done with it.</em></p>
<p>So how do we do this? We’re going to learn a couple new functions, and make use of the <code>sizeof</code> operator to help us learn how many bytes to allocate.</p>
<p> In common C parlance, devs say that automatic local variables are allocated “on the stack”, and manually-allocated memory is “on the heap”. The spec doesn’t talk about either of those things, but all C devs will know what you’re talking about if you bring them up. </p>
<p>All functions we’re going to learn in this chapter can be found in <code>&lt;stdlib.h&gt;</code>.</p>
<h2 data-number="12.1" id="allocating-and-deallocating-malloc-and-free"><span class="header-section-number">12.1</span> Allocating and Deallocating, <code>malloc()</code> and <code>free()</code></h2>
<p> The <code>malloc()</code> function accepts a number of bytes to allocate, and returns a void pointer to that block of newly-allocated memory.</p>
<p>Since it’s a <code>void*</code>, you can assign it into whatever pointer type you want… normally this will correspond in some way to the number of bytes you’re allocating.</p>
<p> So… how many bytes should I allocate? We can use <code>sizeof</code> to help with that. If we want to allocate enough room for a single <code>int</code>, we can use <code>sizeof(int)</code> and pass that to <code>malloc()</code>. </p>
<p> After we’re done with some allocated memory, we can call <code>free()</code> to indicate we’re done with that memory and it can be used for something else. As an argument, you pass the same pointer you got from <code>malloc()</code> (or a copy of it). It’s undefined behavior to use a memory region after you <code>free()</code> it.</p>
<p>Let’s try. We’ll allocate enough memory for an <code>int</code>, and then store something there, and the print it.</p>
<div class="sourceCode" id="cb192"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb192-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb192-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Allocate space for a single int (sizeof(int) bytes-worth):</span></span>
<span id="cb192-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb192-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb192-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb192-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> <span class="op">*</span>p <span class="op">=</span> malloc<span class="op">(</span><span class="kw">sizeof</span><span class="op">(</span><span class="dt">int</span><span class="op">));</span></span>
<span id="cb192-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb192-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb192-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb192-5" aria-hidden="true" tabindex="-1"></a><span class="op">*</span>p <span class="op">=</span> <span class="dv">12</span><span class="op">;</span>  <span class="co">// Store something there</span></span>
<span id="cb192-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb192-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb192-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb192-7" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> <span class="op">*</span>p<span class="op">);</span>  <span class="co">// Print it: 12</span></span>
<span id="cb192-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb192-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb192-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb192-9" aria-hidden="true" tabindex="-1"></a>free<span class="op">(</span>p<span class="op">);</span>  <span class="co">// All done with that memory</span></span>
<span id="cb192-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb192-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb192-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb192-11" aria-hidden="true" tabindex="-1"></a><span class="co">//*p = 3490;  // ERROR: undefined behavior! Use after free()!</span></span></code></pre></div>
<p></p>
<p>Now, in that contrived example, there’s really no benefit to it. We could have just used an automatic <code>int</code> and it would have worked. But we’ll see how the ability to allocate memory this way has its advantages, especially with more complex data structures.</p>
<p> One more thing you’ll commonly see takes advantage of the fact that <code>sizeof</code> can give you the size of the result type of any constant expression. So you could put a variable name in there, too, and use that. Here’s an example of that, just like the previous one:</p>
<div class="sourceCode" id="cb193"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb193-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb193-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> <span class="op">*</span>p <span class="op">=</span> malloc<span class="op">(</span><span class="kw">sizeof</span> <span class="op">*</span>p<span class="op">);</span>  <span class="co">// *p is an int, so same as sizeof(int)</span></span></code></pre></div>
<p> </p>
<h2 data-number="12.2" id="error-checking"><span class="header-section-number">12.2</span> Error Checking</h2>
<p> All the allocation functions return a pointer to the newly-allocated stretch of memory, or <code>NULL</code> if the memory cannot be allocated for some reason.</p>
<p>Some OSes like Linux can be configured in such a way that <code>malloc()</code> never returns <code>NULL</code>, even if you’re out of memory. But despite this, you should always code it up with protections in mind.</p>
<div class="sourceCode" id="cb194"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb194-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb194-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> <span class="op">*</span>x<span class="op">;</span></span>
<span id="cb194-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb194-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb194-3" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> malloc<span class="op">(</span><span class="kw">sizeof</span><span class="op">(</span><span class="dt">int</span><span class="op">)</span> <span class="op">*</span> <span class="dv">10</span><span class="op">);</span></span>
<span id="cb194-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb194-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb194-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb194-5" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>x <span class="op">==</span> NULL<span class="op">)</span> <span class="op">{</span></span>
<span id="cb194-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb194-6" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Error allocating 10 ints</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb194-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb194-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">// do something here to handle it</span></span>
<span id="cb194-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb194-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Here’s a common pattern that you’ll see, where we do the assignment and the condition on the same line:</p>
<div class="sourceCode" id="cb195"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb195-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb195-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> <span class="op">*</span>x<span class="op">;</span></span>
<span id="cb195-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb195-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb195-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb195-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">((</span>x <span class="op">=</span> malloc<span class="op">(</span><span class="kw">sizeof</span><span class="op">(</span><span class="dt">int</span><span class="op">)</span> <span class="op">*</span> <span class="dv">10</span><span class="op">))</span> <span class="op">==</span> NULL<span class="op">)</span></span>
<span id="cb195-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb195-4" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Error allocating 10 ints</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb195-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb195-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">// do something here to handle it</span></span>
<span id="cb195-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb195-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p></p>
<h2 data-number="12.3" id="allocating-space-for-an-array"><span class="header-section-number">12.3</span> Allocating Space for an Array</h2>
<p> We’ve seen how to allocate space for a single thing; now what about for a bunch of them in an array?</p>
<p>In C, an array is a bunch of the same thing back-to-back in a contiguous stretch of memory.</p>
<p>We can allocate a contiguous stretch of memory—we’ve seen how to do that. If we wanted 3490 bytes of memory, we could just ask for it:</p>
<div class="sourceCode" id="cb196"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb196-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb196-1" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span> <span class="op">*</span>p <span class="op">=</span> malloc<span class="op">(</span><span class="dv">3490</span><span class="op">);</span>  <span class="co">// Voila</span></span></code></pre></div>
<p>And—indeed!—that’s an array of 3490 <code>char</code>s (AKA a string!) since each <code>char</code> is 1 byte. In other words, <code>sizeof(char)</code> is <code>1</code>.</p>
<p>Note: there’s no initialization done on the newly-allocated memory—it’s full of garbage. Clear it with <code>memset()</code> if you want to, or see <code>calloc()</code>, below.</p>
<p>But we can just multiply the size of the thing we want by the number of elements we want, and then access them using either pointer or array notation. Example!</p>
<p></p>
<div class="sourceCode" id="cb197"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb197-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb197-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb197-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb197-2"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb197-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb197-3"></a></span>
<span id="cb197-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb197-4"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb197-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb197-5"></a><span class="op">{</span></span>
<span id="cb197-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb197-6"></a>    <span class="co">// Allocate space for 10 ints</span></span>
<span id="cb197-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb197-7"></a>    <span class="dt">int</span> <span class="op">*</span>p <span class="op">=</span> malloc<span class="op">(</span><span class="kw">sizeof</span><span class="op">(</span><span class="dt">int</span><span class="op">)</span> <span class="op">*</span> <span class="dv">10</span><span class="op">);</span></span>
<span id="cb197-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb197-8"></a></span>
<span id="cb197-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb197-9"></a>    <span class="co">// Assign them values 0-45:</span></span>
<span id="cb197-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb197-10"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">10</span><span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb197-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb197-11"></a>        p<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> i <span class="op">*</span> <span class="dv">5</span><span class="op">;</span></span>
<span id="cb197-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb197-12"></a></span>
<span id="cb197-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb197-13"></a>    <span class="co">// Print all values 0, 5, 10, 15, ..., 40, 45</span></span>
<span id="cb197-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb197-14"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">10</span><span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb197-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb197-15"></a>        printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> p<span class="op">[</span>i<span class="op">]);</span></span>
<span id="cb197-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb197-16"></a></span>
<span id="cb197-17"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb197-17"></a>    <span class="co">// Free the space</span></span>
<span id="cb197-18"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb197-18"></a>    free<span class="op">(</span>p<span class="op">);</span></span>
<span id="cb197-19"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb197-19"></a><span class="op">}</span></span></code></pre></div>
<p>The key’s in that <code>malloc()</code> line. If we know each <code>int</code> takes <code>sizeof(int)</code> bytes to hold it, and we know we want 10 of them, we can just allocate exactly that many bytes with:</p>
<div class="sourceCode" id="cb198"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb198-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb198-1" aria-hidden="true" tabindex="-1"></a><span class="kw">sizeof</span><span class="op">(</span><span class="dt">int</span><span class="op">)</span> <span class="op">*</span> <span class="dv">10</span></span></code></pre></div>
<p>And this trick works for every type. Just pass it to <code>sizeof</code> and multiply by the size of the array. </p>
<h2 data-number="12.4" id="an-alternative-calloc"><span class="header-section-number">12.4</span> An Alternative: <code>calloc()</code></h2>
<p> This is another allocation function that works similarly to <code>malloc()</code>, with two key differences:</p>
<ul>
<li>Instead of a single argument, you pass the size of one element, and the number of elements you wish to allocate. It’s like it’s made for allocating arrays.</li>
<li>It clears the memory to zero.</li>
</ul>
<p>You still use <code>free()</code> to deallocate memory obtained through <code>calloc()</code>.</p>
<p>Here’s a comparison of <code>calloc()</code> and <code>malloc()</code>.</p>
<div class="sourceCode" id="cb199"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb199-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb199-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Allocate space for 10 ints with calloc(), initialized to 0:</span></span>
<span id="cb199-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb199-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> <span class="op">*</span>p <span class="op">=</span> calloc<span class="op">(</span><span class="dv">10</span><span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">int</span><span class="op">));</span></span>
<span id="cb199-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb199-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb199-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb199-4" aria-hidden="true" tabindex="-1"></a><span class="co">// Allocate space for 10 ints with malloc(), initialized to 0:</span></span>
<span id="cb199-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb199-5" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> <span class="op">*</span>q <span class="op">=</span> malloc<span class="op">(</span><span class="dv">10</span> <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">int</span><span class="op">));</span></span>
<span id="cb199-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb199-6" aria-hidden="true" tabindex="-1"></a>memset<span class="op">(</span>q<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="dv">10</span> <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">int</span><span class="op">));</span>   <span class="co">// set to 0</span></span></code></pre></div>
<p>Again, the result is the same for both except <code>malloc()</code> doesn’t zero the memory by default. </p>
<h2 data-number="12.5" id="changing-allocated-size-with-realloc"><span class="header-section-number">12.5</span> Changing Allocated Size with <code>realloc()</code></h2>
<p> If you’ve already allocated 10 <code>int</code>s, but later you decide you need 20, what can you do?</p>
<p>One option is to allocate some new space, and then <code>memcpy()</code> the memory over… but it turns out that sometimes you don’t need to move anything. And there’s one function that’s just smart enough to do the right thing in all the right circumstances: <code>realloc()</code>.</p>
<p>It takes a pointer to some previously-allocted memory (by <code>malloc()</code> or <code>calloc()</code>) and a new size for the memory region to be.</p>
<p>It then grows or shrinks that memory, and returns a pointer to it. Sometimes it might return the same pointer (if the data didn’t have to be copied elsewhere), or it might return a different one (if the data did have to be copied).</p>
<p>Be sure when you call <code>realloc()</code>, you specify the number of <em>bytes</em> to allocate, and not just the number of array elements! That is:</p>
<div class="sourceCode" id="cb200"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb200-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb200-1" aria-hidden="true" tabindex="-1"></a>num_floats <span class="op">*=</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb200-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb200-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb200-3" aria-hidden="true" tabindex="-1"></a>np <span class="op">=</span> realloc<span class="op">(</span>p<span class="op">,</span> num_floats<span class="op">);</span>  <span class="co">// WRONG: need bytes, not number of elements!</span></span>
<span id="cb200-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb200-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb200-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb200-5" aria-hidden="true" tabindex="-1"></a>np <span class="op">=</span> realloc<span class="op">(</span>p<span class="op">,</span> num_floats <span class="op">*</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">float</span><span class="op">));</span>  <span class="co">// Better!</span></span></code></pre></div>
<p>Let’s allocate an array of 20 <code>float</code>s, and then change our mind and make it an array of 40.</p>
<p>We’re going to assign the return value of <code>realloc()</code> into another pointer just to make sure it’s not <code>NULL</code>. If it’s not, then we can reassign it into our original pointer. (If we just assigned the return value directly into the original pointer, we’d lose that pointer if the function returned <code>NULL</code> and we’d have no way to get it back.)</p>
<div class="sourceCode" id="cb201"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb201-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb201-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb201-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb201-2"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb201-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb201-3"></a></span>
<span id="cb201-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb201-4"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb201-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb201-5"></a><span class="op">{</span></span>
<span id="cb201-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb201-6"></a>    <span class="co">// Allocate space for 20 floats</span></span>
<span id="cb201-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb201-7"></a>    <span class="dt">float</span> <span class="op">*</span>p <span class="op">=</span> malloc<span class="op">(</span><span class="kw">sizeof</span> <span class="op">*</span>p <span class="op">*</span> <span class="dv">20</span><span class="op">);</span>  <span class="co">// sizeof *p same as sizeof(float)</span></span>
<span id="cb201-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb201-8"></a></span>
<span id="cb201-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb201-9"></a>    <span class="co">// Assign them fractional values 0.0-1.0:</span></span>
<span id="cb201-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb201-10"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">20</span><span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb201-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb201-11"></a>        p<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> i <span class="op">/</span> <span class="fl">20.0</span><span class="op">;</span></span>
<span id="cb201-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb201-12"></a></span>
<span id="cb201-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb201-13"></a>    <span class="co">// But wait! Let's actually make this an array of 40 elements</span></span>
<span id="cb201-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb201-14"></a>    <span class="dt">float</span> <span class="op">*</span>new_p <span class="op">=</span> realloc<span class="op">(</span>p<span class="op">,</span> <span class="kw">sizeof</span> <span class="op">*</span>p <span class="op">*</span> <span class="dv">40</span><span class="op">);</span></span>
<span id="cb201-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb201-15"></a></span>
<span id="cb201-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb201-16"></a>    <span class="co">// Check to see if we successfully reallocated</span></span>
<span id="cb201-17"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb201-17"></a>    <span class="cf">if</span> <span class="op">(</span>new_p <span class="op">==</span> NULL<span class="op">)</span> <span class="op">{</span></span>
<span id="cb201-18"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb201-18"></a>        printf<span class="op">(</span><span class="st">"Error reallocing</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb201-19"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb201-19"></a>        <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb201-20"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb201-20"></a>    <span class="op">}</span></span>
<span id="cb201-21"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb201-21"></a></span>
<span id="cb201-22"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb201-22"></a>    <span class="co">// If we did, we can just reassign p</span></span>
<span id="cb201-23"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb201-23"></a>    p <span class="op">=</span> new_p<span class="op">;</span></span>
<span id="cb201-24"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb201-24"></a></span>
<span id="cb201-25"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb201-25"></a>    <span class="co">// And assign the new elements values in the range 1.0-2.0</span></span>
<span id="cb201-26"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb201-26"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">20</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">40</span><span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb201-27"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb201-27"></a>        p<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> <span class="fl">1.0</span> <span class="op">+</span> <span class="op">(</span>i <span class="op">-</span> <span class="dv">20</span><span class="op">)</span> <span class="op">/</span> <span class="fl">20.0</span><span class="op">;</span></span>
<span id="cb201-28"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb201-28"></a></span>
<span id="cb201-29"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb201-29"></a>    <span class="co">// Print all values 0.0-2.0 in the 40 elements:</span></span>
<span id="cb201-30"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb201-30"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">40</span><span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb201-31"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb201-31"></a>        printf<span class="op">(</span><span class="st">"</span><span class="sc">%f\n</span><span class="st">"</span><span class="op">,</span> p<span class="op">[</span>i<span class="op">]);</span></span>
<span id="cb201-32"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb201-32"></a></span>
<span id="cb201-33"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb201-33"></a>    <span class="co">// Free the space</span></span>
<span id="cb201-34"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb201-34"></a>    free<span class="op">(</span>p<span class="op">);</span></span>
<span id="cb201-35"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb201-35"></a><span class="op">}</span></span></code></pre></div>
<p>Notice in there how we took the return value from <code>realloc()</code> and reassigned it into the same pointer variable <code>p</code> that we passed in. That’s pretty common to do.</p>
<p>Also if line 7 is looking weird, with that <code>sizeof *p</code> in there, remember that <code>sizeof</code> works on the size of the type of the expression. And the type of <code>*p</code> is <code>float</code>, so that line is equivalent to <code>sizeof(float)</code>. </p>
<h3 data-number="12.5.1" id="reading-in-lines-of-arbitrary-length"><span class="header-section-number">12.5.1</span> Reading in Lines of Arbitrary Length</h3>
<p>I want to demonstrate two things with this full-blown example.</p>
<ol type="1">
<li>Use of <code>realloc()</code> to grow a buffer as we read in more data.</li>
<li>Use of <code>realloc()</code> to shrink the buffer down to the perfect size after we’ve completed the read.</li>
</ol>
<p>What we see here is a loop that calls <code>fgetc()</code> over and over to append to a buffer until we see that the last character is a newline.</p>
<p>Once it finds the newline, it shrinks the buffer to just the right size and returns it.</p>
<div class="sourceCode" id="cb202"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb202-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb202-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb202-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb202-2"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb202-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb202-3"></a></span>
<span id="cb202-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb202-4"></a><span class="co">// Read a line of arbitrary size from a file</span></span>
<span id="cb202-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb202-5"></a><span class="co">//</span></span>
<span id="cb202-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb202-6"></a><span class="co">// Returns a pointer to the line.</span></span>
<span id="cb202-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb202-7"></a><span class="co">// Returns NULL on EOF or error.</span></span>
<span id="cb202-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb202-8"></a><span class="co">//</span></span>
<span id="cb202-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb202-9"></a><span class="co">// It's up to the caller to free() this pointer when done with it.</span></span>
<span id="cb202-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb202-10"></a><span class="co">//</span></span>
<span id="cb202-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb202-11"></a><span class="co">// Note that this strips the newline from the result. If you need</span></span>
<span id="cb202-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb202-12"></a><span class="co">// it in there, probably best to switch this to a do-while.</span></span>
<span id="cb202-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb202-13"></a></span>
<span id="cb202-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb202-14"></a><span class="dt">char</span> <span class="op">*</span>readline<span class="op">(</span><span class="dt">FILE</span> <span class="op">*</span>fp<span class="op">)</span></span>
<span id="cb202-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb202-15"></a><span class="op">{</span></span>
<span id="cb202-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb202-16"></a>    <span class="dt">int</span> offset <span class="op">=</span> <span class="dv">0</span><span class="op">;</span>   <span class="co">// Index next char goes in the buffer</span></span>
<span id="cb202-17"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb202-17"></a>    <span class="dt">int</span> bufsize <span class="op">=</span> <span class="dv">4</span><span class="op">;</span>  <span class="co">// Preferably power of 2 initial size</span></span>
<span id="cb202-18"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb202-18"></a>    <span class="dt">char</span> <span class="op">*</span>buf<span class="op">;</span>        <span class="co">// The buffer</span></span>
<span id="cb202-19"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb202-19"></a>    <span class="dt">int</span> c<span class="op">;</span>            <span class="co">// The character we've read in</span></span>
<span id="cb202-20"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb202-20"></a></span>
<span id="cb202-21"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb202-21"></a>    buf <span class="op">=</span> malloc<span class="op">(</span>bufsize<span class="op">);</span>  <span class="co">// Allocate initial buffer</span></span>
<span id="cb202-22"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb202-22"></a></span>
<span id="cb202-23"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb202-23"></a>    <span class="cf">if</span> <span class="op">(</span>buf <span class="op">==</span> NULL<span class="op">)</span>   <span class="co">// Error check</span></span>
<span id="cb202-24"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb202-24"></a>        <span class="cf">return</span> NULL<span class="op">;</span></span>
<span id="cb202-25"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb202-25"></a></span>
<span id="cb202-26"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb202-26"></a>    <span class="co">// Main loop--read until newline or EOF</span></span>
<span id="cb202-27"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb202-27"></a>    <span class="cf">while</span> <span class="op">(</span>c <span class="op">=</span> fgetc<span class="op">(</span>fp<span class="op">),</span> c <span class="op">!=</span> <span class="ch">'</span><span class="sc">\n</span><span class="ch">'</span> <span class="op">&amp;&amp;</span> c <span class="op">!=</span> EOF<span class="op">)</span> <span class="op">{</span></span>
<span id="cb202-28"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb202-28"></a></span>
<span id="cb202-29"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb202-29"></a>        <span class="co">// Check if we're out of room in the buffer accounting</span></span>
<span id="cb202-30"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb202-30"></a>        <span class="co">// for the extra byte for the NUL terminator</span></span>
<span id="cb202-31"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb202-31"></a>        <span class="cf">if</span> <span class="op">(</span>offset <span class="op">==</span> bufsize <span class="op">-</span> <span class="dv">1</span><span class="op">)</span> <span class="op">{</span>  <span class="co">// -1 for the NUL terminator</span></span>
<span id="cb202-32"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb202-32"></a>            bufsize <span class="op">*=</span> <span class="dv">2</span><span class="op">;</span>  <span class="co">// 2x the space</span></span>
<span id="cb202-33"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb202-33"></a></span>
<span id="cb202-34"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb202-34"></a>            <span class="dt">char</span> <span class="op">*</span>new_buf <span class="op">=</span> realloc<span class="op">(</span>buf<span class="op">,</span> bufsize<span class="op">);</span></span>
<span id="cb202-35"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb202-35"></a></span>
<span id="cb202-36"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb202-36"></a>            <span class="cf">if</span> <span class="op">(</span>new_buf <span class="op">==</span> NULL<span class="op">)</span> <span class="op">{</span></span>
<span id="cb202-37"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb202-37"></a>                free<span class="op">(</span>buf<span class="op">);</span>   <span class="co">// On error, free and bail</span></span>
<span id="cb202-38"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb202-38"></a>                <span class="cf">return</span> NULL<span class="op">;</span></span>
<span id="cb202-39"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb202-39"></a>            <span class="op">}</span></span>
<span id="cb202-40"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb202-40"></a></span>
<span id="cb202-41"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb202-41"></a>            buf <span class="op">=</span> new_buf<span class="op">;</span>  <span class="co">// Successful realloc</span></span>
<span id="cb202-42"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb202-42"></a>        <span class="op">}</span></span>
<span id="cb202-43"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb202-43"></a></span>
<span id="cb202-44"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb202-44"></a>        buf<span class="op">[</span>offset<span class="op">++]</span> <span class="op">=</span> c<span class="op">;</span>  <span class="co">// Add the byte onto the buffer</span></span>
<span id="cb202-45"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb202-45"></a>    <span class="op">}</span></span>
<span id="cb202-46"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb202-46"></a></span>
<span id="cb202-47"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb202-47"></a>    <span class="co">// We hit newline or EOF...</span></span>
<span id="cb202-48"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb202-48"></a></span>
<span id="cb202-49"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb202-49"></a>    <span class="co">// If at EOF and we read no bytes, free the buffer and</span></span>
<span id="cb202-50"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb202-50"></a>    <span class="co">// return NULL to indicate we're at EOF:</span></span>
<span id="cb202-51"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb202-51"></a>    <span class="cf">if</span> <span class="op">(</span>c <span class="op">==</span> EOF <span class="op">&amp;&amp;</span> offset <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb202-52"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb202-52"></a>        free<span class="op">(</span>buf<span class="op">);</span></span>
<span id="cb202-53"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb202-53"></a>        <span class="cf">return</span> NULL<span class="op">;</span></span>
<span id="cb202-54"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb202-54"></a>    <span class="op">}</span></span>
<span id="cb202-55"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb202-55"></a></span>
<span id="cb202-56"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb202-56"></a>    <span class="co">// Shrink to fit</span></span>
<span id="cb202-57"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb202-57"></a>    <span class="cf">if</span> <span class="op">(</span>offset <span class="op">&lt;</span> bufsize <span class="op">-</span> <span class="dv">1</span><span class="op">)</span> <span class="op">{</span>  <span class="co">// If we're short of the end</span></span>
<span id="cb202-58"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb202-58"></a>        <span class="dt">char</span> <span class="op">*</span>new_buf <span class="op">=</span> realloc<span class="op">(</span>buf<span class="op">,</span> offset <span class="op">+</span> <span class="dv">1</span><span class="op">);</span> <span class="co">// +1 for NUL terminator</span></span>
<span id="cb202-59"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb202-59"></a></span>
<span id="cb202-60"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb202-60"></a>        <span class="co">// If successful, point buf to new_buf;</span></span>
<span id="cb202-61"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb202-61"></a>        <span class="co">// otherwise we'll just leave buf where it is</span></span>
<span id="cb202-62"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb202-62"></a>        <span class="cf">if</span> <span class="op">(</span>new_buf <span class="op">!=</span> NULL<span class="op">)</span></span>
<span id="cb202-63"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb202-63"></a>            buf <span class="op">=</span> new_buf<span class="op">;</span></span>
<span id="cb202-64"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb202-64"></a>    <span class="op">}</span></span>
<span id="cb202-65"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb202-65"></a></span>
<span id="cb202-66"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb202-66"></a>    <span class="co">// Add the NUL terminator</span></span>
<span id="cb202-67"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb202-67"></a>    buf<span class="op">[</span>offset<span class="op">]</span> <span class="op">=</span> <span class="ch">'</span><span class="sc">\0</span><span class="ch">'</span><span class="op">;</span></span>
<span id="cb202-68"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb202-68"></a></span>
<span id="cb202-69"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb202-69"></a>    <span class="cf">return</span> buf<span class="op">;</span></span>
<span id="cb202-70"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb202-70"></a><span class="op">}</span></span>
<span id="cb202-71"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb202-71"></a></span>
<span id="cb202-72"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb202-72"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb202-73"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb202-73"></a><span class="op">{</span></span>
<span id="cb202-74"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb202-74"></a>    <span class="dt">FILE</span> <span class="op">*</span>fp <span class="op">=</span> fopen<span class="op">(</span><span class="st">"foo.txt"</span><span class="op">,</span> <span class="st">"r"</span><span class="op">);</span></span>
<span id="cb202-75"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb202-75"></a></span>
<span id="cb202-76"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb202-76"></a>    <span class="dt">char</span> <span class="op">*</span>line<span class="op">;</span></span>
<span id="cb202-77"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb202-77"></a></span>
<span id="cb202-78"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb202-78"></a>    <span class="cf">while</span> <span class="op">((</span>line <span class="op">=</span> readline<span class="op">(</span>fp<span class="op">))</span> <span class="op">!=</span> NULL<span class="op">)</span> <span class="op">{</span></span>
<span id="cb202-79"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb202-79"></a>        printf<span class="op">(</span><span class="st">"</span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> line<span class="op">);</span></span>
<span id="cb202-80"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb202-80"></a>        free<span class="op">(</span>line<span class="op">);</span></span>
<span id="cb202-81"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb202-81"></a>    <span class="op">}</span></span>
<span id="cb202-82"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb202-82"></a></span>
<span id="cb202-83"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb202-83"></a>    fclose<span class="op">(</span>fp<span class="op">);</span></span>
<span id="cb202-84"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb202-84"></a><span class="op">}</span></span></code></pre></div>
<p>When growing memory like this, it’s common (though hardly a law) to double the space needed each step just to minimize the number of <code>realloc()</code>s that occur.</p>
<p>Finally you might note that <code>readline()</code> returns a pointer to a <code>malloc()</code>d buffer. As such, it’s up to the caller to explicitly <code>free()</code> that memory when it’s done with it.</p>
<h3 data-number="12.5.2" id="realloc-with-null"><span class="header-section-number">12.5.2</span> <code>realloc()</code> with <code>NULL</code></h3>
<p> Trivia time! These two lines are equivalent:</p>
<div class="sourceCode" id="cb203"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb203-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb203-1" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span> <span class="op">*</span>p <span class="op">=</span> malloc<span class="op">(</span><span class="dv">3490</span><span class="op">);</span></span>
<span id="cb203-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb203-2" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span> <span class="op">*</span>p <span class="op">=</span> realloc<span class="op">(</span>NULL<span class="op">,</span> <span class="dv">3490</span><span class="op">);</span></span></code></pre></div>
<p>That could be convenient if you have some kind of allocation loop and you don’t want to special-case the first <code>malloc()</code>.</p>
<div class="sourceCode" id="cb204"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb204-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb204-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> <span class="op">*</span>p <span class="op">=</span> NULL<span class="op">;</span></span>
<span id="cb204-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb204-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> length <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb204-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb204-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb204-4" aria-hidden="true" tabindex="-1"></a><span class="cf">while</span> <span class="op">(!</span>done<span class="op">)</span> <span class="op">{</span></span>
<span id="cb204-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb204-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Allocate 10 more ints:</span></span>
<span id="cb204-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb204-6" aria-hidden="true" tabindex="-1"></a>    length <span class="op">+=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb204-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb204-7" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> realloc<span class="op">(</span>p<span class="op">,</span> <span class="kw">sizeof</span> <span class="op">*</span>p <span class="op">*</span> length<span class="op">);</span></span>
<span id="cb204-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb204-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb204-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb204-9" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Do amazing things</span></span>
<span id="cb204-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb204-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ...</span></span>
<span id="cb204-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb204-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>In that example, we didn’t need an initial <code>malloc()</code> since <code>p</code> was <code>NULL</code> to start. </p>
<h2 data-number="12.6" id="aligned-allocations"><span class="header-section-number">12.6</span> Aligned Allocations</h2>
<p> You probably aren’t going to need to use this.</p>
<p>And I don’t want to get too far off in the weeds talking about it right now, but there’s this thing called <em>memory alignment</em>, which has to do with the memory address (pointer value) being a multiple of a certain number.</p>
<p>For example, a system might require that 16-bit values begin on memory addresses that are multiples of 2. Or that 64-bit values begin on memory addresses that are multiples of 2, 4, or 8, for example. It depends on the CPU.</p>
<p>Some systems require this kind of alignment for fast memory access, or some even for memory access at all.</p>
<p>Now, if you use <code>malloc()</code>, <code>calloc()</code>, or <code>realloc()</code>, C will give you a chunk of memory that’s well-aligned for any value at all, even <code>struct</code>s. Works in all cases.</p>
<p>But there might be times that you know that some data can be aligned at a smaller boundary, or must be aligned at a larger one for some reason. I imagine this is more common with embedded systems programming.</p>
<p> In those cases, you can specify an alignment with <code>aligned_alloc()</code>.</p>
<p>The alignment is an integer power of two greater than zero, so <code>2</code>, <code>4</code>, <code>8</code>, <code>16</code>, etc. and you give that to <code>aligned_alloc()</code> before the number of bytes you’re interested in.</p>
<p>The other restriction is that the number of bytes you allocate needs to be a multiple of the alignment. But this might be changing. See <a href="http://www.open-std.org/jtc1/sc22/wg14/www/docs/summary.htm#dr_460">C Defect Report 460</a><a href="https://beej.us/guide/bgc/html/index-wide.html#fn89" class="footnote-ref" id="fnref89" role="doc-noteref"><sup>89</sup></a></p>
<p>Let’s do an example, allocating on a 64-byte boundary:</p>
<div class="sourceCode" id="cb205"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb205-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb205-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb205-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb205-2"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb205-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb205-3"></a><span class="pp">#include </span><span class="im">&lt;string.h&gt;</span></span>
<span id="cb205-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb205-4"></a></span>
<span id="cb205-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb205-5"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb205-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb205-6"></a><span class="op">{</span></span>
<span id="cb205-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb205-7"></a>    <span class="co">// Allocate 256 bytes aligned on a 64-byte boundary</span></span>
<span id="cb205-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb205-8"></a>    <span class="dt">char</span> <span class="op">*</span>p <span class="op">=</span> aligned_alloc<span class="op">(</span><span class="dv">64</span><span class="op">,</span> <span class="dv">256</span><span class="op">);</span>  <span class="co">// 256 == 64 * 4</span></span>
<span id="cb205-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb205-9"></a></span>
<span id="cb205-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb205-10"></a>    <span class="co">// Copy a string in there and print it</span></span>
<span id="cb205-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb205-11"></a>    strcpy<span class="op">(</span>p<span class="op">,</span> <span class="st">"Hello, world!"</span><span class="op">);</span></span>
<span id="cb205-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb205-12"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> p<span class="op">);</span></span>
<span id="cb205-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb205-13"></a></span>
<span id="cb205-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb205-14"></a>    <span class="co">// Free the space</span></span>
<span id="cb205-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb205-15"></a>    free<span class="op">(</span>p<span class="op">);</span></span>
<span id="cb205-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb205-16"></a><span class="op">}</span></span></code></pre></div>
<p>I want to throw a note here about <code>realloc()</code> and <code>aligned_alloc()</code>. <code>realloc()</code> doesn’t have any alignment guarantees, so if you need to get some aligned reallocated space, you’ll have to do it the hard way with <code>memcpy()</code>. </p>
<p>Here’s a non-standard <code>aligned_realloc()</code> function, if you need it:</p>
<div class="sourceCode" id="cb206"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb206-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb206-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="op">*</span>aligned_realloc<span class="op">(</span><span class="dt">void</span> <span class="op">*</span>ptr<span class="op">,</span> <span class="dt">size_t</span> old_size<span class="op">,</span> <span class="dt">size_t</span> alignment<span class="op">,</span> <span class="dt">size_t</span> size<span class="op">)</span></span>
<span id="cb206-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb206-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb206-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb206-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> <span class="op">*</span>new_ptr <span class="op">=</span> aligned_alloc<span class="op">(</span>alignment<span class="op">,</span> size<span class="op">);</span></span>
<span id="cb206-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb206-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb206-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb206-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>new_ptr <span class="op">==</span> NULL<span class="op">)</span></span>
<span id="cb206-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb206-6" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> NULL<span class="op">;</span></span>
<span id="cb206-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb206-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb206-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb206-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">size_t</span> copy_size <span class="op">=</span> old_size <span class="op">&lt;</span> size<span class="op">?</span> old_size<span class="op">:</span> size<span class="op">;</span>  <span class="co">// get min</span></span>
<span id="cb206-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb206-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb206-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb206-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>ptr <span class="op">!=</span> NULL<span class="op">)</span></span>
<span id="cb206-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb206-11" aria-hidden="true" tabindex="-1"></a>        memcpy<span class="op">(</span>new_ptr<span class="op">,</span> ptr<span class="op">,</span> copy_size<span class="op">);</span></span>
<span id="cb206-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb206-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb206-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb206-13" aria-hidden="true" tabindex="-1"></a>    free<span class="op">(</span>ptr<span class="op">);</span></span>
<span id="cb206-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb206-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb206-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb206-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> new_ptr<span class="op">;</span></span>
<span id="cb206-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb206-16" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Note that it <em>always</em> copies data, taking time, while real <code>realloc()</code> will avoid that if it can. So this is hardly efficient. Avoid needing to reallocate custom-aligned data. </p>
<!-- Beej's guide to C

# vim: ts=4:sw=4:nosi:et:tw=72
-->
<h1 data-number="13" id="scope"><span class="header-section-number">13</span> Scope</h1>
<p> Scope is all about what variables are visible in what contexts.</p>
<h2 data-number="13.1" id="block-scope"><span class="header-section-number">13.1</span> Block Scope</h2>
<p> This is the scope of almost all the variables devs define. It includes what other languages might call “function scope”, i.e.&nbsp;variables that are declared inside functions.</p>
<p>The basic rule is that if you’ve declared a variable in a block delimited by squirrelly braces, the scope of that variable is that block.</p>
<p>If there’s a block inside a block, then variables declared in the <em>inner</em> block are local to that block, and cannot be seen in the outer scope.</p>
<p>Once a variable’s scope ends, that variable can no longer be referenced, and you can consider its value to be gone into the great <a href="https://en.wikipedia.org/wiki/Bit_bucket">bit bucket</a><a href="https://beej.us/guide/bgc/html/index-wide.html#fn90" class="footnote-ref" id="fnref90" role="doc-noteref"><sup>90</sup></a> in the sky.</p>
<p>An example with nested scope:</p>
<div class="sourceCode" id="cb207"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb207-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb207-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb207-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb207-2"></a></span>
<span id="cb207-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb207-3"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb207-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb207-4"></a><span class="op">{</span></span>
<span id="cb207-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb207-5"></a>    <span class="dt">int</span> a <span class="op">=</span> <span class="dv">12</span><span class="op">;</span>         <span class="co">// Local to outer block, but visible in inner block</span></span>
<span id="cb207-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb207-6"></a></span>
<span id="cb207-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb207-7"></a>    <span class="cf">if</span>  <span class="op">(</span>a <span class="op">==</span> <span class="dv">12</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb207-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb207-8"></a>        <span class="dt">int</span> b <span class="op">=</span> <span class="dv">99</span><span class="op">;</span>     <span class="co">// Local to inner block, not visible in outer block</span></span>
<span id="cb207-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb207-9"></a></span>
<span id="cb207-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb207-10"></a>        printf<span class="op">(</span><span class="st">"</span><span class="sc">%d</span><span class="st"> </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> a<span class="op">,</span> b<span class="op">);</span>  <span class="co">// OK: "12 99"</span></span>
<span id="cb207-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb207-11"></a>    <span class="op">}</span></span>
<span id="cb207-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb207-12"></a></span>
<span id="cb207-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb207-13"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> a<span class="op">);</span>  <span class="co">// OK, we're still in a's scope</span></span>
<span id="cb207-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb207-14"></a></span>
<span id="cb207-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb207-15"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> b<span class="op">);</span>  <span class="co">// ILLEGAL, out of b's scope</span></span>
<span id="cb207-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb207-16"></a><span class="op">}</span></span></code></pre></div>
<h3 data-number="13.1.1" id="where-to-define-variables"><span class="header-section-number">13.1.1</span> Where To Define Variables</h3>
<p>Another fun fact is that you can define variables anywhere in the block, within reason—they have the scope of that block, but cannot be used before they are defined.</p>
<div class="sourceCode" id="cb208"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb208-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb208-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb208-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb208-2"></a></span>
<span id="cb208-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb208-3"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb208-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb208-4"></a><span class="op">{</span></span>
<span id="cb208-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb208-5"></a>    <span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb208-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb208-6"></a></span>
<span id="cb208-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb208-7"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> i<span class="op">);</span>     <span class="co">// OK: "0"</span></span>
<span id="cb208-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb208-8"></a></span>
<span id="cb208-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb208-9"></a>    <span class="co">//printf("%d\n", j);   // ILLEGAL--can't use j before it's defined</span></span>
<span id="cb208-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb208-10"></a></span>
<span id="cb208-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb208-11"></a>    <span class="dt">int</span> j <span class="op">=</span> <span class="dv">5</span><span class="op">;</span></span>
<span id="cb208-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb208-12"></a></span>
<span id="cb208-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb208-13"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%d</span><span class="st"> </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> i<span class="op">,</span> j<span class="op">);</span>   <span class="co">// OK: "0 5"</span></span>
<span id="cb208-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb208-14"></a><span class="op">}</span></span></code></pre></div>
<p>Historically, C required all the variables be defined before any code in the block, but this is no longer the case in the C99 standard.</p>
<h3 data-number="13.1.2" id="variable-hiding"><span class="header-section-number">13.1.2</span> Variable Hiding</h3>
<p> If you have a variable named the same thing at an inner scope as one at an outer scope, the one at the inner scope takes precedence as long as you’re running in the inner scope. That is, it <em>hides</em> the one at outer scope for the duration of its lifetime.</p>
<div class="sourceCode" id="cb209"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb209-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb209-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb209-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb209-2"></a></span>
<span id="cb209-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb209-3"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb209-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb209-4"></a><span class="op">{</span></span>
<span id="cb209-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb209-5"></a>    <span class="dt">int</span> i <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb209-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb209-6"></a></span>
<span id="cb209-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb209-7"></a>    <span class="op">{</span></span>
<span id="cb209-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb209-8"></a>        <span class="dt">int</span> i <span class="op">=</span> <span class="dv">20</span><span class="op">;</span></span>
<span id="cb209-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb209-9"></a></span>
<span id="cb209-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb209-10"></a>        printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> i<span class="op">);</span>  <span class="co">// Inner scope i, 20 (outer i is hidden)</span></span>
<span id="cb209-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb209-11"></a>    <span class="op">}</span></span>
<span id="cb209-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb209-12"></a></span>
<span id="cb209-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb209-13"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> i<span class="op">);</span>  <span class="co">// Outer scope i, 10</span></span>
<span id="cb209-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb209-14"></a><span class="op">}</span></span></code></pre></div>
<p>You might have noticed in that example that I just threw a block in there at line 7, not so much as a <code>for</code> or <code>if</code> statement to kick it off! This is perfectly legal. Sometimes a dev will want to group a bunch of local variables together for a quick computation and will do this, but it’s rare to see. </p>
<h2 data-number="13.2" id="file-scope"><span class="header-section-number">13.2</span> File Scope</h2>
<p> If you define a variable outside of a block, that variable has <em>file scope</em>. It’s visible in all functions in the file that come after it, and shared between them. (An exception is if a block defines a variable of the same name, it would hide the one at file scope.)</p>
<p>This is closest to what you would consider to be “global” scope in another language.</p>
<p>For example:</p>
<div class="sourceCode" id="cb210"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb210-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb210-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb210-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb210-2"></a></span>
<span id="cb210-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb210-3"></a><span class="dt">int</span> shared <span class="op">=</span> <span class="dv">10</span><span class="op">;</span>    <span class="co">// File scope! Visible to the whole file after this!</span></span>
<span id="cb210-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb210-4"></a></span>
<span id="cb210-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb210-5"></a><span class="dt">void</span> func1<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb210-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb210-6"></a><span class="op">{</span></span>
<span id="cb210-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb210-7"></a>    shared <span class="op">+=</span> <span class="dv">100</span><span class="op">;</span>  <span class="co">// Now shared holds 110</span></span>
<span id="cb210-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb210-8"></a><span class="op">}</span></span>
<span id="cb210-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb210-9"></a></span>
<span id="cb210-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb210-10"></a><span class="dt">void</span> func2<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb210-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb210-11"></a><span class="op">{</span></span>
<span id="cb210-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb210-12"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> shared<span class="op">);</span>  <span class="co">// Prints "110"</span></span>
<span id="cb210-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb210-13"></a><span class="op">}</span></span>
<span id="cb210-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb210-14"></a></span>
<span id="cb210-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb210-15"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb210-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb210-16"></a><span class="op">{</span></span>
<span id="cb210-17"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb210-17"></a>    func1<span class="op">();</span></span>
<span id="cb210-18"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb210-18"></a>    func2<span class="op">();</span></span>
<span id="cb210-19"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb210-19"></a><span class="op">}</span></span></code></pre></div>
<p>Note that if <code>shared</code> were declared at the bottom of the file, it wouldn’t compile. It has to be declared <em>before</em> any functions use it.</p>
<p>There are ways to further modify items at file scope, namely with <a href="https://beej.us/guide/bgc/html/index-wide.html#static">static</a> and <a href="https://beej.us/guide/bgc/html/index-wide.html#extern">extern</a>, but we’ll talk more about those later. </p>
<h2 data-number="13.3" id="for-loop-scope"><span class="header-section-number">13.3</span> <code>for</code>-loop Scope</h2>
<p> I really don’t know what to call this, as C11 §6.8.5.3¶1 doesn’t give it a proper name. We’ve done it already a few times in this guide, as well. It’s when you declare a variable inside the first clause of a <code>for</code>-loop:</p>
<div class="sourceCode" id="cb211"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb211-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb211-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">10</span><span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb211-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb211-2" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> i<span class="op">);</span></span>
<span id="cb211-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb211-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb211-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb211-4" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> i<span class="op">);</span>  <span class="co">// ILLEGAL--i is only in scope for the for-loop</span></span></code></pre></div>
<p>In that example, <code>i</code>’s lifetime begins the moment it is defined, and continues for the duration of the loop.</p>
<p>If the loop body is enclosed in a block, the variables defined in the <code>for</code>-loop are visible from that inner scope.</p>
<p>Unless, of course, that inner scope hides them. This crazy example prints <code>999</code> five times:</p>
<div class="sourceCode" id="cb212"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb212-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb212-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb212-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb212-2"></a></span>
<span id="cb212-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb212-3"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb212-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb212-4"></a><span class="op">{</span></span>
<span id="cb212-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb212-5"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">5</span><span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb212-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb212-6"></a>        <span class="dt">int</span> i <span class="op">=</span> <span class="dv">999</span><span class="op">;</span>  <span class="co">// Hides the i in the for-loop scope</span></span>
<span id="cb212-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb212-7"></a>        printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> i<span class="op">);</span></span>
<span id="cb212-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb212-8"></a>    <span class="op">}</span></span>
<span id="cb212-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb212-9"></a><span class="op">}</span></span></code></pre></div>
<p></p>
<h2 data-number="13.4" id="a-note-on-function-scope"><span class="header-section-number">13.4</span> A Note on Function Scope</h2>
<p> The C spec does refer to <em>function scope</em>, but it’s used exclusively with <em>labels</em>, something we haven’t discussed yet. More on that another day. </p>
<!-- Beej's guide to C

# vim: ts=4:sw=4:nosi:et:tw=72
-->
<h1 data-number="14" id="types-ii-way-more-types"><span class="header-section-number">14</span> Types II: Way More Types!</h1>
<p>We’re used to <code>char</code>, <code>int</code>, and <code>float</code> types, but it’s now time to take that stuff to the next level and see what else we have out there in the types department!</p>
<h2 data-number="14.1" id="signed-and-unsigned-integers"><span class="header-section-number">14.1</span> Signed and Unsigned Integers</h2>
<p> So far we’ve used <code>int</code> as a <em>signed</em> type, that is, a value that can be either negative or positive. But C also has specific <em>unsigned</em> integer types that can only hold positive numbers.</p>
<p>These types are prefaced by the keyword <code>unsigned</code>.</p>
<div class="sourceCode" id="cb213"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb213-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb213-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> a<span class="op">;</span>           <span class="co">// signed</span></span>
<span id="cb213-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb213-2" aria-hidden="true" tabindex="-1"></a><span class="dt">signed</span> <span class="dt">int</span> a<span class="op">;</span>    <span class="co">// signed</span></span>
<span id="cb213-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb213-3" aria-hidden="true" tabindex="-1"></a><span class="dt">signed</span> a<span class="op">;</span>        <span class="co">// signed, "shorthand" for "int" or "signed int", rare</span></span>
<span id="cb213-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb213-4" aria-hidden="true" tabindex="-1"></a><span class="dt">unsigned</span> <span class="dt">int</span> b<span class="op">;</span>  <span class="co">// unsigned</span></span>
<span id="cb213-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb213-5" aria-hidden="true" tabindex="-1"></a><span class="dt">unsigned</span> c<span class="op">;</span>      <span class="co">// unsigned, shorthand for "unsigned int"</span></span></code></pre></div>
<p>Why? Why would you decide you only wanted to hold positive numbers?</p>
<p>Answer: you can get larger numbers in an unsigned variable than you can in a signed ones.</p>
<p>But why is that?</p>
<p>You can think of integers being represented by a certain number of <em>bits</em><a href="https://beej.us/guide/bgc/html/index-wide.html#fn91" class="footnote-ref" id="fnref91" role="doc-noteref"><sup>91</sup></a>. On my computer, an <code>int</code> is represented by 64 bits.</p>
<p>And each permutation of bits that are either <code>1</code> or <code>0</code> represents a number. We can decide how to divvy up these numbers.</p>
<p>With signed numbers, we use (roughly) half the permutations to represent negative numbers, and the other half to represent positive numbers.</p>
<p>With unsigned, we use <em>all</em> the permutations to represent positive numbers.</p>
<p>On my computer with 64-bit <code>int</code>s using <a href="https://en.wikipedia.org/wiki/Two%27s_complement">two’s complement</a><a href="https://beej.us/guide/bgc/html/index-wide.html#fn92" class="footnote-ref" id="fnref92" role="doc-noteref"><sup>92</sup></a> to represent unsigned numbers, I have the following limits on integer range:</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Type</th>
<th style="text-align: right;">Minimum</th>
<th style="text-align: right;">Maximum</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>int</code></td>
<td style="text-align: right;"><code>-9,223,372,036,854,775,808</code></td>
<td style="text-align: right;"><code>9,223,372,036,854,775,807</code></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>unsigned int</code></td>
<td style="text-align: right;"><code>0</code></td>
<td style="text-align: right;"><code>18,446,744,073,709,551,615</code></td>
</tr>
</tbody>
</table>
<p>Notice that the largest positive <code>unsigned int</code> is approximately twice as large as the largest positive <code>int</code>. So you can get some flexibility there. </p>
<h2 data-number="14.2" id="character-types"><span class="header-section-number">14.2</span> Character Types</h2>
<p> Remember <code>char</code>? The type we can use to hold a single character?</p>
<div class="sourceCode" id="cb214"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb214-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb214-1" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span> c <span class="op">=</span> <span class="ch">'B'</span><span class="op">;</span></span>
<span id="cb214-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb214-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb214-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb214-3" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">%c\n</span><span class="st">"</span><span class="op">,</span> c<span class="op">);</span>  <span class="co">// "B"</span></span></code></pre></div>
<p>I have a shocker for you: it’s actually an integer.</p>
<div class="sourceCode" id="cb215"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb215-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb215-1" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span> c <span class="op">=</span> <span class="ch">'B'</span><span class="op">;</span></span>
<span id="cb215-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb215-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb215-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb215-3" aria-hidden="true" tabindex="-1"></a><span class="co">// Change this from %c to %d:</span></span>
<span id="cb215-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb215-4" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> c<span class="op">);</span>  <span class="co">// 66 (!!)</span></span></code></pre></div>
<p>Deep down, <code>char</code> is just a small <code>int</code>, namely an integer that uses just a single byte of space, limiting its range to…</p>
<p>Here the C spec gets just a little funky. It assures us that a <code>char</code> is a single byte, i.e.&nbsp;<code>sizeof(char) == 1</code>. But then in C11 §3.6¶3 it goes out of its way to say:</p>
<blockquote>
<p>A byte is composed of a contiguous sequence of bits, <em>the number of which is implementation-defined.</em></p>
</blockquote>
<p>Wait—what? Some of you might be used to the notion that a byte is 8 bits, right? I mean, that’s what it is, right? And the answer is, “Almost certainly.”<a href="https://beej.us/guide/bgc/html/index-wide.html#fn93" class="footnote-ref" id="fnref93" role="doc-noteref"><sup>93</sup></a> But C is an old language, and machines back in the day had, shall we say, a more <em>relaxed</em> opinion over how many bits were in a byte. And through the years, C has retained this flexibility.</p>
<p>But assuming your bytes in C are 8 bits, like they are for virtually all machines in the world that you’ll ever see, the range of a <code>char</code> is…</p>
<p> —So before I can tell you, it turns out that <code>char</code>s might be signed or unsigned depending on your compiler. Unless you explicitly specify.</p>
<p>In many cases, just having <code>char</code> is fine because you don’t care about the sign of the data. But if you need signed or unsigned <code>char</code>s, you <em>must</em> be specific:</p>
<div class="sourceCode" id="cb216"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb216-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb216-1" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span> a<span class="op">;</span>           <span class="co">// Could be signed or unsigned</span></span>
<span id="cb216-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb216-2" aria-hidden="true" tabindex="-1"></a><span class="dt">signed</span> <span class="dt">char</span> b<span class="op">;</span>    <span class="co">// Definitely signed</span></span>
<span id="cb216-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb216-3" aria-hidden="true" tabindex="-1"></a><span class="dt">unsigned</span> <span class="dt">char</span> c<span class="op">;</span>  <span class="co">// Definitely unsigned</span></span></code></pre></div>
<p>OK, now, finally, we can figure out the range of numbers if we assume that a <code>char</code> is 8 bits and your system uses the virtually universal two’s complement representation for signed and unsigned<a href="https://beej.us/guide/bgc/html/index-wide.html#fn94" class="footnote-ref" id="fnref94" role="doc-noteref"><sup>94</sup></a>.</p>
<p>So, assuming those constraints, we can finally figure our ranges:</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;"><code>char</code> type</th>
<th style="text-align: right;">Minimum</th>
<th style="text-align: right;">Maximum</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>signed char</code></td>
<td style="text-align: right;"><code>-128</code></td>
<td style="text-align: right;"><code>127</code></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>unsigned char</code></td>
<td style="text-align: right;"><code>0</code></td>
<td style="text-align: right;"><code>255</code></td>
</tr>
</tbody>
</table>
<p>And the ranges for <code>char</code> are implementation-defined. </p>
<p>Let me get this straight. <code>char</code> is actually a number, so can we do math on it?</p>
<p>Yup! Just remember to keep things in the range of a <code>char</code>!</p>
<div class="sourceCode" id="cb217"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb217-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb217-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb217-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb217-2"></a></span>
<span id="cb217-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb217-3"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb217-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb217-4"></a><span class="op">{</span></span>
<span id="cb217-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb217-5"></a>    <span class="dt">char</span> a <span class="op">=</span> <span class="dv">10</span><span class="op">,</span> b <span class="op">=</span> <span class="dv">20</span><span class="op">;</span></span>
<span id="cb217-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb217-6"></a></span>
<span id="cb217-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb217-7"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> a <span class="op">+</span> b<span class="op">);</span>  <span class="co">// 30!</span></span>
<span id="cb217-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb217-8"></a><span class="op">}</span></span></code></pre></div>
<p> What about those constant characters in single quotes, like <code>'B'</code>? How does that have a numeric value?</p>
<p>The spec is also hand-wavey here, since C isn’t designed to run on a single type of underlying system.</p>
<p>But let’s just assume for the moment that your character set is based on <a href="https://en.wikipedia.org/wiki/ASCII">ASCII</a><a href="https://beej.us/guide/bgc/html/index-wide.html#fn95" class="footnote-ref" id="fnref95" role="doc-noteref"><sup>95</sup></a> for at least the first 128 characters. In that case, the character constant will be converted to a <code>char</code> whose value is the same as the ASCII value of the character.</p>
<p>That was a mouthful. Let’s just have an example:</p>
<div class="sourceCode" id="cb218"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb218-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb218-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb218-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb218-2"></a></span>
<span id="cb218-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb218-3"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb218-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb218-4"></a><span class="op">{</span></span>
<span id="cb218-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb218-5"></a>    <span class="dt">char</span> a <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb218-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb218-6"></a>    <span class="dt">char</span> b <span class="op">=</span> <span class="ch">'B'</span><span class="op">;</span>  <span class="co">// ASCII value 66</span></span>
<span id="cb218-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb218-7"></a></span>
<span id="cb218-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb218-8"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> a <span class="op">+</span> b<span class="op">);</span>  <span class="co">// 76!</span></span>
<span id="cb218-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb218-9"></a><span class="op">}</span></span></code></pre></div>
<p>This depends on your execution environment and the <a href="https://en.wikipedia.org/wiki/List_of_information_system_character_sets">character set used</a><a href="https://beej.us/guide/bgc/html/index-wide.html#fn96" class="footnote-ref" id="fnref96" role="doc-noteref"><sup>96</sup></a>. One of the most popular character sets today is <a href="https://en.wikipedia.org/wiki/Unicode">Unicode</a><a href="https://beej.us/guide/bgc/html/index-wide.html#fn97" class="footnote-ref" id="fnref97" role="doc-noteref"><sup>97</sup></a> (which is a superset of ASCII), so for your basic 0-9, A-Z, a-z and punctuation, you’ll almost certainly get the ASCII values out of them. </p>
<h2 data-number="14.3" id="more-integer-types-short-long-long-long"><span class="header-section-number">14.3</span> More Integer Types: <code>short</code>, <code>long</code>, <code>long long</code></h2>
<p>So far we’ve just generally been using two integer types:</p>
<ul>
<li><code>char</code></li>
<li><code>int</code></li>
</ul>
<p>and we recently learned about the unsigned variants of the integer types. And we learned that <code>char</code> was secretly a small <code>int</code> in disguise. So we know the <code>int</code>s can come in multiple bit sizes.</p>
<p>But there are a couple more integer types we should look at, and the <em>minimum</em> minimum and maximum values they can hold.</p>
<p>Yes, I said “minimum” twice. The spec says that these types will hold numbers of <em>at least</em> these sizes, so your implementation might be different. The header file <code>&lt;limits.h&gt;</code> defines macros that hold the minimum and maximum integer values; rely on that to be sure, and <em>never hardcode or assume these values</em>.</p>
<p> These additional types are <code>short int</code>, <code>long int</code>, and <code>long long int</code>. Commonly, when using these types, C developers leave the <code>int</code> part off (e.g.&nbsp;<code>long long</code>), and the compiler is perfectly happy.</p>
<div class="sourceCode" id="cb219"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb219-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb219-1" aria-hidden="true" tabindex="-1"></a><span class="co">// These two lines are equivalent:</span></span>
<span id="cb219-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb219-2" aria-hidden="true" tabindex="-1"></a><span class="dt">long</span> <span class="dt">long</span> <span class="dt">int</span> x<span class="op">;</span></span>
<span id="cb219-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb219-3" aria-hidden="true" tabindex="-1"></a><span class="dt">long</span> <span class="dt">long</span> x<span class="op">;</span></span>
<span id="cb219-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb219-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb219-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb219-5" aria-hidden="true" tabindex="-1"></a><span class="co">// And so are these:</span></span>
<span id="cb219-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb219-6" aria-hidden="true" tabindex="-1"></a><span class="dt">short</span> <span class="dt">int</span> x<span class="op">;</span></span>
<span id="cb219-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb219-7" aria-hidden="true" tabindex="-1"></a><span class="dt">short</span> x<span class="op">;</span></span></code></pre></div>
<p>Let’s take a look at the integer data types and sizes in ascending order, grouped by signedness.</p>
<table>
<colgroup>
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
<col style="width: 25%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Type</th>
<th style="text-align: right;">Minimum Bytes</th>
<th style="text-align: right;">Minimum Value</th>
<th style="text-align: right;">Maximum Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>char</code></td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">-127 or 0</td>
<td style="text-align: right;">127 or 255<a href="https://beej.us/guide/bgc/html/index-wide.html#fn98" class="footnote-ref" id="fnref98" role="doc-noteref"><sup>98</sup></a></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>signed char</code></td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">-127</td>
<td style="text-align: right;">127</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>short</code></td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">-32767</td>
<td style="text-align: right;">32767</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>int</code></td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">-32767</td>
<td style="text-align: right;">32767</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>long</code></td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">-2147483647</td>
<td style="text-align: right;">2147483647</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>long long</code></td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">-9223372036854775807</td>
<td style="text-align: right;">9223372036854775807</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>unsigned char</code></td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">255</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>unsigned short</code></td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">65535</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>unsigned int</code></td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">65535</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>unsigned long</code></td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">4294967295</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>unsigned long long</code></td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">18446744073709551615</td>
</tr>
</tbody>
</table>
<p>There is no <code>long long long</code> type. You can’t just keep adding <code>long</code>s like that. Don’t be silly.</p>
<blockquote>
<p>Two’s complement fans might have noticed something funny about those numbers. Why does, for example, the <code>signed char</code> stop at -127 instead of -128? Remember: these are only the minimums required by the spec. Some number representations (like <a href="https://en.wikipedia.org/wiki/Signed_number_representations#Signed_magnitude_representation">sign and magnitude</a><a href="https://beej.us/guide/bgc/html/index-wide.html#fn99" class="footnote-ref" id="fnref99" role="doc-noteref"><sup>99</sup></a>) top off at ±127.</p>
</blockquote>
<p>Let’s run the same table on my 64-bit, two’s complement system and see what comes out:</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Type</th>
<th style="text-align: right;">My Bytes</th>
<th style="text-align: right;">Minimum Value</th>
<th style="text-align: right;">Maximum Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>char</code></td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">-128</td>
<td style="text-align: right;">127<a href="https://beej.us/guide/bgc/html/index-wide.html#fn100" class="footnote-ref" id="fnref100" role="doc-noteref"><sup>100</sup></a></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>signed char</code></td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">-128</td>
<td style="text-align: right;">127</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>short</code></td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">-32768</td>
<td style="text-align: right;">32767</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>int</code></td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">-2147483648</td>
<td style="text-align: right;">2147483647</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>long</code></td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">-9223372036854775808</td>
<td style="text-align: right;">9223372036854775807</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>long long</code></td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">-9223372036854775808</td>
<td style="text-align: right;">9223372036854775807</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>unsigned char</code></td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">255</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>unsigned short</code></td>
<td style="text-align: right;">2</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">65535</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>unsigned int</code></td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">4294967295</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>unsigned long</code></td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">18446744073709551615</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>unsigned long long</code></td>
<td style="text-align: right;">8</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">18446744073709551615</td>
</tr>
</tbody>
</table>
<p>That’s a little more sensible, but we can see how my system has larger limits than the minimums in the specification.</p>
<p><span id="limits-macros">So what are the macros in <code>&lt;limits.h&gt;</code>?</span></p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Min Macro</th>
<th style="text-align: left;">Max Macro</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>char</code></td>
<td style="text-align: left;"><code>CHAR_MIN</code></td>
<td style="text-align: left;"><code>CHAR_MAX</code></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>signed char</code></td>
<td style="text-align: left;"><code>SCHAR_MIN</code></td>
<td style="text-align: left;"><code>SCHAR_MAX</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>short</code></td>
<td style="text-align: left;"><code>SHRT_MIN</code></td>
<td style="text-align: left;"><code>SHRT_MAX</code></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>int</code></td>
<td style="text-align: left;"><code>INT_MIN</code></td>
<td style="text-align: left;"><code>INT_MAX</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>long</code></td>
<td style="text-align: left;"><code>LONG_MIN</code></td>
<td style="text-align: left;"><code>LONG_MAX</code></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>long long</code></td>
<td style="text-align: left;"><code>LLONG_MIN</code></td>
<td style="text-align: left;"><code>LLONG_MAX</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>unsigned char</code></td>
<td style="text-align: left;"><code>0</code></td>
<td style="text-align: left;"><code>UCHAR_MAX</code></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>unsigned short</code></td>
<td style="text-align: left;"><code>0</code></td>
<td style="text-align: left;"><code>USHRT_MAX</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>unsigned int</code></td>
<td style="text-align: left;"><code>0</code></td>
<td style="text-align: left;"><code>UINT_MAX</code></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>unsigned long</code></td>
<td style="text-align: left;"><code>0</code></td>
<td style="text-align: left;"><code>ULONG_MAX</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>unsigned long long</code></td>
<td style="text-align: left;"><code>0</code></td>
<td style="text-align: left;"><code>ULLONG_MAX</code></td>
</tr>
</tbody>
</table>
<p>Notice there’s a way hidden in there to determine if a system uses signed or unsigned <code>char</code>s. If <code>CHAR_MAX == UCHAR_MAX</code>, it must be unsigned.</p>
<p>Also notice there’s no minimum macro for the <code>unsigned</code> variants—they’re just <code>0</code>. </p>
<h2 data-number="14.4" id="more-float-double-and-long-double"><span class="header-section-number">14.4</span> More Float: <code>double</code> and <code>long double</code></h2>
<p>Let’s see what the spec has to say about floating point numbers in §5.2.4.2.2¶1-2:</p>
<blockquote>
<p>The following parameters are used to define the model for each floating-point type:</p>
<table>
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Parameter</th>
<th style="text-align: left;">Definition</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><span class="math inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="2" style="font-size: 101.6%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D460 TEX-I"></mjx-c></mjx-mi></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>s</mi></math></mjx-assistive-mml></mjx-container></span></td>
<td style="text-align: left;">sign (<span class="math inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="3" style="font-size: 101.6%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-cB1"></mjx-c></mjx-mo><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>±</mo><mn>1</mn></math></mjx-assistive-mml></mjx-container></span>)</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="4" style="font-size: 101.6%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D44F TEX-I"></mjx-c></mjx-mi></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>b</mi></math></mjx-assistive-mml></mjx-container></span></td>
<td style="text-align: left;">base or radix of exponent representation (an integer <span class="math inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="5" style="font-size: 101.6%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c3E"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>&gt;</mo><mn>1</mn></math></mjx-assistive-mml></mjx-container></span>)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="6" style="font-size: 101.6%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D452 TEX-I"></mjx-c></mjx-mi></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>e</mi></math></mjx-assistive-mml></mjx-container></span></td>
<td style="text-align: left;">exponent (an integer between a minimum <span class="math inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="7" style="font-size: 101.6%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-msub><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D452 TEX-I"></mjx-c></mjx-mi><mjx-script style="vertical-align: -0.15em;"><mjx-texatom size="s" texclass="ORD"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45A TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D456 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45B TEX-I"></mjx-c></mjx-mi></mjx-texatom></mjx-script></mjx-msub></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>e</mi><mrow data-mjx-texclass="ORD"><mi>m</mi><mi>i</mi><mi>n</mi></mrow></msub></math></mjx-assistive-mml></mjx-container></span> and a maximum <span class="math inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="8" style="font-size: 101.6%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-msub><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D452 TEX-I"></mjx-c></mjx-mi><mjx-script style="vertical-align: -0.15em;"><mjx-texatom size="s" texclass="ORD"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45A TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D44E TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D465 TEX-I"></mjx-c></mjx-mi></mjx-texatom></mjx-script></mjx-msub></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>e</mi><mrow data-mjx-texclass="ORD"><mi>m</mi><mi>a</mi><mi>x</mi></mrow></msub></math></mjx-assistive-mml></mjx-container></span>)</td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="9" style="font-size: 101.6%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45D TEX-I"></mjx-c></mjx-mi></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>p</mi></math></mjx-assistive-mml></mjx-container></span></td>
<td style="text-align: left;">precision (the number of base-<span class="math inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="10" style="font-size: 101.6%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D44F TEX-I"></mjx-c></mjx-mi></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>b</mi></math></mjx-assistive-mml></mjx-container></span> digits in the significand)</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><span class="math inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="11" style="font-size: 101.6%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-msub><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D453 TEX-I"></mjx-c></mjx-mi><mjx-script style="vertical-align: -0.15em; margin-left: -0.06em;"><mjx-mi class="mjx-i" size="s"><mjx-c class="mjx-c1D458 TEX-I"></mjx-c></mjx-mi></mjx-script></mjx-msub></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>f</mi><mi>k</mi></msub></math></mjx-assistive-mml></mjx-container></span></td>
<td style="text-align: left;">nonnegative integers less than <span class="math inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="12" style="font-size: 101.6%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D44F TEX-I"></mjx-c></mjx-mi></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>b</mi></math></mjx-assistive-mml></mjx-container></span> (the significand digits)</td>
</tr>
</tbody>
</table>
<p>A <em>floating-point number</em> (<span class="math inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="13" style="font-size: 101.6%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D465 TEX-I"></mjx-c></mjx-mi></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>x</mi></math></mjx-assistive-mml></mjx-container></span>) is defined by the following model:</p>
<blockquote>
<p><span class="math inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="14" style="font-size: 101.6%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D465 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mi class="mjx-i" space="4"><mjx-c class="mjx-c1D460 TEX-I"></mjx-c></mjx-mi><mjx-msup><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D44F TEX-I"></mjx-c></mjx-mi><mjx-script style="vertical-align: 0.363em;"><mjx-mi class="mjx-i" size="s"><mjx-c class="mjx-c1D452 TEX-I"></mjx-c></mjx-mi></mjx-script></mjx-msup><mjx-munderover space="2"><mjx-over style="padding-bottom: 0.111em; padding-left: 0.458em;"><mjx-mi class="mjx-i" size="s"><mjx-c class="mjx-c1D45D TEX-I"></mjx-c></mjx-mi></mjx-over><mjx-box><mjx-munder><mjx-row><mjx-base style="padding-left: 0.108em;"><mjx-mo class="mjx-sop"><mjx-c class="mjx-c2211 TEX-S1"></mjx-c></mjx-mo></mjx-base></mjx-row><mjx-row><mjx-under style="padding-top: 0.167em;"><mjx-texatom size="s" texclass="ORD"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D458 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-texatom></mjx-under></mjx-row></mjx-munder></mjx-box></mjx-munderover><mjx-msub space="2"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D453 TEX-I"></mjx-c></mjx-mi><mjx-script style="vertical-align: -0.15em; margin-left: -0.06em;"><mjx-mi class="mjx-i" size="s"><mjx-c class="mjx-c1D458 TEX-I"></mjx-c></mjx-mi></mjx-script></mjx-msub><mjx-msup><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D44F TEX-I"></mjx-c></mjx-mi><mjx-script style="vertical-align: 0.363em;"><mjx-texatom size="s" texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D458 TEX-I"></mjx-c></mjx-mi></mjx-texatom></mjx-script></mjx-msup><mjx-mo class="mjx-n"><mjx-c class="mjx-c2C"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>x</mi><mo>=</mo><mi>s</mi><msup><mi>b</mi><mi>e</mi></msup><munderover><mo data-mjx-texclass="OP" movablelimits="false">∑</mo><mrow data-mjx-texclass="ORD"><mi>k</mi><mo>=</mo><mn>1</mn></mrow><mi>p</mi></munderover><msub><mi>f</mi><mi>k</mi></msub><msup><mi>b</mi><mrow data-mjx-texclass="ORD"><mo>−</mo><mi>k</mi></mrow></msup><mo>,</mo></math></mjx-assistive-mml></mjx-container></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="math inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="15" style="font-size: 101.6%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-msub><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D452 TEX-I"></mjx-c></mjx-mi><mjx-script style="vertical-align: -0.15em;"><mjx-texatom size="s" texclass="ORD"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45A TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D456 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45B TEX-I"></mjx-c></mjx-mi></mjx-texatom></mjx-script></mjx-msub><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c2264"></mjx-c></mjx-mo><mjx-mi class="mjx-i" space="4"><mjx-c class="mjx-c1D452 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c2264"></mjx-c></mjx-mo><mjx-msub space="4"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D452 TEX-I"></mjx-c></mjx-mi><mjx-script style="vertical-align: -0.15em;"><mjx-texatom size="s" texclass="ORD"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45A TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D44E TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D465 TEX-I"></mjx-c></mjx-mi></mjx-texatom></mjx-script></mjx-msub></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>e</mi><mrow data-mjx-texclass="ORD"><mi>m</mi><mi>i</mi><mi>n</mi></mrow></msub><mo>≤</mo><mi>e</mi><mo>≤</mo><msub><mi>e</mi><mrow data-mjx-texclass="ORD"><mi>m</mi><mi>a</mi><mi>x</mi></mrow></msub></math></mjx-assistive-mml></mjx-container></span></p>
</blockquote>
</blockquote>
<p>I hope that cleared it right up for you.</p>
<p>Okay, fine. Let’s step back a bit and see what’s practical.</p>
<p>Note: we refer to a bunch of macros in this section. They can be found in the header <code>&lt;float.h&gt;</code>.</p>
<p>Floating point number are encoded in a specific sequence of bits (<a href="https://en.wikipedia.org/wiki/IEEE_754">IEEE-754 format</a><a href="https://beej.us/guide/bgc/html/index-wide.html#fn101" class="footnote-ref" id="fnref101" role="doc-noteref"><sup>101</sup></a> is tremendously popular) in bytes.</p>
<p>Diving in a bit more, the number is basically represented as the <em>significand</em> (which is the number part—the significant digits themselves, also sometimes referred to as the <em>mantissa</em>) and the <em>exponent</em>, which is what power to raise the digits to. Recall that a negative exponent can make a number smaller.</p>
<p>Imagine we’re using <span class="math inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="16" style="font-size: 101.6%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>10</mn></math></mjx-assistive-mml></mjx-container></span> as a number to raise by an exponent. We could represent the following numbers by using a significand of <span class="math inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="17" style="font-size: 101.6%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c32"></mjx-c><mjx-c class="mjx-c33"></mjx-c><mjx-c class="mjx-c34"></mjx-c><mjx-c class="mjx-c35"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>12345</mn></math></mjx-assistive-mml></mjx-container></span>, and exponents of <span class="math inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="18" style="font-size: 101.6%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mn class="mjx-n"><mjx-c class="mjx-c33"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>−</mo><mn>3</mn></math></mjx-assistive-mml></mjx-container></span>, <span class="math inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="19" style="font-size: 101.6%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c34"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>4</mn></math></mjx-assistive-mml></mjx-container></span>, and <span class="math inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="20" style="font-size: 101.6%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>0</mn></math></mjx-assistive-mml></mjx-container></span> to encode the following floating point values:</p>
<p><span class="math inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="21" style="font-size: 101.6%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c32"></mjx-c><mjx-c class="mjx-c33"></mjx-c><mjx-c class="mjx-c34"></mjx-c><mjx-c class="mjx-c35"></mjx-c></mjx-mn><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-cD7"></mjx-c></mjx-mo><mjx-msup space="3"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn><mjx-script style="vertical-align: 0.393em;"><mjx-texatom size="s" texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mn class="mjx-n"><mjx-c class="mjx-c33"></mjx-c></mjx-mn></mjx-texatom></mjx-script></mjx-msup><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c32"></mjx-c><mjx-c class="mjx-c2E"></mjx-c><mjx-c class="mjx-c33"></mjx-c><mjx-c class="mjx-c34"></mjx-c><mjx-c class="mjx-c35"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>12345</mn><mo>×</mo><msup><mn>10</mn><mrow data-mjx-texclass="ORD"><mo>−</mo><mn>3</mn></mrow></msup><mo>=</mo><mn>12.345</mn></math></mjx-assistive-mml></mjx-container></span></p>
<p><span class="math inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="22" style="font-size: 101.6%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c32"></mjx-c><mjx-c class="mjx-c33"></mjx-c><mjx-c class="mjx-c34"></mjx-c><mjx-c class="mjx-c35"></mjx-c></mjx-mn><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-cD7"></mjx-c></mjx-mo><mjx-msup space="3"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn><mjx-script style="vertical-align: 0.393em;"><mjx-mn class="mjx-n" size="s"><mjx-c class="mjx-c34"></mjx-c></mjx-mn></mjx-script></mjx-msup><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c32"></mjx-c><mjx-c class="mjx-c33"></mjx-c><mjx-c class="mjx-c34"></mjx-c><mjx-c class="mjx-c35"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>12345</mn><mo>×</mo><msup><mn>10</mn><mn>4</mn></msup><mo>=</mo><mn>123450000</mn></math></mjx-assistive-mml></mjx-container></span></p>
<p><span class="math inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="23" style="font-size: 101.6%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c32"></mjx-c><mjx-c class="mjx-c33"></mjx-c><mjx-c class="mjx-c34"></mjx-c><mjx-c class="mjx-c35"></mjx-c></mjx-mn><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-cD7"></mjx-c></mjx-mo><mjx-msup space="3"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn><mjx-script style="vertical-align: 0.393em;"><mjx-mn class="mjx-n" size="s"><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-script></mjx-msup><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c32"></mjx-c><mjx-c class="mjx-c33"></mjx-c><mjx-c class="mjx-c34"></mjx-c><mjx-c class="mjx-c35"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>12345</mn><mo>×</mo><msup><mn>10</mn><mn>0</mn></msup><mo>=</mo><mn>12345</mn></math></mjx-assistive-mml></mjx-container></span></p>
<p>For all those numbers, the significand stays the same. The only difference is the exponent.</p>
<p>On your machine, the base for the exponent is probably <span class="math inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="24" style="font-size: 101.6%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>2</mn></math></mjx-assistive-mml></mjx-container></span>, not <span class="math inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="25" style="font-size: 101.6%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>10</mn></math></mjx-assistive-mml></mjx-container></span>, since computers like binary. You can check it by printing the <code>FLT_RADIX</code> macro.</p>
<p>So we have a number that’s represented by a number of bytes, encoded in some way. Because there are a limited number of bit patterns, a limited number of floating point numbers can be represented.</p>
<p>But more particularly, only a certain number of significant decimal digits can be represented accurately.</p>
<p>How can you get more? You can use larger data types!</p>
<p>And we have a couple of them. We know about <code>float</code> already, but for more precision we have <code>double</code>. And for even more precision, we have <code>long double</code> (unrelated to <code>long int</code> except by name).</p>
<p>The spec doesn’t go into how many bytes of storage each type should take, but on my system, we can see the relative size increases:</p>
<p> </p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Type</th>
<th style="text-align: right;"><code>sizeof</code></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>float</code></td>
<td style="text-align: right;">4</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>double</code></td>
<td style="text-align: right;">8</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>long double</code></td>
<td style="text-align: right;">16</td>
</tr>
</tbody>
</table>
<p>So each of the types (on my system) uses those additional bits for more precision.</p>
<p>But <em>how much</em> precision are we talking, here? How many decimal numbers can be represented by these values?</p>
<p>Well, C provides us with a bunch of macros in <code>&lt;float.h&gt;</code> to help us figure that out.</p>
<p>It gets a little wonky if you are using a base-2 (binary) system for storing the numbers (which is virtually everyone on the planet, probably including you), but bear with me while we figure it out. </p>
<h3 data-number="14.4.1" id="how-many-decimal-digits"><span class="header-section-number">14.4.1</span> How Many Decimal Digits?</h3>
<p> The million dollar question is, “How many significant decimal digits can I store in a given floating point type so that I get out the same decimal number when I print it?”</p>
<p>The number of decimal digits you can store in a floating point type and surely get the same number back out when you print it is given by these macros:</p>
<p> </p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Type</th>
<th style="text-align: right;">Decimal Digits You Can Store</th>
<th style="text-align: right;">Minimum</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>float</code></td>
<td style="text-align: right;"><code>FLT_DIG</code></td>
<td style="text-align: right;">6</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>double</code></td>
<td style="text-align: right;"><code>DBL_DIG</code></td>
<td style="text-align: right;">10</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>long double</code></td>
<td style="text-align: right;"><code>LDBL_DIG</code></td>
<td style="text-align: right;">10</td>
</tr>
</tbody>
</table>
<p> </p>
<p>On my system, <code>FLT_DIG</code> is 6, so I can be sure that if I print out a 6 digit <code>float</code>, I’ll get the same thing back. (It could be more digits—some numbers will come back correctly with more digits. But 6 is definitely coming back.)</p>
<p>For example, printing out <code>float</code>s following this pattern of increasing digits, we apparently make it to 8 digits before something goes wrong, but after that we’re back to 7 correct digits.</p>
<div class="sourceCode" id="cb220"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb220-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb220-1" aria-hidden="true" tabindex="-1"></a>0.12345</span>
<span id="cb220-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb220-2" aria-hidden="true" tabindex="-1"></a>0.123456</span>
<span id="cb220-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb220-3" aria-hidden="true" tabindex="-1"></a>0.1234567</span>
<span id="cb220-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb220-4" aria-hidden="true" tabindex="-1"></a>0.12345678</span>
<span id="cb220-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb220-5" aria-hidden="true" tabindex="-1"></a>0.123456791  &lt;-- Things start going wrong</span>
<span id="cb220-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb220-6" aria-hidden="true" tabindex="-1"></a>0.1234567910</span></code></pre></div>
<p>Let’s do another demo. In this code we’ll have two <code>float</code>s that both hold numbers that have <code>FLT_DIG</code> significant decimal digits<a href="https://beej.us/guide/bgc/html/index-wide.html#fn102" class="footnote-ref" id="fnref102" role="doc-noteref"><sup>102</sup></a>. Then we add those together, for what should be 12 significant decimal digits. But that’s more than we can store in a <code>float</code> and correctly recover as a string—so we see when we print it out, things start going wrong after the 7th significant digit.</p>
<div class="sourceCode" id="cb221"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb221-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb221-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb221-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb221-2"></a><span class="pp">#include </span><span class="im">&lt;float.h&gt;</span></span>
<span id="cb221-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb221-3"></a></span>
<span id="cb221-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb221-4"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb221-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb221-5"></a><span class="op">{</span></span>
<span id="cb221-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb221-6"></a>    <span class="co">// Both these numbers have 6 significant digits, so they can be</span></span>
<span id="cb221-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb221-7"></a>    <span class="co">// stored accurately in a float:</span></span>
<span id="cb221-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb221-8"></a></span>
<span id="cb221-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb221-9"></a>    <span class="dt">float</span> f <span class="op">=</span> <span class="fl">3.14159</span><span class="bu">f</span><span class="op">;</span></span>
<span id="cb221-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb221-10"></a>    <span class="dt">float</span> g <span class="op">=</span> <span class="dv">0</span><span class="er">.00000265358f</span><span class="op">;</span></span>
<span id="cb221-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb221-11"></a></span>
<span id="cb221-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb221-12"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%.5f\n</span><span class="st">"</span><span class="op">,</span> f<span class="op">);</span>   <span class="co">// 3.14159       -- correct!</span></span>
<span id="cb221-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb221-13"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%.11f\n</span><span class="st">"</span><span class="op">,</span> g<span class="op">);</span>  <span class="co">// 0.00000265358 -- correct!</span></span>
<span id="cb221-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb221-14"></a></span>
<span id="cb221-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb221-15"></a>    <span class="co">// Now add them up</span></span>
<span id="cb221-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb221-16"></a>    f <span class="op">+=</span> g<span class="op">;</span>                <span class="co">// 3.14159265358 is what f _should_ be</span></span>
<span id="cb221-17"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb221-17"></a></span>
<span id="cb221-18"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb221-18"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%.11f\n</span><span class="st">"</span><span class="op">,</span> f<span class="op">);</span>  <span class="co">// 3.14159274101 -- wrong!</span></span>
<span id="cb221-19"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb221-19"></a><span class="op">}</span></span></code></pre></div>
<p>(The above code has an <code>f</code> after the numeric constants—this indicates that the constant is type <code>float</code>, as opposed to the default of <code>double</code>. More on this later.)</p>
<p>Remember that <code>FLT_DIG</code> is the safe number of digits you can store in a <code>float</code> and retrieve correctly.</p>
<p>Sometimes you might get one or two more out of it. But sometimes you’ll only get <code>FLT_DIG</code> digits back. The sure thing: if you store any number of digits up to and including <code>FLT_DIG</code> in a <code>float</code>, you’re sure to get them back correctly.</p>
<p>So that’s the story. <code>FLT_DIG</code>. The End.</p>
<p></p>
<p>…Or is it?</p>
<h3 data-number="14.4.2" id="converting-to-decimal-and-back"><span class="header-section-number">14.4.2</span> Converting to Decimal and Back</h3>
<p>But storing a base 10 number in a floating point number and getting it back out is only half the story.</p>
<p>Turns out floating point numbers can encode numbers that require more decimal places to print out completely. It’s just that your big decimal number might not map to one of those numbers.</p>
<p>That is, when you look at floating point numbers from one to the next, there’s a gap. If you try to encode a decimal number in that gap, it’ll use the closest floating point number. That’s why you can only encode <code>FLT_DIG</code> for a <code>float</code>.</p>
<p>But what about those floating point numbers that <em>aren’t</em> in the gap? How many places do you need to print those out accurately?</p>
<p>Another way to phrase this question is for any given floating point number, how many decimal digits do I have to preserve if I want to convert the decimal number back into an identical floating point number? That is, how many digits do I have to print in base 10 to recover <strong>all</strong> the digits in base 2 in the original number?</p>
<p>Sometimes it might only be a few. But to be sure, you’ll want to convert to decimal with a certain safe number of decimal places. That number is encoded in the following macros:</p>
<p> </p>
<table>
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th>Macro</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>FLT_DECIMAL_DIG</code></td>
<td>Number of decimal digits encoded in a <code>float</code>.</td>
</tr>
<tr class="even">
<td><code>DBL_DECIMAL_DIG</code></td>
<td>Number of decimal digits encoded in a <code>double</code>.</td>
</tr>
<tr class="odd">
<td><code>LDBL_DECIMAL_DIG</code></td>
<td>Number of decimal digits encoded in a <code>long double</code>.</td>
</tr>
<tr class="even">
<td><code>DECIMAL_DIG</code></td>
<td>Same as the widest encoding, <code>LDBL_DECIMAL_DIG</code>.</td>
</tr>
</tbody>
</table>
<p> </p>
<p>Let’s see an example where <code>DBL_DIG</code> is 15 (so that’s all we can have in a constant), but <code>DBL_DECIMAL_DIG</code> is 17 (so we have to convert to 17 decimal numbers to preserve all the bits of the original <code>double</code>).</p>
<p>Let’s assign the 15 significant digit number <code>0.123456789012345</code> to <code>x</code>, and let’s assign the 1 significant digit number <code>0.0000000000000006</code> to <code>y</code>.</p>
<div class="sourceCode" id="cb222"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb222-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb222-1" aria-hidden="true" tabindex="-1"></a>x is exact: 0.12345678901234500    Printed to 17 decimal places</span>
<span id="cb222-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb222-2" aria-hidden="true" tabindex="-1"></a>y is exact: 0.00000000000000060</span></code></pre></div>
<p>But let’s add them together. This should give <code>0.1234567890123456</code>, but that’s more than <code>DBL_DIG</code>, so strange things might happen… let’s look:</p>
<div class="sourceCode" id="cb223"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb223-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb223-1" aria-hidden="true" tabindex="-1"></a>x + y not quite right: 0.12345678901234559    Should end in 4560!</span></code></pre></div>
<p>That’s what we get for printing more than <code>DBL_DIG</code>, right? But check this out… that number, above, is exactly representable as it is!</p>
<p>If we assign <code>0.12345678901234559</code> (17 digits) to <code>z</code> and print it, we get:</p>
<div class="sourceCode" id="cb224"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb224-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb224-1" aria-hidden="true" tabindex="-1"></a>z is exact: 0.12345678901234559   17 digits correct! More than DBL_DIG!</span></code></pre></div>
<p>If we’d truncated <code>z</code> down to 15 digits, it wouldn’t have been the same number. That’s why to preserve all the bits of a <code>double</code>, we need <code>DBL_DECIMAL_DIG</code> and not just the lesser <code>DBL_DIG</code>.</p>
<p></p>
<p>All that being said, it’s clear that when we’re messing with decimal numbers in general, it’s not safe to print more than <code>FLT_DIG</code>, <code>DBL_DIG</code>, or <code>LDBL_DIG</code> digits to be sensible in relation to the original base 10 numbers and any subsequent math.</p>
<p>But when converting from <code>float</code> to a decimal representation and <em>back</em> to <code>float</code>, definitely use <code>FLT_DECIMAL_DIG</code> to do that so that all the bits are preserved exactly. </p>
<p></p>
<h2 data-number="14.5" id="constant-numeric-types"><span class="header-section-number">14.5</span> Constant Numeric Types</h2>
<p>When you write down a constant number, like <code>1234</code>, it has a type. But what type is it? Let’s look at how C decides what type the constant is, and how to force it to choose a specific type.</p>
<h3 data-number="14.5.1" id="hexadecimal-and-octal"><span class="header-section-number">14.5.1</span> Hexadecimal and Octal</h3>
<p>In addition to good ol’ decimal like Grandma used to bake, C also supports constants of different bases.</p>
<p></p>
<p>If you lead a number with <code>0x</code>, it is read as a hex number:</p>
<div class="sourceCode" id="cb225"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb225-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb225-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> a <span class="op">=</span> <span class="bn">0x1A2B</span><span class="op">;</span>   <span class="co">// Hexadecimal</span></span>
<span id="cb225-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb225-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> b <span class="op">=</span> <span class="bn">0x1a2b</span><span class="op">;</span>   <span class="co">// Case doesn't matter for hex digits</span></span>
<span id="cb225-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb225-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb225-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb225-4" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">%x</span><span class="st">"</span><span class="op">,</span> a<span class="op">);</span>  <span class="co">// Print a hex number, "1a2b"</span></span></code></pre></div>
<p></p>
<p> If you lead a number with a <code>0</code>, it is read as an octal number:</p>
<div class="sourceCode" id="cb226"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb226-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb226-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> a <span class="op">=</span> <span class="bn">012</span><span class="op">;</span></span>
<span id="cb226-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb226-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb226-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb226-3" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">%o\n</span><span class="st">"</span><span class="op">,</span> a<span class="op">);</span>  <span class="co">// Print an octal number, "12"</span></span></code></pre></div>
<p>This is particularly problematic for beginner programmers who try to pad decimal numbers on the left with <code>0</code> to line things up nice and pretty, inadvertently changing the base of the number:</p>
<div class="sourceCode" id="cb227"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb227-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb227-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> x <span class="op">=</span> <span class="dv">11111</span><span class="op">;</span>  <span class="co">// Decimal 11111</span></span>
<span id="cb227-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb227-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> y <span class="op">=</span> <span class="bn">00111</span><span class="op">;</span>  <span class="co">// Decimal 73 (Octal 111)</span></span>
<span id="cb227-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb227-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> z <span class="op">=</span> <span class="bn">01111</span><span class="op">;</span>  <span class="co">// Decimal 585 (Octal 1111)</span></span></code></pre></div>
<p></p>
<h4 data-number="14.5.1.1" id="a-note-on-binary"><span class="header-section-number">14.5.1.1</span> A Note on Binary</h4>
<p></p>
<p>An unofficial extension<a href="https://beej.us/guide/bgc/html/index-wide.html#fn103" class="footnote-ref" id="fnref103" role="doc-noteref"><sup>103</sup></a> in many C compilers allows you to represent a binary number with a <code>0b</code> prefix:</p>
<div class="sourceCode" id="cb228"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb228-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb228-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> x <span class="op">=</span> <span class="bn">0b101010</span><span class="op">;</span>    <span class="co">// Binary 101010</span></span>
<span id="cb228-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb228-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb228-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb228-3" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> x<span class="op">);</span>   <span class="co">// Prints 42 decimal</span></span></code></pre></div>
<p>There’s no <code>printf()</code> format specifier for printing a binary number. You have to do it a character at a time with bitwise operators.</p>
<p></p>
<h3 data-number="14.5.2" id="integer-constants"><span class="header-section-number">14.5.2</span> Integer Constants</h3>
<p></p>
<p>You can force a constant integer to be a certain type by appending a suffix to it that indicates the type.</p>
<p>We’ll do some assignments to demo, but most often devs leave off the suffixes unless needed to be precise. The compiler is pretty good at making sure the types are compatible.</p>
<p> </p>
<div class="sourceCode" id="cb229"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb229-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb229-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span>           x <span class="op">=</span> <span class="dv">1234</span><span class="op">;</span></span>
<span id="cb229-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb229-2" aria-hidden="true" tabindex="-1"></a><span class="dt">long</span> <span class="dt">int</span>      x <span class="op">=</span> <span class="dv">1234</span><span class="bu">L</span><span class="op">;</span></span>
<span id="cb229-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb229-3" aria-hidden="true" tabindex="-1"></a><span class="dt">long</span> <span class="dt">long</span> <span class="dt">int</span> x <span class="op">=</span> <span class="dv">1234</span><span class="bu">LL</span></span>
<span id="cb229-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb229-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb229-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb229-5" aria-hidden="true" tabindex="-1"></a><span class="dt">unsigned</span> <span class="dt">int</span>           x <span class="op">=</span> <span class="dv">1234</span><span class="bu">U</span><span class="op">;</span></span>
<span id="cb229-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb229-6" aria-hidden="true" tabindex="-1"></a><span class="dt">unsigned</span> <span class="dt">long</span> <span class="dt">int</span>      x <span class="op">=</span> <span class="dv">1234</span><span class="bu">UL</span><span class="op">;</span></span>
<span id="cb229-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb229-7" aria-hidden="true" tabindex="-1"></a><span class="dt">unsigned</span> <span class="dt">long</span> <span class="dt">long</span> <span class="dt">int</span> x <span class="op">=</span> <span class="dv">1234</span><span class="bu">ULL</span><span class="op">;</span></span></code></pre></div>
<p>The suffix can be uppercase or lowercase. And the <code>U</code> and <code>L</code> or <code>LL</code> can appear either one first.</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Suffix</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>int</code></td>
<td style="text-align: left;">None</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>long int</code></td>
<td style="text-align: left;"><code>L</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>long long int</code></td>
<td style="text-align: left;"><code>LL</code></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>unsigned int</code></td>
<td style="text-align: left;"><code>U</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>unsigned long int</code></td>
<td style="text-align: left;"><code>UL</code></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>unsigned long long int</code></td>
<td style="text-align: left;"><code>ULL</code></td>
</tr>
</tbody>
</table>
<p>I mentioned in the table that “no suffix” means <code>int</code>… but it’s actually more complex than that.</p>
<p>So what happens when you have an unsuffixed number like:</p>
<div class="sourceCode" id="cb230"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb230-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb230-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> x <span class="op">=</span> <span class="dv">1234</span><span class="op">;</span></span></code></pre></div>
<p>What type is it?</p>
<p>What C will generally do is choose the smallest type from <code>int</code> up that can hold the value.</p>
<p>But specifically, that depends on the number’s base (decimal, hex, or octal), as well.</p>
<p>The spec has a great table indicating which type gets used for what unsuffixed value. In fact, I’m just going to copy it wholesale right here.</p>
<p>C11 §6.4.4.1¶5 reads, “The type of an integer constant is the first of the first of the corresponding list in which its value can be represented.”</p>
<p>And then goes on to show this table:</p>
<table style="width:94%;">
<colgroup>
<col style="width: 23%">
<col style="width: 34%">
<col style="width: 36%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Suffix</th>
<th style="text-align: left;">Decimal Constant</th>
<th style="text-align: left;">Octal or Hexadecimal<br>
Constant</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">none</td>
<td style="text-align: left;"><code>int</code><br>
<code>long int</code></td>
<td style="text-align: left;"><code>int</code><br>
<code>unsigned int</code><br>
<code>long int</code><br>
<code>unsigned long int</code><br>
<code>long long int</code><br>
<code>unsigned long long int</code><br>
</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>u</code> or <code>U</code></td>
<td style="text-align: left;"><code>unsigned int</code><br>
<code>unsigned long int</code><br>
<code>unsigned long long int</code></td>
<td style="text-align: left;"><code>unsigned int</code><br>
<code>unsigned long int</code><br>
<code>unsigned long long int</code><br>
</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>l</code> or <code>L</code></td>
<td style="text-align: left;"><code>long int</code><br>
<code>long long int</code></td>
<td style="text-align: left;"><code>long int</code><br>
<code>unsigned long int</code><br>
<code>long long int</code><br>
<code>unsigned long long int</code><br>
</td>
</tr>
<tr class="even">
<td style="text-align: left;">Both <code>u</code> or <code>U</code><br>
and <code>l</code> or <code>L</code></td>
<td style="text-align: left;"><code>unsigned long int</code><br>
<code>unsigned long long int</code></td>
<td style="text-align: left;"><code>unsigned long int</code><br>
<code>unsigned long long int</code><br>
</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>ll</code> or <code>LL</code></td>
<td style="text-align: left;"><code>long long int</code></td>
<td style="text-align: left;"><code>long long int</code><br>
<code>unsigned long long int</code><br>
</td>
</tr>
<tr class="even">
<td style="text-align: left;">Both <code>u</code> or <code>U</code><br>
and <code>ll</code> or <code>LL</code></td>
<td style="text-align: left;"><code>unsigned long long int</code></td>
<td style="text-align: left;"><code>unsigned long long int</code></td>
</tr>
</tbody>
</table>
<p> </p>
<p>What that’s saying is that, for example, if you specify a number like <code>123456789U</code>, first C will see if it can be <code>unsigned int</code>. If it doesn’t fit there, it’ll try <code>unsigned long int</code>. And then <code>unsigned long long int</code>. It’ll use the smallest type that can hold the number.</p>
<p></p>
<p></p>
<h3 data-number="14.5.3" id="floating-point-constants"><span class="header-section-number">14.5.3</span> Floating Point Constants</h3>
<p></p>
<p>You’d think that a floating point constant like <code>1.23</code> would have a default type of <code>float</code>, right?</p>
<p>Surprise! Turns out unsuffiexed floating point numbers are type <code>double</code>! Happy belated birthday!</p>
<p> </p>
<p>You can force it to be of type <code>float</code> by appending an <code>f</code> (or <code>F</code>—it’s case-insensitive). You can force it to be of type <code>long double</code> by appending <code>l</code> (or <code>L</code>).</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Type</th>
<th style="text-align: left;">Suffix</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>float</code></td>
<td style="text-align: left;"><code>F</code></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>double</code></td>
<td style="text-align: left;">None</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>long double</code></td>
<td style="text-align: left;"><code>L</code></td>
</tr>
</tbody>
</table>
<p>For example:</p>
<div class="sourceCode" id="cb231"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb231-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb231-1" aria-hidden="true" tabindex="-1"></a><span class="dt">float</span> x       <span class="op">=</span> <span class="fl">3.14</span><span class="bu">f</span><span class="op">;</span></span>
<span id="cb231-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb231-2" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> x      <span class="op">=</span> <span class="fl">3.14</span><span class="op">;</span></span>
<span id="cb231-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb231-3" aria-hidden="true" tabindex="-1"></a><span class="dt">long</span> <span class="dt">double</span> x <span class="op">=</span> <span class="fl">3.14</span><span class="bu">L</span><span class="op">;</span></span></code></pre></div>
<p> </p>
<p>This whole time, though, we’ve just been doing this, right?</p>
<div class="sourceCode" id="cb232"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb232-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb232-1" aria-hidden="true" tabindex="-1"></a><span class="dt">float</span> x <span class="op">=</span> <span class="fl">3.14</span><span class="op">;</span></span></code></pre></div>
<p>Isn’t the left a <code>float</code> and the right a <code>double</code>? Yes! But C’s pretty good with automatic numeric conversions, so it’s more common to have an unsuffixed floating point constant than not. More on that later.</p>
<p></p>
<h4 data-number="14.5.3.1" id="scientific-notation"><span class="header-section-number">14.5.3.1</span> Scientific Notation</h4>
<p></p>
<p>Remember earlier when we talked about how a floating point number can be represented by a significand, base, and exponent?</p>
<p>Well, there’s a common way of writing such a number, shown here followed by it’s more recognizable equivalent which is what you get when you actually run the math:</p>
<p><span class="math inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="26" style="font-size: 101.6%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c2E"></mjx-c><mjx-c class="mjx-c32"></mjx-c><mjx-c class="mjx-c33"></mjx-c><mjx-c class="mjx-c34"></mjx-c><mjx-c class="mjx-c35"></mjx-c></mjx-mn><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-cD7"></mjx-c></mjx-mo><mjx-msup space="3"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn><mjx-script style="vertical-align: 0.393em;"><mjx-mn class="mjx-n" size="s"><mjx-c class="mjx-c33"></mjx-c></mjx-mn></mjx-script></mjx-msup><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c32"></mjx-c><mjx-c class="mjx-c33"></mjx-c><mjx-c class="mjx-c34"></mjx-c><mjx-c class="mjx-c2E"></mjx-c><mjx-c class="mjx-c35"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>1.2345</mn><mo>×</mo><msup><mn>10</mn><mn>3</mn></msup><mo>=</mo><mn>1234.5</mn></math></mjx-assistive-mml></mjx-container></span></p>
<p>Writing numbers in the form <span class="math inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="27" style="font-size: 101.6%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D460 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-cD7"></mjx-c></mjx-mo><mjx-msup space="3"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D44F TEX-I"></mjx-c></mjx-mi><mjx-script style="vertical-align: 0.363em;"><mjx-mi class="mjx-i" size="s"><mjx-c class="mjx-c1D452 TEX-I"></mjx-c></mjx-mi></mjx-script></mjx-msup></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>s</mi><mo>×</mo><msup><mi>b</mi><mi>e</mi></msup></math></mjx-assistive-mml></mjx-container></span> is called <a href="https://en.wikipedia.org/wiki/Scientific_notation"><em>scientific notation</em></a><a href="https://beej.us/guide/bgc/html/index-wide.html#fn104" class="footnote-ref" id="fnref104" role="doc-noteref"><sup>104</sup></a>. In C, these are written using “E notation”, so these are equivalent:</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Scientific Notation</th>
<th style="text-align: left;">E notation</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><span class="math inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="28" style="font-size: 101.6%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c2E"></mjx-c><mjx-c class="mjx-c32"></mjx-c><mjx-c class="mjx-c33"></mjx-c><mjx-c class="mjx-c34"></mjx-c><mjx-c class="mjx-c35"></mjx-c></mjx-mn><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-cD7"></mjx-c></mjx-mo><mjx-msup space="3"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn><mjx-script style="vertical-align: 0.393em;"><mjx-texatom size="s" texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mn class="mjx-n"><mjx-c class="mjx-c33"></mjx-c></mjx-mn></mjx-texatom></mjx-script></mjx-msup><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c2E"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c32"></mjx-c><mjx-c class="mjx-c33"></mjx-c><mjx-c class="mjx-c34"></mjx-c><mjx-c class="mjx-c35"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>1.2345</mn><mo>×</mo><msup><mn>10</mn><mrow data-mjx-texclass="ORD"><mo>−</mo><mn>3</mn></mrow></msup><mo>=</mo><mn>0.0012345</mn></math></mjx-assistive-mml></mjx-container></span></td>
<td style="text-align: left;"><code>1.2345e-3</code></td>
</tr>
<tr class="even">
<td style="text-align: left;"><span class="math inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="29" style="font-size: 101.6%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c2E"></mjx-c><mjx-c class="mjx-c32"></mjx-c><mjx-c class="mjx-c33"></mjx-c><mjx-c class="mjx-c34"></mjx-c><mjx-c class="mjx-c35"></mjx-c></mjx-mn><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-cD7"></mjx-c></mjx-mo><mjx-msup space="3"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn><mjx-script style="vertical-align: 0.393em;"><mjx-mn class="mjx-n" size="s"><mjx-c class="mjx-c38"></mjx-c></mjx-mn></mjx-script></mjx-msup><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c32"></mjx-c><mjx-c class="mjx-c33"></mjx-c><mjx-c class="mjx-c34"></mjx-c><mjx-c class="mjx-c35"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>1.2345</mn><mo>×</mo><msup><mn>10</mn><mn>8</mn></msup><mo>=</mo><mn>123450000</mn></math></mjx-assistive-mml></mjx-container></span></td>
<td style="text-align: left;"><code>1.2345e+8</code></td>
</tr>
</tbody>
</table>
<p>You can print a number in this notation with <code>%e</code>:</p>
<div class="sourceCode" id="cb233"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb233-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb233-1" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">%e\n</span><span class="st">"</span><span class="op">,</span> <span class="fl">123456.0</span><span class="op">);</span>  <span class="co">// Prints 1.234560e+05</span></span></code></pre></div>
<p>A couple little fun facts about scientific notation:</p>
<ul>
<li><p>You don’t have to write them with a single leading digit before the decimal point. Any number of numbers can go in front.</p>
<div class="sourceCode" id="cb234"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb234-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb234-1" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> x <span class="op">=</span> <span class="fl">123.456e+3</span><span class="op">;</span>  <span class="co">// 123456</span></span></code></pre></div>
<p>However, when you print it, it will change the exponent so there is only one digit in front of the decimal point.</p></li>
<li><p>The plus can be left off the exponent, as it’s default, but this is uncommon in practice from what I’ve seen.</p>
<div class="sourceCode" id="cb235"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb235-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb235-1" aria-hidden="true" tabindex="-1"></a><span class="fl">1.2345e10</span> <span class="op">==</span> <span class="fl">1.2345e+10</span></span></code></pre></div></li>
<li><p>You can apply the <code>F</code> or <code>L</code> suffixes to E-notation constants:</p>
<div class="sourceCode" id="cb236"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb236-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb236-1" aria-hidden="true" tabindex="-1"></a><span class="fl">1.2345e10</span><span class="bu">F</span></span>
<span id="cb236-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb236-2" aria-hidden="true" tabindex="-1"></a><span class="fl">1.2345e10</span><span class="bu">L</span></span></code></pre></div></li>
</ul>
<p></p>
<h4 data-number="14.5.3.2" id="hexadecimal-floating-point-constants"><span class="header-section-number">14.5.3.2</span> Hexadecimal Floating Point Constants</h4>
<p></p>
<p>But wait, there’s more floating to be done!</p>
<p>Turns out there are hexadecimal floating point constants, as well!</p>
<p>These work similar to decimal floating point numbers, but they begin with a <code>0x</code> just like integer numbers.</p>
<p>The catch is that you <em>must</em> specify an exponent, and this exponent produces a power of 2. That is: <span class="math inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="30" style="font-size: 101.6%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-msup><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn><mjx-script style="vertical-align: 0.363em;"><mjx-mi class="mjx-i" size="s"><mjx-c class="mjx-c1D465 TEX-I"></mjx-c></mjx-mi></mjx-script></mjx-msup></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mn>2</mn><mi>x</mi></msup></math></mjx-assistive-mml></mjx-container></span>.</p>
<p>And then you use a <code>p</code> instead of an <code>e</code> when writing the number:</p>
<p>So <code>0xa.1p3</code> is <span class="math inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="31" style="font-size: 101.6%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c2E"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c36"></mjx-c><mjx-c class="mjx-c32"></mjx-c><mjx-c class="mjx-c35"></mjx-c></mjx-mn><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-cD7"></mjx-c></mjx-mo><mjx-msup space="3"><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn><mjx-script style="vertical-align: 0.363em;"><mjx-mn class="mjx-n" size="s"><mjx-c class="mjx-c33"></mjx-c></mjx-mn></mjx-script></mjx-msup><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c38"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c2E"></mjx-c><mjx-c class="mjx-c35"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>10.0625</mn><mo>×</mo><msup><mn>2</mn><mn>3</mn></msup><mo>==</mo><mn>80.5</mn></math></mjx-assistive-mml></mjx-container></span>.</p>
<p>When using floating point hex constants, We can print hex scientific notation with <code>%a</code>:</p>
<div class="sourceCode" id="cb237"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb237-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb237-1" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> x <span class="op">=</span> <span class="fl">0xa.1p3</span><span class="op">;</span></span>
<span id="cb237-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb237-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb237-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb237-3" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">%a\n</span><span class="st">"</span><span class="op">,</span> x<span class="op">);</span>  <span class="co">// 0x1.42p+6</span></span>
<span id="cb237-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb237-4" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">%f\n</span><span class="st">"</span><span class="op">,</span> x<span class="op">);</span>  <span class="co">// 80.500000</span></span></code></pre></div>
<p></p>
<!-- Beej's guide to C

# vim: ts=4:sw=4:nosi:et:tw=72
-->
<h1 data-number="15" id="types-iii-conversions"><span class="header-section-number">15</span> Types III: Conversions</h1>
<p></p>
<p>In this chapter, we want to talk all about converting from one type to another. C has a variety of ways of doing this, and some might be a little different that you’re used to in other languages.</p>
<p>Before we talk about how to make conversions happen, let’s talk about how they work when they <em>do</em> happen.</p>
<h2 data-number="15.1" id="string-conversions"><span class="header-section-number">15.1</span> String Conversions</h2>
<p></p>
<p>Unlike many languages, C doesn’t do string-to-number (and vice-versa) conversions in quite as streamlined a manner as it does numeric conversions.</p>
<p>For these, we’ll have to call functions to do the dirty work.</p>
<h3 data-number="15.1.1" id="numeric-value-to-string"><span class="header-section-number">15.1.1</span> Numeric Value to String</h3>
<p>When we want to convert a number to a string, we can use either <code>sprintf()</code> (pronounced <em>SPRINT-f</em>) or <code>snprintf()</code> (<em>s-n-print-f</em>)<a href="https://beej.us/guide/bgc/html/index-wide.html#fn105" class="footnote-ref" id="fnref105" role="doc-noteref"><sup>105</sup></a></p>
<p>These basically work like <code>printf()</code>, except they output to a string instead, and you can print that string later, or whatever.</p>
<p>For example, turning part of the value π into a string:</p>
<div class="sourceCode" id="cb238"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb238-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb238-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb238-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb238-2"></a></span>
<span id="cb238-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb238-3"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb238-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb238-4"></a><span class="op">{</span></span>
<span id="cb238-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb238-5"></a>    <span class="dt">char</span> s<span class="op">[</span><span class="dv">10</span><span class="op">];</span></span>
<span id="cb238-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb238-6"></a>    <span class="dt">float</span> f <span class="op">=</span> <span class="fl">3.14159</span><span class="op">;</span></span>
<span id="cb238-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb238-7"></a></span>
<span id="cb238-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb238-8"></a>    <span class="co">// Convert "f" to string, storing in "s", writing at most 10 characters</span></span>
<span id="cb238-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb238-9"></a>    <span class="co">// including the NUL terminator</span></span>
<span id="cb238-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb238-10"></a></span>
<span id="cb238-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb238-11"></a>    snprintf<span class="op">(</span>s<span class="op">,</span> <span class="dv">10</span><span class="op">,</span> <span class="st">"</span><span class="sc">%f</span><span class="st">"</span><span class="op">,</span> f<span class="op">);</span></span>
<span id="cb238-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb238-12"></a></span>
<span id="cb238-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb238-13"></a>    printf<span class="op">(</span><span class="st">"String value: </span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> s<span class="op">);</span>  <span class="co">// String value: 3.141590</span></span>
<span id="cb238-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb238-14"></a><span class="op">}</span></span></code></pre></div>
<p>So you can use <code>%d</code> or <code>%u</code> like you’re used to for integers.</p>
<h3 data-number="15.1.2" id="string-to-numeric-value"><span class="header-section-number">15.1.2</span> String to Numeric Value</h3>
<p>There are a couple families of functions to do this in C. We’ll call these the <code>atoi</code> (pronounced <em>a-to-i</em>) family and the <code>strtol</code> (<em>stir-to-long</em>) family.</p>
<p>For basic conversion from a string to a number, try the <code>atoi</code> functions from <code>&lt;stdlib.h&gt;</code>. These have bad error-handling characteristics (including undefined behavior if you pass in a bad string), so use them carefully.</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Function</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>atoi</code></td>
<td style="text-align: left;">String to <code>int</code></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>atof</code></td>
<td style="text-align: left;">String to <code>float</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>atol</code></td>
<td style="text-align: left;">String to <code>long int</code></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>atoll</code></td>
<td style="text-align: left;">String to <code>long long int</code></td>
</tr>
</tbody>
</table>
<p>Though the spec doesn’t cop to it, the <code>a</code> at the beginning of the function stands for <a href="https://en.wikipedia.org/wiki/ASCII">ASCII</a><a href="https://beej.us/guide/bgc/html/index-wide.html#fn106" class="footnote-ref" id="fnref106" role="doc-noteref"><sup>106</sup></a>, so really <code>atoi()</code> is “ASCII-to-integer”, but saying so today is a bit ASCII-centric.</p>
<p>Here’s an example converting a string to a <code>float</code>:</p>
<div class="sourceCode" id="cb239"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb239-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb239-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb239-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb239-2"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb239-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb239-3"></a></span>
<span id="cb239-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb239-4"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb239-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb239-5"></a><span class="op">{</span></span>
<span id="cb239-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb239-6"></a>    <span class="dt">char</span> <span class="op">*</span>pi <span class="op">=</span> <span class="st">"3.14159"</span><span class="op">;</span></span>
<span id="cb239-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb239-7"></a>    <span class="dt">float</span> f<span class="op">;</span></span>
<span id="cb239-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb239-8"></a></span>
<span id="cb239-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb239-9"></a>    f <span class="op">=</span> atof<span class="op">(</span>pi<span class="op">);</span></span>
<span id="cb239-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb239-10"></a></span>
<span id="cb239-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb239-11"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%f\n</span><span class="st">"</span><span class="op">,</span> f<span class="op">);</span></span>
<span id="cb239-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb239-12"></a><span class="op">}</span></span></code></pre></div>
<p>But, like I said, we get undefined behavior from weird things like this:</p>
<div class="sourceCode" id="cb240"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb240-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb240-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> x <span class="op">=</span> atoi<span class="op">(</span><span class="st">"what"</span><span class="op">);</span>  <span class="co">// "What" ain't no number I ever heard of</span></span></code></pre></div>
<p>(When I run that, I get <code>0</code> back, but you really shouldn’t count on that in any way. You could get something completely different.)</p>
<p>For better error handling characteristics, let’s check out all those <code>strtol</code> functions, also in <code>&lt;stdlib.h&gt;</code>. Not only that, but they convert to more types and more bases, too!</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Function</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>strtol</code></td>
<td style="text-align: left;">String to <code>long int</code></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>strtoll</code></td>
<td style="text-align: left;">String to <code>long long int</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>strtoul</code></td>
<td style="text-align: left;">String to <code>unsigned long int</code></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>strtoull</code></td>
<td style="text-align: left;">String to <code>unsigned long long int</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>strtof</code></td>
<td style="text-align: left;">String to <code>float</code></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>strtod</code></td>
<td style="text-align: left;">String to <code>double</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>strtold</code></td>
<td style="text-align: left;">String to <code>long double</code></td>
</tr>
</tbody>
</table>
<p>These functions all follow a similar pattern of use, and are a lot of people’s first experience with pointers to pointers! But never fret—it’s easier than it looks.</p>
<p>Let’s do an example where we convert a string to an <code>unsigned long</code>, discarding error information (i.e.&nbsp;information about bad characters in the input string):</p>
<div class="sourceCode" id="cb241"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb241-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb241-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb241-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb241-2"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb241-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb241-3"></a></span>
<span id="cb241-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb241-4"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb241-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb241-5"></a><span class="op">{</span></span>
<span id="cb241-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb241-6"></a>    <span class="dt">char</span> <span class="op">*</span>s <span class="op">=</span> <span class="st">"3490"</span><span class="op">;</span></span>
<span id="cb241-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb241-7"></a></span>
<span id="cb241-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb241-8"></a>    <span class="co">// Convert string s, a number in base 10, to an unsigned long int.</span></span>
<span id="cb241-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb241-9"></a>    <span class="co">// NULL means we don't care to learn about any error information.</span></span>
<span id="cb241-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb241-10"></a></span>
<span id="cb241-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb241-11"></a>    <span class="dt">unsigned</span> <span class="dt">long</span> <span class="dt">int</span> x <span class="op">=</span> strtoul<span class="op">(</span>s<span class="op">,</span> NULL<span class="op">,</span> <span class="dv">10</span><span class="op">);</span></span>
<span id="cb241-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb241-12"></a></span>
<span id="cb241-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb241-13"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%lu\n</span><span class="st">"</span><span class="op">,</span> x<span class="op">);</span>  <span class="co">// 3490</span></span>
<span id="cb241-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb241-14"></a><span class="op">}</span></span></code></pre></div>
<p>Notice a couple things there. Even though we didn’t deign to capture any information about error characters in the string, <code>strtoul()</code> won’t give us undefined behavior; it will just return <code>0</code>.</p>
<p>Also, we specified that this was a decimal (base 10) number.</p>
<p>Does this mean we can convert numbers of different bases? Sure! Let’s do binary!</p>
<div class="sourceCode" id="cb242"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb242-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb242-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb242-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb242-2"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb242-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb242-3"></a></span>
<span id="cb242-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb242-4"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb242-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb242-5"></a><span class="op">{</span></span>
<span id="cb242-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb242-6"></a>    <span class="dt">char</span> <span class="op">*</span>s <span class="op">=</span> <span class="st">"101010"</span><span class="op">;</span>  <span class="co">// What's the meaning of this number?</span></span>
<span id="cb242-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb242-7"></a></span>
<span id="cb242-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb242-8"></a>    <span class="co">// Convert string s, a number in base 2, to an unsigned long int.</span></span>
<span id="cb242-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb242-9"></a></span>
<span id="cb242-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb242-10"></a>    <span class="dt">unsigned</span> <span class="dt">long</span> <span class="dt">int</span> x <span class="op">=</span> strtoul<span class="op">(</span>s<span class="op">,</span> NULL<span class="op">,</span> <span class="dv">2</span><span class="op">);</span></span>
<span id="cb242-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb242-11"></a></span>
<span id="cb242-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb242-12"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%lu\n</span><span class="st">"</span><span class="op">,</span> x<span class="op">);</span>  <span class="co">// 42</span></span>
<span id="cb242-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb242-13"></a><span class="op">}</span></span></code></pre></div>
<p>OK, that’s all fun and games, but what’s with that <code>NULL</code> in there? What’s that for?</p>
<p>That helps us figure out if an error occurred in the processing of the string. It’s a pointer to a pointer to a <code>char</code>, which sounds scary, but isn’t once you wrap your head around it.</p>
<p>Let’s do an example where we feed in a deliberately bad number, and we’ll see how <code>strtol()</code> lets us know where the first invalid digit is.</p>
<div class="sourceCode" id="cb243"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb243-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb243-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb243-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb243-2"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb243-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb243-3"></a></span>
<span id="cb243-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb243-4"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb243-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb243-5"></a><span class="op">{</span></span>
<span id="cb243-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb243-6"></a>    <span class="dt">char</span> <span class="op">*</span>s <span class="op">=</span> <span class="st">"34x90"</span><span class="op">;</span>  <span class="co">// "x" is not a valid digit in base 10!</span></span>
<span id="cb243-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb243-7"></a>    <span class="dt">char</span> <span class="op">*</span>badchar<span class="op">;</span></span>
<span id="cb243-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb243-8"></a></span>
<span id="cb243-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb243-9"></a>    <span class="co">// Convert string s, a number in base 10, to an unsigned long int.</span></span>
<span id="cb243-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb243-10"></a></span>
<span id="cb243-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb243-11"></a>    <span class="dt">unsigned</span> <span class="dt">long</span> <span class="dt">int</span> x <span class="op">=</span> strtoul<span class="op">(</span>s<span class="op">,</span> <span class="op">&amp;</span>badchar<span class="op">,</span> <span class="dv">10</span><span class="op">);</span></span>
<span id="cb243-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb243-12"></a></span>
<span id="cb243-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb243-13"></a>    <span class="co">// It tries to convert as much as possible, so gets this far:</span></span>
<span id="cb243-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb243-14"></a></span>
<span id="cb243-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb243-15"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%lu\n</span><span class="st">"</span><span class="op">,</span> x<span class="op">);</span>  <span class="co">// 34</span></span>
<span id="cb243-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb243-16"></a></span>
<span id="cb243-17"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb243-17"></a>    <span class="co">// But we can see the offending bad character because badchar</span></span>
<span id="cb243-18"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb243-18"></a>    <span class="co">// points to it!</span></span>
<span id="cb243-19"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb243-19"></a></span>
<span id="cb243-20"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb243-20"></a>    printf<span class="op">(</span><span class="st">"Invalid character: </span><span class="sc">%c\n</span><span class="st">"</span><span class="op">,</span> <span class="op">*</span>badchar<span class="op">);</span>  <span class="co">// "x"</span></span>
<span id="cb243-21"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb243-21"></a><span class="op">}</span></span></code></pre></div>
<p>So there we have <code>strtoul()</code> modifying what <code>badchar</code> points to in order to show us where things went wrong<a href="https://beej.us/guide/bgc/html/index-wide.html#fn107" class="footnote-ref" id="fnref107" role="doc-noteref"><sup>107</sup></a>.</p>
<p>But what if nothing goes wrong? In that case, <code>badchar</code> will point to the <code>NUL</code> terminator at the end of the string. So we can test for it:</p>
<div class="sourceCode" id="cb244"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb244-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb244-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb244-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb244-2"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb244-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb244-3"></a></span>
<span id="cb244-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb244-4"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb244-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb244-5"></a><span class="op">{</span></span>
<span id="cb244-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb244-6"></a>    <span class="dt">char</span> <span class="op">*</span>s <span class="op">=</span> <span class="st">"3490"</span><span class="op">;</span>  <span class="co">// "x" is not a valid digit in base 10!</span></span>
<span id="cb244-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb244-7"></a>    <span class="dt">char</span> <span class="op">*</span>badchar<span class="op">;</span></span>
<span id="cb244-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb244-8"></a></span>
<span id="cb244-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb244-9"></a>    <span class="co">// Convert string s, a number in base 10, to an unsigned long int.</span></span>
<span id="cb244-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb244-10"></a></span>
<span id="cb244-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb244-11"></a>    <span class="dt">unsigned</span> <span class="dt">long</span> <span class="dt">int</span> x <span class="op">=</span> strtoul<span class="op">(</span>s<span class="op">,</span> <span class="op">&amp;</span>badchar<span class="op">,</span> <span class="dv">10</span><span class="op">);</span></span>
<span id="cb244-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb244-12"></a></span>
<span id="cb244-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb244-13"></a>    <span class="co">// Check if things went well</span></span>
<span id="cb244-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb244-14"></a></span>
<span id="cb244-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb244-15"></a>    <span class="cf">if</span> <span class="op">(*</span>badchar <span class="op">==</span> <span class="ch">'</span><span class="sc">\0</span><span class="ch">'</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb244-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb244-16"></a>        printf<span class="op">(</span><span class="st">"Success! </span><span class="sc">%lu\n</span><span class="st">"</span><span class="op">,</span> x<span class="op">);</span></span>
<span id="cb244-17"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb244-17"></a>    <span class="op">}</span> <span class="cf">else</span>  <span class="op">{</span></span>
<span id="cb244-18"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb244-18"></a>        printf<span class="op">(</span><span class="st">"Partial conversion: </span><span class="sc">%lu\n</span><span class="st">"</span><span class="op">,</span> x<span class="op">);</span></span>
<span id="cb244-19"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb244-19"></a>        printf<span class="op">(</span><span class="st">"Invalid character: </span><span class="sc">%c\n</span><span class="st">"</span><span class="op">,</span> <span class="op">*</span>badchar<span class="op">);</span></span>
<span id="cb244-20"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb244-20"></a>    <span class="op">}</span></span>
<span id="cb244-21"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb244-21"></a><span class="op">}</span></span></code></pre></div>
<p>So there you have it. The <code>atoi()</code>-style functions are good in a controlled pinch, but the <code>strtol()</code>-style functions give you far more control over error handling and the base of the input.</p>
<p></p>
<h2 data-number="15.2" id="char-conversions"><span class="header-section-number">15.2</span> <code>char</code> Conversions</h2>
<p></p>
<p>What if you have a single character with a digit in it, like <code>'5'</code>… Is that the same as the value <code>5</code>?</p>
<p>Let’s try it and see.</p>
<div class="sourceCode" id="cb245"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb245-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb245-1" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">%d</span><span class="st"> </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> <span class="dv">5</span><span class="op">,</span> <span class="ch">'5'</span><span class="op">);</span></span></code></pre></div>
<p>On my UTF-8 system, this prints:</p>
<div class="sourceCode" id="cb246"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb246-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb246-1" aria-hidden="true" tabindex="-1"></a>5 53</span></code></pre></div>
<p>So… no. And 53? What is that? That’s the UTF-8 (and ASCII) code point for the character symbol <code>'5'</code><a href="https://beej.us/guide/bgc/html/index-wide.html#fn108" class="footnote-ref" id="fnref108" role="doc-noteref"><sup>108</sup></a></p>
<p>So how do we convert the character <code>'5'</code> (which apparently has value 53) into the value <code>5</code>?</p>
<p>With one clever trick, that’s how!</p>
<p>The C Standard guarantees that these character will have code points that are in sequence and in this order:</p>
<div class="sourceCode" id="cb247"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb247-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb247-1" aria-hidden="true" tabindex="-1"></a>0  1  2  3  4  5  6  7  8  9</span></code></pre></div>
<p>Ponder for a second–how can we use that? Spoilers ahead…</p>
<p>Let’s take a look at the characters and their code points in UTF-8:</p>
<div class="sourceCode" id="cb248"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb248-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb248-1" aria-hidden="true" tabindex="-1"></a>0  1  2  3  4  5  6  7  8  9</span>
<span id="cb248-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb248-2" aria-hidden="true" tabindex="-1"></a>48 49 50 51 52 53 54 55 56 57</span></code></pre></div>
<p>You see there that <code>'5'</code> is <code>53</code>, just like we were getting. And <code>'0'</code> is <code>48</code>.</p>
<p>So we can subtract <code>'0'</code> from any digit character to get its numeric value:</p>
<div class="sourceCode" id="cb249"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb249-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb249-1" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span> c <span class="op">=</span> <span class="ch">'6'</span><span class="op">;</span></span>
<span id="cb249-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb249-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb249-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb249-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> x <span class="op">=</span> c<span class="op">;</span>  <span class="co">// x has value 54, the code point for '6'</span></span>
<span id="cb249-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb249-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb249-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb249-5" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> y <span class="op">=</span> c <span class="op">-</span> <span class="ch">'0'</span><span class="op">;</span> <span class="co">// y has value 6, just like we want</span></span></code></pre></div>
<p>And we can convert the other way, too, just by adding the value on.</p>
<div class="sourceCode" id="cb250"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb250-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb250-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> x <span class="op">=</span> <span class="dv">6</span><span class="op">;</span></span>
<span id="cb250-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb250-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb250-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb250-3" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span> c <span class="op">=</span> x <span class="op">+</span> <span class="ch">'0'</span><span class="op">;</span>  <span class="co">// c has value 54</span></span>
<span id="cb250-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb250-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb250-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb250-5" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> c<span class="op">);</span>  <span class="co">// prints 54</span></span>
<span id="cb250-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb250-6" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">%c\n</span><span class="st">"</span><span class="op">,</span> c<span class="op">);</span>  <span class="co">// prints 6 with %c</span></span></code></pre></div>
<p>You might think this is a weird way to do this conversion, and by today’s standards, it certainly is. But back in the olden days when computers were made literally out of wood, this was the method for doing this conversion. And it wasn’t broke, so C never fixed it.</p>
<p></p>
<h2 data-number="15.3" id="numeric-conversions"><span class="header-section-number">15.3</span> Numeric Conversions</h2>
<p></p>
<h3 data-number="15.3.1" id="boolean"><span class="header-section-number">15.3.1</span> Boolean</h3>
<p></p>
<p>If you convert a zero to <code>bool</code>, the result is <code>0</code>. Otherwise it’s <code>1</code>.</p>
<h3 data-number="15.3.2" id="integer-to-integer-conversions"><span class="header-section-number">15.3.2</span> Integer to Integer Conversions</h3>
<p></p>
<p>If an integer type is converted to unsigned and doesn’t fit in it, the unsigned result wraps around odometer-style until it fits in the unsigned<a href="https://beej.us/guide/bgc/html/index-wide.html#fn109" class="footnote-ref" id="fnref109" role="doc-noteref"><sup>109</sup></a>.</p>
<p>If an integer type is converted to a signed number and doesn’t fit, the result is implementation-defined! Something documented will happen, but you’ll have to look it up<a href="https://beej.us/guide/bgc/html/index-wide.html#fn110" class="footnote-ref" id="fnref110" role="doc-noteref"><sup>110</sup></a></p>
<h3 data-number="15.3.3" id="integer-and-floating-point-conversions"><span class="header-section-number">15.3.3</span> Integer and Floating Point Conversions</h3>
<p></p>
<p>If a floating point type is converted to an integer type, the fractional part is discarded with prejudice<a href="https://beej.us/guide/bgc/html/index-wide.html#fn111" class="footnote-ref" id="fnref111" role="doc-noteref"><sup>111</sup></a>.</p>
<p>But—and here’s the catch—if the number is too large to fit in the integer, you get undefined behavior. So don’t do that.</p>
<p>Going From integer or floating point to floating point, C makes a best effort to find the closest floating point number to the integer that it can.</p>
<p>Again, though, if the original value can’t be represented, it’s undefined behavior.</p>
<p> </p>
<h2 data-number="15.4" id="implicit-conversions"><span class="header-section-number">15.4</span> Implicit Conversions</h2>
<p></p>
<p>These are conversions the compiler does automatically for you when you mix and match types.</p>
<h3 data-number="15.4.1" id="integer-promotions"><span class="header-section-number">15.4.1</span> The Integer Promotions</h3>
<p>In a number of places, if an <code>int</code> can be used to represent a value from <code>char</code> or <code>short</code> (signed or unsigned), that value is <em>promoted</em> up to <code>int</code>. If it doesn’t fit in an <code>int</code>, it’s promoted to <code>unsigned int</code>.</p>
<p>This is how we can do something like this:</p>
<div class="sourceCode" id="cb251"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb251-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb251-1" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span> x <span class="op">=</span> <span class="dv">10</span><span class="op">,</span> y <span class="op">=</span> <span class="dv">20</span><span class="op">;</span></span>
<span id="cb251-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb251-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> i <span class="op">=</span> x <span class="op">+</span> y<span class="op">;</span></span></code></pre></div>
<p>In that case, <code>x</code> and <code>y</code> get promoted to <code>int</code> by C before the math takes place.</p>
<p>The integer promotions take place during The Usual Arithmetic Conversions, with variadic functions<a href="https://beej.us/guide/bgc/html/index-wide.html#fn112" class="footnote-ref" id="fnref112" role="doc-noteref"><sup>112</sup></a>, unary <code>+</code> and <code>-</code> operators, or when passing values to functions without prototypes<a href="https://beej.us/guide/bgc/html/index-wide.html#fn113" class="footnote-ref" id="fnref113" role="doc-noteref"><sup>113</sup></a>.</p>
<h3 data-number="15.4.2" id="usual-arithmetic-conversions"><span class="header-section-number">15.4.2</span> The Usual Arithmetic Conversions</h3>
<p>These are automatic conversions that C does around numeric operations that you ask for. (That’s actually what they’re called, by the way, by C11 §6.3.1.8.) Note that for this section, we’re just talking about numeric types—strings will come later.</p>
<p>These conversions answer questions about what happens when you mix types, like this:</p>
<div class="sourceCode" id="cb252"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb252-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb252-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> x <span class="op">=</span> <span class="dv">3</span> <span class="op">+</span> <span class="fl">1.2</span><span class="op">;</span>   <span class="co">// Mixing int and double</span></span>
<span id="cb252-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb252-2" aria-hidden="true" tabindex="-1"></a>                   <span class="co">// 4.2 is converted to int</span></span>
<span id="cb252-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb252-3" aria-hidden="true" tabindex="-1"></a>                   <span class="co">// 4 is stored in x</span></span>
<span id="cb252-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb252-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb252-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb252-5" aria-hidden="true" tabindex="-1"></a><span class="dt">float</span> y <span class="op">=</span> <span class="dv">12</span> <span class="op">*</span> <span class="dv">2</span><span class="op">;</span>  <span class="co">// Mixing float and int</span></span>
<span id="cb252-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb252-6" aria-hidden="true" tabindex="-1"></a>                   <span class="co">// 24 is converted to float</span></span>
<span id="cb252-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb252-7" aria-hidden="true" tabindex="-1"></a>                   <span class="co">// 24.0 is stored in y</span></span></code></pre></div>
<p>Do they become <code>int</code>s? Do they become <code>float</code>s? How does it work?</p>
<p>Here are the steps, paraphrased for easy consumption.</p>
<ol type="1">
<li><p>If one thing in the expression is a floating type, convert the other things to that floating type.</p></li>
<li><p>Otherwise, if both types are integer types, perform the integer promotions on each, then make the operand types as big as they need to be hold the common largest value. Sometimes this involves changing signed to unsigned.</p></li>
</ol>
<p>If you want to know the gritty details, check out C11 §6.3.1.8. But you probably don’t.</p>
<p>Just generally remember that int types become float types if there’s a floating point type anywhere in there, and the compiler makes an effort to make sure mixed integer types don’t overflow.</p>
<p>Finally, if you convert from one floating point type to another, the compiler will try to make an exact conversion. If it can’t, it’ll do the best approximation it can. If the number is too large to fit in the type you’re converting into, <em>boom</em>: undefined behavior!</p>
<h3 data-number="15.4.3" id="void"><span class="header-section-number">15.4.3</span> <code>void*</code></h3>
<p>The <code>void*</code> type is interesting because it can be converted from or to any pointer type.</p>
<div class="sourceCode" id="cb253"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb253-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb253-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> x <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb253-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb253-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb253-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb253-3" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="op">*</span>p <span class="op">=</span> <span class="op">&amp;</span>x<span class="op">;</span>  <span class="co">// &amp;x is type int*, but we store it in a void*</span></span>
<span id="cb253-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb253-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb253-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb253-5" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> <span class="op">*</span>q <span class="op">=</span> p<span class="op">;</span>    <span class="co">// p is void*, but we store it in an int*</span></span></code></pre></div>
<p></p>
<h2 data-number="15.5" id="explicit-conversions"><span class="header-section-number">15.5</span> Explicit Conversions</h2>
<p></p>
<p>These are conversions from type to type that you have to ask for; the compiler won’t do it for you.</p>
<p>You can convert from one type to another by assigning one type to another with an <code>=</code>.</p>
<p>You can also convert explicitly with a <em>cast</em>.</p>
<p></p>
<h3 data-number="15.5.1" id="casting"><span class="header-section-number">15.5.1</span> Casting</h3>
<p></p>
<p>You can explicitly change the type of an expression by putting a new type in parentheses in front of it. Some C devs frown on the practice unless absolutely necessary, but it’s likely you’ll come across some C code with these in it.</p>
<p>Let’s do an example where we want to convert an <code>int</code> into a <code>long</code> so that we can store it in a <code>long</code>.</p>
<p>Note: this example is contrived and the cast in this case is completely unnecessary because the <code>x + 12</code> expression would automatically be changed to <code>long int</code> to match the wider type of <code>y</code>.</p>
<div class="sourceCode" id="cb254"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb254-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb254-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> x <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb254-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb254-2" aria-hidden="true" tabindex="-1"></a><span class="dt">long</span> <span class="dt">int</span> y <span class="op">=</span> <span class="op">(</span><span class="dt">long</span> <span class="dt">int</span><span class="op">)</span>x <span class="op">+</span> <span class="dv">12</span><span class="op">;</span></span></code></pre></div>
<p>In that example, even those <code>x</code> was type <code>int</code> before, the expression <code>(long int)x</code> has type <code>long int</code>. We say, “We cast <code>x</code> to <code>long int</code>.”</p>
<p>More commonly, you might see a cast being used to convert a <code>void*</code> into a specific pointer type so it can be dereferenced.</p>
<p>A callback from the built-in <code>qsort()</code> function might display this behavior since it has <code>void*</code>s passed into it:</p>
<div class="sourceCode" id="cb255"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb255-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb255-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> compar<span class="op">(</span><span class="dt">const</span> <span class="dt">void</span> <span class="op">*</span>elem1<span class="op">,</span> <span class="dt">const</span> <span class="dt">void</span> <span class="op">*</span>elem2<span class="op">)</span></span>
<span id="cb255-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb255-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb255-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb255-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(*((</span><span class="dt">const</span> <span class="dt">int</span><span class="op">*)</span>elem2<span class="op">)</span> <span class="op">&gt;</span> <span class="op">*((</span><span class="dt">const</span> <span class="dt">int</span><span class="op">*)</span>elem1<span class="op">))</span> <span class="cf">return</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb255-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb255-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(*((</span><span class="dt">const</span> <span class="dt">int</span><span class="op">*)</span>elem2<span class="op">)</span> <span class="op">&lt;</span> <span class="op">*((</span><span class="dt">const</span> <span class="dt">int</span><span class="op">*)</span>elem1<span class="op">))</span> <span class="cf">return</span> <span class="op">-</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb255-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb255-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb255-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb255-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>But you could also clearly write it with an assignment:</p>
<div class="sourceCode" id="cb256"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb256-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb256-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> compar<span class="op">(</span><span class="dt">const</span> <span class="dt">void</span> <span class="op">*</span>elem1<span class="op">,</span> <span class="dt">const</span> <span class="dt">void</span> <span class="op">*</span>elem2<span class="op">)</span></span>
<span id="cb256-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb256-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb256-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb256-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">const</span> <span class="dt">int</span> <span class="op">*</span>e1 <span class="op">=</span> elem1<span class="op">;</span></span>
<span id="cb256-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb256-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">const</span> <span class="dt">int</span> <span class="op">*</span>e2 <span class="op">=</span> elem2<span class="op">;</span></span>
<span id="cb256-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb256-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb256-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb256-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">*</span>e2 <span class="op">-</span> <span class="op">*</span>e1<span class="op">;</span></span>
<span id="cb256-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb256-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>One place you’ll see casts more commonly is to avoid a warning when printing pointer values with the rarely-used <code>%p</code> which gets picky with anything other than a <code>void*</code>:</p>
<div class="sourceCode" id="cb257"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb257-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb257-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> x <span class="op">=</span> <span class="dv">3490</span><span class="op">;</span></span>
<span id="cb257-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb257-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> <span class="op">*</span>p <span class="op">=</span> <span class="op">&amp;</span>x<span class="op">;</span></span>
<span id="cb257-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb257-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb257-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb257-4" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">%p\n</span><span class="st">"</span><span class="op">,</span> p<span class="op">);</span></span></code></pre></div>
<p>generates this warning:</p>
<div class="sourceCode" id="cb258"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb258-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb258-1" aria-hidden="true" tabindex="-1"></a>warning: format ‘%p’ expects argument of type ‘void *’, but argument</span>
<span id="cb258-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb258-2" aria-hidden="true" tabindex="-1"></a>         2 has type ‘int *’</span></code></pre></div>
<p>You can fix it with a cast:</p>
<div class="sourceCode" id="cb259"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb259-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb259-1" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">%p\n</span><span class="st">"</span><span class="op">,</span> <span class="op">(</span><span class="dt">void</span> <span class="op">*)</span>p<span class="op">);</span></span></code></pre></div>
<p>Another place is with explicit pointer changes, if you don’t want to use an intervening <code>void*</code>, but these are also pretty uncommon:</p>
<div class="sourceCode" id="cb260"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb260-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb260-1" aria-hidden="true" tabindex="-1"></a><span class="dt">long</span> x <span class="op">=</span> <span class="dv">3490</span><span class="op">;</span></span>
<span id="cb260-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb260-2" aria-hidden="true" tabindex="-1"></a><span class="dt">long</span> <span class="op">*</span>p <span class="op">=</span> <span class="op">&amp;</span>x<span class="op">;</span></span>
<span id="cb260-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb260-3" aria-hidden="true" tabindex="-1"></a><span class="dt">unsigned</span> <span class="dt">char</span> <span class="op">*</span>c <span class="op">=</span> <span class="op">(</span><span class="dt">unsigned</span> <span class="dt">char</span> <span class="op">*)</span>p<span class="op">;</span></span></code></pre></div>
<p>A third place it’s often required is with the character conversion functions in <a href="https://beej.us/guide/bgclr/html/split/ctype.html"><code>&lt;ctype.h&gt;</code></a><a href="https://beej.us/guide/bgc/html/index-wide.html#fn114" class="footnote-ref" id="fnref114" role="doc-noteref"><sup>114</sup></a> where you should cast questionably-signed values to <code>unsigned char</code> to avoid undefined behavior.</p>
<p>Again, casting is rarely <em>needed</em> in practice. If you find yourself casting, there might be another way to do the same thing, or maybe you’re casting unnecessarily.</p>
<p>Or maybe it is necessary. Personally, I try to avoid it, but am not afraid to use it if I have to.</p>
<p> </p>
<!-- Beej's guide to C

# vim: ts=4:sw=4:nosi:et:tw=72
-->
<h1 data-number="16" id="types-iv-qualifiers-and-specifiers"><span class="header-section-number">16</span> Types IV: Qualifiers and Specifiers</h1>
<p>Now that we have some more types under our belts, turns out we can give these types some additional attributes that control their behavior. These are the <em>type qualifiers</em> and <em>storage-class specifiers</em>.</p>
<h2 data-number="16.1" id="type-qualifiers"><span class="header-section-number">16.1</span> Type Qualifiers</h2>
<p></p>
<p>These are going to allow you to declare constant values, and also to give the compiler optimization hints that it can use.</p>
<h3 data-number="16.1.1" id="const"><span class="header-section-number">16.1.1</span> <code>const</code></h3>
<p></p>
<p>This is the most common type qualifier you’ll see. It means the variable is constant, and any attempt to modify it will result in a very angry compiler.</p>
<div class="sourceCode" id="cb261"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb261-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb261-1" aria-hidden="true" tabindex="-1"></a><span class="dt">const</span> <span class="dt">int</span> x <span class="op">=</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb261-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb261-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb261-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb261-3" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> <span class="dv">4</span><span class="op">;</span>  <span class="co">// COMPILER PUKING SOUNDS, can't assign to a constant</span></span></code></pre></div>
<p>You can’t change a <code>const</code> value.</p>
<p>Often you see <code>const</code> in parameter lists for functions:</p>
<div class="sourceCode" id="cb262"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb262-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb262-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> foo<span class="op">(</span><span class="dt">const</span> <span class="dt">int</span> x<span class="op">)</span></span>
<span id="cb262-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb262-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb262-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb262-3" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> x <span class="op">+</span> <span class="dv">30</span><span class="op">);</span>  <span class="co">// OK, doesn't modify "x"</span></span>
<span id="cb262-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb262-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<h4 data-number="16.1.1.1" id="const-and-pointers"><span class="header-section-number">16.1.1.1</span> <code>const</code> and Pointers</h4>
<p></p>
<p>This one gets a little funky, because there are two usages that have two meanings when it comes to pointers.</p>
<p>For one thing, we can make it so you can’t change the thing the pointer points to. You do this by putting the <code>const</code> up front with the type name (before the asterisk) in the type declaration.</p>
<div class="sourceCode" id="cb263"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb263-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb263-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> x<span class="op">[]</span> <span class="op">=</span> <span class="op">{</span><span class="dv">10</span><span class="op">,</span> <span class="dv">20</span><span class="op">};</span></span>
<span id="cb263-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb263-2" aria-hidden="true" tabindex="-1"></a><span class="dt">const</span> <span class="dt">int</span> <span class="op">*</span>p <span class="op">=</span> x<span class="op">;</span> </span>
<span id="cb263-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb263-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb263-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb263-4" aria-hidden="true" tabindex="-1"></a>p<span class="op">++;</span>  <span class="co">// We can modify p, no problem</span></span>
<span id="cb263-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb263-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb263-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb263-6" aria-hidden="true" tabindex="-1"></a><span class="op">*</span>p <span class="op">=</span> <span class="dv">30</span><span class="op">;</span> <span class="co">// Compiler error! Can't change what it points to</span></span></code></pre></div>
<p>Somewhat confusingly, these two things are equivalent:</p>
<div class="sourceCode" id="cb264"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb264-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb264-1" aria-hidden="true" tabindex="-1"></a><span class="dt">const</span> <span class="dt">int</span> <span class="op">*</span>p<span class="op">;</span>  <span class="co">// Can't modify what p points to</span></span>
<span id="cb264-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb264-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> <span class="dt">const</span> <span class="op">*</span>p<span class="op">;</span>  <span class="co">// Can't modify what p points to, just like the previous line</span></span></code></pre></div>
<p>Great, so we can’t change the thing the pointer points to, but we can change the pointer itself. What if we want the other way around? We want to be able to change what the pointer points to, but <em>not</em> the pointer itself?</p>
<p>Just move the <code>const</code> after the asterisk in the declaration:</p>
<div class="sourceCode" id="cb265"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb265-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb265-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> <span class="op">*</span><span class="dt">const</span> p<span class="op">;</span>   <span class="co">// We can't modify "p" with pointer arithmetic</span></span>
<span id="cb265-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb265-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb265-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb265-3" aria-hidden="true" tabindex="-1"></a>p<span class="op">++;</span>  <span class="co">// Compiler error!</span></span></code></pre></div>
<p>But we can modify what they point to:</p>
<div class="sourceCode" id="cb266"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb266-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb266-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> x <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb266-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb266-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> <span class="op">*</span><span class="dt">const</span> p <span class="op">=</span> <span class="op">&amp;</span>x<span class="op">;</span></span>
<span id="cb266-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb266-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb266-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb266-4" aria-hidden="true" tabindex="-1"></a><span class="op">*</span>p <span class="op">=</span> <span class="dv">20</span><span class="op">;</span>   <span class="co">// Set "x" to 20, no problem</span></span></code></pre></div>
<p>You can also do make both things <code>const</code>:</p>
<div class="sourceCode" id="cb267"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb267-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb267-1" aria-hidden="true" tabindex="-1"></a><span class="dt">const</span> <span class="dt">int</span> <span class="op">*</span><span class="dt">const</span> p<span class="op">;</span>  <span class="co">// Can't modify p or *p!</span></span></code></pre></div>
<p>Finally, if you have multiple levels of indirection, you should <code>const</code> the appropriate levels. Just because a pointer is <code>const</code>, doesn’t mean the pointer it points to must also be. You can explicitly set them like in the following examples:</p>
<div class="sourceCode" id="cb268"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb268-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb268-1" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span> <span class="op">**</span>p<span class="op">;</span></span>
<span id="cb268-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb268-2" aria-hidden="true" tabindex="-1"></a>p<span class="op">++;</span>     <span class="co">// OK!</span></span>
<span id="cb268-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb268-3" aria-hidden="true" tabindex="-1"></a><span class="op">(*</span>p<span class="op">)++;</span>  <span class="co">// OK!</span></span>
<span id="cb268-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb268-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb268-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb268-5" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span> <span class="op">**</span><span class="dt">const</span> p<span class="op">;</span></span>
<span id="cb268-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb268-6" aria-hidden="true" tabindex="-1"></a>p<span class="op">++;</span>     <span class="co">// Error!</span></span>
<span id="cb268-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb268-7" aria-hidden="true" tabindex="-1"></a><span class="op">(*</span>p<span class="op">)++;</span>  <span class="co">// OK!</span></span>
<span id="cb268-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb268-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb268-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb268-9" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span> <span class="op">*</span><span class="dt">const</span> <span class="op">*</span>p<span class="op">;</span></span>
<span id="cb268-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb268-10" aria-hidden="true" tabindex="-1"></a>p<span class="op">++;</span>     <span class="co">// OK!</span></span>
<span id="cb268-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb268-11" aria-hidden="true" tabindex="-1"></a><span class="op">(*</span>p<span class="op">)++;</span>  <span class="co">// Error!</span></span>
<span id="cb268-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb268-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb268-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb268-13" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span> <span class="op">*</span><span class="dt">const</span> <span class="op">*</span><span class="dt">const</span> p<span class="op">;</span></span>
<span id="cb268-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb268-14" aria-hidden="true" tabindex="-1"></a>p<span class="op">++;</span>     <span class="co">// Error!</span></span>
<span id="cb268-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb268-15" aria-hidden="true" tabindex="-1"></a><span class="op">(*</span>p<span class="op">)++;</span>  <span class="co">// Error!</span></span></code></pre></div>
<p></p>
<h4 data-number="16.1.1.2" id="const-correctness"><span class="header-section-number">16.1.1.2</span> <code>const</code> Correctness</h4>
<p></p>
<p>One more thing I have to mention is that the compiler will warn on something like this:</p>
<div class="sourceCode" id="cb269"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb269-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb269-1" aria-hidden="true" tabindex="-1"></a><span class="dt">const</span> <span class="dt">int</span> x <span class="op">=</span> <span class="dv">20</span><span class="op">;</span></span>
<span id="cb269-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb269-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> <span class="op">*</span>p <span class="op">=</span> <span class="op">&amp;</span>x<span class="op">;</span></span></code></pre></div>
<p>saying something to the effect of:</p>
<div class="sourceCode" id="cb270"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb270-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb270-1" aria-hidden="true" tabindex="-1"></a>initialization discards 'const' qualifier from pointer type target</span></code></pre></div>
<p>What’s happening there?</p>
<p>Well, we need to look at the types on either side of the assignment:</p>
<div class="sourceCode" id="cb271"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb271-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb271-1" aria-hidden="true" tabindex="-1"></a>    <span class="dt">const</span> <span class="dt">int</span> x <span class="op">=</span> <span class="dv">20</span><span class="op">;</span></span>
<span id="cb271-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb271-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> <span class="op">*</span>p <span class="op">=</span> <span class="op">&amp;</span>x<span class="op">;</span></span>
<span id="cb271-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb271-3" aria-hidden="true" tabindex="-1"></a><span class="co">//    ^       ^</span></span>
<span id="cb271-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb271-4" aria-hidden="true" tabindex="-1"></a><span class="co">//    |       |</span></span>
<span id="cb271-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb271-5" aria-hidden="true" tabindex="-1"></a><span class="co">//  int*    const int*</span></span></code></pre></div>
<p>The compiler is warning us that the value on the right side of the assignment is <code>const</code>, but the one of the left is not. And the compiler is letting us know that it is discarding the “const-ness” of the expression on the right.</p>
<p>That is, we <em>can</em> still try to do the following, but it’s just wrong. The compiler will warn, and it’s undefined behavior:</p>
<div class="sourceCode" id="cb272"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb272-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb272-1" aria-hidden="true" tabindex="-1"></a><span class="dt">const</span> <span class="dt">int</span> x <span class="op">=</span> <span class="dv">20</span><span class="op">;</span></span>
<span id="cb272-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb272-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> <span class="op">*</span>p <span class="op">=</span> <span class="op">&amp;</span>x<span class="op">;</span></span>
<span id="cb272-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb272-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb272-4" aria-hidden="true" tabindex="-1"></a><span class="op">*</span>p <span class="op">=</span> <span class="dv">40</span><span class="op">;</span>  <span class="co">// Undefined behavior--maybe it modifies "x", maybe not!</span></span>
<span id="cb272-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb272-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb272-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb272-6" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> x<span class="op">);</span>  <span class="co">// 40, if you're lucky</span></span></code></pre></div>
<p> </p>
<h3 data-number="16.1.2" id="restrict"><span class="header-section-number">16.1.2</span> <code>restrict</code></h3>
<p></p>
<p>TLDR: you never have to use this and you can ignore it every time you see it. If you use it correctly, you will likely realize some performance gain. If you use it incorrectly, you will realize undefined behavior.</p>
<p><code>restrict</code> is a hint to the compiler that a particular piece of memory will only be accessed by one pointer and never another. (That is, there will be no aliasing of the particular object the <code>restrict</code> pointer points to.) If a developer declares a pointer to be <code>restrict</code> and then accesses the object it points to in another way (e.g.&nbsp;via another pointer), the behavior is undefined.</p>
<p>Basically you’re telling C, “Hey—I guarantee that this one single pointer is the only way I access this memory, and if I’m lying, you can pull undefined behavior on me.”</p>
<p>And C uses that information to perform certain optimizations. For instance, if you’re dereferencing the <code>restrict</code> pointer repeatedly in a loop, C might decide to cache the result in a register and only store the final result once the loop completes. If any other pointer referred to that same memory and accessed it in the loop, the results would not be accurate.</p>
<p>(Note that <code>restrict</code> has no effect if the object pointed to is never written to. It’s all about optimizations surrounding writes to memory.)</p>
<p>Let’s write a function to swap two variables, and we’ll use the <code>restrict</code> keyword to assure C that we’ll never pass in pointers to the same thing. And then let’s blow it and try passing in pointers to the same thing.</p>
<div class="sourceCode" id="cb273"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb273-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb273-1"></a><span class="dt">void</span> swap<span class="op">(</span><span class="dt">int</span> <span class="op">*</span><span class="dt">restrict</span> a<span class="op">,</span> <span class="dt">int</span> <span class="op">*</span><span class="dt">restrict</span> b<span class="op">)</span></span>
<span id="cb273-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb273-2"></a><span class="op">{</span></span>
<span id="cb273-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb273-3"></a>    <span class="dt">int</span> t<span class="op">;</span></span>
<span id="cb273-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb273-4"></a></span>
<span id="cb273-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb273-5"></a>    t <span class="op">=</span> <span class="op">*</span>a<span class="op">;</span></span>
<span id="cb273-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb273-6"></a>    <span class="op">*</span>a <span class="op">=</span> <span class="op">*</span>b<span class="op">;</span></span>
<span id="cb273-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb273-7"></a>    <span class="op">*</span>b <span class="op">=</span> t<span class="op">;</span></span>
<span id="cb273-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb273-8"></a><span class="op">}</span></span>
<span id="cb273-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb273-9"></a></span>
<span id="cb273-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb273-10"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb273-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb273-11"></a><span class="op">{</span></span>
<span id="cb273-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb273-12"></a>    <span class="dt">int</span> x <span class="op">=</span> <span class="dv">10</span><span class="op">,</span> y <span class="op">=</span> <span class="dv">20</span><span class="op">;</span></span>
<span id="cb273-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb273-13"></a></span>
<span id="cb273-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb273-14"></a>    swap<span class="op">(&amp;</span>x<span class="op">,</span> <span class="op">&amp;</span>y<span class="op">);</span>  <span class="co">// OK! "a" and "b", above, point to different things</span></span>
<span id="cb273-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb273-15"></a></span>
<span id="cb273-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb273-16"></a>    swap<span class="op">(&amp;</span>x<span class="op">,</span> <span class="op">&amp;</span>x<span class="op">);</span>  <span class="co">// Undefined behavior! "a" and "b" point to the same thing</span></span>
<span id="cb273-17"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb273-17"></a><span class="op">}</span></span></code></pre></div>
<p>If we were to take out the <code>restrict</code> keywords, above, that would allow both calls to work safely. But then the compiler might not be able to optimize.</p>
<p><code>restrict</code> has block scope, that is, the restriction only lasts for the scope it’s used. If it’s in a parameter list for a function, it’s in the block scope of that function.</p>
<p>If the restricted pointer points to an array, it only applies to the individual objects in the array. Other pointers could read and write from the array as long as they didn’t read or write any of the same elements as the restricted one.</p>
<p>If it’s outside any function in file scope, the restriction covers the entire program.</p>
<p>You’re likely to see this in library functions like <code>printf()</code>:</p>
<div class="sourceCode" id="cb274"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb274-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb274-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> printf<span class="op">(</span><span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span> <span class="dt">restrict</span> format<span class="op">,</span> <span class="op">...);</span></span></code></pre></div>
<p>Again, that’s just telling the compiler that inside the <code>printf()</code> function, there will be only one pointer that refers to any part of that <code>format</code> string.</p>
<p>One last note: if you’re using array notation in your function parameter for some reason instead of pointer notation, you can use <code>restrict</code> like so:</p>
<div class="sourceCode" id="cb275"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb275-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb275-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> foo<span class="op">(</span><span class="dt">int</span> p<span class="op">[</span><span class="dt">restrict</span><span class="op">])</span>     <span class="co">// With no size</span></span>
<span id="cb275-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb275-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb275-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb275-3" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> foo<span class="op">(</span><span class="dt">int</span> p<span class="op">[</span><span class="dt">restrict</span> <span class="dv">10</span><span class="op">])</span>  <span class="co">// Or with a size</span></span></code></pre></div>
<p>But pointer notation would be more common.</p>
<p></p>
<h3 data-number="16.1.3" id="volatile"><span class="header-section-number">16.1.3</span> <code>volatile</code></h3>
<p></p>
<p>You’re unlikely to see or need this unless you’re dealing with hardware directly.</p>
<p><code>volatile</code> tells the compiler that a value might change behind its back and should be looked up every time.</p>
<p>An example might be where the compiler is looking in memory at an address that continuously updates behind the scenes, e.g.&nbsp;some kind of hardware timer.</p>
<p>If the compiler decides to optimize that and store the value in a register for a protracted time, the value in memory will update and won’t be reflected in the register.</p>
<p>By declaring something <code>volatile</code>, you’re telling the compiler, “Hey, the thing this points at might change at any time for reasons outside this program code.”</p>
<div class="sourceCode" id="cb276"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb276-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb276-1" aria-hidden="true" tabindex="-1"></a><span class="dt">volatile</span> <span class="dt">int</span> <span class="op">*</span>p<span class="op">;</span></span></code></pre></div>
<h3 data-number="16.1.4" id="atomic"><span class="header-section-number">16.1.4</span> <code>_Atomic</code></h3>
<p>This is an optional C feature that we’ll talk about in <a href="https://beej.us/guide/bgc/html/index-wide.html#chapter-atomics">the Atomics chapter</a>.</p>
<p> </p>
<h2 data-number="16.2" id="storage-class-specifiers"><span class="header-section-number">16.2</span> Storage-Class Specifiers</h2>
<p></p>
<p>Storage-class specifiers are similar to type quantifiers. They give the compiler more information about the type of a variable.</p>
<h3 data-number="16.2.1" id="auto"><span class="header-section-number">16.2.1</span> <code>auto</code></h3>
<p></p>
<p>You barely ever see this keyword, since <code>auto</code> is the default for block scope variables. It’s implied.</p>
<p>These are the same:</p>
<div class="sourceCode" id="cb277"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb277-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb277-1" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb277-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb277-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> a<span class="op">;</span>         <span class="co">// auto is the default...</span></span>
<span id="cb277-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb277-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">auto</span> <span class="dt">int</span> a<span class="op">;</span>    <span class="co">// So this is redundant</span></span>
<span id="cb277-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb277-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>The <code>auto</code> keyword indicates that this object has <em>automatic storage duration</em>. That is, it exists in the scope in which it is defined, and is automatically deallocated when the scope is exited.</p>
<p>One gotcha about automatic variables is that their value is indeterminate until you explicitly initialize them. We say they’re full of “random” or “garbage” data, though neither of those really makes me happy. In any case, you won’t know what’s in it unless you initialize it.</p>
<p></p>
<p>Always initialize all automatic variables before use!</p>
<h3 data-number="16.2.2" id="static"><span class="header-section-number">16.2.2</span> <code>static</code></h3>
<p></p>
<p>This keyword has two meanings, depending on if the variable is file scope or block scope.</p>
<p>Let’s start with block scope.</p>
<h4 data-number="16.2.2.1" id="static-in-block-scope"><span class="header-section-number">16.2.2.1</span> <code>static</code> in Block Scope</h4>
<p></p>
<p>In this case, we’re basically saying, “I just want a single instance of this variable to exist, shared between calls.”</p>
<p>That is, its value will persist between calls.</p>
<p><code>static</code> in block scope with an initializer will only be initialized one time on program startup, not each time the function is called.</p>
<p>Let’s do an example:</p>
<div class="sourceCode" id="cb278"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb278-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb278-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb278-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb278-2"></a></span>
<span id="cb278-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb278-3"></a><span class="dt">void</span> counter<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb278-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb278-4"></a><span class="op">{</span></span>
<span id="cb278-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb278-5"></a>    <span class="dt">static</span> <span class="dt">int</span> count <span class="op">=</span> <span class="dv">1</span><span class="op">;</span>  <span class="co">// This is initialized one time</span></span>
<span id="cb278-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb278-6"></a></span>
<span id="cb278-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb278-7"></a>    printf<span class="op">(</span><span class="st">"This has been called </span><span class="sc">%d</span><span class="st"> time(s)</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> count<span class="op">);</span></span>
<span id="cb278-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb278-8"></a></span>
<span id="cb278-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb278-9"></a>    count<span class="op">++;</span></span>
<span id="cb278-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb278-10"></a><span class="op">}</span></span>
<span id="cb278-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb278-11"></a></span>
<span id="cb278-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb278-12"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb278-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb278-13"></a><span class="op">{</span></span>
<span id="cb278-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb278-14"></a>    counter<span class="op">();</span>  <span class="co">// "This has been called 1 time(s)"</span></span>
<span id="cb278-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb278-15"></a>    counter<span class="op">();</span>  <span class="co">// "This has been called 2 time(s)"</span></span>
<span id="cb278-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb278-16"></a>    counter<span class="op">();</span>  <span class="co">// "This has been called 3 time(s)"</span></span>
<span id="cb278-17"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb278-17"></a>    counter<span class="op">();</span>  <span class="co">// "This has been called 4 time(s)"</span></span>
<span id="cb278-18"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb278-18"></a><span class="op">}</span></span></code></pre></div>
<p>See how the value of <code>count</code> persists between calls?</p>
<p>One thing of note is that <code>static</code> block scope variables are initialized to <code>0</code> by default.</p>
<div class="sourceCode" id="cb279"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb279-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb279-1" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> <span class="dt">int</span> foo<span class="op">;</span>      <span class="co">// Default starting value is `0`...</span></span>
<span id="cb279-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb279-2" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> <span class="dt">int</span> foo <span class="op">=</span> <span class="dv">0</span><span class="op">;</span>  <span class="co">// So the `0` assignment is redundant</span></span></code></pre></div>
<p>Finally, be advised that if you’re writing multithreaded programs, you have to be sure you don’t let multiple threads trample the same variable.</p>
<p></p>
<h4 data-number="16.2.2.2" id="static-in-file-scope"><span class="header-section-number">16.2.2.2</span> <code>static</code> in File Scope</h4>
<p></p>
<p>When you get out to file scope, outside any blocks, the meaning rather changes.</p>
<p>Variables at file scope already persist between function calls, so that behavior is already there.</p>
<p>Instead what <code>static</code> means in this context is that this variable isn’t visible outside of this particular source file. Kinda like “global”, but only in this file.</p>
<p>More on that in the section about building with multiple source files.</p>
<p> </p>
<h3 data-number="16.2.3" id="extern"><span class="header-section-number">16.2.3</span> <code>extern</code></h3>
<p></p>
<p>The <code>extern</code> storage-class specifier gives us a way to refer to objects in other source files.</p>
<p>Let’s say, for example, the file <code>bar.c</code> had the following as its entirety:</p>
<div class="sourceCode" id="cb280"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb280-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb280-1"></a><span class="co">// bar.c</span></span>
<span id="cb280-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb280-2"></a></span>
<span id="cb280-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb280-3"></a><span class="dt">int</span> a <span class="op">=</span> <span class="dv">37</span><span class="op">;</span></span></code></pre></div>
<p>Just that. Declaring a new <code>int a</code> in file scope.</p>
<p>But what if we had another source file, <code>foo.c</code>, and we wanted to refer to the <code>a</code> that’s in <code>bar.c</code>?</p>
<p>It’s easy with the <code>extern</code> keyword:</p>
<div class="sourceCode" id="cb281"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb281-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb281-1"></a><span class="co">// foo.c</span></span>
<span id="cb281-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb281-2"></a></span>
<span id="cb281-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb281-3"></a><span class="kw">extern</span> <span class="dt">int</span> a<span class="op">;</span></span>
<span id="cb281-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb281-4"></a></span>
<span id="cb281-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb281-5"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb281-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb281-6"></a><span class="op">{</span></span>
<span id="cb281-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb281-7"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> a<span class="op">);</span>  <span class="co">// 37, from bar.c!</span></span>
<span id="cb281-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb281-8"></a></span>
<span id="cb281-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb281-9"></a>    a <span class="op">=</span> <span class="dv">99</span><span class="op">;</span></span>
<span id="cb281-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb281-10"></a></span>
<span id="cb281-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb281-11"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> a<span class="op">);</span>  <span class="co">// Same "a" from bar.c, but it's now 99</span></span>
<span id="cb281-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb281-12"></a><span class="op">}</span></span></code></pre></div>
<p>We could have also made the <code>extern int a</code> in block scope, and it still would have referred to the <code>a</code> in <code>bar.c</code>:</p>
<div class="sourceCode" id="cb282"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb282-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb282-1"></a><span class="co">// foo.c</span></span>
<span id="cb282-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb282-2"></a></span>
<span id="cb282-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb282-3"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb282-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb282-4"></a><span class="op">{</span></span>
<span id="cb282-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb282-5"></a>    <span class="kw">extern</span> <span class="dt">int</span> a<span class="op">;</span></span>
<span id="cb282-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb282-6"></a></span>
<span id="cb282-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb282-7"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> a<span class="op">);</span>  <span class="co">// 37, from bar.c!</span></span>
<span id="cb282-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb282-8"></a></span>
<span id="cb282-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb282-9"></a>    a <span class="op">=</span> <span class="dv">99</span><span class="op">;</span></span>
<span id="cb282-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb282-10"></a></span>
<span id="cb282-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb282-11"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> a<span class="op">);</span>  <span class="co">// Same "a" from bar.c, but it's now 99</span></span>
<span id="cb282-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb282-12"></a><span class="op">}</span></span></code></pre></div>
<p>Now, if <code>a</code> in <code>bar.c</code> had been marked <code>static</code>. this wouldn’t have worked. <code>static</code> variables at file scope are not visible outside that file.</p>
<p>A final note about <code>extern</code> on functions. For functions, <code>extern</code> is the default, so it’s redundant. You can declare a function <code>static</code> if you only want it visible in a single source file.</p>
<p></p>
<h3 data-number="16.2.4" id="register"><span class="header-section-number">16.2.4</span> <code>register</code></h3>
<p></p>
<p>This is a keyword to hint to the compiler that this variable is frequently-used, and should be made as fast as possible to access. The compiler is under no obligation to agree to it.</p>
<p>Now, modern C compiler optimizers are pretty effective at figuring this out themselves, so it’s rare to see these days.</p>
<p>But if you must:</p>
<div class="sourceCode" id="cb283"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb283-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb283-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb283-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb283-2"></a></span>
<span id="cb283-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb283-3"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb283-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb283-4"></a><span class="op">{</span></span>
<span id="cb283-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb283-5"></a>    <span class="dt">register</span> <span class="dt">int</span> a<span class="op">;</span>   <span class="co">// Make "a" as fast to use as possible.</span></span>
<span id="cb283-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb283-6"></a></span>
<span id="cb283-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb283-7"></a>    <span class="cf">for</span> <span class="op">(</span>a <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> a <span class="op">&lt;</span> <span class="dv">10</span><span class="op">;</span> a<span class="op">++)</span></span>
<span id="cb283-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb283-8"></a>        printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> a<span class="op">);</span></span>
<span id="cb283-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb283-9"></a><span class="op">}</span></span></code></pre></div>
<p>It does come at a price, however. You can’t take the address of a register:</p>
<div class="sourceCode" id="cb284"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb284-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb284-1" aria-hidden="true" tabindex="-1"></a><span class="dt">register</span> <span class="dt">int</span> a<span class="op">;</span></span>
<span id="cb284-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb284-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> <span class="op">*</span>p <span class="op">=</span> <span class="op">&amp;</span>a<span class="op">;</span>    <span class="co">// COMPILER ERROR! Can't take address of a register</span></span></code></pre></div>
<p>The same applies to any part of an array:</p>
<div class="sourceCode" id="cb285"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb285-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb285-1" aria-hidden="true" tabindex="-1"></a><span class="dt">register</span> <span class="dt">int</span> a<span class="op">[]</span> <span class="op">=</span> <span class="op">{</span><span class="dv">11</span><span class="op">,</span> <span class="dv">22</span><span class="op">,</span> <span class="dv">33</span><span class="op">,</span> <span class="dv">44</span><span class="op">,</span> <span class="dv">55</span><span class="op">};</span></span>
<span id="cb285-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb285-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> <span class="op">*</span>p <span class="op">=</span> a<span class="op">;</span>  <span class="co">// COMPILER ERROR! Can't take address of a[0]</span></span></code></pre></div>
<p>Or dereferencing part of an array:</p>
<div class="sourceCode" id="cb286"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb286-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb286-1" aria-hidden="true" tabindex="-1"></a><span class="dt">register</span> <span class="dt">int</span> a<span class="op">[]</span> <span class="op">=</span> <span class="op">{</span><span class="dv">11</span><span class="op">,</span> <span class="dv">22</span><span class="op">,</span> <span class="dv">33</span><span class="op">,</span> <span class="dv">44</span><span class="op">,</span> <span class="dv">55</span><span class="op">};</span></span>
<span id="cb286-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb286-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb286-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb286-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> a <span class="op">=</span> <span class="op">*(</span>a <span class="op">+</span> <span class="dv">2</span><span class="op">);</span>  <span class="co">// COMPILER ERROR! Address of a[0] taken</span></span></code></pre></div>
<p>Interestingly, for the equivalent with array notation, gcc only warns:</p>
<div class="sourceCode" id="cb287"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb287-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb287-1" aria-hidden="true" tabindex="-1"></a><span class="dt">register</span> <span class="dt">int</span> a<span class="op">[]</span> <span class="op">=</span> <span class="op">{</span><span class="dv">11</span><span class="op">,</span> <span class="dv">22</span><span class="op">,</span> <span class="dv">33</span><span class="op">,</span> <span class="dv">44</span><span class="op">,</span> <span class="dv">55</span><span class="op">};</span></span>
<span id="cb287-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb287-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb287-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb287-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> a <span class="op">=</span> a<span class="op">[</span><span class="dv">2</span><span class="op">];</span>  <span class="co">// COMPILER </span><span class="al">WARNING</span><span class="co">!</span></span></code></pre></div>
<p>with:</p>
<div class="sourceCode" id="cb288"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb288-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb288-1" aria-hidden="true" tabindex="-1"></a>warning: ISO C forbids subscripting ‘register’ array</span></code></pre></div>
<p>The fact that you can’t take the address of a register variable frees the compiler up to make optimizations around that assumption if it hasn’t figured them out already. Also adding <code>register</code> to a <code>const</code> variable prevents one from accidentally passing its pointer to another function that willfully ignore its constness<a href="https://beej.us/guide/bgc/html/index-wide.html#fn115" class="footnote-ref" id="fnref115" role="doc-noteref"><sup>115</sup></a>.</p>
<p>A bit of historic backstory, here: deep inside the CPU are little dedicated “variables” called <a href="https://en.wikipedia.org/wiki/Processor_register"><em>registers</em></a><a href="https://beej.us/guide/bgc/html/index-wide.html#fn116" class="footnote-ref" id="fnref116" role="doc-noteref"><sup>116</sup></a>. They are super fast to access compared to RAM, so using them gets you a speed boost. But they’re not in RAM, so they don’t have an associated memory address (which is why you can’t take the address-of or get a pointer to them).</p>
<p>But, like I said, modern compilers are really good at producing optimal code, using registers whenever possible regardless of whether or not you specified the <code>register</code> keyword. Not only that, but the spec allows them to just treat it as if you’d typed <code>auto</code>, if they want. So no guarantees.</p>
<p></p>
<h3 data-number="16.2.5" id="thread_local"><span class="header-section-number">16.2.5</span> <code>_Thread_local</code></h3>
<p></p>
<p>When you’re using multiple threads and you have some variables in either global or <code>static</code> block scope, this is a way to make sure that each thread gets its own copy of the variable. This’ll help you avoid race conditions and threads stepping on each other’s toes.</p>
<p>If you’re in block scope, you have to use this along with either <code>extern</code> or <code>static</code>.</p>
<p>Also, if you include <code>&lt;threads.h&gt;</code>, you can use the rather more palatable <code>thread_local</code> as an alias for the uglier <code>_Thread_local</code>.</p>
<p>More information can be found in the <a href="https://beej.us/guide/bgc/html/index-wide.html#thread-local">Threads section</a>.</p>
<p> </p>
<!-- Beej's guide to C

# vim: ts=4:sw=4:nosi:et:tw=72
-->
<h1 data-number="17" id="multifile-projects"><span class="header-section-number">17</span> Multifile Projects</h1>
<p></p>
<p>So far we’ve been looking at toy programs that for the most part fit in a single file. But complex C programs are made up of many files that are all compiled and linked together into a single executable.</p>
<p>In this chapter we’ll check out some of the common patterns and practices for putting together larger projects.</p>
<h2 data-number="17.1" id="includes-func-protos"><span class="header-section-number">17.1</span> Includes and Function Prototypes</h2>
<p> </p>
<p>A really common situation is that some of your functions are defined in one file, and you want to call them from another.</p>
<p>This actually works out of the box with a warning… let’s first try it and then look at the right way to fix the warning.</p>
<p>For these examples, we’ll put the filename as the first comment in the source.</p>
<p>To compile them, you’ll need to specify all the sources on the command line:</p>
<div class="sourceCode" id="cb289"><pre class="sourceCode zsh"><code class="sourceCode zsh"><span id="cb289-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb289-1" aria-hidden="true" tabindex="-1"></a><span class="co"># output file   source files</span></span>
<span id="cb289-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb289-2" aria-hidden="true" tabindex="-1"></a><span class="co">#     v            v</span></span>
<span id="cb289-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb289-3" aria-hidden="true" tabindex="-1"></a><span class="co">#   |----| |---------|</span></span>
<span id="cb289-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb289-4" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-o</span> foo foo.c bar.c</span></code></pre></div>
<p>In that examples, <code>foo.c</code> and <code>bar.c</code> get built into the executable named <code>foo</code>.</p>
<p>So let’s take a look at the source file <code>bar.c</code>:</p>
<div class="sourceCode" id="cb290"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb290-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb290-1"></a><span class="co">// File bar.c</span></span>
<span id="cb290-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb290-2"></a></span>
<span id="cb290-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb290-3"></a><span class="dt">int</span> add<span class="op">(</span><span class="dt">int</span> x<span class="op">,</span> <span class="dt">int</span> y<span class="op">)</span></span>
<span id="cb290-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb290-4"></a><span class="op">{</span></span>
<span id="cb290-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb290-5"></a>    <span class="cf">return</span> x <span class="op">+</span> y<span class="op">;</span></span>
<span id="cb290-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb290-6"></a><span class="op">}</span></span></code></pre></div>
<p>And the file <code>foo.c</code> with main in it:</p>
<div class="sourceCode" id="cb291"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb291-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb291-1"></a><span class="co">// File foo.c</span></span>
<span id="cb291-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb291-2"></a></span>
<span id="cb291-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb291-3"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb291-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb291-4"></a></span>
<span id="cb291-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb291-5"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb291-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb291-6"></a><span class="op">{</span></span>
<span id="cb291-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb291-7"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> add<span class="op">(</span><span class="dv">2</span><span class="op">,</span> <span class="dv">3</span><span class="op">));</span>  <span class="co">// 5!</span></span>
<span id="cb291-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb291-8"></a><span class="op">}</span></span></code></pre></div>
<p>See how from <code>main()</code> we call <code>add()</code>—but <code>add()</code> is in a completely different source file! It’s in <code>bar.c</code>, while the call to it is in <code>foo.c</code>!</p>
<p>If we build this with:</p>
<div class="sourceCode" id="cb292"><pre class="sourceCode zsh"><code class="sourceCode zsh"><span id="cb292-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb292-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-o</span> foo foo.c bar.c</span></code></pre></div>
<p>we get this error:</p>
<div class="sourceCode" id="cb293"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb293-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb293-1" aria-hidden="true" tabindex="-1"></a>error: implicit declaration of function 'add' is invalid in C99</span></code></pre></div>
<p>(Or you might get a warning. Which you should not ignore. Never ignore warnings in C; address them all.)</p>
<p>If you recall from the <a href="https://beej.us/guide/bgc/html/index-wide.html#prototypes">section on prototypes</a>, implicit declarations are banned in modern C and there’s no legitimate reason to introduce them into new code. We should fix it.</p>
<p>What <code>implicit declaration</code> means is that we’re using a function, namely <code>add()</code> in this case, without letting C know anything about it ahead of time. C wants to know what it returns, what types it takes as arguments, and things such as that.</p>
<p>We saw how to fix that earlier with a <em>function prototype</em>. Indeed, if we add one of those to <code>foo.c</code> before we make the call, everything works well:</p>
<div class="sourceCode" id="cb294"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb294-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb294-1"></a><span class="co">// File foo.c</span></span>
<span id="cb294-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb294-2"></a></span>
<span id="cb294-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb294-3"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb294-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb294-4"></a></span>
<span id="cb294-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb294-5"></a><span class="dt">int</span> add<span class="op">(</span><span class="dt">int</span><span class="op">,</span> <span class="dt">int</span><span class="op">);</span>  <span class="co">// Add the prototype</span></span>
<span id="cb294-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb294-6"></a></span>
<span id="cb294-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb294-7"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb294-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb294-8"></a><span class="op">{</span></span>
<span id="cb294-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb294-9"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> add<span class="op">(</span><span class="dv">2</span><span class="op">,</span> <span class="dv">3</span><span class="op">));</span>  <span class="co">// 5!</span></span>
<span id="cb294-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb294-10"></a><span class="op">}</span></span></code></pre></div>
<p>No more error!</p>
<p>But that’s a pain—needing to type in the prototype every time you want to use a function. I mean, we used <code>printf()</code> right there and didn’t need to type in a prototype; what gives?</p>
<p>If you remember from what back with <code>hello.c</code> at the beginning of the book, <em>we actually did include the prototype for <code>printf()</code></em>! It’s in the file <code>stdio.h</code>! And we included that with <code>#include</code>!</p>
<p>Can we do the same with our <code>add()</code> function? Make a prototype for it and put it in a header file?</p>
<p>Sure!</p>
<p>Header files in C have a <code>.h</code> extension by default. And they often, but not always, have the same name as their corresponding <code>.c</code> file. So let’s make a <code>bar.h</code> file for our <code>bar.c</code> file, and we’ll stick the prototype in it:</p>
<div class="sourceCode" id="cb295"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb295-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb295-1"></a><span class="co">// File bar.h</span></span>
<span id="cb295-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb295-2"></a></span>
<span id="cb295-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb295-3"></a><span class="dt">int</span> add<span class="op">(</span><span class="dt">int</span><span class="op">,</span> <span class="dt">int</span><span class="op">);</span></span></code></pre></div>
<p>And now let’s modify <code>foo.c</code> to include that file. Assuming it’s in the same directory, we include it inside double quotes (as opposed to angle brackets):</p>
<div class="sourceCode" id="cb296"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb296-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb296-1"></a><span class="co">// File foo.c</span></span>
<span id="cb296-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb296-2"></a></span>
<span id="cb296-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb296-3"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb296-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb296-4"></a></span>
<span id="cb296-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb296-5"></a><span class="pp">#include </span><span class="im">"bar.h"</span><span class="pp">  </span><span class="co">// Include from current directory</span></span>
<span id="cb296-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb296-6"></a></span>
<span id="cb296-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb296-7"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb296-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb296-8"></a><span class="op">{</span></span>
<span id="cb296-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb296-9"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> add<span class="op">(</span><span class="dv">2</span><span class="op">,</span> <span class="dv">3</span><span class="op">));</span>  <span class="co">// 5!</span></span>
<span id="cb296-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb296-10"></a><span class="op">}</span></span></code></pre></div>
<p>Notice how we don’t have the prototype in <code>foo.c</code> anymore—we included it from <code>bar.h</code>. Now <em>any</em> file that wants that <code>add()</code> functionality can just <code>#include "bar.h"</code> to get it, and you don’t need to worry about typing in the function prototype.</p>
<p>As you might have guessed, <code>#include</code> literally includes the named file <em>right there</em> in your source code, just as if you’d typed it in.</p>
<p>And building and running:</p>
<div class="sourceCode" id="cb297"><pre class="sourceCode zsh"><code class="sourceCode zsh"><span id="cb297-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb297-1" aria-hidden="true" tabindex="-1"></a><span class="ex">./foo</span></span>
<span id="cb297-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb297-2" aria-hidden="true" tabindex="-1"></a><span class="ex">5</span></span></code></pre></div>
<p>Indeed, we get the result of <span class="math inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="32" style="font-size: 101.6%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="3"><mjx-c class="mjx-c33"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>2</mn><mo>+</mo><mn>3</mn></math></mjx-assistive-mml></mjx-container></span>! Yay!</p>
<p>But don’t crack open your drink of choice quite yet. We’re almost there! There’s just one more piece of boilerplate we have to add.</p>
<p></p>
<h2 data-number="17.2" id="dealing-with-repeated-includes"><span class="header-section-number">17.2</span> Dealing with Repeated Includes</h2>
<p>It’s not uncommon that a header file will itself <code>#include</code> other headers needed for the functionality of its corresponding C files. I mean, why not?</p>
<p>And it could be that you have a header <code>#include</code>d multiple times from different places. Maybe that’s no problem, but maybe it would cause compiler errors. And we can’t control how many places <code>#include</code> it!</p>
<p>Even, worse we might get into a crazy situation where header <code>a.h</code> includes header <code>b.h</code>, and <code>b.h</code> includes <code>a.h</code>! It’s an <code>#include</code> infinite cycle!</p>
<p>Trying to build such a thing gives an error:</p>
<div class="sourceCode" id="cb298"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb298-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb298-1" aria-hidden="true" tabindex="-1"></a>error: #include nested depth 200 exceeds maximum of 200</span></code></pre></div>
<p>What we need to do is make it so that if a file gets included once, subsequent <code>#include</code>s for that file are ignored.</p>
<p><strong>The stuff that we’re about to do is so common that you should just automatically do it every time you make a header file!</strong></p>
<p>And the common way to do this is with a preprocessor variable that we set the first time we <code>#include</code> the file. And then for subsequent <code>#include</code>s, we first check to make sure that the variable isn’t defined.</p>
<p>For that variable name, it’s super common to take the name of the header file, like <code>bar.h</code>, make it uppercase, and replace the period with an underscore: <code>BAR_H</code>.</p>
<p>So put a check at the very, very top of the file where you see if it’s already been included, and effectively comment the whole thing out if it has.</p>
<p>(Don’t put a leading underscore (because a leading underscore followed by a capital letter is reserved) or a double leading underscore (because that’s also reserved.))</p>
<div class="sourceCode" id="cb299"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb299-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb299-1"></a><span class="pp">#ifndef BAR_H   </span><span class="co">// If BAR_H isn't defined...</span></span>
<span id="cb299-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb299-2"></a><span class="pp">#define BAR_H   </span><span class="co">// Define it (with no particular value)</span></span>
<span id="cb299-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb299-3"></a></span>
<span id="cb299-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb299-4"></a><span class="co">// File bar.h</span></span>
<span id="cb299-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb299-5"></a></span>
<span id="cb299-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb299-6"></a><span class="dt">int</span> add<span class="op">(</span><span class="dt">int</span><span class="op">,</span> <span class="dt">int</span><span class="op">);</span></span>
<span id="cb299-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb299-7"></a></span>
<span id="cb299-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb299-8"></a><span class="pp">#endif          </span><span class="co">// End of the #ifndef BAR_H</span></span></code></pre></div>
<p>This will effectively cause the header file to be included only a single time, no matter how many places try to <code>#include</code> it.</p>
<p></p>
<h2 data-number="17.3" id="static-and-extern"><span class="header-section-number">17.3</span> <code>static</code> and <code>extern</code></h2>
<p> </p>
<p>When it comes to multifile projects, you can make sure file-scope variables and functions are <em>not</em> visible from other source files with the <code>static</code> keyword.</p>
<p>And you can refer to objects in other files with <code>extern</code>.</p>
<p>For more info, check out the sections in the book on the <a href="https://beej.us/guide/bgc/html/index-wide.html#static"><code>static</code></a> and <a href="https://beej.us/guide/bgc/html/index-wide.html#extern"><code>extern</code></a> storage-class specifiers.</p>
<p> </p>
<h2 data-number="17.4" id="compiling-with-object-files"><span class="header-section-number">17.4</span> Compiling with Object Files</h2>
<p></p>
<p>This isn’t part of the spec, but it’s 99.999% common in the C world.</p>
<p>You can compile C files into an intermediate representation called <em>object files</em>. These are compiled machine code that hasn’t been put into an executable yet.</p>
<p>Object files in Windows have a <code>.OBJ</code> extension; in Unix-likes, they’re <code>.o</code>.</p>
<p></p>
<p>In gcc, we can build some like this, with the <code>-c</code> (compile only!) flag:</p>
<div class="sourceCode" id="cb300"><pre class="sourceCode zsh"><code class="sourceCode zsh"><span id="cb300-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb300-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-c</span> foo.c     <span class="co"># produces foo.o</span></span>
<span id="cb300-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb300-2" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-c</span> bar.c     <span class="co"># produces bar.o</span></span></code></pre></div>
<p>And then we can <em>link</em> those together into a single executable:</p>
<div class="sourceCode" id="cb301"><pre class="sourceCode zsh"><code class="sourceCode zsh"><span id="cb301-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb301-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-o</span> foo foo.o bar.o</span></code></pre></div>
<p><em>Voila</em>, we’ve produced an executable <code>foo</code> from the two object files.</p>
<p>But you’re thinking, why bother? Can’t we just:</p>
<div class="sourceCode" id="cb302"><pre class="sourceCode zsh"><code class="sourceCode zsh"><span id="cb302-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb302-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-o</span> foo foo.c bar.c</span></code></pre></div>
<p>and kill two <a href="https://en.wikipedia.org/wiki/Boids">boids</a><a href="https://beej.us/guide/bgc/html/index-wide.html#fn117" class="footnote-ref" id="fnref117" role="doc-noteref"><sup>117</sup></a> with one stone?</p>
<p></p>
<p>For little programs, that’s fine. I do it all the time.</p>
<p>But for larger programs, we can take advantage of the fact that compiling from source to object files is relatively slow, and linking together a bunch of object files is relatively fast.</p>
<p>This really shows with the <code>make</code> utility that only rebuilds sources that are newer than their outputs.</p>
<p>Let’s say you had a thousand C files. You could compile them all to object files to start (slowly) and then combine all those object files into an executable (fast).</p>
<p>Now say you modified just one of those C source files—here’s the magic: <em>you only have to rebuild that one object file for that source file</em>! And then you rebuild the executable (fast). All the other C files don’t have to be touched.</p>
<p>In other words, by only rebuilding the object files we need to, we cut down on compilation times radically. (Unless of course you’re doing a “clean” build, in which case all the object files have to be created.)</p>
<p> </p>
<!-- Beej's guide to C

# vim: ts=4:sw=4:nosi:et:tw=72
-->
<h1 data-number="18" id="the-outside-environment"><span class="header-section-number">18</span> The Outside Environment</h1>
<p>When you run a program, it’s actually you talking to the shell, saying, “Hey, please run this thing.” And the shell says, “Sure,” and then tells the operating system, “Hey, could you please make a new process and run this thing?” And if all goes well, the OS complies and your program runs.</p>
<p>But there’s a whole world outside your program in the shell that can be interacted with from within C. We’ll look at a few of those in this chapter.</p>
<h2 data-number="18.1" id="command-line-arguments"><span class="header-section-number">18.1</span> Command Line Arguments</h2>
<p></p>
<p>Many command line utilities accept <em>command line arguments</em>. For example, if we want to see all files that end in <code>.txt</code>, we can type something like this on a Unix-like system:</p>
<div class="sourceCode" id="cb303"><pre class="sourceCode zsh"><code class="sourceCode zsh"><span id="cb303-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb303-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ls</span> <span class="pp">*</span>.txt</span></code></pre></div>
<p>(or <code>dir</code> instead of <code>ls</code> on a Windows system).</p>
<p>In this case, the command is <code>ls</code>, but it arguments are all all files that end with <code>.txt</code><a href="https://beej.us/guide/bgc/html/index-wide.html#fn118" class="footnote-ref" id="fnref118" role="doc-noteref"><sup>118</sup></a>.</p>
<p>So how can we see what is passed into program from the command line?</p>
<p>Say we have a program called <code>add</code> that adds all numbers passed on the command line and prints the result:</p>
<div class="sourceCode" id="cb304"><pre class="sourceCode zsh"><code class="sourceCode zsh"><span id="cb304-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb304-1" aria-hidden="true" tabindex="-1"></a><span class="ex">./add</span> 10 30 5</span>
<span id="cb304-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb304-2" aria-hidden="true" tabindex="-1"></a><span class="ex">45</span></span></code></pre></div>
<p>That’s gonna pay the bills for sure!</p>
<p>But seriously, this is a great tool for seeing how to get those arguments from the command line and break them down.</p>
<p>First, let’s see how to get them at all. For this, we’re going to need a new <code>main()</code>!</p>
<p>Here’s a program that prints out all the command line arguments. For example, if we name the executable <code>foo</code>, we can run it like this:</p>
<div class="sourceCode" id="cb305"><pre class="sourceCode zsh"><code class="sourceCode zsh"><span id="cb305-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb305-1" aria-hidden="true" tabindex="-1"></a><span class="ex">./foo</span> i like turtles</span></code></pre></div>
<p>and we’ll see this output:</p>
<div class="sourceCode" id="cb306"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb306-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb306-1" aria-hidden="true" tabindex="-1"></a>arg 0: ./foo</span>
<span id="cb306-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb306-2" aria-hidden="true" tabindex="-1"></a>arg 1: i</span>
<span id="cb306-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb306-3" aria-hidden="true" tabindex="-1"></a>arg 2: like</span>
<span id="cb306-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb306-4" aria-hidden="true" tabindex="-1"></a>arg 3: turtles</span></code></pre></div>
<p>It’s a little weird, because the zeroth argument is the name of the executable, itself. But that’s just something to get used to. The arguments themselves follow directly.</p>
<p>Source:</p>
<p> </p>
<div class="sourceCode" id="cb307"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb307-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb307-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb307-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb307-2"></a></span>
<span id="cb307-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb307-3"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">int</span> argc<span class="op">,</span> <span class="dt">char</span> <span class="op">*</span>argv<span class="op">[])</span></span>
<span id="cb307-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb307-4"></a><span class="op">{</span></span>
<span id="cb307-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb307-5"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> argc<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb307-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb307-6"></a>        printf<span class="op">(</span><span class="st">"arg </span><span class="sc">%d</span><span class="st">: </span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> i<span class="op">,</span> argv<span class="op">[</span>i<span class="op">]);</span></span>
<span id="cb307-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb307-7"></a>    <span class="op">}</span></span>
<span id="cb307-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb307-8"></a><span class="op">}</span></span></code></pre></div>
<p>Whoa! What’s going on with the <code>main()</code> function signature? What’s <code>argc</code> and <code>argv</code><a href="https://beej.us/guide/bgc/html/index-wide.html#fn119" class="footnote-ref" id="fnref119" role="doc-noteref"><sup>119</sup></a> (pronounced <em>arg-cee</em> and <em>arg-vee</em>)?</p>
<p>Let’s start with the easy one first: <code>argc</code>. This is the <em>argument count</em>, including the program name, itself. If you think of all the arguments as an array of strings, which is exactly what they are, then you can think of <code>argc</code> as the length of that array, which is exactly what it is.</p>
<p>And so what we’re doing in that loop is going through all the <code>argv</code>s and printing them out one at a time, so for a given input:</p>
<div class="sourceCode" id="cb308"><pre class="sourceCode zsh"><code class="sourceCode zsh"><span id="cb308-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb308-1" aria-hidden="true" tabindex="-1"></a><span class="ex">./foo</span> i like turtles</span></code></pre></div>
<p>we get a corresponding output:</p>
<div class="sourceCode" id="cb309"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb309-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb309-1" aria-hidden="true" tabindex="-1"></a>arg 0: ./foo</span>
<span id="cb309-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb309-2" aria-hidden="true" tabindex="-1"></a>arg 1: i</span>
<span id="cb309-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb309-3" aria-hidden="true" tabindex="-1"></a>arg 2: like</span>
<span id="cb309-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb309-4" aria-hidden="true" tabindex="-1"></a>arg 3: turtles</span></code></pre></div>
<p>With that in mind, we should be good to go with our adder program.</p>
<p>Our plan:</p>
<ul>
<li>Look at all the command line arguments (past <code>argv[0]</code>, the program name)</li>
<li>Convert them to integers</li>
<li>Add them to a running total</li>
<li>Print the result</li>
</ul>
<p>Let’s get to it!</p>
<div class="sourceCode" id="cb310"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb310-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb310-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb310-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb310-2"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb310-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb310-3"></a></span>
<span id="cb310-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb310-4"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">int</span> argc<span class="op">,</span> <span class="dt">char</span> <span class="op">**</span>argv<span class="op">)</span></span>
<span id="cb310-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb310-5"></a><span class="op">{</span></span>
<span id="cb310-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb310-6"></a>    <span class="dt">int</span> total <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb310-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb310-7"></a></span>
<span id="cb310-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb310-8"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">1</span><span class="op">;</span> i <span class="op">&lt;</span> argc<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span>  <span class="co">// Start at 1, the first argument</span></span>
<span id="cb310-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb310-9"></a>        <span class="dt">int</span> value <span class="op">=</span> atoi<span class="op">(</span>argv<span class="op">[</span>i<span class="op">]);</span>    <span class="co">// Use strtol() for better error handling</span></span>
<span id="cb310-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb310-10"></a></span>
<span id="cb310-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb310-11"></a>        total <span class="op">+=</span> value<span class="op">;</span></span>
<span id="cb310-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb310-12"></a>    <span class="op">}</span></span>
<span id="cb310-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb310-13"></a></span>
<span id="cb310-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb310-14"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> total<span class="op">);</span></span>
<span id="cb310-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb310-15"></a><span class="op">}</span></span></code></pre></div>
<p> </p>
<p>Sample runs:</p>
<div class="sourceCode" id="cb311"><pre class="sourceCode zsh"><code class="sourceCode zsh"><span id="cb311-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb311-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> ./add</span>
<span id="cb311-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb311-2" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span></span>
<span id="cb311-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb311-3" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> ./add 1</span>
<span id="cb311-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb311-4" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span></span>
<span id="cb311-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb311-5" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> ./add 1 2</span>
<span id="cb311-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb311-6" aria-hidden="true" tabindex="-1"></a><span class="ex">3</span></span>
<span id="cb311-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb311-7" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> ./add 1 2 3</span>
<span id="cb311-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb311-8" aria-hidden="true" tabindex="-1"></a><span class="ex">6</span></span>
<span id="cb311-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb311-9" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> ./add 1 2 3 4</span>
<span id="cb311-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb311-10" aria-hidden="true" tabindex="-1"></a><span class="ex">10</span></span></code></pre></div>
<p>Of course, it might puke if you pass in a non-integer, but hardening against that is left as an exercise to the reader.</p>
<h3 data-number="18.1.1" id="the-last-argv-is-null"><span class="header-section-number">18.1.1</span> The Last <code>argv</code> is <code>NULL</code></h3>
<p>One bit of fun trivia about <code>argv</code> is that after the last string is a pointer to <code>NULL</code>.</p>
<p>That is:</p>
<div class="sourceCode" id="cb312"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb312-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb312-1" aria-hidden="true" tabindex="-1"></a>argv<span class="op">[</span>argc<span class="op">]</span> <span class="op">==</span> NULL</span></code></pre></div>
<p>is always true!</p>
<p>This might seem pointless, but it turns out to be useful in a couple places; we’ll take a look at one of those right now.</p>
<h3 data-number="18.1.2" id="the-alternate-char-argv"><span class="header-section-number">18.1.2</span> The Alternate: <code>char **argv</code></h3>
<p>Remember that when you call a function, C doesn’t differentiate between array notation and pointer notation in the function signature.</p>
<p>That is, these are the same:</p>
<div class="sourceCode" id="cb313"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb313-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb313-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> foo<span class="op">(</span><span class="dt">char</span> a<span class="op">[])</span></span>
<span id="cb313-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb313-2" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> foo<span class="op">(</span><span class="dt">char</span> <span class="op">*</span>a<span class="op">)</span></span></code></pre></div>
<p>Now, it’s been convenient to think of <code>argv</code> as an array of strings, i.e.&nbsp;an array of <code>char*</code>s, so this made sense:</p>
<div class="sourceCode" id="cb314"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb314-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb314-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">int</span> argc<span class="op">,</span> <span class="dt">char</span> <span class="op">*</span>argv<span class="op">[])</span></span></code></pre></div>
<p>but because of the equivalence, you could also write:</p>
<div class="sourceCode" id="cb315"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb315-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb315-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">int</span> argc<span class="op">,</span> <span class="dt">char</span> <span class="op">**</span>argv<span class="op">)</span></span></code></pre></div>
<p>Yeah, that’s a pointer to a pointer, all right! If it makes it easier, think of it as a pointer to a string. But really, it’s a pointer to a value that points to a <code>char</code>.</p>
<p>Also recall that these are equivalent:</p>
<div class="sourceCode" id="cb316"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb316-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb316-1" aria-hidden="true" tabindex="-1"></a>argv<span class="op">[</span>i<span class="op">]</span></span>
<span id="cb316-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb316-2" aria-hidden="true" tabindex="-1"></a><span class="op">*(</span>argv <span class="op">+</span> i<span class="op">)</span></span></code></pre></div>
<p>which means you can do pointer arithmetic on <code>argv</code>.</p>
<p>So an alternate way to consume the command line arguments might be to just walk along the <code>argv</code> array by bumping up a pointer until we hit that <code>NULL</code> at the end.</p>
<p>Let’s modify our adder to do that:</p>
<div class="sourceCode" id="cb317"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb317-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb317-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb317-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb317-2"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb317-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb317-3"></a></span>
<span id="cb317-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb317-4"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">int</span> argc<span class="op">,</span> <span class="dt">char</span> <span class="op">**</span>argv<span class="op">)</span></span>
<span id="cb317-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb317-5"></a><span class="op">{</span></span>
<span id="cb317-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb317-6"></a>    <span class="dt">int</span> total <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb317-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb317-7"></a>    </span>
<span id="cb317-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb317-8"></a>    <span class="co">// Cute trick to get the compiler to stop warning about the</span></span>
<span id="cb317-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb317-9"></a>    <span class="co">// unused variable argc:</span></span>
<span id="cb317-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb317-10"></a>    <span class="op">(</span><span class="dt">void</span><span class="op">)</span>argc<span class="op">;</span></span>
<span id="cb317-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb317-11"></a></span>
<span id="cb317-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb317-12"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">char</span> <span class="op">**</span>p <span class="op">=</span> argv <span class="op">+</span> <span class="dv">1</span><span class="op">;</span> <span class="op">*</span>p <span class="op">!=</span> NULL<span class="op">;</span> p<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb317-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb317-13"></a>        <span class="dt">int</span> value <span class="op">=</span> atoi<span class="op">(*</span>p<span class="op">);</span>  <span class="co">// Use strtol() for better error handling</span></span>
<span id="cb317-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb317-14"></a></span>
<span id="cb317-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb317-15"></a>        total <span class="op">+=</span> value<span class="op">;</span></span>
<span id="cb317-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb317-16"></a>    <span class="op">}</span></span>
<span id="cb317-17"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb317-17"></a></span>
<span id="cb317-18"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb317-18"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> total<span class="op">);</span></span>
<span id="cb317-19"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb317-19"></a><span class="op">}</span></span></code></pre></div>
<p>Personally, I use array notation to access <code>argv</code>, but have seen this style floating around, as well.</p>
<h3 data-number="18.1.3" id="fun-facts"><span class="header-section-number">18.1.3</span> Fun Facts</h3>
<p></p>
<p>Just a few more things about <code>argc</code> and <code>argv</code>.</p>
<ul>
<li><p>Some environments might not set <code>argv[0]</code> to the program name. If it’s not available, <code>argv[0]</code> will be an empty string. I’ve never seen this happen.</p></li>
<li><p>The spec is actually pretty liberal with what an implementation can do with <code>argv</code> and where those values come from. But every system I’ve been on works the same way, as we’ve discussed in this section.</p></li>
<li><p>You can modify <code>argc</code>, <code>argv</code>, or any of the strings that <code>argv</code> points to. (Just don’t make those strings longer than they already are!)</p></li>
<li><p>On some Unix-like systems, modifying the string <code>argv[0]</code> results in the output of <code>ps</code> changing<a href="https://beej.us/guide/bgc/html/index-wide.html#fn120" class="footnote-ref" id="fnref120" role="doc-noteref"><sup>120</sup></a>.</p>
<p>Normally, if you have a program called <code>foo</code> that you’ve run with <code>./foo</code>, you might see this in the output of <code>ps</code>:</p>
<div class="sourceCode" id="cb318"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb318-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb318-1" aria-hidden="true" tabindex="-1"></a> 4078 tty1     S      0:00 ./foo</span></code></pre></div>
<p>But if you modify <code>argv[0]</code> like so, being careful that the new string <code>"Hi!  "</code> is the same length as the old one <code>"./foo"</code>:</p>
<div class="sourceCode" id="cb319"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb319-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb319-1" aria-hidden="true" tabindex="-1"></a>strcpy<span class="op">(</span>argv<span class="op">[</span><span class="dv">0</span><span class="op">],</span> <span class="st">"Hi!  "</span><span class="op">);</span></span></code></pre></div>
<p>and then run <code>ps</code> while the program <code>./foo</code> is still executing, we’ll see this instead:</p>
<div class="sourceCode" id="cb320"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb320-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb320-1" aria-hidden="true" tabindex="-1"></a> 4079 tty1     S      0:00 Hi!  </span></code></pre></div>
<p>This behavior is not in the spec and is highly system-dependent.</p></li>
</ul>
<p> </p>
<h2 data-number="18.2" id="exit-status"><span class="header-section-number">18.2</span> Exit Status</h2>
<p></p>
<p>Did you notice that the function signatures for <code>main()</code> have it returning type <code>int</code>? What’s that all about? It has to do with a thing called the <em>exit status</em>, which is an integer that can be returned to the program that launched yours to let it know how things went.</p>
<p>Now, there are a number of ways a program can exit in C, including <code>return</code>ing from <code>main()</code>, or calling one of the <code>exit()</code> variants.</p>
<p>All of these methods accept an <code>int</code> as an argument.</p>
<p> Side note: did you see that in basically all my examples, even though <code>main()</code> is supposed to return an <code>int</code>, I don’t actually <code>return</code> anything? In any other function, this would be illegal, but there’s a special case in C: if execution reaches the end of <code>main()</code> without finding a <code>return</code>, it automatically does a <code>return 0</code>. </p>
<p>But what does the <code>0</code> mean? What other numbers can we put there? And how are they used?</p>
<p>The spec is both clear and vague on the matter, as is common. Clear because it spells out what you can do, but vague in that it doesn’t particularly limit it, either.</p>
<p>Nothing for it but to <em>forge ahead</em> and figure it out!</p>
<p>Let’s get <a href="https://en.wikipedia.org/wiki/Inception">Inception</a><a href="https://beej.us/guide/bgc/html/index-wide.html#fn121" class="footnote-ref" id="fnref121" role="doc-noteref"><sup>121</sup></a> for a second: turns out that when you run your program, <em>you’re running it from another program</em>.</p>
<p>Usually this other program is some kind of <a href="https://en.wikipedia.org/wiki/Shell_(computing)">shell</a><a href="https://beej.us/guide/bgc/html/index-wide.html#fn122" class="footnote-ref" id="fnref122" role="doc-noteref"><sup>122</sup></a> that doesn’t do much on its own except launch other programs.</p>
<p>But this is a multi-phase process, especially visible in command-line shells:</p>
<ol type="1">
<li>The shell launches your program</li>
<li>The shell typically goes to sleep (for command-line shells)</li>
<li>Your program runs</li>
<li>Your program terminates</li>
<li>The shell wakes up and waits for another command</li>
</ol>
<p>Now, there’s a little piece of communication that takes place between steps 4 and 5: the program can return a <em>status value</em> that the shell can interrogate. Typically, this value is used to indicate the success or failure of your program, and, if a failure, what type of failure.</p>
<p>This value is what we’ve been <code>return</code>ing from <code>main()</code>. That’s the status.</p>
<p>Now, the C spec allows for two different status values, which have macro names defined in <code>&lt;stdlib.h&gt;</code>:</p>
<p> </p>
<table>
<thead>
<tr class="header">
<th>Status</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>EXIT_SUCCESS</code> or <code>0</code></td>
<td>Program terminated successfully.</td>
</tr>
<tr class="even">
<td><code>EXIT_FAILURE</code></td>
<td>Program terminated with an error.</td>
</tr>
</tbody>
</table>
<p>Let’s write a short program that multiplies two numbers from the command line. We’ll require that you specify exactly two values. If you don’t, we’ll print an error message, and exit with an error status.</p>
<div class="sourceCode" id="cb321"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb321-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb321-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb321-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb321-2"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb321-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb321-3"></a></span>
<span id="cb321-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb321-4"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">int</span> argc<span class="op">,</span> <span class="dt">char</span> <span class="op">**</span>argv<span class="op">)</span></span>
<span id="cb321-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb321-5"></a><span class="op">{</span></span>
<span id="cb321-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb321-6"></a>    <span class="cf">if</span> <span class="op">(</span>argc <span class="op">!=</span> <span class="dv">3</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb321-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb321-7"></a>        printf<span class="op">(</span><span class="st">"usage: mult x y</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb321-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb321-8"></a>        <span class="cf">return</span> EXIT_FAILURE<span class="op">;</span>   <span class="co">// Indicate to shell that it didn't work</span></span>
<span id="cb321-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb321-9"></a>    <span class="op">}</span></span>
<span id="cb321-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb321-10"></a></span>
<span id="cb321-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb321-11"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> atoi<span class="op">(</span>argv<span class="op">[</span><span class="dv">1</span><span class="op">])</span> <span class="op">*</span> atoi<span class="op">(</span>argv<span class="op">[</span><span class="dv">2</span><span class="op">]));</span></span>
<span id="cb321-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb321-12"></a></span>
<span id="cb321-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb321-13"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span>  <span class="co">// same as EXIT_SUCCESS, everything was good.</span></span>
<span id="cb321-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb321-14"></a><span class="op">}</span></span></code></pre></div>
<p> </p>
<p>Now if we try to run this, we get the expected effect until we specify exactly the right number of command-line arguments:</p>
<div class="sourceCode" id="cb322"><pre class="sourceCode zsh"><code class="sourceCode zsh"><span id="cb322-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb322-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> ./mult</span>
<span id="cb322-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb322-2" aria-hidden="true" tabindex="-1"></a><span class="ex">usage:</span> mult x y</span>
<span id="cb322-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb322-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb322-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb322-4" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> ./mult 3 4 5</span>
<span id="cb322-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb322-5" aria-hidden="true" tabindex="-1"></a><span class="ex">usage:</span> mult x y</span>
<span id="cb322-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb322-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb322-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb322-7" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> ./mult 3 4</span>
<span id="cb322-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb322-8" aria-hidden="true" tabindex="-1"></a><span class="ex">12</span></span></code></pre></div>
<p></p>
<p>But that doesn’t really show the exit status that we returned, does it? We can get the shell to print it out, though. Assuming you’re running Bash or another POSIX shell, you can use <code>echo $?</code> to see it<a href="https://beej.us/guide/bgc/html/index-wide.html#fn123" class="footnote-ref" id="fnref123" role="doc-noteref"><sup>123</sup></a>.</p>
<p>Let’s try:</p>
<div class="sourceCode" id="cb323"><pre class="sourceCode zsh"><code class="sourceCode zsh"><span id="cb323-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb323-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> ./mult</span>
<span id="cb323-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb323-2" aria-hidden="true" tabindex="-1"></a><span class="ex">usage:</span> mult x y</span>
<span id="cb323-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb323-3" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> echo <span class="va">$?</span></span>
<span id="cb323-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb323-4" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span></span>
<span id="cb323-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb323-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb323-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb323-6" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> ./mult 3 4 5</span>
<span id="cb323-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb323-7" aria-hidden="true" tabindex="-1"></a><span class="ex">usage:</span> mult x y</span>
<span id="cb323-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb323-8" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> echo <span class="va">$?</span></span>
<span id="cb323-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb323-9" aria-hidden="true" tabindex="-1"></a><span class="ex">1</span></span>
<span id="cb323-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb323-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb323-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb323-11" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> ./mult 3 4</span>
<span id="cb323-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb323-12" aria-hidden="true" tabindex="-1"></a><span class="ex">12</span></span>
<span id="cb323-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb323-13" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> echo <span class="va">$?</span></span>
<span id="cb323-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb323-14" aria-hidden="true" tabindex="-1"></a><span class="ex">0</span></span></code></pre></div>
<p></p>
<p>Interesting! We see that on my system, <code>EXIT_FAILURE</code> is <code>1</code>. The spec doesn’t spell this out, so it could be any number. But try it; it’s probably <code>1</code> on your system, too.</p>
<h3 data-number="18.2.1" id="other-exit-status-values"><span class="header-section-number">18.2.1</span> Other Exit Status Values</h3>
<p>The status <code>0</code> most definitely means success, but what about all the other integers, even negative ones?</p>
<p>Here we’re going off the C spec and into Unix land. In general, while <code>0</code> means success, a positive non-zero number means failure. So you can only have one type of success, and multiple types of failure. Bash says the exit code should be between 0 and 255, though a number of codes are reserved.</p>
<p>In short, if you want to indicate different error exit statuses in a Unix environment, you can start with <code>1</code> and work your way up.</p>
<p>On Linux, if you try any code outside the range 0-255, it will bitwise AND the code with <code>0xff</code>, effectively clamping it to that range.</p>
<p>You can script the shell to later use these status codes to make decisions about what to do next.</p>
<p></p>
<h2 data-number="18.3" id="env-var"><span class="header-section-number">18.3</span> Environment Variables</h2>
<p></p>
<p>Before I get into this, I need to warn you that C doesn’t specify what an environment variable is. So I’m going to describe the environment variable system that works on every major platform I’m aware of.</p>
<p>Basically, the environment is the program that’s going to run your program, e.g.&nbsp;the bash shell. And it might have some bash variables defined. In case you didn’t know, the shell can make its own variables. Each shell is different, but in bash you can just type <code>set</code> and it’ll show you all of them.</p>
<p>Here’s an excerpt from the 61 variables that are defined in my bash shell:</p>
<div class="sourceCode" id="cb324"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb324-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb324-1" aria-hidden="true" tabindex="-1"></a>HISTFILE=/home/beej/.bash_history</span>
<span id="cb324-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb324-2" aria-hidden="true" tabindex="-1"></a>HISTFILESIZE=500</span>
<span id="cb324-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb324-3" aria-hidden="true" tabindex="-1"></a>HISTSIZE=500</span>
<span id="cb324-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb324-4" aria-hidden="true" tabindex="-1"></a>HOME=/home/beej</span>
<span id="cb324-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb324-5" aria-hidden="true" tabindex="-1"></a>HOSTNAME=FBILAPTOP</span>
<span id="cb324-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb324-6" aria-hidden="true" tabindex="-1"></a>HOSTTYPE=x86_64</span>
<span id="cb324-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb324-7" aria-hidden="true" tabindex="-1"></a>IFS=$' \t\n'</span></code></pre></div>
<p>Notice they are in the form of key/value pairs. For example, one key is <code>HOSTTYPE</code> and its value is <code>x86_64</code>. From a C perspective, all values are strings, even if they’re numbers<a href="https://beej.us/guide/bgc/html/index-wide.html#fn124" class="footnote-ref" id="fnref124" role="doc-noteref"><sup>124</sup></a>.</p>
<p>So, <em>anyway</em>! Long story short, it’s possible to get these values from inside your C program.</p>
<p></p>
<p>Let’s write a program that uses the standard <code>getenv()</code> function to look up a value that you set in the shell.</p>
<p><code>getenv()</code> will return a pointer to the value string, or else <code>NULL</code> if the environment variable doesn’t exist.</p>
<div class="sourceCode" id="cb325"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb325-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb325-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb325-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb325-2"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb325-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb325-3"></a></span>
<span id="cb325-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb325-4"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb325-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb325-5"></a><span class="op">{</span></span>
<span id="cb325-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb325-6"></a>    <span class="dt">char</span> <span class="op">*</span>val <span class="op">=</span> getenv<span class="op">(</span><span class="st">"FROTZ"</span><span class="op">);</span>  <span class="co">// Try to get the value</span></span>
<span id="cb325-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb325-7"></a></span>
<span id="cb325-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb325-8"></a>    <span class="co">// Check to make sure it exists</span></span>
<span id="cb325-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb325-9"></a>    <span class="cf">if</span> <span class="op">(</span>val <span class="op">==</span> NULL<span class="op">)</span> <span class="op">{</span></span>
<span id="cb325-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb325-10"></a>        printf<span class="op">(</span><span class="st">"Cannot find the FROTZ environment variable</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb325-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb325-11"></a>        <span class="cf">return</span> EXIT_FAILURE<span class="op">;</span></span>
<span id="cb325-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb325-12"></a>    <span class="op">}</span></span>
<span id="cb325-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb325-13"></a></span>
<span id="cb325-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb325-14"></a>    printf<span class="op">(</span><span class="st">"Value: </span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> val<span class="op">);</span></span>
<span id="cb325-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb325-15"></a><span class="op">}</span></span></code></pre></div>
<p></p>
<p>If I run this directly, I get this:</p>
<div class="sourceCode" id="cb326"><pre class="sourceCode zsh"><code class="sourceCode zsh"><span id="cb326-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb326-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> ./foo</span>
<span id="cb326-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb326-2" aria-hidden="true" tabindex="-1"></a><span class="ex">Cannot</span> find the FROTZ environment variable</span></code></pre></div>
<p>which makes sense, since I haven’t set it yet.</p>
<p>In bash, I can set it to something with<a href="https://beej.us/guide/bgc/html/index-wide.html#fn125" class="footnote-ref" id="fnref125" role="doc-noteref"><sup>125</sup></a>:</p>
<div class="sourceCode" id="cb327"><pre class="sourceCode zsh"><code class="sourceCode zsh"><span id="cb327-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb327-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> export FROTZ=<span class="st">"C is awesome!"</span></span></code></pre></div>
<p>Then if I run it, I get:</p>
<div class="sourceCode" id="cb328"><pre class="sourceCode zsh"><code class="sourceCode zsh"><span id="cb328-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb328-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> ./foo</span>
<span id="cb328-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb328-2" aria-hidden="true" tabindex="-1"></a><span class="ex">Value:</span> C is awesome!</span></code></pre></div>
<p>In this way, you can set up data in environment variables, and you can get it in your C code and modify your behavior accordingly.</p>
<h3 data-number="18.3.1" id="setting-environment-variables"><span class="header-section-number">18.3.1</span> Setting Environment Variables</h3>
<p>This isn’t standard, but a lot of systems provide ways to set environment variables.</p>
<p>If on a Unix-like, look up the documentation for <code>putenv()</code>, <code>setenv()</code>, and <code>unsetenv()</code>. On Windows, see <code>_putenv()</code>.</p>
<h3 data-number="18.3.2" id="unix-like-alternative-environment-variables"><span class="header-section-number">18.3.2</span> Unix-like Alternative Environment Variables</h3>
<p>If you’re on a Unix-like system, odds are you have another couple ways of getting access to environment variables. Note that although the spec points this out as a common extension, it’s not truly part of the C standard. It is, however, part of the POSIX standard.</p>
<p></p>
<p>One of these is a variable called <code>environ</code> that must be declared like so:</p>
<div class="sourceCode" id="cb329"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb329-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb329-1" aria-hidden="true" tabindex="-1"></a><span class="kw">extern</span> <span class="dt">char</span> <span class="op">**</span>environ<span class="op">;</span></span></code></pre></div>
<p>It’s an array of strings terminated with a <code>NULL</code> pointer.</p>
<p>You should declare it yourself before you use it, or you might find it in the non-standard <code>&lt;unistd.h&gt;</code> header file.</p>
<p>Each string is in the form <code>"key=value"</code> so you’ll have to split it and parse it yourself if you want to get the keys and values out.</p>
<p>Here’s an example of looping through and printing out the environment variables a couple different ways:</p>
<div class="sourceCode" id="cb330"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb330-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb330-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb330-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb330-2"></a></span>
<span id="cb330-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb330-3"></a><span class="kw">extern</span> <span class="dt">char</span> <span class="op">**</span>environ<span class="op">;</span>  <span class="co">// MUST be extern AND named "environ"</span></span>
<span id="cb330-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb330-4"></a></span>
<span id="cb330-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb330-5"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb330-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb330-6"></a><span class="op">{</span></span>
<span id="cb330-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb330-7"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">char</span> <span class="op">**</span>p <span class="op">=</span> environ<span class="op">;</span> <span class="op">*</span>p <span class="op">!=</span> NULL<span class="op">;</span> p<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb330-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb330-8"></a>        printf<span class="op">(</span><span class="st">"</span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> <span class="op">*</span>p<span class="op">);</span></span>
<span id="cb330-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb330-9"></a>    <span class="op">}</span></span>
<span id="cb330-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb330-10"></a></span>
<span id="cb330-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb330-11"></a>    <span class="co">// Or you could do this:</span></span>
<span id="cb330-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb330-12"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> environ<span class="op">[</span>i<span class="op">]</span> <span class="op">!=</span> NULL<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb330-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb330-13"></a>        printf<span class="op">(</span><span class="st">"</span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> environ<span class="op">[</span>i<span class="op">]);</span></span>
<span id="cb330-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb330-14"></a>    <span class="op">}</span></span>
<span id="cb330-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb330-15"></a><span class="op">}</span></span></code></pre></div>
<p>For a bunch of output that looks like this:</p>
<div class="sourceCode" id="cb331"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb331-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb331-1" aria-hidden="true" tabindex="-1"></a>SHELL=/bin/bash</span>
<span id="cb331-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb331-2" aria-hidden="true" tabindex="-1"></a>COLORTERM=truecolor</span>
<span id="cb331-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb331-3" aria-hidden="true" tabindex="-1"></a>TERM_PROGRAM_VERSION=1.53.2</span>
<span id="cb331-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb331-4" aria-hidden="true" tabindex="-1"></a>LOGNAME=beej</span>
<span id="cb331-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb331-5" aria-hidden="true" tabindex="-1"></a>HOME=/home/beej</span>
<span id="cb331-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb331-6" aria-hidden="true" tabindex="-1"></a>... etc ...</span></code></pre></div>
<p>Use <code>getenv()</code> if at all possible because it’s more portable. But if you have to iterate over environment variables, using <code>environ</code> might be the way to go.</p>
<p> </p>
<p>Another non-standard way to get the environment variables is as a parameter to <code>main()</code>. It works much the same way, but you avoid needing to add your <code>extern</code> <code>environ</code> variable. <a href="https://pubs.opengroup.org/onlinepubs/9699919799/functions/exec.html">Not even the POSIX spec supports this</a><a href="https://beej.us/guide/bgc/html/index-wide.html#fn126" class="footnote-ref" id="fnref126" role="doc-noteref"><sup>126</sup></a> as far as I can tell, but it’s common in Unix land.</p>
<div class="sourceCode" id="cb332"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb332-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb332-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb332-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb332-2"></a></span>
<span id="cb332-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb332-3"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">int</span> argc<span class="op">,</span> <span class="dt">char</span> <span class="op">**</span>argv<span class="op">,</span> <span class="dt">char</span> <span class="op">**</span>env<span class="op">)</span>  <span class="co">// &lt;-- env!</span></span>
<span id="cb332-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb332-4"></a><span class="op">{</span></span>
<span id="cb332-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb332-5"></a>    <span class="op">(</span><span class="dt">void</span><span class="op">)</span>argc<span class="op">;</span> <span class="op">(</span><span class="dt">void</span><span class="op">)</span>argv<span class="op">;</span>  <span class="co">// Suppress unused warnings</span></span>
<span id="cb332-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb332-6"></a></span>
<span id="cb332-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb332-7"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">char</span> <span class="op">**</span>p <span class="op">=</span> env<span class="op">;</span> <span class="op">*</span>p <span class="op">!=</span> NULL<span class="op">;</span> p<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb332-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb332-8"></a>        printf<span class="op">(</span><span class="st">"</span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> <span class="op">*</span>p<span class="op">);</span></span>
<span id="cb332-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb332-9"></a>    <span class="op">}</span></span>
<span id="cb332-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb332-10"></a></span>
<span id="cb332-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb332-11"></a>    <span class="co">// Or you could do this:</span></span>
<span id="cb332-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb332-12"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> env<span class="op">[</span>i<span class="op">]</span> <span class="op">!=</span> NULL<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb332-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb332-13"></a>        printf<span class="op">(</span><span class="st">"</span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> env<span class="op">[</span>i<span class="op">]);</span></span>
<span id="cb332-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb332-14"></a>    <span class="op">}</span></span>
<span id="cb332-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb332-15"></a><span class="op">}</span></span></code></pre></div>
<p>Just like using <code>environ</code> but <em>even less portable</em>. It’s good to have goals.</p>
<p> </p>
<!-- Beej's guide to C

# vim: ts=4:sw=4:nosi:et:tw=72
-->
<h1 data-number="19" id="the-c-preprocessor"><span class="header-section-number">19</span> The C Preprocessor</h1>
<p></p>
<p>Before your program gets compiled, it actually runs through a phase called <em>preprocessing</em>. It’s almost like there’s a language <em>on top</em> of the C language that runs first. And it outputs the C code, which then gets compiled.</p>
<p>We’ve already seen this to an extent with <code>#include</code>! That’s the C Preprocessor! Where it sees that directive, it includes the named file right there, just as if you’d typed it in there. And <em>then</em> the compiler builds the whole thing.</p>
<p>But it turns out it’s a lot more powerful than just being able to include things. You can define <em>macros</em> that are substituted… and even macros that take arguments!</p>
<h2 data-number="19.1" id="include"><span class="header-section-number">19.1</span> <code>#include</code></h2>
<p></p>
<p>Let’s start with the one we’ve already seen a bunch. This is, of course, a way to include other sources in your source. Very commonly used with header files.</p>
<p>While the spec allows for all kinds of behavior with <code>#include</code>, we’re going to take a more pragmatic approach and talk about the way it works on every system I’ve ever seen.</p>
<p>We can split header files into two categories: system and local. Things that are built-in, like <code>stdio.h</code>, <code>stdlib.h</code>, <code>math.h</code>, and so on, you can include with angle brackets:</p>
<div class="sourceCode" id="cb333"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb333-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb333-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb333-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb333-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span></code></pre></div>
<p>The angle brackets tell C, “Hey, don’t look in the current directory for this header file—look in the system-wide include directory instead.”</p>
<p></p>
<p>Which, of course, implies that there must be a way to include local files from the current directory. And there is: with double quotes:</p>
<div class="sourceCode" id="cb334"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb334-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb334-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">"myheader.h"</span></span></code></pre></div>
<p>Or you can very probably look in relative directories using forward slashes and dots, like this:</p>
<div class="sourceCode" id="cb335"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb335-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb335-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">"mydir/myheader.h"</span></span>
<span id="cb335-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb335-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">"../someheader.py"</span></span></code></pre></div>
<p>Don’t use a backslash (<code>\</code>) for your path separators in your <code>#include</code>! It’s undefined behavior! Use forward slash (<code>/</code>) only, even on Windows.</p>
<p>In summary, used angle brackets (<code>&lt;</code> and <code>&gt;</code>) for the system includes, and use double quotes (<code>"</code>) for your personal includes.</p>
<p> </p>
<h2 data-number="19.2" id="simple-macros"><span class="header-section-number">19.2</span> Simple Macros</h2>
<p></p>
<p>A <em>macro</em> is an identifier that gets <em>expanded</em> to another piece of code before the compiler even sees it. Think of it like a placeholder—when the preprocessor sees one of those identifiers, it replaces it with another value that you’ve defined.</p>
<p></p>
<p>We do this with <code>#define</code> (often read “pound define”). Here’s an example:</p>
<div class="sourceCode" id="cb336"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb336-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb336-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb336-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb336-2"></a></span>
<span id="cb336-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb336-3"></a><span class="pp">#define HELLO </span><span class="st">"Hello, world"</span></span>
<span id="cb336-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb336-4"></a><span class="pp">#define PI </span><span class="fl">3.14159</span></span>
<span id="cb336-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb336-5"></a></span>
<span id="cb336-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb336-6"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb336-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb336-7"></a><span class="op">{</span></span>
<span id="cb336-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb336-8"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%s</span><span class="st">, </span><span class="sc">%f\n</span><span class="st">"</span><span class="op">,</span> HELLO<span class="op">,</span> PI<span class="op">);</span></span>
<span id="cb336-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb336-9"></a><span class="op">}</span></span></code></pre></div>
<p>On lines 3 and 4 we defined a couple macros. Wherever these appear elsewhere in the code (line 8), they’ll be substituted with the defined values.</p>
<p>From the C compiler’s perspective, it’s exactly as if we’d written this, instead:</p>
<div class="sourceCode" id="cb337"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb337-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb337-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb337-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb337-2"></a></span>
<span id="cb337-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb337-3"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb337-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb337-4"></a><span class="op">{</span></span>
<span id="cb337-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb337-5"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%s</span><span class="st">, </span><span class="sc">%f\n</span><span class="st">"</span><span class="op">,</span> <span class="st">"Hello, world"</span><span class="op">,</span> <span class="fl">3.14159</span><span class="op">);</span></span>
<span id="cb337-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb337-6"></a><span class="op">}</span></span></code></pre></div>
<p>See how <code>HELLO</code> was replaced with <code>"Hello, world"</code> and <code>PI</code> was replaced with <code>3.14159</code>? From the compiler’s perspective, it’s just like those values had appeared right there in the code.</p>
<p>Note that the macros don’t have a specific type, <em>per se</em>. Really all that happens is they get replaced wholesale with whatever they’re <code>#define</code>d as. If the resulting C code is invalid, the compiler will puke.</p>
<p>You can also define a macro with no value:</p>
<div class="sourceCode" id="cb338"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb338-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb338-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#define EXTRA_HAPPY</span></span></code></pre></div>
<p>in that case, the macro exists and is defined, but is defined to be nothing. So anyplace it occurs in the text will just be replaced with nothing. We’ll see a use for this later.</p>
<p>It’s conventional to write macro names in <code>ALL_CAPS</code> even though that’s not technically required.</p>
<p></p>
<p>Overall, this gives you a way to define constant values that are effectively global and can be used <em>any</em> place. Even in those places where a <code>const</code> variable won’t work, e.g.&nbsp;in <code>switch</code> <code>case</code>s and fixed array lengths.</p>
<p>That said, the debate rages online whether a typed <code>const</code> variable is better than <code>#define</code> macro in the general case.</p>
<p>It can also be used to replace or modify keywords, a concept completely foreign to <code>const</code>, though this practice should be used sparingly.</p>
<p> </p>
<h2 data-number="19.3" id="conditional-compilation"><span class="header-section-number">19.3</span> Conditional Compilation</h2>
<p></p>
<p>It’s possible to get the preprocessor to decide whether or not to present certain blocks of code to the compiler, or just remove them entirely before compilation.</p>
<p>We do that by basically wrapping up the code in conditional blocks, similar to <code>if</code>-<code>else</code> statements.</p>
<h3 data-number="19.3.1" id="if-defined-ifdef-and-endif"><span class="header-section-number">19.3.1</span> If Defined, <code>#ifdef</code> and <code>#endif</code></h3>
<p>First of all, let’s try to compile specific code depending on whether or not a macro is even defined.</p>
<p> </p>
<div class="sourceCode" id="cb339"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb339-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb339-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb339-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb339-2"></a></span>
<span id="cb339-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb339-3"></a><span class="pp">#define EXTRA_HAPPY</span></span>
<span id="cb339-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb339-4"></a></span>
<span id="cb339-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb339-5"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb339-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb339-6"></a><span class="op">{</span></span>
<span id="cb339-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb339-7"></a></span>
<span id="cb339-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb339-8"></a><span class="pp">#ifdef EXTRA_HAPPY</span></span>
<span id="cb339-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb339-9"></a>    printf<span class="op">(</span><span class="st">"I'm extra happy!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb339-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb339-10"></a><span class="pp">#endif</span></span>
<span id="cb339-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb339-11"></a></span>
<span id="cb339-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb339-12"></a>    printf<span class="op">(</span><span class="st">"OK!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb339-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb339-13"></a><span class="op">}</span></span></code></pre></div>
<p>In that example, we define <code>EXTRA_HAPPY</code> (to be nothing, but it <em>is</em> defined), then on line 8 we check to see if it is defined with an <code>#ifdef</code> directive. If it is defined, the subsequent code will be included up until the <code>#endif</code>.</p>
<p> </p>
<p>So because it is defined, the code will be included for compilation and the output will be:</p>
<div class="sourceCode" id="cb340"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb340-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb340-1" aria-hidden="true" tabindex="-1"></a>I'm extra happy!</span>
<span id="cb340-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb340-2" aria-hidden="true" tabindex="-1"></a>OK!</span></code></pre></div>
<p>If we were to comment out the <code>#define</code>, like so:</p>
<div class="sourceCode" id="cb341"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb341-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb341-1" aria-hidden="true" tabindex="-1"></a><span class="co">//#define EXTRA_HAPPY</span></span></code></pre></div>
<p>then it wouldn’t be defined, and the code wouldn’t be included in compilation. And the output would just be:</p>
<div class="sourceCode" id="cb342"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb342-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb342-1" aria-hidden="true" tabindex="-1"></a>OK!</span></code></pre></div>
<p>It’s important to remember that these decisions happen at compile time! The code actually gets compiled or removed depending on the condition. This is in contrast to a standard <code>if</code> statement that gets evaluated while the program is running.</p>
<h3 data-number="19.3.2" id="if-not-defined-ifndef"><span class="header-section-number">19.3.2</span> If Not Defined, <code>#ifndef</code></h3>
<p>There’s also the negative sense of “if defined”: “if not defined”, or <code>#ifndef</code>. We could change the previous example to output different things based on whether or not something was defined:</p>
<p> </p>
<div class="sourceCode" id="cb343" data-startfrom="8"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c" style="counter-reset: source-line 7;"><span id="cb343-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb343-8"></a><span class="pp">#ifdef EXTRA_HAPPY</span></span>
<span id="cb343-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb343-9"></a>    printf<span class="op">(</span><span class="st">"I'm extra happy!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb343-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb343-10"></a><span class="pp">#endif</span></span>
<span id="cb343-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb343-11"></a></span>
<span id="cb343-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb343-12"></a><span class="pp">#ifndef EXTRA_HAPPY</span></span>
<span id="cb343-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb343-13"></a>    printf<span class="op">(</span><span class="st">"I'm just regular</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb343-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb343-14"></a><span class="pp">#endif</span></span></code></pre></div>
<p>We’ll see a cleaner way to do that in the next section.</p>
<p>Tying it all back in to header files, we’ve seen how we can cause header files to only be included one time by wrapping them in preprocessor directives like this:</p>
<div class="sourceCode" id="cb344"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb344-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb344-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#ifndef MYHEADER_H  </span><span class="co">// First line of myheader.h</span></span>
<span id="cb344-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb344-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#define MYHEADER_H</span></span>
<span id="cb344-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb344-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb344-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb344-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> x <span class="op">=</span> <span class="dv">12</span><span class="op">;</span></span>
<span id="cb344-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb344-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb344-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb344-6" aria-hidden="true" tabindex="-1"></a><span class="pp">#endif  </span><span class="co">// Last line of myheader.h</span></span></code></pre></div>
<p> </p>
<p>This demonstrates how a macro persists across files and multiple <code>#include</code>s. If it’s not yet defined, let’s define it and compile the whole header file.</p>
<p>But the next time it’s included, we see that <code>MYHEADER_H</code> <em>is</em> defined, so we don’t send the header file to the compiler—it gets effectively removed.</p>
<h3 data-number="19.3.3" id="else"><span class="header-section-number">19.3.3</span> <code>#else</code></h3>
<p></p>
<p>But that’s not all we can do! There’s also an <code>#else</code> that we can throw in the mix.</p>
<p> </p>
<p>Let’s mod the previous example:</p>
<div class="sourceCode" id="cb345" data-startfrom="8"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c" style="counter-reset: source-line 7;"><span id="cb345-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb345-8"></a><span class="pp">#ifdef EXTRA_HAPPY</span></span>
<span id="cb345-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb345-9"></a>    printf<span class="op">(</span><span class="st">"I'm extra happy!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb345-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb345-10"></a><span class="pp">#else</span></span>
<span id="cb345-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb345-11"></a>    printf<span class="op">(</span><span class="st">"I'm just regular</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb345-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb345-12"></a><span class="pp">#endif</span></span></code></pre></div>
<p> </p>
<p>Now if <code>EXTRA_HAPPY</code> is not defined, it’ll hit the <code>#else</code> clause and print:</p>
<div class="sourceCode" id="cb346"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb346-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb346-1" aria-hidden="true" tabindex="-1"></a>I'm just regular</span></code></pre></div>
<h3 data-number="19.3.4" id="general-conditional-if-elif"><span class="header-section-number">19.3.4</span> General Conditional: <code>#if</code>, <code>#elif</code></h3>
<p> </p>
<p>This works very much like the <code>#ifdef</code> and <code>#ifndef</code> directives in that you can also have an <code>#else</code> and the whole thing wraps up with <code>#endif</code>.</p>
<p>The only difference is that the constant expression after the <code>#if</code> must evaluate to true (non-zero) for the code in the <code>#if</code> to be compiled. So instead of whether or not something is defined, we want an expression that evaluates to true.</p>
<div class="sourceCode" id="cb347"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb347-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb347-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb347-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb347-2"></a></span>
<span id="cb347-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb347-3"></a><span class="pp">#define HAPPY_FACTOR </span><span class="dv">1</span></span>
<span id="cb347-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb347-4"></a></span>
<span id="cb347-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb347-5"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb347-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb347-6"></a><span class="op">{</span></span>
<span id="cb347-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb347-7"></a></span>
<span id="cb347-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb347-8"></a><span class="pp">#if HAPPY_FACTOR == 0</span></span>
<span id="cb347-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb347-9"></a>    printf<span class="op">(</span><span class="st">"I'm not happy!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb347-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb347-10"></a><span class="pp">#elif HAPPY_FACTOR == 1</span></span>
<span id="cb347-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb347-11"></a>    printf<span class="op">(</span><span class="st">"I'm just regular</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb347-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb347-12"></a><span class="pp">#else</span></span>
<span id="cb347-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb347-13"></a>    printf<span class="op">(</span><span class="st">"I'm extra happy!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb347-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb347-14"></a><span class="pp">#endif</span></span>
<span id="cb347-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb347-15"></a></span>
<span id="cb347-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb347-16"></a>    printf<span class="op">(</span><span class="st">"OK!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb347-17"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb347-17"></a><span class="op">}</span></span></code></pre></div>
<p></p>
<p>Again, for the unmatched <code>#if</code> clauses, the compiler won’t even see those lines. For the above code, after the preprocessor gets finished with it, all the compiler sees is:</p>
<div class="sourceCode" id="cb348"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb348-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb348-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb348-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb348-2"></a></span>
<span id="cb348-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb348-3"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb348-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb348-4"></a><span class="op">{</span></span>
<span id="cb348-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb348-5"></a></span>
<span id="cb348-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb348-6"></a>    printf<span class="op">(</span><span class="st">"I'm just regular</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb348-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb348-7"></a></span>
<span id="cb348-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb348-8"></a>    printf<span class="op">(</span><span class="st">"OK!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb348-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb348-9"></a><span class="op">}</span></span></code></pre></div>
<p>One hackish thing this is used for is to comment out large numbers of lines quickly<a href="https://beej.us/guide/bgc/html/index-wide.html#fn127" class="footnote-ref" id="fnref127" role="doc-noteref"><sup>127</sup></a>.</p>
<p></p>
<p>If you put an <code>#if 0</code> (“if false”) at the front of the block to be commented out and an <code>#endif</code> at the end, you can get this effect:</p>
<div class="sourceCode" id="cb349"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb349-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb349-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#if 0</span></span>
<span id="cb349-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb349-2" aria-hidden="true" tabindex="-1"></a><span class="co">    printf(</span><span class="st">"All this code"</span><span class="co">); /* is effectively */</span></span>
<span id="cb349-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb349-3" aria-hidden="true" tabindex="-1"></a><span class="co">    printf(</span><span class="st">"commented out"</span><span class="co">); // by the #if 0</span></span>
<span id="cb349-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb349-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#endif</span></span></code></pre></div>
<p></p>
<p>You might have noticed that there’s no <code>#elifdef</code> or <code>#elifndef</code> directives. How can we get the same effect with <code>#if</code>? That is, what if I wanted this:</p>
<div class="sourceCode" id="cb350"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb350-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb350-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#ifdef FOO</span></span>
<span id="cb350-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb350-2" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb350-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb350-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#elifdef BAR  </span><span class="co">// ERROR: Not supported by standard C</span></span>
<span id="cb350-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb350-4" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="dv">3</span><span class="op">;</span></span>
<span id="cb350-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb350-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#endif</span></span></code></pre></div>
<p>How could I do it?</p>
<p>Turns out there’s a preprocessor operator called <code>defined</code> that we can use with an <code>#if</code> statement.</p>
<p>These are equivalent:</p>
<p></p>
<div class="sourceCode" id="cb351"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb351-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb351-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#ifdef FOO</span></span>
<span id="cb351-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb351-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#if defined FOO</span></span>
<span id="cb351-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb351-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#if defined(FOO)   </span><span class="co">// Parentheses optional</span></span></code></pre></div>
<p>As are these:</p>
<div class="sourceCode" id="cb352"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb352-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb352-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#ifndef FOO</span></span>
<span id="cb352-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb352-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#if !defined FOO</span></span>
<span id="cb352-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb352-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#if !defined(FOO)   </span><span class="co">// Parentheses optional</span></span></code></pre></div>
<p>Notice how we can use the standard logical NOT operator (<code>!</code>) for “not defined”.</p>
<p>So now we’re back in <code>#if</code> land and we can use <code>#elif</code> with impunity!</p>
<p>This broken code:</p>
<div class="sourceCode" id="cb353"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb353-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb353-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#ifdef FOO</span></span>
<span id="cb353-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb353-2" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb353-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb353-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#elifdef BAR  </span><span class="co">// ERROR: Not supported by standard C</span></span>
<span id="cb353-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb353-4" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="dv">3</span><span class="op">;</span></span>
<span id="cb353-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb353-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#endif</span></span></code></pre></div>
<p>can be replaced with:</p>
<div class="sourceCode" id="cb354"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb354-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb354-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#if defined FOO</span></span>
<span id="cb354-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb354-2" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb354-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb354-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#elif defined BAR</span></span>
<span id="cb354-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb354-4" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="dv">3</span><span class="op">;</span></span>
<span id="cb354-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb354-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#endif</span></span></code></pre></div>
<p> </p>
<h3 data-number="19.3.5" id="losing-a-macro-undef"><span class="header-section-number">19.3.5</span> Losing a Macro: <code>#undef</code></h3>
<p></p>
<p>If you’ve defined something but you don’t need it any longer, you can undefine it with <code>#undef</code>.</p>
<div class="sourceCode" id="cb355"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb355-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb355-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb355-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb355-2"></a></span>
<span id="cb355-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb355-3"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb355-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb355-4"></a><span class="op">{</span></span>
<span id="cb355-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb355-5"></a><span class="pp">#define GOATS</span></span>
<span id="cb355-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb355-6"></a></span>
<span id="cb355-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb355-7"></a><span class="pp">#ifdef GOATS</span></span>
<span id="cb355-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb355-8"></a>    printf<span class="op">(</span><span class="st">"Goats detected!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span>  <span class="co">// prints</span></span>
<span id="cb355-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb355-9"></a><span class="pp">#endif</span></span>
<span id="cb355-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb355-10"></a></span>
<span id="cb355-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb355-11"></a><span class="pp">#undef GOATS  </span><span class="co">// Make GOATS no longer defined</span></span>
<span id="cb355-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb355-12"></a></span>
<span id="cb355-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb355-13"></a><span class="pp">#ifdef GOATS</span></span>
<span id="cb355-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb355-14"></a>    printf<span class="op">(</span><span class="st">"Goats detected, again!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span> <span class="co">// doesn't print</span></span>
<span id="cb355-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb355-15"></a><span class="pp">#endif</span></span>
<span id="cb355-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb355-16"></a><span class="op">}</span></span></code></pre></div>
<p></p>
<h2 data-number="19.4" id="built-in-macros"><span class="header-section-number">19.4</span> Built-in Macros</h2>
<p></p>
<p>The standard defines a lot of built-in macros that you can test and use for conditional compilation. Let’s look at those here.</p>
<h3 data-number="19.4.1" id="mandatory-macros"><span class="header-section-number">19.4.1</span> Mandatory Macros</h3>
<p>These are all defined:</p>
<p> </p>
<table>
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th>Macro</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>__DATE__</code></td>
<td>The date of compilation—like when you’re compiling this file—in <code>Mmm dd yyyy</code> format</td>
</tr>
<tr class="even">
<td><code>__TIME__</code></td>
<td>The time of compilation in <code>hh:mm:ss</code> format</td>
</tr>
<tr class="odd">
<td><code>__FILE__</code></td>
<td>A string containing this file’s name</td>
</tr>
<tr class="even">
<td><code>__LINE__</code></td>
<td>The line number of the file this macro appears on</td>
</tr>
<tr class="odd">
<td><code>__func__</code></td>
<td>The name of the function this appears in, as a string<a href="https://beej.us/guide/bgc/html/index-wide.html#fn128" class="footnote-ref" id="fnref128" role="doc-noteref"><sup>128</sup></a></td>
</tr>
<tr class="even">
<td><code>__STDC__</code></td>
<td>Defined with <code>1</code> if this is a standard C compiler</td>
</tr>
<tr class="odd">
<td><code>__STDC_HOSTED__</code></td>
<td>This will be <code>1</code> if the compiler is a <em>hosted implementation</em><a href="https://beej.us/guide/bgc/html/index-wide.html#fn129" class="footnote-ref" id="fnref129" role="doc-noteref"><sup>129</sup></a>, otherwise <code>0</code></td>
</tr>
<tr class="even">
<td><code>__STDC_VERSION__</code></td>
<td>This version of C, a constant <code>long int</code> in the form <code>yyyymmL</code>, e.g.&nbsp;<code>201710L</code></td>
</tr>
</tbody>
</table>
<p>Let’s put these together.</p>
<div class="sourceCode" id="cb356"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb356-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb356-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb356-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb356-2"></a></span>
<span id="cb356-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb356-3"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb356-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb356-4"></a><span class="op">{</span></span>
<span id="cb356-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb356-5"></a>    printf<span class="op">(</span><span class="st">"This function: </span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> __func__<span class="op">);</span></span>
<span id="cb356-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb356-6"></a>    printf<span class="op">(</span><span class="st">"This file: </span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> __FILE__<span class="op">);</span></span>
<span id="cb356-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb356-7"></a>    printf<span class="op">(</span><span class="st">"This line: </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> __LINE__<span class="op">);</span></span>
<span id="cb356-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb356-8"></a>    printf<span class="op">(</span><span class="st">"Compiled on: </span><span class="sc">%s</span><span class="st"> </span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> __DATE__<span class="op">,</span> __TIME__<span class="op">);</span></span>
<span id="cb356-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb356-9"></a>    printf<span class="op">(</span><span class="st">"C Version: </span><span class="sc">%ld\n</span><span class="st">"</span><span class="op">,</span> __STDC_VERSION__<span class="op">);</span></span>
<span id="cb356-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb356-10"></a><span class="op">}</span></span></code></pre></div>
<p> </p>
<p>The output on my system is:</p>
<div class="sourceCode" id="cb357"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb357-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb357-1" aria-hidden="true" tabindex="-1"></a>This function: main</span>
<span id="cb357-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb357-2" aria-hidden="true" tabindex="-1"></a>This file: foo.c</span>
<span id="cb357-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb357-3" aria-hidden="true" tabindex="-1"></a>This line: 7</span>
<span id="cb357-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb357-4" aria-hidden="true" tabindex="-1"></a>Compiled on: Nov 23 2020 17:16:27</span>
<span id="cb357-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb357-5" aria-hidden="true" tabindex="-1"></a>C Version: 201710</span></code></pre></div>
<p><code>__FILE__</code>, <code>__func__</code> and <code>__LINE__</code> are particularly useful to report error conditions in messages to developers. The <code>assert()</code> macro in <code>&lt;assert.h&gt;</code> uses these to call out where in the code the assertion failed.</p>
<p> </p>
<h4 data-number="19.4.1.1" id="stdc_version__s"><span class="header-section-number">19.4.1.1</span> <code>__STDC_VERSION__</code>s</h4>
<p></p>
<p>In case you’re wondering, here are the version numbers for different major releases of the C Language Spec:</p>
<table>
<thead>
<tr class="header">
<th>Release</th>
<th>ISO/IEC version</th>
<th><code>__STDC_VERSION__</code></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>C89</td>
<td>ISO/IEC 9899:1990</td>
<td>undefined</td>
</tr>
<tr class="even">
<td><strong>C89</strong></td>
<td>ISO/IEC 9899:1990/Amd.1:1995</td>
<td><code>199409L</code></td>
</tr>
<tr class="odd">
<td><strong>C99</strong></td>
<td>ISO/IEC 9899:1999</td>
<td><code>199901L</code></td>
</tr>
<tr class="even">
<td><strong>C11</strong></td>
<td>ISO/IEC 9899:2011/Amd.1:2012</td>
<td><code>201112L</code></td>
</tr>
</tbody>
</table>
<p>Note the macro did not exist originally in C89.</p>
<p>Also note that the plan is that the version numbers will strictly increase, so you could always check for, say, “at least C99” with:</p>
<div class="sourceCode" id="cb358"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb358-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb358-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#if __STDC_VERSION__ &gt;= 1999901L</span></span></code></pre></div>
<p> </p>
<h3 data-number="19.4.2" id="optional-macros"><span class="header-section-number">19.4.2</span> Optional Macros</h3>
<p>Your implementation might define these, as well. Or it might not.</p>
<table>
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th>Macro</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>__STDC_ISO_10646__</code></td>
<td>If defined, <code>wchar_t</code> holds Unicode values, otherwise something else</td>
</tr>
<tr class="even">
<td><code>__STDC_MB_MIGHT_NEQ_WC__</code></td>
<td>A <code>1</code> indicates that the values in multibyte characters might not map equally to values in wide characters</td>
</tr>
<tr class="odd">
<td><code>__STDC_UTF_16__</code></td>
<td>A <code>1</code> indicates that the system uses UTF-16 encoding in type <code>char16_t</code></td>
</tr>
<tr class="even">
<td><code>__STDC_UTF_32__</code></td>
<td>A <code>1</code> indicates that the system uses UTF-32 encoding in type <code>char32_t</code></td>
</tr>
<tr class="odd">
<td><code>__STDC_ANALYZABLE__</code></td>
<td>A <code>1</code> indicates the code is analyzable<a href="https://beej.us/guide/bgc/html/index-wide.html#fn130" class="footnote-ref" id="fnref130" role="doc-noteref"><sup>130</sup></a></td>
</tr>
<tr class="even">
<td><code>__STDC_IEC_559__</code></td>
<td><code>1</code> if IEEE-754 (aka IEC 60559) floating point is supported</td>
</tr>
<tr class="odd">
<td><code>__STDC_IEC_559_COMPLEX__</code></td>
<td><code>1</code> if IEC 60559 complex floating point is supported</td>
</tr>
<tr class="even">
<td><code>__STDC_LIB_EXT1__</code></td>
<td><code>1</code> if this implementation supports a variety of “safe” alternate standard library functions (they have <code>_s</code> suffixes on the name)</td>
</tr>
<tr class="odd">
<td><code>__STDC_NO_ATOMICS__</code></td>
<td><code>1</code> if this implementation does <strong>not</strong> support <code>_Atomic</code> or <code>&lt;stdatomic.h&gt;</code></td>
</tr>
<tr class="even">
<td><code>__STDC_NO_COMPLEX__</code></td>
<td><code>1</code> if this implementation does <strong>not</strong> support complex types or <code>&lt;complex.h&gt;</code></td>
</tr>
<tr class="odd">
<td><code>__STDC_NO_THREADS__</code></td>
<td><code>1</code> if this implementation does <strong>not</strong> support <code>&lt;threads.h&gt;</code></td>
</tr>
<tr class="even">
<td><code>__STDC_NO_VLA__</code></td>
<td><code>1</code> if this implementation does <strong>not</strong> support variable-length arrays</td>
</tr>
</tbody>
</table>
<p></p>
<h2 data-number="19.5" id="macros-with-arguments"><span class="header-section-number">19.5</span> Macros with Arguments</h2>
<p></p>
<p>Macros are more powerful than simple substitution, though. You can set them up to take arguments that are substituted in, as well.</p>
<p>A question often arises for when to use parameterized macros versus functions. Short answer: use functions. But you’ll see lots of macros in the wild and in the standard library. People tend to use them for short, mathy things, and also for features that might change from platform to platform. You can define different keywords for one platform or another.</p>
<h3 data-number="19.5.1" id="macros-with-one-argument"><span class="header-section-number">19.5.1</span> Macros with One Argument</h3>
<p>Let’s start with a simple one that squares a number:</p>
<p></p>
<div class="sourceCode" id="cb359"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb359-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb359-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb359-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb359-2"></a></span>
<span id="cb359-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb359-3"></a><span class="pp">#define SQR</span><span class="op">(</span><span class="pp">x</span><span class="op">)</span><span class="pp"> x </span><span class="op">*</span><span class="pp"> x  </span><span class="co">// Not quite right, but bear with me</span></span>
<span id="cb359-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb359-4"></a></span>
<span id="cb359-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb359-5"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb359-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb359-6"></a><span class="op">{</span></span>
<span id="cb359-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb359-7"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> SQR<span class="op">(</span><span class="dv">12</span><span class="op">));</span>  <span class="co">// 144</span></span>
<span id="cb359-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb359-8"></a><span class="op">}</span></span></code></pre></div>
<p>What that’s saying is “everywhere you see <code>SQR</code> with some value, replace it with that value times itself”.</p>
<p>So line 7 will be changed to:</p>
<div class="sourceCode" id="cb360" data-startfrom="7"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c" style="counter-reset: source-line 6;"><span id="cb360-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb360-7"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> <span class="dv">12</span> <span class="op">*</span> <span class="dv">12</span><span class="op">);</span>  <span class="co">// 144</span></span></code></pre></div>
<p>which C comfortably converts to 144.</p>
<p>But we’ve made an elementary error in that macro, one that we need to avoid.</p>
<p>Let’s check it out. What if we wanted to compute <code>SQR(3 + 4)</code>? Well, <span class="math inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="33" style="font-size: 101.6%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c33"></mjx-c></mjx-mn><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="3"><mjx-c class="mjx-c34"></mjx-c></mjx-mn><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c37"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>3</mn><mo>+</mo><mn>4</mn><mo>=</mo><mn>7</mn></math></mjx-assistive-mml></mjx-container></span>, so we must want to compute <span class="math inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="34" style="font-size: 101.6%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-msup><mjx-mn class="mjx-n"><mjx-c class="mjx-c37"></mjx-c></mjx-mn><mjx-script style="vertical-align: 0.363em;"><mjx-mn class="mjx-n" size="s"><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-script></mjx-msup><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c34"></mjx-c><mjx-c class="mjx-c39"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mn>7</mn><mn>2</mn></msup><mo>=</mo><mn>49</mn></math></mjx-assistive-mml></mjx-container></span>. That’s it; <code>49</code>—final answer.</p>
<p>Let’s drop it in our code and see that we get… 19?</p>
<div class="sourceCode" id="cb361" data-startfrom="7"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c" style="counter-reset: source-line 6;"><span id="cb361-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb361-7"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> SQR<span class="op">(</span><span class="dv">3</span> <span class="op">+</span> <span class="dv">4</span><span class="op">));</span>  <span class="co">// 19!!??</span></span></code></pre></div>
<p>What happened?</p>
<p>If we follow the macro expansion, we get</p>
<div class="sourceCode" id="cb362" data-startfrom="7"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c" style="counter-reset: source-line 6;"><span id="cb362-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb362-7"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> <span class="dv">3</span> <span class="op">+</span> <span class="dv">4</span> <span class="op">*</span> <span class="dv">3</span> <span class="op">+</span> <span class="dv">4</span><span class="op">);</span>  <span class="co">// 19!</span></span></code></pre></div>
<p>Oops! Since multiplication takes precedence, we do the <span class="math inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="35" style="font-size: 101.6%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c34"></mjx-c></mjx-mn><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-cD7"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="3"><mjx-c class="mjx-c33"></mjx-c></mjx-mn><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>4</mn><mo>×</mo><mn>3</mn><mo>=</mo><mn>12</mn></math></mjx-assistive-mml></mjx-container></span> first, and get <span class="math inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="36" style="font-size: 101.6%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c33"></mjx-c></mjx-mn><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="3"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c32"></mjx-c></mjx-mn><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="3"><mjx-c class="mjx-c34"></mjx-c></mjx-mn><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c39"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>3</mn><mo>+</mo><mn>12</mn><mo>+</mo><mn>4</mn><mo>=</mo><mn>19</mn></math></mjx-assistive-mml></mjx-container></span>. Not what we were after.</p>
<p>So we have to fix this to make it right.</p>
<p><strong>This is so common that you should automatically do it every time you make a parameterized math macro!</strong></p>
<p>The fix is easy: just add some parentheses!</p>
<div class="sourceCode" id="cb363" data-startfrom="3"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c" style="counter-reset: source-line 2;"><span id="cb363-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb363-3"></a><span class="pp">#define SQR</span><span class="op">(</span><span class="pp">x</span><span class="op">)</span><span class="pp"> </span><span class="op">(</span><span class="pp">x</span><span class="op">)</span><span class="pp"> </span><span class="op">*</span><span class="pp"> </span><span class="op">(</span><span class="pp">x</span><span class="op">)</span><span class="pp">   </span><span class="co">// Better... but still not quite good enough!</span></span></code></pre></div>
<p>And now our macro expands to:</p>
<div class="sourceCode" id="cb364" data-startfrom="7"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c" style="counter-reset: source-line 6;"><span id="cb364-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb364-7"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> <span class="op">(</span><span class="dv">3</span> <span class="op">+</span> <span class="dv">4</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="dv">3</span> <span class="op">+</span> <span class="dv">4</span><span class="op">));</span>  <span class="co">// 49! Woo hoo!</span></span></code></pre></div>
<p>But we actually still have the same problem which might manifest if we have a higher-precedence operator than multiply (<code>*</code>) nearby.</p>
<p>So the safe, proper way to put the macro together is to wrap the whole thing in additional parentheses, like so:</p>
<div class="sourceCode" id="cb365" data-startfrom="3"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c" style="counter-reset: source-line 2;"><span id="cb365-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb365-3"></a><span class="pp">#define SQR</span><span class="op">(</span><span class="pp">x</span><span class="op">)</span><span class="pp"> </span><span class="op">((</span><span class="pp">x</span><span class="op">)</span><span class="pp"> </span><span class="op">*</span><span class="pp"> </span><span class="op">(</span><span class="pp">x</span><span class="op">))</span><span class="pp">   </span><span class="co">// Good!</span></span></code></pre></div>
<p>Just make it a habit to do that when you make a math macro and you can’t go wrong.</p>
<h3 data-number="19.5.2" id="macros-with-more-than-one-argument"><span class="header-section-number">19.5.2</span> Macros with More than One Argument</h3>
<p>You can stack these things up as much as you want:</p>
<div class="sourceCode" id="cb366"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb366-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb366-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#define TRIANGLE_AREA</span><span class="op">(</span><span class="pp">w</span><span class="op">,</span><span class="pp"> h</span><span class="op">)</span><span class="pp"> </span><span class="op">(</span><span class="dv">0</span><span class="er">.5</span><span class="pp"> </span><span class="op">*</span><span class="pp"> </span><span class="op">(</span><span class="pp">w</span><span class="op">)</span><span class="pp"> </span><span class="op">*</span><span class="pp"> </span><span class="op">(</span><span class="pp">h</span><span class="op">))</span></span></code></pre></div>
<p>Let’s do some macros that solve for <span class="math inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="37" style="font-size: 101.6%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D465 TEX-I"></mjx-c></mjx-mi></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>x</mi></math></mjx-assistive-mml></mjx-container></span> using the quadratic formula. Just in case you don’t have it on the top of your head, it says for equations of the form:</p>
<p><span class="math inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="38" style="font-size: 101.6%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D44E TEX-I"></mjx-c></mjx-mi><mjx-msup><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D465 TEX-I"></mjx-c></mjx-mi><mjx-script style="vertical-align: 0.363em;"><mjx-mn class="mjx-n" size="s"><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-script></mjx-msup><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-mi class="mjx-i" space="3"><mjx-c class="mjx-c1D44F TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D465 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-mi class="mjx-i" space="3"><mjx-c class="mjx-c1D450 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>a</mi><msup><mi>x</mi><mn>2</mn></msup><mo>+</mo><mi>b</mi><mi>x</mi><mo>+</mo><mi>c</mi><mo>=</mo><mn>0</mn></math></mjx-assistive-mml></mjx-container></span></p>
<p>you can solve for <span class="math inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="39" style="font-size: 101.6%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D465 TEX-I"></mjx-c></mjx-mi></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>x</mi></math></mjx-assistive-mml></mjx-container></span> with the quadratic formula:</p>
<p><span class="math inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="40" style="font-size: 101.6%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D465 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mstyle space="4"><mjx-mfrac><mjx-frac type="d"><mjx-num><mjx-nstrut type="d"></mjx-nstrut><mjx-mrow><mjx-mo class="mjx-n"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D44F TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-cB1"></mjx-c></mjx-mo><mjx-msqrt space="3"><mjx-sqrt><mjx-surd><mjx-mo class="mjx-n"><mjx-c class="mjx-c221A"></mjx-c></mjx-mo></mjx-surd><mjx-box style="padding-top: 0.087em;"><mjx-msup><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D44F TEX-I"></mjx-c></mjx-mi><mjx-script style="vertical-align: 0.289em;"><mjx-mn class="mjx-n" size="s"><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-script></mjx-msup><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="3"><mjx-c class="mjx-c34"></mjx-c></mjx-mn><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D44E TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D450 TEX-I"></mjx-c></mjx-mi></mjx-box></mjx-sqrt></mjx-msqrt></mjx-mrow></mjx-num><mjx-dbox><mjx-dtable><mjx-line type="d"></mjx-line><mjx-row><mjx-den><mjx-dstrut type="d"></mjx-dstrut><mjx-mrow><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D44E TEX-I"></mjx-c></mjx-mi></mjx-mrow></mjx-den></mjx-row></mjx-dtable></mjx-dbox></mjx-frac></mjx-mfrac></mjx-mstyle></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>x</mi><mo>=</mo><mstyle displaystyle="true" scriptlevel="0"><mfrac><mrow><mo>−</mo><mi>b</mi><mo>±</mo><msqrt><msup><mi>b</mi><mn>2</mn></msup><mo>−</mo><mn>4</mn><mi>a</mi><mi>c</mi></msqrt></mrow><mrow><mn>2</mn><mi>a</mi></mrow></mfrac></mstyle></math></mjx-assistive-mml></mjx-container></span></p>
<p>Which is crazy. Also notice the plus-or-minus (<span class="math inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="41" style="font-size: 101.6%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-cB1"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>±</mo></math></mjx-assistive-mml></mjx-container></span>) in there, indicating that there are actually two solutions.</p>
<p>So let’s make macros for both:</p>
<div class="sourceCode" id="cb367"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb367-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb367-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#define QUADP</span><span class="op">(</span><span class="pp">a</span><span class="op">,</span><span class="pp"> b</span><span class="op">,</span><span class="pp"> c</span><span class="op">)</span><span class="pp"> </span><span class="op">((-(</span><span class="pp">b</span><span class="op">)</span><span class="pp"> </span><span class="op">+</span><span class="pp"> sqrt</span><span class="op">((</span><span class="pp">b</span><span class="op">)</span><span class="pp"> </span><span class="op">*</span><span class="pp"> </span><span class="op">(</span><span class="pp">b</span><span class="op">)</span><span class="pp"> </span><span class="op">-</span><span class="pp"> </span><span class="dv">4</span><span class="pp"> </span><span class="op">*</span><span class="pp"> </span><span class="op">(</span><span class="pp">a</span><span class="op">)</span><span class="pp"> </span><span class="op">*</span><span class="pp"> </span><span class="op">(</span><span class="pp">c</span><span class="op">)))</span><span class="pp"> </span><span class="op">/</span><span class="pp"> </span><span class="op">(</span><span class="dv">2</span><span class="pp"> </span><span class="op">*</span><span class="pp"> </span><span class="op">(</span><span class="pp">a</span><span class="op">)))</span></span>
<span id="cb367-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb367-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#define QUADM</span><span class="op">(</span><span class="pp">a</span><span class="op">,</span><span class="pp"> b</span><span class="op">,</span><span class="pp"> c</span><span class="op">)</span><span class="pp"> </span><span class="op">((-(</span><span class="pp">b</span><span class="op">)</span><span class="pp"> </span><span class="op">-</span><span class="pp"> sqrt</span><span class="op">((</span><span class="pp">b</span><span class="op">)</span><span class="pp"> </span><span class="op">*</span><span class="pp"> </span><span class="op">(</span><span class="pp">b</span><span class="op">)</span><span class="pp"> </span><span class="op">-</span><span class="pp"> </span><span class="dv">4</span><span class="pp"> </span><span class="op">*</span><span class="pp"> </span><span class="op">(</span><span class="pp">a</span><span class="op">)</span><span class="pp"> </span><span class="op">*</span><span class="pp"> </span><span class="op">(</span><span class="pp">c</span><span class="op">)))</span><span class="pp"> </span><span class="op">/</span><span class="pp"> </span><span class="op">(</span><span class="dv">2</span><span class="pp"> </span><span class="op">*</span><span class="pp"> </span><span class="op">(</span><span class="pp">a</span><span class="op">)))</span></span></code></pre></div>
<p>So that gets us some math. But let’s define one more that we can use as arguments to <code>printf()</code> to print both answers.</p>
<div class="sourceCode" id="cb368"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb368-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb368-1" aria-hidden="true" tabindex="-1"></a><span class="co">//          macro              replacement</span></span>
<span id="cb368-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb368-2" aria-hidden="true" tabindex="-1"></a><span class="co">//      |-----------| |----------------------------|</span></span>
<span id="cb368-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb368-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#define QUAD</span><span class="op">(</span><span class="pp">a</span><span class="op">,</span><span class="pp"> b</span><span class="op">,</span><span class="pp"> c</span><span class="op">)</span><span class="pp"> QUADP</span><span class="op">(</span><span class="pp">a</span><span class="op">,</span><span class="pp"> b</span><span class="op">,</span><span class="pp"> c</span><span class="op">),</span><span class="pp"> QUADM</span><span class="op">(</span><span class="pp">a</span><span class="op">,</span><span class="pp"> b</span><span class="op">,</span><span class="pp"> c</span><span class="op">)</span></span></code></pre></div>
<p>That’s just a couple values separated by a comma—and we can use that as a “combined” argument of sorts to <code>printf()</code> like this:</p>
<div class="sourceCode" id="cb369"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb369-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb369-1" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"x = </span><span class="sc">%f</span><span class="st"> or x = </span><span class="sc">%f\n</span><span class="st">"</span><span class="op">,</span> QUAD<span class="op">(</span><span class="dv">2</span><span class="op">,</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">5</span><span class="op">));</span></span></code></pre></div>
<p>Let’s put it together into some code:</p>
<div class="sourceCode" id="cb370"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb370-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb370-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb370-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb370-2"></a><span class="pp">#include </span><span class="im">&lt;math.h&gt;</span><span class="pp">  </span><span class="co">// For sqrt()</span></span>
<span id="cb370-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb370-3"></a></span>
<span id="cb370-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb370-4"></a><span class="pp">#define QUADP</span><span class="op">(</span><span class="pp">a</span><span class="op">,</span><span class="pp"> b</span><span class="op">,</span><span class="pp"> c</span><span class="op">)</span><span class="pp"> </span><span class="op">((-(</span><span class="pp">b</span><span class="op">)</span><span class="pp"> </span><span class="op">+</span><span class="pp"> sqrt</span><span class="op">((</span><span class="pp">b</span><span class="op">)</span><span class="pp"> </span><span class="op">*</span><span class="pp"> </span><span class="op">(</span><span class="pp">b</span><span class="op">)</span><span class="pp"> </span><span class="op">-</span><span class="pp"> </span><span class="dv">4</span><span class="pp"> </span><span class="op">*</span><span class="pp"> </span><span class="op">(</span><span class="pp">a</span><span class="op">)</span><span class="pp"> </span><span class="op">*</span><span class="pp"> </span><span class="op">(</span><span class="pp">c</span><span class="op">)))</span><span class="pp"> </span><span class="op">/</span><span class="pp"> </span><span class="op">(</span><span class="dv">2</span><span class="pp"> </span><span class="op">*</span><span class="pp"> </span><span class="op">(</span><span class="pp">a</span><span class="op">)))</span></span>
<span id="cb370-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb370-5"></a><span class="pp">#define QUADM</span><span class="op">(</span><span class="pp">a</span><span class="op">,</span><span class="pp"> b</span><span class="op">,</span><span class="pp"> c</span><span class="op">)</span><span class="pp"> </span><span class="op">((-(</span><span class="pp">b</span><span class="op">)</span><span class="pp"> </span><span class="op">-</span><span class="pp"> sqrt</span><span class="op">((</span><span class="pp">b</span><span class="op">)</span><span class="pp"> </span><span class="op">*</span><span class="pp"> </span><span class="op">(</span><span class="pp">b</span><span class="op">)</span><span class="pp"> </span><span class="op">-</span><span class="pp"> </span><span class="dv">4</span><span class="pp"> </span><span class="op">*</span><span class="pp"> </span><span class="op">(</span><span class="pp">a</span><span class="op">)</span><span class="pp"> </span><span class="op">*</span><span class="pp"> </span><span class="op">(</span><span class="pp">c</span><span class="op">)))</span><span class="pp"> </span><span class="op">/</span><span class="pp"> </span><span class="op">(</span><span class="dv">2</span><span class="pp"> </span><span class="op">*</span><span class="pp"> </span><span class="op">(</span><span class="pp">a</span><span class="op">)))</span></span>
<span id="cb370-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb370-6"></a><span class="pp">#define QUAD</span><span class="op">(</span><span class="pp">a</span><span class="op">,</span><span class="pp"> b</span><span class="op">,</span><span class="pp"> c</span><span class="op">)</span><span class="pp"> QUADP</span><span class="op">(</span><span class="pp">a</span><span class="op">,</span><span class="pp"> b</span><span class="op">,</span><span class="pp"> c</span><span class="op">),</span><span class="pp"> QUADM</span><span class="op">(</span><span class="pp">a</span><span class="op">,</span><span class="pp"> b</span><span class="op">,</span><span class="pp"> c</span><span class="op">)</span></span>
<span id="cb370-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb370-7"></a></span>
<span id="cb370-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb370-8"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb370-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb370-9"></a><span class="op">{</span></span>
<span id="cb370-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb370-10"></a>    printf<span class="op">(</span><span class="st">"2*x^2 + 10*x + 5 = 0</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb370-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb370-11"></a>    printf<span class="op">(</span><span class="st">"x = </span><span class="sc">%f</span><span class="st"> or x = </span><span class="sc">%f\n</span><span class="st">"</span><span class="op">,</span> QUAD<span class="op">(</span><span class="dv">2</span><span class="op">,</span> <span class="dv">10</span><span class="op">,</span> <span class="dv">5</span><span class="op">));</span></span>
<span id="cb370-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb370-12"></a><span class="op">}</span></span></code></pre></div>
<p>And this gives us the output:</p>
<div class="sourceCode" id="cb371"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb371-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb371-1" aria-hidden="true" tabindex="-1"></a>2*x^2 + 10*x + 5 = 0</span>
<span id="cb371-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb371-2" aria-hidden="true" tabindex="-1"></a>x = -0.563508 or x = -4.436492</span></code></pre></div>
<p>Plugging in either of those values gives us roughly zero (a bit off because the numbers aren’t exact):</p>
<p><span class="math inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="42" style="font-size: 101.6%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-cD7"></mjx-c></mjx-mo><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-msup><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c2E"></mjx-c><mjx-c class="mjx-c35"></mjx-c><mjx-c class="mjx-c36"></mjx-c><mjx-c class="mjx-c33"></mjx-c><mjx-c class="mjx-c35"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c38"></mjx-c></mjx-mn><mjx-script style="vertical-align: 0.393em;"><mjx-mn class="mjx-n" size="s"><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-script></mjx-msup><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="3"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-cD7"></mjx-c></mjx-mo><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c2E"></mjx-c><mjx-c class="mjx-c35"></mjx-c><mjx-c class="mjx-c36"></mjx-c><mjx-c class="mjx-c33"></mjx-c><mjx-c class="mjx-c35"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c38"></mjx-c></mjx-mn><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="3"><mjx-c class="mjx-c35"></mjx-c></mjx-mn><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c2248"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="4"><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c2E"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c30"></mjx-c><mjx-c class="mjx-c33"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>2</mn><mo>×</mo><mo>−</mo><msup><mn>0.563508</mn><mn>2</mn></msup><mo>+</mo><mn>10</mn><mo>×</mo><mo>−</mo><mn>0.563508</mn><mo>+</mo><mn>5</mn><mo>≈</mo><mn>0.000003</mn></math></mjx-assistive-mml></mjx-container></span></p>
<h3 data-number="19.5.3" id="macros-with-variable-arguments"><span class="header-section-number">19.5.3</span> Macros with Variable Arguments</h3>
<p></p>
<p>There’s also a way to have a variable number of arguments passed to a macro, using ellipses (<code>...</code>) after the known, named arguments. When the macro is expanded, all of the extra arguments will be in a comma-separated list in the <code>__VA_ARGS__</code> macro, and can be replaced from there:</p>
<div class="sourceCode" id="cb372"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb372-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb372-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb372-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb372-2"></a></span>
<span id="cb372-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb372-3"></a><span class="co">// Combine the first two arguments to a single number,</span></span>
<span id="cb372-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb372-4"></a><span class="co">// then have a commalist of the rest of them:</span></span>
<span id="cb372-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb372-5"></a></span>
<span id="cb372-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb372-6"></a><span class="pp">#define X</span><span class="op">(</span><span class="pp">a</span><span class="op">,</span><span class="pp"> b</span><span class="op">,</span><span class="pp"> </span><span class="op">...)</span><span class="pp"> </span><span class="op">(</span><span class="dv">10</span><span class="op">*(</span><span class="pp">a</span><span class="op">)</span><span class="pp"> </span><span class="op">+</span><span class="pp"> </span><span class="dv">20</span><span class="op">*(</span><span class="pp">b</span><span class="op">)),</span><span class="pp"> __VA_ARGS__</span></span>
<span id="cb372-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb372-7"></a></span>
<span id="cb372-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb372-8"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb372-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb372-9"></a><span class="op">{</span></span>
<span id="cb372-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb372-10"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%d</span><span class="st"> </span><span class="sc">%f</span><span class="st"> </span><span class="sc">%s</span><span class="st"> </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> X<span class="op">(</span><span class="dv">5</span><span class="op">,</span> <span class="dv">4</span><span class="op">,</span> <span class="fl">3.14</span><span class="op">,</span> <span class="st">"Hi!"</span><span class="op">,</span> <span class="dv">12</span><span class="op">));</span></span>
<span id="cb372-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb372-11"></a><span class="op">}</span></span></code></pre></div>
<p>The substitution that takes place on line 10 would be:</p>
<div class="sourceCode" id="cb373" data-startfrom="10"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c" style="counter-reset: source-line 9;"><span id="cb373-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb373-10"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%d</span><span class="st"> </span><span class="sc">%f</span><span class="st"> </span><span class="sc">%s</span><span class="st"> </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> <span class="op">(</span><span class="dv">10</span><span class="op">*(</span><span class="dv">5</span><span class="op">)</span> <span class="op">+</span> <span class="dv">20</span><span class="op">*(</span><span class="dv">4</span><span class="op">)),</span> <span class="fl">3.14</span><span class="op">,</span> <span class="st">"Hi!"</span><span class="op">,</span> <span class="dv">12</span><span class="op">);</span></span></code></pre></div>
<p>for output:</p>
<div class="sourceCode" id="cb374"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb374-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb374-1" aria-hidden="true" tabindex="-1"></a>130 3.140000 Hi! 12</span></code></pre></div>
<p>You can also “stringify” <code>__VA_ARGS__</code> by putting a <code>#</code> in front of it:</p>
<div class="sourceCode" id="cb375"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb375-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb375-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#define X</span><span class="op">(...)</span><span class="pp"> </span><span class="op">#</span><span class="pp">__VA_ARGS__</span></span>
<span id="cb375-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb375-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb375-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb375-3" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> X<span class="op">(</span><span class="dv">1</span><span class="op">,</span><span class="dv">2</span><span class="op">,</span><span class="dv">3</span><span class="op">));</span>  <span class="co">// Prints "1, 2, 3"</span></span></code></pre></div>
<p> </p>
<h3 data-number="19.5.4" id="stringification"><span class="header-section-number">19.5.4</span> Stringification</h3>
<p></p>
<p>Already mentioned, just above, you can turn any argument into a string by preceding it with a <code>#</code> in the replacement text.</p>
<p>For example, we could print anything as a string with this macro and <code>printf()</code>:</p>
<div class="sourceCode" id="cb376"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb376-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb376-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#define STR</span><span class="op">(</span><span class="pp">x</span><span class="op">)</span><span class="pp"> </span><span class="op">#</span><span class="pp">x</span></span>
<span id="cb376-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb376-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb376-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb376-3" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> STR<span class="op">(</span><span class="fl">3.14159</span><span class="op">));</span></span></code></pre></div>
<p>In that case, the substitution leads to:</p>
<div class="sourceCode" id="cb377"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb377-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb377-1" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> <span class="st">"3.14159"</span><span class="op">);</span></span></code></pre></div>
<p>Let’s see if we can use this to greater effect so that we can pass any <code>int</code> variable name into a macro, and have it print out it’s name and value.</p>
<div class="sourceCode" id="cb378"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb378-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb378-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb378-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb378-2"></a></span>
<span id="cb378-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb378-3"></a><span class="pp">#define PRINT_INT_VAL</span><span class="op">(</span><span class="pp">x</span><span class="op">)</span><span class="pp"> printf</span><span class="op">(</span><span class="st">"</span><span class="sc">%s</span><span class="st"> = </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span><span class="pp"> </span><span class="op">#</span><span class="pp">x</span><span class="op">,</span><span class="pp"> x</span><span class="op">)</span></span>
<span id="cb378-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb378-4"></a></span>
<span id="cb378-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb378-5"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb378-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb378-6"></a><span class="op">{</span></span>
<span id="cb378-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb378-7"></a>    <span class="dt">int</span> a <span class="op">=</span> <span class="dv">5</span><span class="op">;</span></span>
<span id="cb378-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb378-8"></a></span>
<span id="cb378-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb378-9"></a>    PRINT_INT_VAL<span class="op">(</span>a<span class="op">);</span>  <span class="co">// prints "a = 5"</span></span>
<span id="cb378-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb378-10"></a><span class="op">}</span></span></code></pre></div>
<p>On line 9, we get the following macro replacement:</p>
<div class="sourceCode" id="cb379" data-startfrom="9"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c" style="counter-reset: source-line 8;"><span id="cb379-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb379-9"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%s</span><span class="st"> = </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> <span class="st">"a"</span><span class="op">,</span> <span class="dv">5</span><span class="op">);</span></span></code></pre></div>
<p></p>
<h3 data-number="19.5.5" id="concatenation"><span class="header-section-number">19.5.5</span> Concatenation</h3>
<p></p>
<p>We can concatenate two arguments together with <code>##</code>, as well. Fun times!</p>
<div class="sourceCode" id="cb380"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb380-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb380-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#define CAT</span><span class="op">(</span><span class="pp">a</span><span class="op">,</span><span class="pp"> b</span><span class="op">)</span><span class="pp"> a </span><span class="op">##</span><span class="pp"> b</span></span>
<span id="cb380-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb380-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb380-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb380-3" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">%f\n</span><span class="st">"</span><span class="op">,</span> CAT<span class="op">(</span><span class="fl">3.14</span><span class="op">,</span> <span class="dv">1592</span><span class="op">));</span>   <span class="co">// 3.141592</span></span></code></pre></div>
<p></p>
<h2 data-number="19.6" id="multiline-macros"><span class="header-section-number">19.6</span> Multiline Macros</h2>
<p></p>
<p>It’s possible to continue a macro to multiple lines if you escape the newline with a backslash (<code>\</code>).</p>
<p>Let’s write a multiline macro that prints numbers from <code>0</code> to the product of the two arguments passed in.</p>
<p></p>
<div class="sourceCode" id="cb381"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb381-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb381-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb381-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb381-2"></a></span>
<span id="cb381-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb381-3"></a><span class="pp">#define PRINT_NUMS_TO_PRODUCT</span><span class="op">(</span><span class="pp">a</span><span class="op">,</span><span class="pp"> b</span><span class="op">)</span><span class="pp"> </span><span class="cf">do</span><span class="pp"> </span><span class="op">{</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb381-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb381-4"></a><span class="pp">    </span><span class="dt">int</span><span class="pp"> product </span><span class="op">=</span><span class="pp"> </span><span class="op">(</span><span class="pp">a</span><span class="op">)</span><span class="pp"> </span><span class="op">*</span><span class="pp"> </span><span class="op">(</span><span class="pp">b</span><span class="op">);</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb381-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb381-5"></a><span class="pp">    </span><span class="cf">for</span><span class="pp"> </span><span class="op">(</span><span class="dt">int</span><span class="pp"> i </span><span class="op">=</span><span class="pp"> </span><span class="dv">0</span><span class="op">;</span><span class="pp"> i </span><span class="op">&lt;</span><span class="pp"> product</span><span class="op">;</span><span class="pp"> i</span><span class="op">++)</span><span class="pp"> </span><span class="op">{</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb381-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb381-6"></a><span class="pp">        printf</span><span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span><span class="pp"> i</span><span class="op">);</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb381-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb381-7"></a><span class="pp">    </span><span class="op">}</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb381-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb381-8"></a><span class="op">}</span><span class="pp"> </span><span class="cf">while</span><span class="op">(</span><span class="dv">0</span><span class="op">)</span></span>
<span id="cb381-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb381-9"></a></span>
<span id="cb381-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb381-10"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb381-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb381-11"></a><span class="op">{</span></span>
<span id="cb381-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb381-12"></a>    PRINT_NUMS_TO_PRODUCT<span class="op">(</span><span class="dv">2</span><span class="op">,</span> <span class="dv">4</span><span class="op">);</span>  <span class="co">// Outputs numbers from 0 to 7</span></span>
<span id="cb381-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb381-13"></a><span class="op">}</span></span></code></pre></div>
<p>A couple things to note there:</p>
<ul>
<li>Escapes at the end of every line except the last one to indicate that the macro continues.</li>
<li>The whole thing is wrapped in a <code>do</code>-<code>while(0)</code> loop with squirrley braces.</li>
</ul>
<p>The latter point might be a little weird, but it’s all about absorbing the trailing <code>;</code> the coder drops after the macro.</p>
<p>At first I thought that just using squirrely braces would be enough, but there’s a case where it fails if the coder puts a semicolon after the macro. Here’s that case:</p>
<div class="sourceCode" id="cb382"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb382-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb382-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb382-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb382-2"></a></span>
<span id="cb382-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb382-3"></a><span class="pp">#define FOO</span><span class="op">(</span><span class="pp">x</span><span class="op">)</span><span class="pp"> </span><span class="op">{</span><span class="pp"> </span><span class="op">(</span><span class="pp">x</span><span class="op">)++;</span><span class="pp"> </span><span class="op">}</span></span>
<span id="cb382-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb382-4"></a></span>
<span id="cb382-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb382-5"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb382-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb382-6"></a><span class="op">{</span></span>
<span id="cb382-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb382-7"></a>    <span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb382-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb382-8"></a></span>
<span id="cb382-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb382-9"></a>    <span class="cf">if</span> <span class="op">(</span>i <span class="op">==</span> <span class="dv">0</span><span class="op">)</span></span>
<span id="cb382-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb382-10"></a>        FOO<span class="op">(</span>i<span class="op">);</span></span>
<span id="cb382-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb382-11"></a>    <span class="cf">else</span></span>
<span id="cb382-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb382-12"></a>        printf<span class="op">(</span><span class="st">":-(</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb382-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb382-13"></a></span>
<span id="cb382-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb382-14"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> i<span class="op">);</span></span>
<span id="cb382-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb382-15"></a><span class="op">}</span></span></code></pre></div>
<p>Looks simple enough, but it won’t build without a syntax error:</p>
<div class="sourceCode" id="cb383"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb383-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb383-1" aria-hidden="true" tabindex="-1"></a>foo.c:11:5: error: ‘else’ without a previous ‘if’  </span></code></pre></div>
<p>Do you see it?</p>
<p>Let’s look at the expansion:</p>
<div class="sourceCode" id="cb384"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb384-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb384-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb384-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb384-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>i <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb384-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb384-3" aria-hidden="true" tabindex="-1"></a>        <span class="op">(</span>i<span class="op">)++;</span></span>
<span id="cb384-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb384-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span>             <span class="co">// &lt;-- Trouble with a capital-T!</span></span>
<span id="cb384-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb384-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb384-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb384-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb384-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb384-7" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">":-(</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span></code></pre></div>
<p>The <code>;</code> puts an end to the <code>if</code> statement, so the <code>else</code> is just floating out there illegally<a href="https://beej.us/guide/bgc/html/index-wide.html#fn131" class="footnote-ref" id="fnref131" role="doc-noteref"><sup>131</sup></a>.</p>
<p>So wrap that multiline macro with a <code>do</code>-<code>while(0)</code>.</p>
<p> </p>
<h2 data-number="19.7" id="my-assert"><span class="header-section-number">19.7</span> Example: An Assert Macro</h2>
<p>Adding asserts to your code is a good way to catch conditions that you think shouldn’t happen. C provides <code>assert()</code> functionality. It checks a condition, and if it’s false, the program bombs out telling you the file and line number on which the assertion failed.</p>
<p>But this is wanting.</p>
<ol type="1">
<li>First of all, you can’t specify an additional message with the assert.</li>
<li>Secondly, there’s no easy on-off switch for all the asserts.</li>
</ol>
<p>We can address the first with macros.</p>
<p>Basically, when I have this code:</p>
<div class="sourceCode" id="cb385"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb385-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb385-1" aria-hidden="true" tabindex="-1"></a>ASSERT<span class="op">(</span>x <span class="op">&lt;</span> <span class="dv">20</span><span class="op">,</span> <span class="st">"x must be under 20"</span><span class="op">);</span></span></code></pre></div>
<p>I want something like this to happen (assuming the <code>ASSERT()</code> is on line 220 of <code>foo.c</code>):</p>
<div class="sourceCode" id="cb386"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb386-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb386-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(!(</span>x <span class="op">&lt;</span> <span class="dv">20</span><span class="op">))</span> <span class="op">{</span></span>
<span id="cb386-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb386-2" aria-hidden="true" tabindex="-1"></a>    fprintf<span class="op">(</span>stderr<span class="op">,</span> <span class="st">"foo.c:220: assertion x &lt; 20 failed: "</span><span class="op">);</span></span>
<span id="cb386-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb386-3" aria-hidden="true" tabindex="-1"></a>    fprintf<span class="op">(</span>stderr<span class="op">,</span> <span class="st">"x must be under 20</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb386-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb386-4" aria-hidden="true" tabindex="-1"></a>    exit<span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb386-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb386-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>We can get the filename out of the <code>__FILE__</code> macro, and the line number from <code>__LINE__</code>. The message is already a string, but <code>x &lt; 20</code> is not, so we’ll have to stringify it with <code>#</code>. We can make a multiline macro by using backslash escapes at the end of the line.</p>
<div class="sourceCode" id="cb387"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb387-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb387-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#define ASSERT</span><span class="op">(</span><span class="pp">c</span><span class="op">,</span><span class="pp"> m</span><span class="op">)</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb387-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb387-2" aria-hidden="true" tabindex="-1"></a><span class="cf">do</span><span class="pp"> </span><span class="op">{</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb387-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb387-3" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="cf">if</span><span class="pp"> </span><span class="op">(!(</span><span class="pp">c</span><span class="op">))</span><span class="pp"> </span><span class="op">{</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb387-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb387-4" aria-hidden="true" tabindex="-1"></a><span class="pp">        fprintf</span><span class="op">(</span><span class="pp">stderr</span><span class="op">,</span><span class="pp"> __FILE__ </span><span class="st">":</span><span class="sc">%d</span><span class="st">: assertion </span><span class="sc">%s</span><span class="st"> failed: </span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb387-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb387-5" aria-hidden="true" tabindex="-1"></a><span class="pp">                        __LINE__</span><span class="op">,</span><span class="pp"> </span><span class="op">#</span><span class="pp">c</span><span class="op">,</span><span class="pp"> m</span><span class="op">);</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb387-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb387-6" aria-hidden="true" tabindex="-1"></a><span class="pp">        exit</span><span class="op">(</span><span class="dv">1</span><span class="op">);</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb387-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb387-7" aria-hidden="true" tabindex="-1"></a><span class="pp">    </span><span class="op">}</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb387-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb387-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span><span class="pp"> </span><span class="cf">while</span><span class="op">(</span><span class="dv">0</span><span class="op">)</span></span></code></pre></div>
<p>(It looks a little weird with <code>__FILE__</code> out front like that, but remember it is a string literal, and string literals next to each other are automagically concatenated. <code>__LINE__</code> on the other hand, it’s just an <code>int</code>.)</p>
<p>And that works! If I run this:</p>
<div class="sourceCode" id="cb388"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb388-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb388-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> x <span class="op">=</span> <span class="dv">30</span><span class="op">;</span></span>
<span id="cb388-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb388-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb388-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb388-3" aria-hidden="true" tabindex="-1"></a>ASSERT<span class="op">(</span>x <span class="op">&lt;</span> <span class="dv">20</span><span class="op">,</span> <span class="st">"x must be under 20"</span><span class="op">);</span></span></code></pre></div>
<p>I get this output:</p>
<pre><code>foo.c:23: assertion x &lt; 20 failed: x must be under 20</code></pre>
<p>Very nice!</p>
<p>The only thing left is a way to turn it on and off, and we could do that with conditional compilation.</p>
<p>Here’s the complete example:</p>
<div class="sourceCode" id="cb390"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb390-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb390-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb390-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb390-2"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb390-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb390-3"></a></span>
<span id="cb390-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb390-4"></a><span class="pp">#define ASSERT_ENABLED </span><span class="dv">1</span></span>
<span id="cb390-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb390-5"></a></span>
<span id="cb390-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb390-6"></a><span class="pp">#if ASSERT_ENABLED</span></span>
<span id="cb390-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb390-7"></a><span class="pp">#define ASSERT</span><span class="op">(</span><span class="pp">c</span><span class="op">,</span><span class="pp"> m</span><span class="op">)</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb390-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb390-8"></a><span class="cf">do</span><span class="pp"> </span><span class="op">{</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb390-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb390-9"></a><span class="pp">    </span><span class="cf">if</span><span class="pp"> </span><span class="op">(!(</span><span class="pp">c</span><span class="op">))</span><span class="pp"> </span><span class="op">{</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb390-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb390-10"></a><span class="pp">        fprintf</span><span class="op">(</span><span class="pp">stderr</span><span class="op">,</span><span class="pp"> __FILE__ </span><span class="st">":</span><span class="sc">%d</span><span class="st">: assertion </span><span class="sc">%s</span><span class="st"> failed: </span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb390-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb390-11"></a><span class="pp">                        __LINE__</span><span class="op">,</span><span class="pp"> </span><span class="op">#</span><span class="pp">c</span><span class="op">,</span><span class="pp"> m</span><span class="op">);</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb390-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb390-12"></a><span class="pp">        exit</span><span class="op">(</span><span class="dv">1</span><span class="op">);</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb390-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb390-13"></a><span class="pp">    </span><span class="op">}</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb390-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb390-14"></a><span class="op">}</span><span class="pp"> </span><span class="cf">while</span><span class="op">(</span><span class="dv">0</span><span class="op">)</span></span>
<span id="cb390-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb390-15"></a><span class="pp">#else</span></span>
<span id="cb390-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb390-16"></a><span class="pp">#define ASSERT</span><span class="op">(</span><span class="pp">c</span><span class="op">,</span><span class="pp"> m</span><span class="op">)</span><span class="pp">  </span><span class="co">// Empty macro if not enabled</span></span>
<span id="cb390-17"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb390-17"></a><span class="pp">#endif</span></span>
<span id="cb390-18"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb390-18"></a></span>
<span id="cb390-19"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb390-19"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb390-20"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb390-20"></a><span class="op">{</span></span>
<span id="cb390-21"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb390-21"></a>    <span class="dt">int</span> x <span class="op">=</span> <span class="dv">30</span><span class="op">;</span></span>
<span id="cb390-22"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb390-22"></a></span>
<span id="cb390-23"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb390-23"></a>    ASSERT<span class="op">(</span>x <span class="op">&lt;</span> <span class="dv">20</span><span class="op">,</span> <span class="st">"x must be under 20"</span><span class="op">);</span></span>
<span id="cb390-24"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb390-24"></a><span class="op">}</span></span></code></pre></div>
<p>This has the output:</p>
<div class="sourceCode" id="cb391"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb391-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb391-1" aria-hidden="true" tabindex="-1"></a>foo.c:23: assertion x &lt; 20 failed: x must be under 20</span></code></pre></div>
<h2 data-number="19.8" id="the-error-directive"><span class="header-section-number">19.8</span> The <code>#error</code> Directive</h2>
<p></p>
<p>This directive causes the compiler to error out as soon as it sees it.</p>
<p>Commonly, this is used inside a conditional to prevent compilation unless some prerequisites are met:</p>
<div class="sourceCode" id="cb392"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb392-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb392-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#ifndef __STDC_IEC_559__</span></span>
<span id="cb392-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb392-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">#error I really need IEEE-754 floating point to compile. Sorry!</span></span>
<span id="cb392-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb392-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#endif</span></span></code></pre></div>
<p> </p>
<p>Some compilers have a non-standard complementary <code>#warning</code> directive that will output a warning but not stop compilation, but this is not in the C11 spec.</p>
<p></p>
<h2 data-number="19.9" id="pragma"><span class="header-section-number">19.9</span> The <code>#pragma</code> Directive</h2>
<p></p>
<p>This is one funky directive, short for “pragmatic”. You can use it to do… well, anything your compiler supports you doing with it.</p>
<p>Basically the only time you’re going to add this to your code is if some documentation tells you to do so.</p>
<h3 data-number="19.9.1" id="non-standard-pragmas"><span class="header-section-number">19.9.1</span> Non-Standard Pragmas</h3>
<p></p>
<p>Here’s one non-standard example of using <code>#pragma</code> to cause the compiler to execute a <code>for</code> loop in parallel with multiple threads (if the compiler supports the <a href="https://www.openmp.org/">OpenMP</a><a href="https://beej.us/guide/bgc/html/index-wide.html#fn132" class="footnote-ref" id="fnref132" role="doc-noteref"><sup>132</sup></a> extension):</p>
<div class="sourceCode" id="cb393"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb393-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb393-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#pragma omp parallel for</span></span>
<span id="cb393-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb393-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">10</span><span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span> <span class="op">...</span> <span class="op">}</span></span></code></pre></div>
<p>There are all kinds of <code>#pragma</code> directives documented across all four corners of the globe.</p>
<p>All unrecognized <code>#pragma</code>s are ignored by the compiler.</p>
<p></p>
<h3 data-number="19.9.2" id="standard-pragmas"><span class="header-section-number">19.9.2</span> Standard Pragmas</h3>
<p>There are also a few standard ones, and these start with <code>STDC</code>, and follow the same form:</p>
<div class="sourceCode" id="cb394"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb394-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb394-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#pragma STDC pragma_name on-off</span></span></code></pre></div>
<p>The <code>on-off</code> portion can be either <code>ON</code>, <code>OFF</code>, or <code>DEFAULT</code>.</p>
<p>And the <code>pragma_name</code> can be one of these:</p>
<p> </p>
<table>
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th>Pragma Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>FP_CONTRACT</code></td>
<td>Allow floating point expressions to be contracted into a single operation to avoid rounding errors that might occur from multiple operations.</td>
</tr>
<tr class="even">
<td><code>FENV_ACCESS</code></td>
<td>Set to <code>ON</code> if you plan to access the floating point status flags. If <code>OFF</code>, the compiler might perform optimizations that cause the values in the flags to be inconsistent or invalid.</td>
</tr>
<tr class="odd">
<td><code>CX_LIMITED_RANGE</code></td>
<td>Set to <code>ON</code> to allow the compiler to skip overflow checks when performing complex arithmetic. Defaults to <code>OFF</code>.</td>
</tr>
</tbody>
</table>
<p>For example:</p>
<div class="sourceCode" id="cb395"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb395-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb395-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#pragma STDC FP_CONTRACT OFF</span></span>
<span id="cb395-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb395-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#pragma STDC CX_LIMITED_RANGE ON</span></span></code></pre></div>
<p></p>
<p>As for <code>CX_LIMITED_RANGE</code>, the spec points out:</p>
<blockquote>
<p>The purpose of the pragma is to allow the implementation to use the formulas:</p>
<p><span class="math inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="43" style="font-size: 101.6%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c28"></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D465 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-mi class="mjx-i" space="3"><mjx-c class="mjx-c1D456 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D466 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c29"></mjx-c></mjx-mo><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-cD7"></mjx-c></mjx-mo><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c28"></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D462 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-mi class="mjx-i" space="3"><mjx-c class="mjx-c1D456 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D463 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c29"></mjx-c></mjx-mo><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c28"></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D465 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D462 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mi class="mjx-i" space="3"><mjx-c class="mjx-c1D466 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D463 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c29"></mjx-c></mjx-mo><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-mi class="mjx-i" space="3"><mjx-c class="mjx-c1D456 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c28"></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D466 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D462 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-mi class="mjx-i" space="3"><mjx-c class="mjx-c1D465 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D463 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c29"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo><mi>x</mi><mo>+</mo><mi>i</mi><mi>y</mi><mo stretchy="false">)</mo><mo>×</mo><mo stretchy="false">(</mo><mi>u</mi><mo>+</mo><mi>i</mi><mi>v</mi><mo stretchy="false">)</mo><mo>=</mo><mo stretchy="false">(</mo><mi>x</mi><mi>u</mi><mo>−</mo><mi>y</mi><mi>v</mi><mo stretchy="false">)</mo><mo>+</mo><mi>i</mi><mo stretchy="false">(</mo><mi>y</mi><mi>u</mi><mo>+</mo><mi>x</mi><mi>v</mi><mo stretchy="false">)</mo></math></mjx-assistive-mml></mjx-container></span></p>
<p><span class="math inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="44" style="font-size: 101.6%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c28"></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D465 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-mi class="mjx-i" space="3"><mjx-c class="mjx-c1D456 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D466 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c29"></mjx-c></mjx-mo><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-texatom><mjx-mo class="mjx-n"><mjx-c class="mjx-c28"></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D462 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-mi class="mjx-i" space="3"><mjx-c class="mjx-c1D456 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D463 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c29"></mjx-c></mjx-mo><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c5B"></mjx-c></mjx-mo><mjx-mo class="mjx-n"><mjx-c class="mjx-c28"></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D465 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D462 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-mi class="mjx-i" space="3"><mjx-c class="mjx-c1D466 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D463 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c29"></mjx-c></mjx-mo><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-mi class="mjx-i" space="3"><mjx-c class="mjx-c1D456 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c28"></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D466 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D462 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mi class="mjx-i" space="3"><mjx-c class="mjx-c1D465 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D463 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c29"></mjx-c></mjx-mo><mjx-mo class="mjx-n"><mjx-c class="mjx-c5D"></mjx-c></mjx-mo><mjx-texatom texclass="ORD"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2F"></mjx-c></mjx-mo></mjx-texatom><mjx-mo class="mjx-n"><mjx-c class="mjx-c28"></mjx-c></mjx-mo><mjx-msup><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D462 TEX-I"></mjx-c></mjx-mi><mjx-script style="vertical-align: 0.363em;"><mjx-mn class="mjx-n" size="s"><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-script></mjx-msup><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-msup space="3"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D463 TEX-I"></mjx-c></mjx-mi><mjx-script style="vertical-align: 0.363em;"><mjx-mn class="mjx-n" size="s"><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-script></mjx-msup><mjx-mo class="mjx-n"><mjx-c class="mjx-c29"></mjx-c></mjx-mo></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo stretchy="false">(</mo><mi>x</mi><mo>+</mo><mi>i</mi><mi>y</mi><mo stretchy="false">)</mo><mrow data-mjx-texclass="ORD"><mo>/</mo></mrow><mo stretchy="false">(</mo><mi>u</mi><mo>+</mo><mi>i</mi><mi>v</mi><mo stretchy="false">)</mo><mo>=</mo><mo stretchy="false">[</mo><mo stretchy="false">(</mo><mi>x</mi><mi>u</mi><mo>+</mo><mi>y</mi><mi>v</mi><mo stretchy="false">)</mo><mo>+</mo><mi>i</mi><mo stretchy="false">(</mo><mi>y</mi><mi>u</mi><mo>−</mo><mi>x</mi><mi>v</mi><mo stretchy="false">)</mo><mo stretchy="false">]</mo><mrow data-mjx-texclass="ORD"><mo>/</mo></mrow><mo stretchy="false">(</mo><msup><mi>u</mi><mn>2</mn></msup><mo>+</mo><msup><mi>v</mi><mn>2</mn></msup><mo stretchy="false">)</mo></math></mjx-assistive-mml></mjx-container></span></p>
<p><span class="math inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="45" style="font-size: 101.6%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c7C"></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D465 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-mi class="mjx-i" space="3"><mjx-c class="mjx-c1D456 TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D466 TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c7C"></mjx-c></mjx-mo><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-msqrt space="4"><mjx-sqrt><mjx-surd><mjx-mo class="mjx-sop"><mjx-c class="mjx-c221A TEX-S1"></mjx-c></mjx-mo></mjx-surd><mjx-box style="padding-top: 0.125em;"><mjx-msup><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D465 TEX-I"></mjx-c></mjx-mi><mjx-script style="vertical-align: 0.289em;"><mjx-mn class="mjx-n" size="s"><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-script></mjx-msup><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-msup space="3"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D466 TEX-I"></mjx-c></mjx-mi><mjx-script style="vertical-align: 0.289em;"><mjx-mn class="mjx-n" size="s"><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-script></mjx-msup></mjx-box></mjx-sqrt></mjx-msqrt></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo data-mjx-texclass="ORD" stretchy="false">|</mo><mi>x</mi><mo>+</mo><mi>i</mi><mi>y</mi><mo data-mjx-texclass="ORD" stretchy="false">|</mo><mo>=</mo><msqrt><msup><mi>x</mi><mn>2</mn></msup><mo>+</mo><msup><mi>y</mi><mn>2</mn></msup></msqrt></math></mjx-assistive-mml></mjx-container></span></p>
<p>where the programmer can determine they are safe.</p>
</blockquote>
<p></p>
<h3 data-number="19.9.3" id="pragma-operator"><span class="header-section-number">19.9.3</span> <code>_Pragma</code> Operator</h3>
<p></p>
<p>This is another way to declare a pragma that you could use in a macro.</p>
<p>These are equivalent:</p>
<div class="sourceCode" id="cb396"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb396-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb396-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#pragma "Unnecessary" quotes</span></span>
<span id="cb396-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb396-2" aria-hidden="true" tabindex="-1"></a>_Pragma<span class="op">(</span><span class="st">"</span><span class="sc">\"</span><span class="st">Unnecessary</span><span class="sc">\"</span><span class="st"> quotes"</span><span class="op">)</span></span></code></pre></div>
<p></p>
<p>This can be used in a macro, if need be:</p>
<div class="sourceCode" id="cb397"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb397-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb397-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#define PRAGMA</span><span class="op">(</span><span class="pp">x</span><span class="op">)</span><span class="pp"> _Pragma</span><span class="op">(#</span><span class="pp">x</span><span class="op">)</span></span></code></pre></div>
<p> </p>
<h2 data-number="19.10" id="the-line-directive"><span class="header-section-number">19.10</span> The <code>#line</code> Directive</h2>
<p> </p>
<p>This allows you to override the values for <code>__LINE__</code> and <code>__FILE__</code>. If you want.</p>
<p>I’ve never wanted to do this, but in K&amp;R2, they write:</p>
<blockquote>
<p>For the benefit of other preprocessors that generate C programs […]</p>
</blockquote>
<p>So maybe there’s that.</p>
<p>To override the line number to, say 300:</p>
<div class="sourceCode" id="cb398"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb398-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb398-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#line 300</span></span></code></pre></div>
<p>and <code>__LINE__</code> will keep counting up from there.</p>
<p></p>
<p>To override the line number and the filename:</p>
<div class="sourceCode" id="cb399"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb399-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb399-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#line 300 "newfilename"</span></span></code></pre></div>
<p></p>
<h2 data-number="19.11" id="the-null-directive"><span class="header-section-number">19.11</span> The Null Directive</h2>
<p></p>
<p>A <code>#</code> on a line by itself is ignored by the preprocessor. Now, to be entirely honest, I don’t know what the use case is for this.</p>
<p>I’ve seen examples like this:</p>
<div class="sourceCode" id="cb400"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb400-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb400-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#ifdef FOO</span></span>
<span id="cb400-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb400-2" aria-hidden="true" tabindex="-1"></a>    <span class="er">#</span></span>
<span id="cb400-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb400-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#else</span></span>
<span id="cb400-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb400-4" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Something"</span><span class="op">);</span></span>
<span id="cb400-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb400-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#endif</span></span></code></pre></div>
<p>which is just cosmetic; the line with the solitary <code>#</code> can be deleted with no ill effect.</p>
<p>Or maybe for cosmetic consistency, like this:</p>
<div class="sourceCode" id="cb401"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb401-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb401-1" aria-hidden="true" tabindex="-1"></a><span class="er">#</span></span>
<span id="cb401-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb401-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#ifdef FOO</span></span>
<span id="cb401-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb401-3" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb401-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb401-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#endif</span></span>
<span id="cb401-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb401-5" aria-hidden="true" tabindex="-1"></a><span class="er">#</span></span>
<span id="cb401-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb401-6" aria-hidden="true" tabindex="-1"></a><span class="pp">#if BAR == 17</span></span>
<span id="cb401-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb401-7" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="dv">12</span><span class="op">;</span></span>
<span id="cb401-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb401-8" aria-hidden="true" tabindex="-1"></a><span class="pp">#endif</span></span>
<span id="cb401-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb401-9" aria-hidden="true" tabindex="-1"></a><span class="er">#</span></span></code></pre></div>
<p>But, with respect to cosmetics, that’s just ugly.</p>
<p>Another post mentions elimination of comments—that in GCC, a comment after a <code>#</code> will not be seen by the compiler. Which I don’t doubt, but the specification doesn’t seem to say this is standard behavior.</p>
<p>My searches for rationale aren’t bearing much fruit. So I’m going to just say this is some good ol’ fashioned C esoterica.</p>
<p> </p>
<!-- Beej's guide to C

# vim: ts=4:sw=4:nosi:et:tw=72
-->
<h1 data-number="20" id="structs-ii-more-fun-with-structs"><span class="header-section-number">20</span> <code>struct</code>s II: More Fun with <code>struct</code>s</h1>
<p></p>
<p>Turns out there’s a lot more you can do with <code>struct</code>s than we’ve talked about, but it’s just a big pile of miscellaneous things. So we’ll throw them in this chapter.</p>
<p>If you’re good with <code>struct</code> basics, you can round out your knowledge here.</p>
<h2 data-number="20.1" id="initializers-of-nested-structs-and-arrays"><span class="header-section-number">20.1</span> Initializers of Nested <code>struct</code>s and Arrays</h2>
<p></p>
<p>Remember how you could <a href="https://beej.us/guide/bgc/html/index-wide.html#struct-initializers">initialize structure members along these lines</a>?</p>
<div class="sourceCode" id="cb402"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb402-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb402-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> foo x <span class="op">=</span> <span class="op">{.</span>a<span class="op">=</span><span class="dv">12</span><span class="op">,</span> <span class="op">.</span>b<span class="op">=</span><span class="fl">3.14</span><span class="op">};</span></span></code></pre></div>
<p>Turns out we have more power in these initializers than we’d originally shared. Exciting!</p>
<p>For one thing, if you have a nested substructure like the following, you can initialize members of that substructure by following the variable names down the line:</p>
<div class="sourceCode" id="cb403"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb403-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb403-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> foo x <span class="op">=</span> <span class="op">{.</span>a<span class="op">.</span>b<span class="op">.</span>c<span class="op">=</span><span class="dv">12</span><span class="op">};</span></span></code></pre></div>
<p>Let’s look at an example:</p>
<div class="sourceCode" id="cb404"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb404-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb404-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb404-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb404-2"></a></span>
<span id="cb404-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb404-3"></a><span class="kw">struct</span> cabin_information <span class="op">{</span></span>
<span id="cb404-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb404-4"></a>    <span class="dt">int</span> window_count<span class="op">;</span></span>
<span id="cb404-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb404-5"></a>    <span class="dt">int</span> o2level<span class="op">;</span></span>
<span id="cb404-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb404-6"></a><span class="op">};</span></span>
<span id="cb404-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb404-7"></a></span>
<span id="cb404-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb404-8"></a><span class="kw">struct</span> spaceship <span class="op">{</span></span>
<span id="cb404-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb404-9"></a>    <span class="dt">char</span> <span class="op">*</span>manufacturer<span class="op">;</span></span>
<span id="cb404-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb404-10"></a>    <span class="kw">struct</span> cabin_information ci<span class="op">;</span></span>
<span id="cb404-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb404-11"></a><span class="op">};</span></span>
<span id="cb404-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb404-12"></a></span>
<span id="cb404-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb404-13"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb404-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb404-14"></a><span class="op">{</span></span>
<span id="cb404-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb404-15"></a>    <span class="kw">struct</span> spaceship s <span class="op">=</span> <span class="op">{</span></span>
<span id="cb404-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb404-16"></a>        <span class="op">.</span>manufacturer<span class="op">=</span><span class="st">"General Products"</span><span class="op">,</span></span>
<span id="cb404-17"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb404-17"></a>        <span class="op">.</span>ci<span class="op">.</span>window_count <span class="op">=</span> <span class="dv">8</span><span class="op">,</span>   <span class="co">// &lt;-- NESTED INITIALIZER!</span></span>
<span id="cb404-18"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb404-18"></a>        <span class="op">.</span>ci<span class="op">.</span>o2level <span class="op">=</span> <span class="dv">21</span></span>
<span id="cb404-19"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb404-19"></a>    <span class="op">};</span></span>
<span id="cb404-20"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb404-20"></a></span>
<span id="cb404-21"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb404-21"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%s</span><span class="st">: </span><span class="sc">%d</span><span class="st"> seats, </span><span class="sc">%d%%</span><span class="st"> oxygen</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span></span>
<span id="cb404-22"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb404-22"></a>        s<span class="op">.</span>manufacturer<span class="op">,</span> s<span class="op">.</span>ci<span class="op">.</span>window_count<span class="op">,</span> s<span class="op">.</span>ci<span class="op">.</span>o2level<span class="op">);</span></span>
<span id="cb404-23"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb404-23"></a><span class="op">}</span></span></code></pre></div>
<p>Check out lines 16-17! That’s where we’re initializing members of the <code>struct cabin_information</code> in the definition of <code>s</code>, our <code>struct spaceship</code>.</p>
<p>And here is another option for that same initializer—this time we’ll do something more standard-looking, but either approach works:</p>
<div class="sourceCode" id="cb405" data-startfrom="15"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c" style="counter-reset: source-line 14;"><span id="cb405-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb405-15"></a>    <span class="kw">struct</span> spaceship s <span class="op">=</span> <span class="op">{</span></span>
<span id="cb405-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb405-16"></a>        <span class="op">.</span>manufacturer<span class="op">=</span><span class="st">"General Products"</span><span class="op">,</span></span>
<span id="cb405-17"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb405-17"></a>        <span class="op">.</span>ci<span class="op">={</span></span>
<span id="cb405-18"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb405-18"></a>            <span class="op">.</span>window_count <span class="op">=</span> <span class="dv">8</span><span class="op">,</span></span>
<span id="cb405-19"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb405-19"></a>            <span class="op">.</span>o2level <span class="op">=</span> <span class="dv">21</span></span>
<span id="cb405-20"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb405-20"></a>        <span class="op">}</span></span>
<span id="cb405-21"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb405-21"></a>    <span class="op">};</span></span></code></pre></div>
<p>Now, as if the above information isn’t spectacular enough, we can also mix in array initializers in there, too.</p>
<p>Let’s change this up to get an array of passenger information in there, and we can check out how the initializers work in there, too.</p>
<div class="sourceCode" id="cb406"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb406-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb406-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb406-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb406-2"></a></span>
<span id="cb406-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb406-3"></a><span class="kw">struct</span> passenger <span class="op">{</span></span>
<span id="cb406-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb406-4"></a>    <span class="dt">char</span> <span class="op">*</span>name<span class="op">;</span></span>
<span id="cb406-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb406-5"></a>    <span class="dt">int</span> covid_vaccinated<span class="op">;</span> <span class="co">// Boolean</span></span>
<span id="cb406-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb406-6"></a><span class="op">};</span></span>
<span id="cb406-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb406-7"></a></span>
<span id="cb406-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb406-8"></a><span class="pp">#define MAX_PASSENGERS </span><span class="dv">8</span></span>
<span id="cb406-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb406-9"></a></span>
<span id="cb406-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb406-10"></a><span class="kw">struct</span> spaceship <span class="op">{</span></span>
<span id="cb406-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb406-11"></a>    <span class="dt">char</span> <span class="op">*</span>manufacturer<span class="op">;</span></span>
<span id="cb406-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb406-12"></a>    <span class="kw">struct</span> passenger passenger<span class="op">[</span>MAX_PASSENGERS<span class="op">];</span></span>
<span id="cb406-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb406-13"></a><span class="op">};</span></span>
<span id="cb406-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb406-14"></a></span>
<span id="cb406-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb406-15"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb406-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb406-16"></a><span class="op">{</span></span>
<span id="cb406-17"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb406-17"></a>    <span class="kw">struct</span> spaceship s <span class="op">=</span> <span class="op">{</span></span>
<span id="cb406-18"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb406-18"></a>        <span class="op">.</span>manufacturer<span class="op">=</span><span class="st">"General Products"</span><span class="op">,</span></span>
<span id="cb406-19"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb406-19"></a>        <span class="op">.</span>passenger <span class="op">=</span> <span class="op">{</span></span>
<span id="cb406-20"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb406-20"></a>            <span class="co">// Initialize a field at a time</span></span>
<span id="cb406-21"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb406-21"></a>            <span class="op">[</span><span class="dv">0</span><span class="op">].</span>name <span class="op">=</span> <span class="st">"Gridley, Lewis"</span><span class="op">,</span></span>
<span id="cb406-22"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb406-22"></a>            <span class="op">[</span><span class="dv">0</span><span class="op">].</span>covid_vaccinated <span class="op">=</span> <span class="dv">0</span><span class="op">,</span></span>
<span id="cb406-23"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb406-23"></a></span>
<span id="cb406-24"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb406-24"></a>            <span class="co">// Or all at once</span></span>
<span id="cb406-25"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb406-25"></a>            <span class="op">[</span><span class="dv">7</span><span class="op">]</span> <span class="op">=</span> <span class="op">{.</span>name<span class="op">=</span><span class="st">"Brown, Teela"</span><span class="op">,</span> <span class="op">.</span>covid_vaccinated<span class="op">=</span><span class="dv">1</span><span class="op">},</span></span>
<span id="cb406-26"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb406-26"></a>        <span class="op">}</span></span>
<span id="cb406-27"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb406-27"></a>    <span class="op">};</span></span>
<span id="cb406-28"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb406-28"></a></span>
<span id="cb406-29"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb406-29"></a>    printf<span class="op">(</span><span class="st">"Passengers for </span><span class="sc">%s</span><span class="st"> ship:</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> s<span class="op">.</span>manufacturer<span class="op">);</span></span>
<span id="cb406-30"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb406-30"></a></span>
<span id="cb406-31"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb406-31"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> MAX_PASSENGERS<span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb406-32"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb406-32"></a>        <span class="cf">if</span> <span class="op">(</span>s<span class="op">.</span>passenger<span class="op">[</span>i<span class="op">].</span>name <span class="op">!=</span> NULL<span class="op">)</span></span>
<span id="cb406-33"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb406-33"></a>            printf<span class="op">(</span><span class="st">"    </span><span class="sc">%s</span><span class="st"> (</span><span class="sc">%s</span><span class="st">vaccinated)</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span></span>
<span id="cb406-34"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb406-34"></a>                s<span class="op">.</span>passenger<span class="op">[</span>i<span class="op">].</span>name<span class="op">,</span></span>
<span id="cb406-35"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb406-35"></a>                s<span class="op">.</span>passenger<span class="op">[</span>i<span class="op">].</span>covid_vaccinated<span class="op">?</span> <span class="st">""</span><span class="op">:</span> <span class="st">"not "</span><span class="op">);</span></span>
<span id="cb406-36"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb406-36"></a><span class="op">}</span></span></code></pre></div>
<p></p>
<h2 data-number="20.2" id="anonymous-structs"><span class="header-section-number">20.2</span> Anonymous <code>struct</code>s</h2>
<p></p>
<p>These are “the <code>struct</code> with no name”. We also mention these in the <a href="https://beej.us/guide/bgc/html/index-wide.html#typedef-struct"><code>typedef</code></a> section, but we’ll refresh here.</p>
<p>Here’s a regular <code>struct</code>:</p>
<div class="sourceCode" id="cb407"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb407-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb407-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> animal <span class="op">{</span></span>
<span id="cb407-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb407-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> <span class="op">*</span>name<span class="op">;</span></span>
<span id="cb407-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb407-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> leg_count<span class="op">,</span> speed<span class="op">;</span></span>
<span id="cb407-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb407-4" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
<p>And here’s the anonymous equivalent:</p>
<div class="sourceCode" id="cb408"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb408-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb408-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> <span class="op">{</span>              <span class="co">// &lt;-- No name!</span></span>
<span id="cb408-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb408-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> <span class="op">*</span>name<span class="op">;</span></span>
<span id="cb408-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb408-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> leg_count<span class="op">,</span> speed<span class="op">;</span></span>
<span id="cb408-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb408-4" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
<p>Okaaaaay. So we have a <code>struct</code>, but it has no name, so we have no way of using it later? Seems pretty pointless.</p>
<p>Admittedly, in that example, it is. But we can still make use of it a couple ways.</p>
<p>One is rare, but since the anonymous <code>struct</code> represents a type, we can just put some variable names after it and use them.</p>
<div class="sourceCode" id="cb409"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb409-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb409-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> <span class="op">{</span>                   <span class="co">// &lt;-- No name!</span></span>
<span id="cb409-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb409-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> <span class="op">*</span>name<span class="op">;</span></span>
<span id="cb409-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb409-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> leg_count<span class="op">,</span> speed<span class="op">;</span></span>
<span id="cb409-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb409-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> a<span class="op">,</span> b<span class="op">,</span> c<span class="op">;</span>                 <span class="co">// 3 variables of this struct type</span></span>
<span id="cb409-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb409-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb409-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb409-6" aria-hidden="true" tabindex="-1"></a>a<span class="op">.</span>name <span class="op">=</span> <span class="st">"antelope"</span><span class="op">;</span></span>
<span id="cb409-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb409-7" aria-hidden="true" tabindex="-1"></a>c<span class="op">.</span>leg_count <span class="op">=</span> <span class="dv">4</span><span class="op">;</span>           <span class="co">// for example</span></span></code></pre></div>
<p>But that’s still not that useful.</p>
<p>Far more common is use of anonymous <code>struct</code>s with a <code>typedef</code> so that we can use it later (e.g.&nbsp;to pass variables to functions).</p>
<div class="sourceCode" id="cb410"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb410-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb410-1" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">struct</span> <span class="op">{</span>                   <span class="co">// &lt;-- No name!</span></span>
<span id="cb410-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb410-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> <span class="op">*</span>name<span class="op">;</span></span>
<span id="cb410-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb410-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> leg_count<span class="op">,</span> speed<span class="op">;</span></span>
<span id="cb410-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb410-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> animal<span class="op">;</span>                          <span class="co">// New type: animal</span></span>
<span id="cb410-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb410-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb410-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb410-6" aria-hidden="true" tabindex="-1"></a>animal a<span class="op">,</span> b<span class="op">,</span> c<span class="op">;</span></span>
<span id="cb410-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb410-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb410-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb410-8" aria-hidden="true" tabindex="-1"></a>a<span class="op">.</span>name <span class="op">=</span> <span class="st">"antelope"</span><span class="op">;</span></span>
<span id="cb410-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb410-9" aria-hidden="true" tabindex="-1"></a>c<span class="op">.</span>leg_count <span class="op">=</span> <span class="dv">4</span><span class="op">;</span>           <span class="co">// for example</span></span></code></pre></div>
<p>Personally, I don’t use many anonymous <code>struct</code>s. I think it’s more pleasant to see the entire <code>struct animal</code> before the variable name in a declaration.</p>
<p>But that’s just, like, my opinion, man.</p>
<p></p>
<h2 data-number="20.3" id="self-referential-structs"><span class="header-section-number">20.3</span> Self-Referential <code>struct</code>s</h2>
<p></p>
<p>For any graph-like data structure, it’s useful to be able to have pointers to the connected nodes/vertices. But this means that in the definition of a node, you need to have a pointer to a node. It’s chicken and eggy!</p>
<p>But it turns out you can do this in C with no problem whatsoever.</p>
<p>For example, here’s a linked list node:</p>
<div class="sourceCode" id="cb411"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb411-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb411-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> node <span class="op">{</span></span>
<span id="cb411-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb411-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> data<span class="op">;</span></span>
<span id="cb411-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb411-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> node <span class="op">*</span>next<span class="op">;</span></span>
<span id="cb411-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb411-4" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
<p>It’s important to note that <code>next</code> is a pointer. This is what allows the whole thing to even build. Even though the compiler doesn’t know what the entire <code>struct node</code> looks like yet, all pointers are the same size.</p>
<p>Here’s a cheesy linked list program to test it out:</p>
<div class="sourceCode" id="cb412"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb412-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb412-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb412-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb412-2"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb412-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb412-3"></a></span>
<span id="cb412-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb412-4"></a><span class="kw">struct</span> node <span class="op">{</span></span>
<span id="cb412-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb412-5"></a>    <span class="dt">int</span> data<span class="op">;</span></span>
<span id="cb412-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb412-6"></a>    <span class="kw">struct</span> node <span class="op">*</span>next<span class="op">;</span></span>
<span id="cb412-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb412-7"></a><span class="op">};</span></span>
<span id="cb412-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb412-8"></a></span>
<span id="cb412-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb412-9"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb412-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb412-10"></a><span class="op">{</span></span>
<span id="cb412-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb412-11"></a>    <span class="kw">struct</span> node <span class="op">*</span>head<span class="op">;</span></span>
<span id="cb412-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb412-12"></a></span>
<span id="cb412-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb412-13"></a>    <span class="co">// Hackishly set up a linked list (11)-&gt;(22)-&gt;(33)</span></span>
<span id="cb412-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb412-14"></a>    head <span class="op">=</span> malloc<span class="op">(</span><span class="kw">sizeof</span><span class="op">(</span><span class="kw">struct</span> node<span class="op">));</span></span>
<span id="cb412-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb412-15"></a>    head<span class="op">-&gt;</span>data <span class="op">=</span> <span class="dv">11</span><span class="op">;</span></span>
<span id="cb412-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb412-16"></a>    head<span class="op">-&gt;</span>next <span class="op">=</span> malloc<span class="op">(</span><span class="kw">sizeof</span><span class="op">(</span><span class="kw">struct</span> node<span class="op">));</span></span>
<span id="cb412-17"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb412-17"></a>    head<span class="op">-&gt;</span>next<span class="op">-&gt;</span>data <span class="op">=</span> <span class="dv">22</span><span class="op">;</span></span>
<span id="cb412-18"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb412-18"></a>    head<span class="op">-&gt;</span>next<span class="op">-&gt;</span>next <span class="op">=</span> malloc<span class="op">(</span><span class="kw">sizeof</span><span class="op">(</span><span class="kw">struct</span> node<span class="op">));</span></span>
<span id="cb412-19"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb412-19"></a>    head<span class="op">-&gt;</span>next<span class="op">-&gt;</span>next<span class="op">-&gt;</span>data <span class="op">=</span> <span class="dv">33</span><span class="op">;</span></span>
<span id="cb412-20"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb412-20"></a>    head<span class="op">-&gt;</span>next<span class="op">-&gt;</span>next<span class="op">-&gt;</span>next <span class="op">=</span> NULL<span class="op">;</span></span>
<span id="cb412-21"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb412-21"></a></span>
<span id="cb412-22"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb412-22"></a>    <span class="co">// Traverse it</span></span>
<span id="cb412-23"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb412-23"></a>    <span class="cf">for</span> <span class="op">(</span><span class="kw">struct</span> node <span class="op">*</span>cur <span class="op">=</span> head<span class="op">;</span> cur <span class="op">!=</span> NULL<span class="op">;</span> cur <span class="op">=</span> cur<span class="op">-&gt;</span>next<span class="op">)</span> <span class="op">{</span></span>
<span id="cb412-24"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb412-24"></a>        printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> cur<span class="op">-&gt;</span>data<span class="op">);</span></span>
<span id="cb412-25"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb412-25"></a>    <span class="op">}</span></span>
<span id="cb412-26"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb412-26"></a><span class="op">}</span></span></code></pre></div>
<p>Running that prints:</p>
<div class="sourceCode" id="cb413"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb413-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb413-1" aria-hidden="true" tabindex="-1"></a>11</span>
<span id="cb413-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb413-2" aria-hidden="true" tabindex="-1"></a>22</span>
<span id="cb413-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb413-3" aria-hidden="true" tabindex="-1"></a>33</span></code></pre></div>
<p></p>
<h2 data-number="20.4" id="flexible-array-members"><span class="header-section-number">20.4</span> Flexible Array Members</h2>
<p></p>
<p>Back in the good old days, when people carved C code out of wood, some folks thought would be neat if they could allocate <code>struct</code>s that had variable length arrays at the end of them.</p>
<p>I want to be clear that the first part of the section is the old way of doing things, and we’re going to do things the new way after that.</p>
<p>For example, maybe you could define a <code>struct</code> for holding strings and the length of that string. It would have a length and an array to hold the data. Maybe something like this:</p>
<div class="sourceCode" id="cb414"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb414-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb414-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> len_string <span class="op">{</span></span>
<span id="cb414-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb414-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> length<span class="op">;</span></span>
<span id="cb414-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb414-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> data<span class="op">[</span><span class="dv">8</span><span class="op">];</span></span>
<span id="cb414-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb414-4" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
<p>But that has <code>8</code> hardcoded as the maximum length of a string, and that’s not much. What if we did something <em>clever</em> and just <code>malloc()</code>d some extra space at the end after the struct, and then let the data overflow into that space?</p>
<p>Let’s do that, and then allocate another 40 bytes on top of it:</p>
<div class="sourceCode" id="cb415"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb415-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb415-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> len_string <span class="op">*</span>s <span class="op">=</span> malloc<span class="op">(</span><span class="kw">sizeof</span> <span class="op">*</span>s <span class="op">+</span> <span class="dv">40</span><span class="op">);</span></span></code></pre></div>
<p>Because <code>data</code> is the last field of the <code>struct</code>, if we overflow that field, it runs out into space that we already allocated! For this reason, this trick only works if the short array is the <em>last</em> field in the <code>struct</code>.</p>
<div class="sourceCode" id="cb416"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb416-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb416-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Copy more than 8 bytes!</span></span>
<span id="cb416-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb416-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb416-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb416-3" aria-hidden="true" tabindex="-1"></a>strcpy<span class="op">(</span>s<span class="op">-&gt;</span>data<span class="op">,</span> <span class="st">"Hello, world!"</span><span class="op">);</span>  <span class="co">// Won't crash. Probably.</span></span></code></pre></div>
<p></p>
<p>In fact, there was a common compiler workaround for doing this, where you’d allocate a zero length array at the end:</p>
<div class="sourceCode" id="cb417"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb417-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb417-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> len_string <span class="op">{</span></span>
<span id="cb417-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb417-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> length<span class="op">;</span></span>
<span id="cb417-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb417-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> data<span class="op">[</span><span class="dv">0</span><span class="op">];</span></span>
<span id="cb417-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb417-4" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
<p>And then every extra byte you allocated was ready for use in that string.</p>
<p>Because <code>data</code> is the last field of the <code>struct</code>, if we overflow that field, it runs out into space that we already allocated!</p>
<div class="sourceCode" id="cb418"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb418-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb418-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Copy more than 8 bytes!</span></span>
<span id="cb418-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb418-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb418-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb418-3" aria-hidden="true" tabindex="-1"></a>strcpy<span class="op">(</span>s<span class="op">-&gt;</span>data<span class="op">,</span> <span class="st">"Hello, world!"</span><span class="op">);</span>  <span class="co">// Won't crash. Probably.</span></span></code></pre></div>
<p>But, of course, actually accessing the data beyond the end of that array is undefined behavior! In these modern times, we no longer deign to resort to such savagery.</p>
<p></p>
<p>Luckily for us, we can still get the same effect with C99 and later, but now it’s legal.</p>
<p>Let’s just change our above definition to have no size for the array<a href="https://beej.us/guide/bgc/html/index-wide.html#fn133" class="footnote-ref" id="fnref133" role="doc-noteref"><sup>133</sup></a>:</p>
<div class="sourceCode" id="cb419"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb419-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb419-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> len_string <span class="op">{</span></span>
<span id="cb419-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb419-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> length<span class="op">;</span></span>
<span id="cb419-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb419-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> data<span class="op">[];</span></span>
<span id="cb419-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb419-4" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
<p>Again, this only works if the flexible array member is the <em>last</em> field in the <code>struct</code>.</p>
<p>And then we can allocate all the space we want for those strings by <code>malloc()</code>ing larger than the <code>struct len_string</code>, as we do in this example that makes a new <code>struct len_string</code> from a C string:</p>
<div class="sourceCode" id="cb420"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb420-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb420-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> len_string <span class="op">*</span>len_string_from_c_string<span class="op">(</span><span class="dt">char</span> <span class="op">*</span>s<span class="op">)</span></span>
<span id="cb420-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb420-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb420-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb420-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> len <span class="op">=</span> strlen<span class="op">(</span>s<span class="op">);</span></span>
<span id="cb420-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb420-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb420-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb420-5" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Allocate "len" more bytes than we'd normally need</span></span>
<span id="cb420-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb420-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> len_string <span class="op">*</span>ls <span class="op">=</span> malloc<span class="op">(</span><span class="kw">sizeof</span> <span class="op">*</span>ls <span class="op">+</span> len<span class="op">);</span></span>
<span id="cb420-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb420-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb420-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb420-8" aria-hidden="true" tabindex="-1"></a>    ls<span class="op">-&gt;</span>length <span class="op">=</span> len<span class="op">;</span></span>
<span id="cb420-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb420-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb420-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb420-10" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Copy the string into those extra bytes</span></span>
<span id="cb420-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb420-11" aria-hidden="true" tabindex="-1"></a>    memcpy<span class="op">(</span>ls<span class="op">-&gt;</span>data<span class="op">,</span> s<span class="op">,</span> len<span class="op">);</span></span>
<span id="cb420-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb420-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb420-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb420-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ls<span class="op">;</span></span>
<span id="cb420-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb420-14" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p></p>
<h2 data-number="20.5" id="struct-padding-bytes"><span class="header-section-number">20.5</span> Padding Bytes</h2>
<p></p>
<p>Beware that C is allowed to add padding bytes within or after a <code>struct</code> as it sees fit. You can’t trust that they will be directly adjacent in memory<a href="https://beej.us/guide/bgc/html/index-wide.html#fn134" class="footnote-ref" id="fnref134" role="doc-noteref"><sup>134</sup></a>.</p>
<p>Let’s take a look at this program. We output two numbers. One is the sum of the <code>sizeof</code>s the individual field types. The other is the <code>sizeof</code> the entire <code>struct</code>.</p>
<p>One would expect them to be the same. The size of the total is the size of the sum of its parts, right?</p>
<div class="sourceCode" id="cb421"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb421-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb421-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb421-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb421-2"></a></span>
<span id="cb421-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb421-3"></a><span class="kw">struct</span> foo <span class="op">{</span></span>
<span id="cb421-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb421-4"></a>    <span class="dt">int</span> a<span class="op">;</span></span>
<span id="cb421-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb421-5"></a>    <span class="dt">char</span> b<span class="op">;</span></span>
<span id="cb421-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb421-6"></a>    <span class="dt">int</span> c<span class="op">;</span></span>
<span id="cb421-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb421-7"></a>    <span class="dt">char</span> d<span class="op">;</span></span>
<span id="cb421-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb421-8"></a><span class="op">};</span></span>
<span id="cb421-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb421-9"></a></span>
<span id="cb421-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb421-10"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb421-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb421-11"></a><span class="op">{</span></span>
<span id="cb421-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb421-12"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%zu\n</span><span class="st">"</span><span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">int</span><span class="op">)</span> <span class="op">+</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">char</span><span class="op">)</span> <span class="op">+</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">int</span><span class="op">)</span> <span class="op">+</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">char</span><span class="op">));</span></span>
<span id="cb421-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb421-13"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%zu\n</span><span class="st">"</span><span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span><span class="kw">struct</span> foo<span class="op">));</span></span>
<span id="cb421-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb421-14"></a><span class="op">}</span></span></code></pre></div>
<p>But on my system, this outputs:</p>
<div class="sourceCode" id="cb422"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb422-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb422-1" aria-hidden="true" tabindex="-1"></a>10</span>
<span id="cb422-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb422-2" aria-hidden="true" tabindex="-1"></a>16</span></code></pre></div>
<p>They’re not the same! The compiler has added 6 bytes of padding to help it be more performant. Maybe you got different output with your compiler, but unless you’re forcing it, you can’t be sure there’s no padding.</p>
<p></p>
<h2 data-number="20.6" id="offsetof"><span class="header-section-number">20.6</span> <code>offsetof</code></h2>
<p></p>
<p>In the previous section, we saw that the compiler could inject padding bytes at will inside a structure.</p>
<p>What if we needed to know where those were? We can measure it with <code>offsetof</code>, defined in <code>&lt;stddef.h&gt;</code>.</p>
<p>Let’s modify the code from above to print the offsets of the individual fields in the <code>struct</code>:</p>
<div class="sourceCode" id="cb423"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb423-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb423-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb423-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb423-2"></a><span class="pp">#include </span><span class="im">&lt;stddef.h&gt;</span></span>
<span id="cb423-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb423-3"></a></span>
<span id="cb423-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb423-4"></a><span class="kw">struct</span> foo <span class="op">{</span></span>
<span id="cb423-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb423-5"></a>    <span class="dt">int</span> a<span class="op">;</span></span>
<span id="cb423-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb423-6"></a>    <span class="dt">char</span> b<span class="op">;</span></span>
<span id="cb423-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb423-7"></a>    <span class="dt">int</span> c<span class="op">;</span></span>
<span id="cb423-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb423-8"></a>    <span class="dt">char</span> d<span class="op">;</span></span>
<span id="cb423-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb423-9"></a><span class="op">};</span></span>
<span id="cb423-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb423-10"></a></span>
<span id="cb423-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb423-11"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb423-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb423-12"></a><span class="op">{</span></span>
<span id="cb423-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb423-13"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%zu\n</span><span class="st">"</span><span class="op">,</span> offsetof<span class="op">(</span><span class="kw">struct</span> foo<span class="op">,</span> a<span class="op">));</span></span>
<span id="cb423-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb423-14"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%zu\n</span><span class="st">"</span><span class="op">,</span> offsetof<span class="op">(</span><span class="kw">struct</span> foo<span class="op">,</span> b<span class="op">));</span></span>
<span id="cb423-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb423-15"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%zu\n</span><span class="st">"</span><span class="op">,</span> offsetof<span class="op">(</span><span class="kw">struct</span> foo<span class="op">,</span> c<span class="op">));</span></span>
<span id="cb423-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb423-16"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%zu\n</span><span class="st">"</span><span class="op">,</span> offsetof<span class="op">(</span><span class="kw">struct</span> foo<span class="op">,</span> d<span class="op">));</span></span>
<span id="cb423-17"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb423-17"></a><span class="op">}</span></span></code></pre></div>
<p>For me, this outputs:</p>
<div class="sourceCode" id="cb424"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb424-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb424-1" aria-hidden="true" tabindex="-1"></a>0</span>
<span id="cb424-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb424-2" aria-hidden="true" tabindex="-1"></a>4</span>
<span id="cb424-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb424-3" aria-hidden="true" tabindex="-1"></a>8</span>
<span id="cb424-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb424-4" aria-hidden="true" tabindex="-1"></a>12</span></code></pre></div>
<p>indicating that we’re using 4 bytes for each of the fields. It’s a little weird, because <code>char</code> is only 1 byte, right? The compiler is putting 3 padding bytes after each <code>char</code> so that all the fields are 4 bytes long. Presumably this will run faster on my CPU.</p>
<p></p>
<!--

6.7.2.1

15 Within a structure object, the non-bit-field members and the units in which bit-fields reside have addresses that increase in the order in which they are declared. A pointer to a structure object, suitably converted, points to its initial member (or if that member is a bit-field, then to the unit in which it resides), and vice versa. There may be unnamed padding within a structure object, but not at its beginning.

6.2.7 Compatible type and composite type

1 Two types have compatible type if their types are the same.

6.5

7 An object shall have its stored value accessed only by an lvalue expression that has one of the following types:

- a type compatible with the effective type of the object

-->
<h2 data-number="20.7" id="fake-oop"><span class="header-section-number">20.7</span> Fake OOP</h2>
<p>There’s a slightly abusive thing that’s sort of OOP-like that you can do with <code>struct</code>s.</p>
<p>Since the pointer to the <code>struct</code> is the same as a pointer to the first element of the <code>struct</code>, you can freely cast a pointer to the <code>struct</code> to a pointer to the first element.</p>
<p>What this means is that we can set up a situation like this:</p>
<div class="sourceCode" id="cb425"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb425-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb425-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> parent <span class="op">{</span></span>
<span id="cb425-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb425-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> a<span class="op">,</span> b<span class="op">;</span></span>
<span id="cb425-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb425-3" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb425-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb425-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb425-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb425-5" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> child <span class="op">{</span></span>
<span id="cb425-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb425-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> parent super<span class="op">;</span>  <span class="co">// MUST be first</span></span>
<span id="cb425-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb425-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> c<span class="op">,</span> d<span class="op">;</span></span>
<span id="cb425-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb425-8" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
<p>Then we are able to pass a pointer to a <code>struct child</code> to a function that expects either that <em>or</em> a pointer to a <code>struct parent</code>!</p>
<p>Because <code>struct parent super</code> is the first item in the <code>struct child</code>, a pointer to any <code>struct child</code> is the same as a pointer to that <code>super</code> field<a href="https://beej.us/guide/bgc/html/index-wide.html#fn135" class="footnote-ref" id="fnref135" role="doc-noteref"><sup>135</sup></a>.</p>
<p>Let’s set up an example here. We’ll make <code>struct</code>s as above, but then we’ll pass a pointer to a <code>struct child</code> to a function that needs a pointer to a <code>struct parent</code>… and it’ll still work.</p>
<div class="sourceCode" id="cb426"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb426-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb426-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb426-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb426-2"></a></span>
<span id="cb426-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb426-3"></a><span class="kw">struct</span> parent <span class="op">{</span></span>
<span id="cb426-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb426-4"></a>    <span class="dt">int</span> a<span class="op">,</span> b<span class="op">;</span></span>
<span id="cb426-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb426-5"></a><span class="op">};</span></span>
<span id="cb426-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb426-6"></a></span>
<span id="cb426-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb426-7"></a><span class="kw">struct</span> child <span class="op">{</span></span>
<span id="cb426-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb426-8"></a>    <span class="kw">struct</span> parent super<span class="op">;</span>  <span class="co">// MUST be first</span></span>
<span id="cb426-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb426-9"></a>    <span class="dt">int</span> c<span class="op">,</span> d<span class="op">;</span></span>
<span id="cb426-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb426-10"></a><span class="op">};</span></span>
<span id="cb426-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb426-11"></a></span>
<span id="cb426-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb426-12"></a><span class="co">// Making the argument `void*` so we can pass any type into it</span></span>
<span id="cb426-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb426-13"></a><span class="co">// (namely a struct parent or struct child)</span></span>
<span id="cb426-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb426-14"></a><span class="dt">void</span> print_parent<span class="op">(</span><span class="dt">void</span> <span class="op">*</span>p<span class="op">)</span></span>
<span id="cb426-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb426-15"></a><span class="op">{</span></span>
<span id="cb426-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb426-16"></a>    <span class="co">// Expects a struct parent--but a struct child will also work</span></span>
<span id="cb426-17"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb426-17"></a>    <span class="co">// because the pointer points to the struct parent in the first</span></span>
<span id="cb426-18"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb426-18"></a>    <span class="co">// field:</span></span>
<span id="cb426-19"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb426-19"></a>    <span class="kw">struct</span> parent <span class="op">*</span>self <span class="op">=</span> p<span class="op">;</span></span>
<span id="cb426-20"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb426-20"></a></span>
<span id="cb426-21"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb426-21"></a>    printf<span class="op">(</span><span class="st">"Parent: </span><span class="sc">%d</span><span class="st">, </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> self<span class="op">-&gt;</span>a<span class="op">,</span> self<span class="op">-&gt;</span>b<span class="op">);</span></span>
<span id="cb426-22"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb426-22"></a><span class="op">}</span></span>
<span id="cb426-23"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb426-23"></a></span>
<span id="cb426-24"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb426-24"></a><span class="dt">void</span> print_child<span class="op">(</span><span class="kw">struct</span> child <span class="op">*</span>self<span class="op">)</span></span>
<span id="cb426-25"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb426-25"></a><span class="op">{</span></span>
<span id="cb426-26"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb426-26"></a>    printf<span class="op">(</span><span class="st">"Child: </span><span class="sc">%d</span><span class="st">, </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> self<span class="op">-&gt;</span>c<span class="op">,</span> self<span class="op">-&gt;</span>d<span class="op">);</span></span>
<span id="cb426-27"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb426-27"></a><span class="op">}</span></span>
<span id="cb426-28"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb426-28"></a></span>
<span id="cb426-29"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb426-29"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb426-30"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb426-30"></a><span class="op">{</span></span>
<span id="cb426-31"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb426-31"></a>    <span class="kw">struct</span> child c <span class="op">=</span> <span class="op">{.</span>super<span class="op">.</span>a<span class="op">=</span><span class="dv">1</span><span class="op">,</span> <span class="op">.</span>super<span class="op">.</span>b<span class="op">=</span><span class="dv">2</span><span class="op">,</span> <span class="op">.</span>c<span class="op">=</span><span class="dv">3</span><span class="op">,</span> <span class="op">.</span>d<span class="op">=</span><span class="dv">4</span><span class="op">};</span></span>
<span id="cb426-32"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb426-32"></a></span>
<span id="cb426-33"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb426-33"></a>    print_child<span class="op">(&amp;</span>c<span class="op">);</span></span>
<span id="cb426-34"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb426-34"></a>    print_parent<span class="op">(&amp;</span>c<span class="op">);</span>  <span class="co">// Also works even though it's a struct child!</span></span>
<span id="cb426-35"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb426-35"></a><span class="op">}</span></span></code></pre></div>
<p>See what we did on the last line of <code>main()</code>? We called <code>print_parent()</code> but passed a <code>struct child*</code> as the argument! Even though <code>print_parent()</code> needs the argument to point to a <code>struct parent</code>, we’re <em>getting away with it</em> because the first field in the <code>struct child</code> is a <code>struct parent</code>.</p>
<p>Again, this works because a pointer to a <code>struct</code> has the same value as a pointer to the first field in that <code>struct</code>.</p>
<p>This all hinges on this part of the spec:</p>
<blockquote>
<p><strong>§6.7.2.1¶15</strong> […] A pointer to a structure object, suitably converted, points to its initial member […], and vice versa.</p>
</blockquote>
<p>and</p>
<blockquote>
<p><strong>§6.5¶7</strong> An object shall have its stored value accessed only by an lvalue expression that has one of the following types:</p>
<ul>
<li>a type compatible with the effective type of the object</li>
<li>[…]</li>
</ul>
</blockquote>
<p>and my assumption that “suitably converted” means “cast to the effective type of the initial member”.</p>
<h2 data-number="20.8" id="bit-fields"><span class="header-section-number">20.8</span> Bit-Fields</h2>
<p></p>
<p>In my experience, these are rarely used, but you might see them out there from time to time, especially in lower-level applications that pack bits together into larger spaces.</p>
<p>Let’s take a look at some code to demonstrate a use case:</p>
<div class="sourceCode" id="cb427"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb427-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb427-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb427-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb427-2"></a></span>
<span id="cb427-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb427-3"></a><span class="kw">struct</span> foo <span class="op">{</span></span>
<span id="cb427-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb427-4"></a>    <span class="dt">unsigned</span> <span class="dt">int</span> a<span class="op">;</span></span>
<span id="cb427-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb427-5"></a>    <span class="dt">unsigned</span> <span class="dt">int</span> b<span class="op">;</span></span>
<span id="cb427-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb427-6"></a>    <span class="dt">unsigned</span> <span class="dt">int</span> c<span class="op">;</span></span>
<span id="cb427-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb427-7"></a>    <span class="dt">unsigned</span> <span class="dt">int</span> d<span class="op">;</span></span>
<span id="cb427-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb427-8"></a><span class="op">};</span></span>
<span id="cb427-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb427-9"></a></span>
<span id="cb427-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb427-10"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb427-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb427-11"></a><span class="op">{</span></span>
<span id="cb427-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb427-12"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%zu\n</span><span class="st">"</span><span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span><span class="kw">struct</span> foo<span class="op">));</span></span>
<span id="cb427-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb427-13"></a><span class="op">}</span></span></code></pre></div>
<p>For me, this prints <code>16</code>. Which makes sense, since <code>unsigned</code>s are 4 bytes on my system.</p>
<p>But what if we knew that all the values that were going to be stored in <code>a</code> and <code>b</code> could be stored in 5 bits, and the values in <code>c</code>, and <code>d</code> could be stored in 3 bits? That’s only a total 16 bits. Why have 128 bits reserved for them if we’re only going to use 16?</p>
<p>Well, we can tell C to pretty-please try to pack these values in. We can specify the maximum number of bits that values can take (from 1 up the size of the containing type).</p>
<p>We do this by putting a colon after the field name, followed by the field width in bits.</p>
<div class="sourceCode" id="cb428" data-startfrom="3"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c" style="counter-reset: source-line 2;"><span id="cb428-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb428-3"></a><span class="kw">struct</span> foo <span class="op">{</span></span>
<span id="cb428-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb428-4"></a>    <span class="dt">unsigned</span> <span class="dt">int</span> a<span class="op">:</span><span class="dv">5</span><span class="op">;</span></span>
<span id="cb428-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb428-5"></a>    <span class="dt">unsigned</span> <span class="dt">int</span> b<span class="op">:</span><span class="dv">5</span><span class="op">;</span></span>
<span id="cb428-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb428-6"></a>    <span class="dt">unsigned</span> <span class="dt">int</span> c<span class="op">:</span><span class="dv">3</span><span class="op">;</span></span>
<span id="cb428-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb428-7"></a>    <span class="dt">unsigned</span> <span class="dt">int</span> d<span class="op">:</span><span class="dv">3</span><span class="op">;</span></span>
<span id="cb428-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb428-8"></a><span class="op">};</span></span></code></pre></div>
<p>Now when I ask C how big my <code>struct foo</code> is, it tells me 4! It was 16 bytes, but now it’s only 4. It has “packed” those 4 values down into 4 bytes, which is a four-fold memory savings.</p>
<p>The tradeoff is, of course, that the 5-bit fields can only hold values from 0-31 and the 3-bit fields can only hold values from 0-7. But life’s all about compromise, after all.</p>
<h3 data-number="20.8.1" id="non-adjacent-bit-fields"><span class="header-section-number">20.8.1</span> Non-Adjacent Bit-Fields</h3>
<p>A gotcha: C will only combine <strong>adjacent</strong> bit-fields. If they’re interrupted by non-bit-fields, you get no savings:</p>
<div class="sourceCode" id="cb429"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb429-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb429-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> foo <span class="op">{</span>            <span class="co">// sizeof(struct foo) == 16 (for me)</span></span>
<span id="cb429-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb429-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">int</span> a<span class="op">:</span><span class="dv">1</span><span class="op">;</span>   <span class="co">// since a is not adjacent to c.</span></span>
<span id="cb429-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb429-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">int</span> b<span class="op">;</span></span>
<span id="cb429-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb429-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">int</span> c<span class="op">:</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb429-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb429-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">int</span> d<span class="op">;</span></span>
<span id="cb429-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb429-6" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
<p>In that example, since <code>a</code> is not adjacent to <code>c</code>, they are both “packed” in their own <code>int</code>s.</p>
<p>So we have one <code>int</code> each for <code>a</code>, <code>b</code>, <code>c</code>, and <code>d</code>. Since my <code>int</code>s are 4 bytes, that’s a grand total of 16 bytes.</p>
<p>A quick rearrangement yields some space savings from 16 bytes down to 12 bytes (on my system):</p>
<div class="sourceCode" id="cb430"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb430-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb430-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> foo <span class="op">{</span>            <span class="co">// sizeof(struct foo) == 12 (for me)</span></span>
<span id="cb430-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb430-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">int</span> a<span class="op">:</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb430-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb430-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">int</span> c<span class="op">:</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb430-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb430-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">int</span> b<span class="op">;</span></span>
<span id="cb430-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb430-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">int</span> d<span class="op">;</span></span>
<span id="cb430-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb430-6" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
<p>And now, since <code>a</code> is next to <code>c</code>, the compiler puts them together into a single <code>int</code>.</p>
<p>So we have one <code>int</code> for a combined <code>a</code> and <code>c</code>, and one <code>int</code> each for <code>b</code> and <code>d</code>. For a grand total of 3 <code>int</code>s, or 12 bytes.</p>
<p>Put all your bitfields together to get the compiler to combine them.</p>
<h3 data-number="20.8.2" id="signed-or-unsigned-ints"><span class="header-section-number">20.8.2</span> Signed or Unsigned <code>int</code>s</h3>
<p>If you just declare a bit-field to be <code>int</code>, the different compilers will treat it as <code>signed</code> or <code>unsigned</code>. Just like the situation with <code>char</code>.</p>
<p>Be specific about the signedness when using bit-fields.</p>
<h3 data-number="20.8.3" id="unnamed-bit-fields"><span class="header-section-number">20.8.3</span> Unnamed Bit-Fields</h3>
<p>In some specific circumstances, you might need to reserve some bits for hardware reasons, but not need to use them in code.</p>
<p>For example, let’s say you have a byte where the top 2 bits have a meaning, the bottom 1 bit has a meaning, but the middle 5 bits do not get used by you<a href="https://beej.us/guide/bgc/html/index-wide.html#fn136" class="footnote-ref" id="fnref136" role="doc-noteref"><sup>136</sup></a>.</p>
<p>We <em>could</em> do something like this:</p>
<div class="sourceCode" id="cb431"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb431-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb431-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> foo <span class="op">{</span></span>
<span id="cb431-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb431-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">char</span> a<span class="op">:</span><span class="dv">2</span><span class="op">;</span></span>
<span id="cb431-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb431-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">char</span> dummy<span class="op">:</span><span class="dv">5</span><span class="op">;</span></span>
<span id="cb431-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb431-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">char</span> b<span class="op">:</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb431-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb431-5" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
<p>And that works—in our code we use <code>a</code> and <code>b</code>, but never <code>dummy</code>. It’s just there to eat up 5 bits to make sure <code>a</code> and <code>b</code> are in the “required” (by this contrived example) positions within the byte.</p>
<p>C allows us a way to clean this up: <em>unnamed bit-fields</em>. You can just leave the name (<code>dummy</code>) out in this case, and C is perfectly happy for the same effect:</p>
<div class="sourceCode" id="cb432"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb432-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb432-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> foo <span class="op">{</span></span>
<span id="cb432-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb432-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">char</span> a<span class="op">:</span><span class="dv">2</span><span class="op">;</span></span>
<span id="cb432-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb432-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">char</span> <span class="op">:</span><span class="dv">5</span><span class="op">;</span>   <span class="co">// &lt;-- unnamed bit-field!</span></span>
<span id="cb432-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb432-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">char</span> b<span class="op">:</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb432-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb432-5" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
<h3 data-number="20.8.4" id="zero-width-unnamed-bit-fields"><span class="header-section-number">20.8.4</span> Zero-Width Unnamed Bit-Fields</h3>
<p>Some more esoterica out here… Let’s say you were packing bits into an <code>unsigned int</code>, and you needed some adjacent bit-fields to pack into the <em>next</em> <code>unsigned int</code>.</p>
<p>That is, if you do this:</p>
<div class="sourceCode" id="cb433"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb433-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb433-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> foo <span class="op">{</span></span>
<span id="cb433-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb433-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">int</span> a<span class="op">:</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb433-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb433-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">int</span> b<span class="op">:</span><span class="dv">2</span><span class="op">;</span></span>
<span id="cb433-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb433-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">int</span> c<span class="op">:</span><span class="dv">3</span><span class="op">;</span></span>
<span id="cb433-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb433-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">int</span> d<span class="op">:</span><span class="dv">4</span><span class="op">;</span></span>
<span id="cb433-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb433-6" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
<p>the compiler packs all those into a single <code>unsigned int</code>. But what if you needed <code>a</code> and <code>b</code> in one <code>int</code>, and <code>c</code> and <code>d</code> in a different one?</p>
<p>There’s a solution for that: put an unnamed bit-field of width <code>0</code> where you want the compiler to start anew with packing bits in a different <code>int</code>:</p>
<div class="sourceCode" id="cb434"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb434-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb434-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> foo <span class="op">{</span></span>
<span id="cb434-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb434-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">int</span> a<span class="op">:</span><span class="dv">1</span><span class="op">;</span></span>
<span id="cb434-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb434-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">int</span> b<span class="op">:</span><span class="dv">2</span><span class="op">;</span></span>
<span id="cb434-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb434-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">int</span> <span class="op">:</span><span class="dv">0</span><span class="op">;</span>   <span class="co">// &lt;--Zero-width unnamed bit-field</span></span>
<span id="cb434-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb434-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">int</span> c<span class="op">:</span><span class="dv">3</span><span class="op">;</span></span>
<span id="cb434-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb434-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">int</span> d<span class="op">:</span><span class="dv">4</span><span class="op">;</span></span>
<span id="cb434-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb434-7" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
<p>It’s analogous to an explicit page break in a word processor. You’re telling the compiler, “Stop packing bits in this <code>unsigned</code>, and start packing them in the next one.”</p>
<p>By adding the zero-width unnamed bit field in that spot, the compiler puts <code>a</code> and <code>b</code> in one <code>unsigned int</code>, and <code>c</code> and <code>d</code> in another <code>unsigned int</code>. Two total, for a size of 8 bytes on my system (<code>unsigned int</code>s are 4 bytes each).</p>
<p></p>
<h2 data-number="20.9" id="unions"><span class="header-section-number">20.9</span> Unions</h2>
<p></p>
<p>These are basically just like <code>struct</code>s, except the fields overlap in memory. The <code>union</code> will be only large enough for the largest field, and you can only use one field at a time.</p>
<p>It’s a way to reuse the same memory space for different types of data.</p>
<p>You declare them just like <code>struct</code>s, except it’s <code>union</code>. Take a look at this:</p>
<div class="sourceCode" id="cb435"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb435-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb435-1" aria-hidden="true" tabindex="-1"></a><span class="kw">union</span> foo <span class="op">{</span></span>
<span id="cb435-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb435-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> a<span class="op">,</span> b<span class="op">,</span> c<span class="op">,</span> d<span class="op">,</span> e<span class="op">,</span> f<span class="op">;</span></span>
<span id="cb435-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb435-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> g<span class="op">,</span> h<span class="op">;</span></span>
<span id="cb435-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb435-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> i<span class="op">,</span> j<span class="op">,</span> k<span class="op">,</span> l<span class="op">;</span></span>
<span id="cb435-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb435-5" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
<p>Now, that’s a lot of fields. If this were a <code>struct</code>, my system would tell me it took 36 bytes to hold it all.</p>
<p>But it’s a <code>union</code>, so all those fields overlap in the same stretch of memory. The biggest one is <code>int</code> (or <code>float</code>), taking up 4 bytes on my system. And, indeed, if I ask for the <code>sizeof</code> the <code>union foo</code>, it tells me 4!</p>
<p>The tradeoff is that you can only portably use one of those fields at a time. However…</p>
<h3 data-number="20.9.1" id="union-type-punning"><span class="header-section-number">20.9.1</span> Unions and Type Punning</h3>
<p></p>
<p>You can non-portably write to one <code>union</code> field and read from another!</p>
<p>Doing so is called <a href="https://en.wikipedia.org/wiki/Type_punning">type punning</a><a href="https://beej.us/guide/bgc/html/index-wide.html#fn137" class="footnote-ref" id="fnref137" role="doc-noteref"><sup>137</sup></a>, and you’d use it if you really knew what you were doing, typically with some kind of low-level programming.</p>
<p>Since the members of a union share the same memory, writing to one member necessarily affects the others. And if you read from one what was written to another, you get some weird effects.</p>
<div class="sourceCode" id="cb436"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb436-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb436-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb436-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb436-2"></a></span>
<span id="cb436-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb436-3"></a><span class="kw">union</span> foo <span class="op">{</span></span>
<span id="cb436-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb436-4"></a>    <span class="dt">float</span> b<span class="op">;</span></span>
<span id="cb436-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb436-5"></a>    <span class="dt">short</span> a<span class="op">;</span></span>
<span id="cb436-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb436-6"></a><span class="op">};</span></span>
<span id="cb436-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb436-7"></a></span>
<span id="cb436-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb436-8"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb436-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb436-9"></a><span class="op">{</span></span>
<span id="cb436-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb436-10"></a>    <span class="kw">union</span> foo x<span class="op">;</span></span>
<span id="cb436-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb436-11"></a></span>
<span id="cb436-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb436-12"></a>    x<span class="op">.</span>b <span class="op">=</span> <span class="fl">3.14159</span><span class="op">;</span></span>
<span id="cb436-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb436-13"></a></span>
<span id="cb436-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb436-14"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%f\n</span><span class="st">"</span><span class="op">,</span> x<span class="op">.</span>b<span class="op">);</span>  <span class="co">// 3.14159, fair enough</span></span>
<span id="cb436-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb436-15"></a></span>
<span id="cb436-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb436-16"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> x<span class="op">.</span>a<span class="op">);</span>  <span class="co">// But what about this?</span></span>
<span id="cb436-17"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb436-17"></a><span class="op">}</span></span></code></pre></div>
<p>On my system, this prints out:</p>
<pre><code>3.141590
4048</code></pre>
<p>because under the hood, the object representation for the float <code>3.14159</code> was the same as the object representation for the short <code>4048</code>. On my system. Your results may vary.</p>
<p></p>
<h3 data-number="20.9.2" id="pointers-to-unions"><span class="header-section-number">20.9.2</span> Pointers to <code>union</code>s</h3>
<p></p>
<p>If you have a pointer to a <code>union</code>, you can cast that pointer to any of the types of the fields in that <code>union</code> and get the values out that way.</p>
<p>In this example, we see that the <code>union</code> has <code>int</code>s and <code>float</code>s in it. And we get pointers to the <code>union</code>, but we cast them to <code>int*</code> and <code>float*</code> types (the cast silences compiler warnings). And then if we dereference those, we see that they have the values we stored directly in the <code>union</code>.</p>
<div class="sourceCode" id="cb438"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb438-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb438-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb438-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb438-2"></a></span>
<span id="cb438-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb438-3"></a><span class="kw">union</span> foo <span class="op">{</span></span>
<span id="cb438-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb438-4"></a>    <span class="dt">int</span> a<span class="op">,</span> b<span class="op">,</span> c<span class="op">,</span> d<span class="op">,</span> e<span class="op">,</span> f<span class="op">;</span></span>
<span id="cb438-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb438-5"></a>    <span class="dt">float</span> g<span class="op">,</span> h<span class="op">;</span></span>
<span id="cb438-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb438-6"></a>    <span class="dt">char</span> i<span class="op">,</span> j<span class="op">,</span> k<span class="op">,</span> l<span class="op">;</span></span>
<span id="cb438-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb438-7"></a><span class="op">};</span></span>
<span id="cb438-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb438-8"></a></span>
<span id="cb438-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb438-9"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb438-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb438-10"></a><span class="op">{</span></span>
<span id="cb438-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb438-11"></a>    <span class="kw">union</span> foo x<span class="op">;</span></span>
<span id="cb438-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb438-12"></a></span>
<span id="cb438-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb438-13"></a>    <span class="dt">int</span> <span class="op">*</span>foo_int_p <span class="op">=</span> <span class="op">(</span><span class="dt">int</span> <span class="op">*)&amp;</span>x<span class="op">;</span></span>
<span id="cb438-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb438-14"></a>    <span class="dt">float</span> <span class="op">*</span>foo_float_p <span class="op">=</span> <span class="op">(</span><span class="dt">float</span> <span class="op">*)&amp;</span>x<span class="op">;</span></span>
<span id="cb438-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb438-15"></a></span>
<span id="cb438-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb438-16"></a>    x<span class="op">.</span>a <span class="op">=</span> <span class="dv">12</span><span class="op">;</span></span>
<span id="cb438-17"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb438-17"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> x<span class="op">.</span>a<span class="op">);</span>           <span class="co">// 12</span></span>
<span id="cb438-18"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb438-18"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> <span class="op">*</span>foo_int_p<span class="op">);</span>    <span class="co">// 12, again</span></span>
<span id="cb438-19"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb438-19"></a></span>
<span id="cb438-20"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb438-20"></a>    x<span class="op">.</span>g <span class="op">=</span> <span class="fl">3.141592</span><span class="op">;</span></span>
<span id="cb438-21"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb438-21"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%f\n</span><span class="st">"</span><span class="op">,</span> x<span class="op">.</span>g<span class="op">);</span>           <span class="co">// 3.141592</span></span>
<span id="cb438-22"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb438-22"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%f\n</span><span class="st">"</span><span class="op">,</span> <span class="op">*</span>foo_float_p<span class="op">);</span>  <span class="co">// 3.141592, again</span></span>
<span id="cb438-23"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb438-23"></a><span class="op">}</span></span></code></pre></div>
<p>The reverse is also true. If we have a pointer to a type inside the <code>union</code>, we can cast that to a pointer to the <code>union</code> and access its members.</p>
<div class="sourceCode" id="cb439"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb439-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb439-1" aria-hidden="true" tabindex="-1"></a><span class="kw">union</span> foo x<span class="op">;</span></span>
<span id="cb439-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb439-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> <span class="op">*</span>foo_int_p <span class="op">=</span> <span class="op">(</span><span class="dt">int</span> <span class="op">*)&amp;</span>x<span class="op">;</span>             <span class="co">// Pointer to int field</span></span>
<span id="cb439-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb439-3" aria-hidden="true" tabindex="-1"></a><span class="kw">union</span> foo <span class="op">*</span>p <span class="op">=</span> <span class="op">(</span><span class="kw">union</span> foo <span class="op">*)</span>foo_int_p<span class="op">;</span>  <span class="co">// Back to pointer to union</span></span>
<span id="cb439-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb439-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb439-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb439-5" aria-hidden="true" tabindex="-1"></a>p<span class="op">-&gt;</span>a <span class="op">=</span> <span class="dv">12</span><span class="op">;</span>  <span class="co">// This line the same as...</span></span>
<span id="cb439-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb439-6" aria-hidden="true" tabindex="-1"></a>x<span class="op">.</span>a <span class="op">=</span> <span class="dv">12</span><span class="op">;</span>   <span class="co">// this one.</span></span></code></pre></div>
<p>All this just lets you know that, under the hood, all these values in a <code>union</code> start at the same place in memory, and that’s the same as where the entire <code>union</code> is.</p>
<p></p>
<h3 data-number="20.9.3" id="common-initial-sequences-in-unions"><span class="header-section-number">20.9.3</span> Common Initial Sequences in Unions</h3>
<p></p>
<p>If you have a <code>union</code> of <code>struct</code>s, and all those <code>struct</code>s begin with a <em>common initial sequence</em>, it’s valid to access members of that sequence from any of the <code>union</code> members.</p>
<p>What?</p>
<p>Here are two <code>struct</code>s with a common initial sequence:</p>
<div class="sourceCode" id="cb440"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb440-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb440-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> a <span class="op">{</span></span>
<span id="cb440-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb440-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> x<span class="op">;</span>     <span class="co">//</span></span>
<span id="cb440-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb440-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> y<span class="op">;</span>   <span class="co">// Common initial sequence</span></span>
<span id="cb440-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb440-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb440-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb440-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> <span class="op">*</span>p<span class="op">;</span></span>
<span id="cb440-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb440-6" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb440-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb440-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb440-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb440-8" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> b <span class="op">{</span></span>
<span id="cb440-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb440-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> x<span class="op">;</span>     <span class="co">//</span></span>
<span id="cb440-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb440-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> y<span class="op">;</span>   <span class="co">// Common initial sequence</span></span>
<span id="cb440-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb440-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb440-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb440-12" aria-hidden="true" tabindex="-1"></a>    <span class="dt">double</span> <span class="op">*</span>p<span class="op">;</span></span>
<span id="cb440-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb440-13" aria-hidden="true" tabindex="-1"></a>    <span class="dt">short</span> z<span class="op">;</span></span>
<span id="cb440-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb440-14" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
<p>Do you see it? It’s that they start with <code>int</code> followed by <code>float</code>—that’s the common initial sequence. The members in the sequence of the <code>struct</code>s have to be compatible types. And we see that with <code>x</code> and <code>y</code>, which are <code>int</code> and <code>float</code> respectively.</p>
<p>Now let’s build a union of these:</p>
<div class="sourceCode" id="cb441"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb441-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb441-1" aria-hidden="true" tabindex="-1"></a><span class="kw">union</span> foo <span class="op">{</span></span>
<span id="cb441-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb441-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> a sa<span class="op">;</span></span>
<span id="cb441-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb441-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> b sb<span class="op">;</span></span>
<span id="cb441-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb441-4" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
<p>What this rule tells us is that we’re guaranteed that the members of the common initial sequences are interchangeable in code. That is:</p>
<ul>
<li><code>f.sa.x</code> is the same as <code>f.sb.x</code>.</li>
</ul>
<p>and</p>
<ul>
<li><code>f.sa.y</code> is the same as <code>f.sb.y</code>.</li>
</ul>
<p>Because fields <code>x</code> and <code>y</code> are both in the common initial sequence.</p>
<p>Also, the names of the members in the common initial sequence don’t matter—all that matters is that the types are the same.</p>
<p>All together, this allows us a way to safely add some shared information between <code>struct</code>s in the <code>union</code>. The best example of this is probably using a field to determine the type of <code>struct</code> out of all the <code>struct</code>s in the <code>union</code> that is currently “in use”.</p>
<p>That is, if we weren’t allowed this and we passed the <code>union</code> to some function, how would that function know which member of the <code>union</code> was the one it should look at?</p>
<p>Take a look at these <code>struct</code>s. Note the common initial sequence:</p>
<div class="sourceCode" id="cb442"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb442-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb442-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb442-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb442-2"></a></span>
<span id="cb442-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb442-3"></a><span class="kw">struct</span> common <span class="op">{</span></span>
<span id="cb442-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb442-4"></a>    <span class="dt">int</span> type<span class="op">;</span>   <span class="co">// common initial sequence</span></span>
<span id="cb442-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb442-5"></a><span class="op">};</span></span>
<span id="cb442-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb442-6"></a></span>
<span id="cb442-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb442-7"></a><span class="kw">struct</span> antelope <span class="op">{</span></span>
<span id="cb442-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb442-8"></a>    <span class="dt">int</span> type<span class="op">;</span>   <span class="co">// common initial sequence</span></span>
<span id="cb442-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb442-9"></a></span>
<span id="cb442-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb442-10"></a>    <span class="dt">int</span> loudness<span class="op">;</span></span>
<span id="cb442-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb442-11"></a><span class="op">};</span></span>
<span id="cb442-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb442-12"></a></span>
<span id="cb442-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb442-13"></a><span class="kw">struct</span> octopus <span class="op">{</span></span>
<span id="cb442-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb442-14"></a>    <span class="dt">int</span> type<span class="op">;</span>   <span class="co">// common initial sequence</span></span>
<span id="cb442-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb442-15"></a></span>
<span id="cb442-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb442-16"></a>    <span class="dt">int</span> sea_creature<span class="op">;</span></span>
<span id="cb442-17"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb442-17"></a>    <span class="dt">float</span> intelligence<span class="op">;</span></span>
<span id="cb442-18"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb442-18"></a><span class="op">};</span></span></code></pre></div>
<p>Now let’s throw them into a <code>union</code>:</p>
<div class="sourceCode" id="cb443" data-startfrom="20"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c" style="counter-reset: source-line 19;"><span id="cb443-20"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb443-20"></a><span class="kw">union</span> animal <span class="op">{</span></span>
<span id="cb443-21"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb443-21"></a>    <span class="kw">struct</span> common common<span class="op">;</span></span>
<span id="cb443-22"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb443-22"></a>    <span class="kw">struct</span> antelope antelope<span class="op">;</span></span>
<span id="cb443-23"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb443-23"></a>    <span class="kw">struct</span> octopus octopus<span class="op">;</span></span>
<span id="cb443-24"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb443-24"></a><span class="op">};</span></span></code></pre></div>
<p>Also, please indulge me these two <code>#define</code>s for the demo:</p>
<div class="sourceCode" id="cb444" data-startfrom="26"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c" style="counter-reset: source-line 25;"><span id="cb444-26"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb444-26"></a><span class="pp">#define ANTELOPE </span><span class="dv">1</span></span>
<span id="cb444-27"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb444-27"></a><span class="pp">#define OCTOPUS  </span><span class="dv">2</span></span></code></pre></div>
<p>So far, nothing special has happened here. It seems like the <code>type</code> field is completely useless.</p>
<p>But now let’s make a generic function that prints a <code>union animal</code>. It has to somehow be able to tell if it’s looking at a <code>struct antelope</code> or a <code>struct octopus</code>.</p>
<p>Because of the magic of common initial sequences, it can look up the animal type in any of these places for a particular <code>union animal x</code>:</p>
<div class="sourceCode" id="cb445"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb445-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb445-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> type <span class="op">=</span> x<span class="op">.</span>common<span class="op">.</span>type<span class="op">;</span>    \\ or<span class="op">...</span></span>
<span id="cb445-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb445-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> type <span class="op">=</span> x<span class="op">.</span>antelope<span class="op">.</span>type<span class="op">;</span>  \\ or<span class="op">...</span></span>
<span id="cb445-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb445-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> type <span class="op">=</span> x<span class="op">.</span>octopus<span class="op">.</span>type<span class="op">;</span></span></code></pre></div>
<p>All those refer to the same value in memory.</p>
<p>And, as you might have guessed, the <code>struct common</code> is there so code can agnostically look at the type without mentioning a particular animal.</p>
<p>Let’s look at the code to print a <code>union animal</code>:</p>
<div class="sourceCode" id="cb446" data-startfrom="29"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c" style="counter-reset: source-line 28;"><span id="cb446-29"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb446-29"></a><span class="dt">void</span> print_animal<span class="op">(</span><span class="kw">union</span> animal <span class="op">*</span>x<span class="op">)</span></span>
<span id="cb446-30"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb446-30"></a><span class="op">{</span></span>
<span id="cb446-31"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb446-31"></a>    <span class="cf">switch</span> <span class="op">(</span>x<span class="op">-&gt;</span>common<span class="op">.</span>type<span class="op">)</span> <span class="op">{</span></span>
<span id="cb446-32"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb446-32"></a>        <span class="cf">case</span> ANTELOPE<span class="op">:</span></span>
<span id="cb446-33"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb446-33"></a>            printf<span class="op">(</span><span class="st">"Antelope: loudness=</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> x<span class="op">-&gt;</span>antelope<span class="op">.</span>loudness<span class="op">);</span></span>
<span id="cb446-34"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb446-34"></a>            <span class="cf">break</span><span class="op">;</span></span>
<span id="cb446-35"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb446-35"></a></span>
<span id="cb446-36"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb446-36"></a>        <span class="cf">case</span> OCTOPUS<span class="op">:</span></span>
<span id="cb446-37"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb446-37"></a>            printf<span class="op">(</span><span class="st">"Octopus : sea_creature=</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> x<span class="op">-&gt;</span>octopus<span class="op">.</span>sea_creature<span class="op">);</span></span>
<span id="cb446-38"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb446-38"></a>            printf<span class="op">(</span><span class="st">"          intelligence=</span><span class="sc">%f\n</span><span class="st">"</span><span class="op">,</span> x<span class="op">-&gt;</span>octopus<span class="op">.</span>intelligence<span class="op">);</span></span>
<span id="cb446-39"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb446-39"></a>            <span class="cf">break</span><span class="op">;</span></span>
<span id="cb446-40"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb446-40"></a>        </span>
<span id="cb446-41"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb446-41"></a>        <span class="cf">default</span><span class="op">:</span></span>
<span id="cb446-42"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb446-42"></a>            printf<span class="op">(</span><span class="st">"Unknown animal type</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb446-43"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb446-43"></a>    <span class="op">}</span></span>
<span id="cb446-44"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb446-44"></a></span>
<span id="cb446-45"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb446-45"></a><span class="op">}</span></span>
<span id="cb446-46"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb446-46"></a></span>
<span id="cb446-47"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb446-47"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb446-48"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb446-48"></a><span class="op">{</span></span>
<span id="cb446-49"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb446-49"></a>    <span class="kw">union</span> animal a <span class="op">=</span> <span class="op">{.</span>antelope<span class="op">.</span>type<span class="op">=</span>ANTELOPE<span class="op">,</span> <span class="op">.</span>antelope<span class="op">.</span>loudness<span class="op">=</span><span class="dv">12</span><span class="op">};</span></span>
<span id="cb446-50"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb446-50"></a>    <span class="kw">union</span> animal b <span class="op">=</span> <span class="op">{.</span>octopus<span class="op">.</span>type<span class="op">=</span>OCTOPUS<span class="op">,</span> <span class="op">.</span>octopus<span class="op">.</span>sea_creature<span class="op">=</span><span class="dv">1</span><span class="op">,</span></span>
<span id="cb446-51"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb446-51"></a>                                       <span class="op">.</span>octopus<span class="op">.</span>intelligence<span class="op">=</span><span class="fl">12.8</span><span class="op">};</span></span>
<span id="cb446-52"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb446-52"></a></span>
<span id="cb446-53"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb446-53"></a>    print_animal<span class="op">(&amp;</span>a<span class="op">);</span></span>
<span id="cb446-54"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb446-54"></a>    print_animal<span class="op">(&amp;</span>b<span class="op">);</span></span>
<span id="cb446-55"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb446-55"></a><span class="op">}</span></span></code></pre></div>
<p>See how on line 29 we’re just passing in the <code>union</code>—we have no idea what type of animal <code>struct</code> is in use within it.</p>
<p>But that’s OK! Because on line 31 we check the type to see if it’s an antelope or an octopus. And then we can look at the proper <code>struct</code> to get the members.</p>
<p>It’s definitely possible to get this same effect using just <code>struct</code>s, but you can do it this way if you want the memory-saving effects of a <code>union</code>.</p>
<p></p>
<h2 data-number="20.10" id="unions-and-unnamed-structs"><span class="header-section-number">20.10</span> Unions and Unnamed Structs</h2>
<p></p>
<p>You know how you can have an unnamed <code>struct</code>, like this:</p>
<div class="sourceCode" id="cb447"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb447-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb447-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> <span class="op">{</span></span>
<span id="cb447-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb447-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> x<span class="op">,</span> y<span class="op">;</span></span>
<span id="cb447-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb447-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> s<span class="op">;</span></span></code></pre></div>
<p>That defines a variable <code>s</code> that is of anonymous <code>struct</code> type (because the <code>struct</code> has no name tag), with members <code>x</code> and <code>y</code>.</p>
<p>So things like this are valid:</p>
<div class="sourceCode" id="cb448"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb448-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb448-1" aria-hidden="true" tabindex="-1"></a>s<span class="op">.</span>x <span class="op">=</span> <span class="dv">34</span><span class="op">;</span></span>
<span id="cb448-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb448-2" aria-hidden="true" tabindex="-1"></a>s<span class="op">.</span>y <span class="op">=</span> <span class="dv">90</span><span class="op">;</span></span>
<span id="cb448-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb448-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb448-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb448-4" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">%d</span><span class="st"> </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> s<span class="op">.</span>x<span class="op">,</span> s<span class="op">.</span>y<span class="op">);</span></span></code></pre></div>
<p>Turns out you can drop those unnamed <code>struct</code>s in <code>union</code>s just like you might expect:</p>
<div class="sourceCode" id="cb449"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb449-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb449-1" aria-hidden="true" tabindex="-1"></a><span class="kw">union</span> foo <span class="op">{</span></span>
<span id="cb449-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb449-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> <span class="op">{</span>       <span class="co">// unnamed!</span></span>
<span id="cb449-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb449-3" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> x<span class="op">,</span> y<span class="op">;</span></span>
<span id="cb449-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb449-4" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> a<span class="op">;</span></span>
<span id="cb449-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb449-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb449-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb449-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> <span class="op">{</span>       <span class="co">// unnamed!</span></span>
<span id="cb449-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb449-7" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> z<span class="op">,</span> w<span class="op">;</span></span>
<span id="cb449-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb449-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span> b<span class="op">;</span></span>
<span id="cb449-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb449-9" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
<p>And then access them as per normal:</p>
<div class="sourceCode" id="cb450"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb450-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb450-1" aria-hidden="true" tabindex="-1"></a><span class="kw">union</span> foo f<span class="op">;</span></span>
<span id="cb450-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb450-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb450-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb450-3" aria-hidden="true" tabindex="-1"></a>f<span class="op">.</span>a<span class="op">.</span>x <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb450-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb450-4" aria-hidden="true" tabindex="-1"></a>f<span class="op">.</span>a<span class="op">.</span>y <span class="op">=</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb450-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb450-5" aria-hidden="true" tabindex="-1"></a>f<span class="op">.</span>b<span class="op">.</span>z <span class="op">=</span> <span class="dv">3</span><span class="op">;</span></span>
<span id="cb450-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb450-6" aria-hidden="true" tabindex="-1"></a>f<span class="op">.</span>b<span class="op">.</span>w <span class="op">=</span> <span class="dv">4</span><span class="op">;</span></span></code></pre></div>
<p>No problem!</p>
<p></p>
<h2 data-number="20.11" id="passing-and-returning-structs-and-unions"><span class="header-section-number">20.11</span> Passing and Returning <code>struct</code>s and <code>union</code>s</h2>
<p> </p>
<p>You can pass a <code>struct</code> or <code>union</code> to a function by value (as opposed to a pointer to it)—a copy of that object to the parameter will be made as if by assignment as per usual.</p>
<p>You can also return a <code>struct</code> or <code>union</code> from a function and it is also passed by value back.</p>
<div class="sourceCode" id="cb451"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb451-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb451-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb451-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb451-2"></a></span>
<span id="cb451-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb451-3"></a><span class="kw">struct</span> foo <span class="op">{</span></span>
<span id="cb451-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb451-4"></a>    <span class="dt">int</span> x<span class="op">,</span> y<span class="op">;</span></span>
<span id="cb451-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb451-5"></a><span class="op">};</span></span>
<span id="cb451-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb451-6"></a></span>
<span id="cb451-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb451-7"></a><span class="kw">struct</span> foo f<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb451-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb451-8"></a><span class="op">{</span></span>
<span id="cb451-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb451-9"></a>    <span class="cf">return</span> <span class="op">(</span><span class="kw">struct</span> foo<span class="op">){.</span>x<span class="op">=</span><span class="dv">34</span><span class="op">,</span> <span class="op">.</span>y<span class="op">=</span><span class="dv">90</span><span class="op">};</span></span>
<span id="cb451-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb451-10"></a><span class="op">}</span></span>
<span id="cb451-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb451-11"></a></span>
<span id="cb451-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb451-12"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb451-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb451-13"></a><span class="op">{</span></span>
<span id="cb451-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb451-14"></a>    <span class="kw">struct</span> foo a <span class="op">=</span> f<span class="op">();</span>  <span class="co">// Copy is made</span></span>
<span id="cb451-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb451-15"></a></span>
<span id="cb451-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb451-16"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%d</span><span class="st"> </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> a<span class="op">.</span>x<span class="op">,</span> a<span class="op">.</span>y<span class="op">);</span></span>
<span id="cb451-17"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb451-17"></a><span class="op">}</span></span></code></pre></div>
<p>Fun fact: if you do this, you can use the <code>.</code> operator right off the function call:</p>
<div class="sourceCode" id="cb452" data-startfrom="16"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c" style="counter-reset: source-line 15;"><span id="cb452-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb452-16"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%d</span><span class="st"> </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> f<span class="op">().</span>x<span class="op">,</span> f<span class="op">().</span>y<span class="op">);</span></span></code></pre></div>
<p>(Of course that example calls the function twice, inefficiently.)</p>
<p>And the same holds true for returning pointers to <code>struct</code>s and <code>union</code>s—just be sure to use the <code>-&gt;</code> arrow operator in that case.</p>
<p> </p>
<!-- Beej's guide to C

# vim: ts=4:sw=4:nosi:et:tw=72
-->
<h1 data-number="21" id="characters-and-strings-ii"><span class="header-section-number">21</span> Characters and Strings II</h1>
<p>We’ve talked about how <code>char</code> types are actually just small integer types… but it’s the same for a character in single quotes.</p>
<p>But a string in double quotes is type <code>const char *</code>.</p>
<p>Turns out there are few more types of strings and characters, and it leads down one of the most infamous rabbit holes in the language: the whole multibyte/wide/Unicode/localization thingy.</p>
<p>We’re going to peer into that rabbit hole, but not go in. …Yet!</p>
<h2 data-number="21.1" id="escape-sequences"><span class="header-section-number">21.1</span> Escape Sequences</h2>
<p></p>
<p>We’re used to strings and characters with regular letters, punctuation, and numbers:</p>
<div class="sourceCode" id="cb453"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb453-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb453-1" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span> <span class="op">*</span>s <span class="op">=</span> <span class="st">"Hello!"</span><span class="op">;</span></span>
<span id="cb453-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb453-2" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span> t <span class="op">=</span> <span class="ch">'c'</span><span class="op">;</span></span></code></pre></div>
<p>But what if we want some special characters in there that we can’t type on the keyboard because they don’t exist (e.g.&nbsp;“€”), or even if we want a character that’s a single quote? We clearly can’t do this:</p>
<div class="sourceCode" id="cb454"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb454-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb454-1" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span> t <span class="op">=</span> <span class="ch">'</span><span class="er">'</span><span class="ch">';</span></span></code></pre></div>
<p></p>
<p>To do these things, we use something called <em>escape sequences</em>. These are the backslash character (<code>\</code>) followed by another character. The two (or more) characters together have special meaning.</p>
<p>For our single quote character example, we can put an escape (that is, <code>\</code>) in front of the central single quote to solve it:</p>
<p></p>
<div class="sourceCode" id="cb455"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb455-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb455-1" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span> t <span class="op">=</span> <span class="ch">'</span><span class="sc">\'</span><span class="ch">'</span><span class="op">;</span></span></code></pre></div>
<p>Now C knows that <code>\'</code> means just a regular quote we want to print, not the end of the character sequence.</p>
<p></p>
<p>You can say either “backslash” or “escape” in this context (“escape that quote”) and C devs will know what you’re talking about. Also, “escape” in this context is different than your <code>Esc</code> key or the ASCII <code>ESC</code> code.</p>
<h3 data-number="21.1.1" id="frequently-used-escapes"><span class="header-section-number">21.1.1</span> Frequently-used Escapes</h3>
<p>In my humble opinion, these escape characters make up 99.2%<a href="https://beej.us/guide/bgc/html/index-wide.html#fn138" class="footnote-ref" id="fnref138" role="doc-noteref"><sup>138</sup></a> of all escapes.</p>
<table>
<colgroup>
<col style="width: 14%">
<col style="width: 85%">
</colgroup>
<thead>
<tr class="header">
<th>Code</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>\n</code></td>
<td>Newline character—when printing, continue subsequent output on the next line</td>
</tr>
<tr class="even">
<td><code>\'</code></td>
<td>Single quote—used for a single quote character constant</td>
</tr>
<tr class="odd">
<td><code>\"</code></td>
<td>Double quote—used for a double quote in a string literal</td>
</tr>
<tr class="even">
<td><code>\\</code></td>
<td>Backslash—used for a literal <code>\</code> in a string or character</td>
</tr>
</tbody>
</table>
<p>Here are some examples of the escapes and what they output when printed.</p>
<div class="sourceCode" id="cb456"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb456-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb456-1" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"Use </span><span class="sc">\\</span><span class="st">n for newline</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span>  <span class="co">// Use \n for newline</span></span>
<span id="cb456-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb456-2" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"Say </span><span class="sc">\"</span><span class="st">hello</span><span class="sc">\"</span><span class="st">!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span>       <span class="co">// Say "hello"!</span></span>
<span id="cb456-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb456-3" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">%c\n</span><span class="st">"</span><span class="op">,</span> <span class="ch">'</span><span class="sc">\'</span><span class="ch">'</span><span class="op">);</span>             <span class="co">// '</span></span></code></pre></div>
<h3 data-number="21.1.2" id="rarely-used-escapes"><span class="header-section-number">21.1.2</span> Rarely-used Escapes</h3>
<p>But there are more escapes! You just don’t see these as often.</p>
<table>
<colgroup>
<col style="width: 14%">
<col style="width: 85%">
</colgroup>
<thead>
<tr class="header">
<th>Code</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>\a</code></td>
<td>Alert. This makes the terminal make a sound or flash, or both!</td>
</tr>
<tr class="even">
<td><code>\b</code></td>
<td>Backspace. Moves the cursor back a character. Doesn’t delete the character.</td>
</tr>
<tr class="odd">
<td><code>\f</code></td>
<td>Formfeed. This moves to the next “page”, but that doesn’t have much modern meaning. On my system, this behaves like <code>\v</code>.</td>
</tr>
<tr class="even">
<td><code>\r</code></td>
<td>Return. Move to the beginning of the same line.</td>
</tr>
<tr class="odd">
<td><code>\t</code></td>
<td>Horizontal tab. Moves to the next horizontal tab stop. On my machine, this lines up on columns that are multiples of 8, but YMMV.</td>
</tr>
<tr class="even">
<td><code>\v</code></td>
<td>Vertical tab. Moves to the next vertical tab stop. On my machine, this moves to the same column on the next line.</td>
</tr>
<tr class="odd">
<td><code>\?</code></td>
<td>Literal question mark. Sometimes you need this to avoid trigraphs, as shown below.</td>
</tr>
</tbody>
</table>
<h4 data-number="21.1.2.1" id="single-line-status-updates"><span class="header-section-number">21.1.2.1</span> Single Line Status Updates</h4>
<p> </p>
<p>A use case for <code>\b</code> or <code>\r</code> is to show status updates that appear on the same line on the screen and don’t cause the display to scroll. Here’s an example that does a countdown from 10. (Note this makes use of the non-standard POSIX function <code>sleep()</code> from <code>&lt;unistd.h&gt;</code>—if you’re not on a Unix-like, search for your platform and <code>sleep</code> for the equivalent.)</p>
<div class="sourceCode" id="cb457"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb457-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb457-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb457-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb457-2"></a><span class="pp">#include </span><span class="im">&lt;threads.h&gt;</span></span>
<span id="cb457-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb457-3"></a></span>
<span id="cb457-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb457-4"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb457-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb457-5"></a><span class="op">{</span></span>
<span id="cb457-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb457-6"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">10</span><span class="op">;</span> i <span class="op">&gt;=</span> <span class="dv">0</span><span class="op">;</span> i<span class="op">--)</span> <span class="op">{</span></span>
<span id="cb457-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb457-7"></a>        printf<span class="op">(</span><span class="st">"</span><span class="sc">\r</span><span class="st">T minus </span><span class="sc">%d</span><span class="st"> second</span><span class="sc">%s</span><span class="st">... </span><span class="sc">\b</span><span class="st">"</span><span class="op">,</span> i<span class="op">,</span> i <span class="op">!=</span> <span class="dv">1</span><span class="op">?</span> <span class="st">"s"</span><span class="op">:</span> <span class="st">""</span><span class="op">);</span></span>
<span id="cb457-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb457-8"></a></span>
<span id="cb457-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb457-9"></a>        fflush<span class="op">(</span>stdout<span class="op">);</span>  <span class="co">// Force output to update</span></span>
<span id="cb457-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb457-10"></a></span>
<span id="cb457-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb457-11"></a>        <span class="co">// Sleep for 1 second</span></span>
<span id="cb457-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb457-12"></a>        thrd_sleep<span class="op">(&amp;(</span><span class="kw">struct</span> timespec<span class="op">){.</span>tv_sec<span class="op">=</span><span class="dv">1</span><span class="op">},</span> NULL<span class="op">);</span></span>
<span id="cb457-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb457-13"></a>    <span class="op">}</span></span>
<span id="cb457-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb457-14"></a></span>
<span id="cb457-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb457-15"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">\r</span><span class="st">Liftoff!             </span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb457-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb457-16"></a><span class="op">}</span></span></code></pre></div>
<p>Quite a few things are happening on line 7. First of all, we lead with a <code>\r</code> to get us to the beginning of the current line, then we overwrite whatever’s there with the current countdown. (There’s ternary operator out there to make sure we print <code>1 second</code> instead of <code>1 seconds</code>.)</p>
<p>Also, there’s a space after the <code>...</code> That’s so that we properly overwrite the last <code>.</code> when <code>i</code> drops from <code>10</code> to <code>9</code> and we get a column narrower. Try it without the space to see what I mean.</p>
<p>And we wrap it up with a <code>\b</code> to back up over that space so the cursor sits at the exact end of the line in an aesthetically-pleasing way.</p>
<p></p>
<p>Note that line 14 also has a lot of spaces at the end to overwrite the characters that were already there from the countdown.</p>
<p>Finally, we have a weird <code>fflush(stdout)</code> in there, whatever that means. Short answer is that most terminals are <em>line buffered</em> by default, meaning they don’t actually display anything until a newline character is encountered. Since we don’t have a newline (we just have <code>\r</code>), without this line, the program would just sit there until <code>Liftoff!</code> and then print everything all in one instant. <code>fflush()</code> overrides this behavior and forces output to happen <em>right now</em>.</p>
<p></p>
<h4 data-number="21.1.2.2" id="the-question-mark-escape"><span class="header-section-number">21.1.2.2</span> The Question Mark Escape</h4>
<p></p>
<p>Why bother with this? After all, this works just fine:</p>
<div class="sourceCode" id="cb458"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb458-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb458-1" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"Doesn't it?</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span></code></pre></div>
<p>And it works fine with the escape, too:</p>
<div class="sourceCode" id="cb459"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb459-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb459-1" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"Doesn't it</span><span class="sc">\?\n</span><span class="st">"</span><span class="op">);</span>   <span class="co">// Note \?</span></span></code></pre></div>
<p>So what’s the point??!</p>
<p></p>
<p>Let’s get more emphatic with another question mark and an exclamation point:</p>
<div class="sourceCode" id="cb460"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb460-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb460-1" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"Doesn't it??!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span></code></pre></div>
<p>When I compile this, I get this warning:</p>
<div class="sourceCode" id="cb461"><pre class="sourceCode zsh"><code class="sourceCode zsh"><span id="cb461-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb461-1" aria-hidden="true" tabindex="-1"></a><span class="ex">foo.c:</span> In function ‘main’:</span>
<span id="cb461-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb461-2" aria-hidden="true" tabindex="-1"></a><span class="ex">foo.c:5:23:</span> warning: trigraph <span class="pp">??</span>! converted to <span class="kw">|</span> <span class="ex">[-Wtrigraphs]</span></span>
<span id="cb461-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb461-3" aria-hidden="true" tabindex="-1"></a>    <span class="ex">5</span> <span class="kw">|</span>     <span class="bu">printf</span><span class="op">(</span><span class="st">"Doesn't it??!\n"</span><span class="op">)</span><span class="kw">;</span></span>
<span id="cb461-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb461-4" aria-hidden="true" tabindex="-1"></a>      <span class="kw">|</span>    </span></code></pre></div>
<p>And running it gives this unlikely result:</p>
<div class="sourceCode" id="cb462"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb462-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb462-1" aria-hidden="true" tabindex="-1"></a>Doesn't it|</span></code></pre></div>
<p>So <em>trigraphs</em>? What the heck is this??!</p>
<p>I’m sure we’ll revisit this dusty corner of the language later, but the short of it is the compiler looks for certain triplets of characters starting with <code>??</code> and it substitutes other characters in their place. So if you’re on some ancient terminal without a pipe symbol (<code>|</code>) on the keyboard, you can type <code>??!</code> instead.</p>
<p>You can fix this by escaping the second question mark, like so:</p>
<div class="sourceCode" id="cb463"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb463-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb463-1" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"Doesn't it?</span><span class="sc">\?</span><span class="st">!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span></code></pre></div>
<p>And then it compiles and works as-expected.</p>
<p>These days, of course, no one ever uses trigraphs. But that whole <code>??!</code> does sometimes appear if you decide to use it in a string for emphasis.</p>
<p> </p>
<h3 data-number="21.1.3" id="numeric-escapes"><span class="header-section-number">21.1.3</span> Numeric Escapes</h3>
<p>In addition, there are ways to specify numeric constants or other character values inside strings or character constants.</p>
<p>If you know an octal or hexadecimal representation of a byte, you can include that in a string or character constant.</p>
<p>The following table has example numbers, but any hex or octal numbers may be used. Pad with leading zeros if necessary to read the proper digit count.</p>
<table>
<colgroup>
<col style="width: 14%">
<col style="width: 85%">
</colgroup>
<thead>
<tr class="header">
<th>Code</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>\123</code></td>
<td>Embed the byte with octal value <code>123</code>, 3 digits exactly.</td>
</tr>
<tr class="even">
<td><code>\x4D</code></td>
<td>Embed the byte with hex value <code>4D</code>, 2 digits.</td>
</tr>
<tr class="odd">
<td><code>\u2620</code></td>
<td>Embed the Unicode character at code point with hex value <code>2620</code>, 4 digits.</td>
</tr>
<tr class="even">
<td><code>\U0001243F</code></td>
<td>Embed the Unicode character at code point with hex value <code>1243F</code>, 8 digits.</td>
</tr>
</tbody>
</table>
<p>Here’s an example of the less-commonly used octal notation to represent the letter <code>B</code> in between <code>A</code> and <code>C</code>. Normally this would be used for some kind of special unprintable character, but we have other ways to do that, below, and this is just an octal demo:</p>
<p></p>
<div class="sourceCode" id="cb464"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb464-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb464-1" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"A</span><span class="er">\1</span><span class="st">02C</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span>  <span class="co">// 102 is `B` in ASCII/UTF-8</span></span></code></pre></div>
<p>Note there’s no leading zero on the octal number when you include it this way. But it does need to be three characters, so pad with leading zeros if you need to.</p>
<p></p>
<p></p>
<p>But far more common is to use hex constants these days. Here’s a demo that you shouldn’t use, but it demos embedding the UTF-8 bytes 0xE2, 0x80, and 0xA2 in a string, which corresponds to the Unicode “bullet” character (•).</p>
<div class="sourceCode" id="cb465"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb465-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb465-1" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">\xE2\x80\xA2</span><span class="st"> Bullet 1</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb465-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb465-2" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">\xE2\x80\xA2</span><span class="st"> Bullet 2</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb465-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb465-3" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">\xE2\x80\xA2</span><span class="st"> Bullet 3</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span></code></pre></div>
<p>Produces the following output if you’re on a UTF-8 console (or probably garbage if you’re not):</p>
<div class="sourceCode" id="cb466"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb466-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb466-1" aria-hidden="true" tabindex="-1"></a>• Bullet 1</span>
<span id="cb466-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb466-2" aria-hidden="true" tabindex="-1"></a>• Bullet 2</span>
<span id="cb466-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb466-3" aria-hidden="true" tabindex="-1"></a>• Bullet 3</span></code></pre></div>
<p></p>
<p> </p>
<p>But that’s a crummy way to do Unicode. You can use the escapes <code>\u</code> (16-bit) or <code>\U</code> (32-bit) to just refer to Unicode by code point number. The bullet is <code>2022</code> (hex) in Unicode, so you can do this and get more portable results:</p>
<div class="sourceCode" id="cb467"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb467-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb467-1" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">\u2022</span><span class="st"> Bullet 1</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb467-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb467-2" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">\u2022</span><span class="st"> Bullet 2</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb467-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb467-3" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">\u2022</span><span class="st"> Bullet 3</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span></code></pre></div>
<p>Be sure to pad <code>\u</code> with enough leading zeros to get to four characters, and <code>\U</code> with enough to get to eight.</p>
<p></p>
<p>For example, that bullet could be done with <code>\U</code> and four leading zeros:</p>
<div class="sourceCode" id="cb468"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb468-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb468-1" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">\U00002022</span><span class="st"> Bullet 1</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span></code></pre></div>
<p></p>
<p>But who has time to be that verbose?</p>
<p> </p>
<!-- Beej's guide to C

# vim: ts=4:sw=4:nosi:et:tw=72
-->
<h1 data-number="22" id="enumerated-types-enum"><span class="header-section-number">22</span> Enumerated Types: <code>enum</code></h1>
<p></p>
<p>C offers us another way to have constant integer values by name: <code>enum</code>.</p>
<p>For example:</p>
<div class="sourceCode" id="cb469"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb469-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb469-1" aria-hidden="true" tabindex="-1"></a><span class="kw">enum</span> <span class="op">{</span></span>
<span id="cb469-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb469-2" aria-hidden="true" tabindex="-1"></a>  ONE<span class="op">=</span><span class="dv">1</span><span class="op">,</span></span>
<span id="cb469-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb469-3" aria-hidden="true" tabindex="-1"></a>  TWO<span class="op">=</span><span class="dv">2</span></span>
<span id="cb469-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb469-4" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb469-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb469-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb469-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb469-6" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">%d</span><span class="st"> </span><span class="sc">%d</span><span class="st">"</span><span class="op">,</span> ONE<span class="op">,</span> TWO<span class="op">);</span>  <span class="co">// 1 2</span></span></code></pre></div>
<p>In some ways, it can be better—or different—than using a <code>#define</code>. Key differences:</p>
<ul>
<li><code>enum</code>s can only be integer types.</li>
<li><code>#define</code> can define anything at all.</li>
<li><code>enum</code>s are often shown by their symbolic identifier name in a debugger.</li>
<li><code>#define</code>d numbers just show as raw numbers which are harder to know the meaning of while debugging.</li>
</ul>
<p>Since they’re integer types, they can be used any place integers can be used, including in array dimensions and <code>case</code> statements.</p>
<p>Let’s tear into this more.</p>
<h2 data-number="22.1" id="behavior-of-enum"><span class="header-section-number">22.1</span> Behavior of <code>enum</code></h2>
<h3 data-number="22.1.1" id="numbering"><span class="header-section-number">22.1.1</span> Numbering</h3>
<p></p>
<p><code>enum</code>s are automatically numbered unless you override them.</p>
<p>They start at <code>0</code>, and autoincrement up from there, by default:</p>
<div class="sourceCode" id="cb470"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb470-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb470-1" aria-hidden="true" tabindex="-1"></a><span class="kw">enum</span> <span class="op">{</span></span>
<span id="cb470-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb470-2" aria-hidden="true" tabindex="-1"></a>    SHEEP<span class="op">,</span>  <span class="co">// Value is 0</span></span>
<span id="cb470-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb470-3" aria-hidden="true" tabindex="-1"></a>    WHEAT<span class="op">,</span>  <span class="co">// Value is 1</span></span>
<span id="cb470-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb470-4" aria-hidden="true" tabindex="-1"></a>    WOOD<span class="op">,</span>   <span class="co">// Value is 2</span></span>
<span id="cb470-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb470-5" aria-hidden="true" tabindex="-1"></a>    BRICK<span class="op">,</span>  <span class="co">// Value is 3</span></span>
<span id="cb470-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb470-6" aria-hidden="true" tabindex="-1"></a>    ORE     <span class="co">// Value is 4</span></span>
<span id="cb470-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb470-7" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb470-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb470-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb470-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb470-9" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">%d</span><span class="st"> </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> SHEEP<span class="op">,</span> BRICK<span class="op">);</span>  <span class="co">// 0 3</span></span></code></pre></div>
<p>You can force particular integer values, as we saw earlier:</p>
<div class="sourceCode" id="cb471"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb471-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb471-1" aria-hidden="true" tabindex="-1"></a><span class="kw">enum</span> <span class="op">{</span></span>
<span id="cb471-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb471-2" aria-hidden="true" tabindex="-1"></a>  X<span class="op">=</span><span class="dv">2</span><span class="op">,</span></span>
<span id="cb471-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb471-3" aria-hidden="true" tabindex="-1"></a>  Y<span class="op">=</span><span class="dv">18</span><span class="op">,</span></span>
<span id="cb471-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb471-4" aria-hidden="true" tabindex="-1"></a>  Z<span class="op">=-</span><span class="dv">2</span></span>
<span id="cb471-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb471-5" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
<p>Duplicates are not a problem:</p>
<div class="sourceCode" id="cb472"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb472-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb472-1" aria-hidden="true" tabindex="-1"></a><span class="kw">enum</span> <span class="op">{</span></span>
<span id="cb472-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb472-2" aria-hidden="true" tabindex="-1"></a>  X<span class="op">=</span><span class="dv">2</span><span class="op">,</span></span>
<span id="cb472-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb472-3" aria-hidden="true" tabindex="-1"></a>  Y<span class="op">=</span><span class="dv">2</span><span class="op">,</span></span>
<span id="cb472-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb472-4" aria-hidden="true" tabindex="-1"></a>  Z<span class="op">=</span><span class="dv">2</span></span>
<span id="cb472-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb472-5" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
<p>if values are omitted, numbering continues counting in the positive direction from whichever value was last specified. For example:</p>
<div class="sourceCode" id="cb473"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb473-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb473-1" aria-hidden="true" tabindex="-1"></a><span class="kw">enum</span> <span class="op">{</span></span>
<span id="cb473-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb473-2" aria-hidden="true" tabindex="-1"></a>  A<span class="op">,</span>    <span class="co">// 0, default starting value</span></span>
<span id="cb473-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb473-3" aria-hidden="true" tabindex="-1"></a>  B<span class="op">,</span>    <span class="co">// 1</span></span>
<span id="cb473-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb473-4" aria-hidden="true" tabindex="-1"></a>  C<span class="op">=</span><span class="dv">4</span><span class="op">,</span>  <span class="co">// 4, manually set</span></span>
<span id="cb473-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb473-5" aria-hidden="true" tabindex="-1"></a>  D<span class="op">,</span>    <span class="co">// 5</span></span>
<span id="cb473-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb473-6" aria-hidden="true" tabindex="-1"></a>  E<span class="op">,</span>    <span class="co">// 6</span></span>
<span id="cb473-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb473-7" aria-hidden="true" tabindex="-1"></a>  F<span class="op">=</span><span class="dv">3</span>   <span class="co">// 3, manually set</span></span>
<span id="cb473-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb473-8" aria-hidden="true" tabindex="-1"></a>  G<span class="op">,</span>    <span class="co">// 4</span></span>
<span id="cb473-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb473-9" aria-hidden="true" tabindex="-1"></a>  H     <span class="co">// 5</span></span>
<span id="cb473-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb473-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p></p>
<h3 data-number="22.1.2" id="trailing-commas"><span class="header-section-number">22.1.2</span> Trailing Commas</h3>
<p>This is perfectly fine, if that’s your style:</p>
<div class="sourceCode" id="cb474"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb474-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb474-1" aria-hidden="true" tabindex="-1"></a><span class="kw">enum</span> <span class="op">{</span></span>
<span id="cb474-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb474-2" aria-hidden="true" tabindex="-1"></a>  X<span class="op">=</span><span class="dv">2</span><span class="op">,</span></span>
<span id="cb474-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb474-3" aria-hidden="true" tabindex="-1"></a>  Y<span class="op">=</span><span class="dv">18</span><span class="op">,</span></span>
<span id="cb474-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb474-4" aria-hidden="true" tabindex="-1"></a>  Z<span class="op">=-</span><span class="dv">2</span><span class="op">,</span>   <span class="co">// &lt;-- Trailing comma</span></span>
<span id="cb474-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb474-5" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
<p>It’s gotten more popular in languages of the recent decades so you might be pleased to see it.</p>
<h3 data-number="22.1.3" id="scope-1"><span class="header-section-number">22.1.3</span> Scope</h3>
<p></p>
<p><code>enum</code>s scope as you’d expect. If at file scope, the whole file can see it. If in a block, it’s local to that block.</p>
<p>It’s really common for <code>enum</code>s to be defined in header files so they can be <code>#include</code>d at file scope.</p>
<p></p>
<h3 data-number="22.1.4" id="style"><span class="header-section-number">22.1.4</span> Style</h3>
<p>As you’ve noticed, it’s common to declare the <code>enum</code> symbols in uppercase (with underscores).</p>
<p>This isn’t a requirement, but is a very, very common idiom.</p>
<h2 data-number="22.2" id="your-enum-is-a-type"><span class="header-section-number">22.2</span> Your <code>enum</code> is a Type</h2>
<p>This is an important thing to know about <code>enum</code>: they’re a type, analogous to how a <code>struct</code> is a type.</p>
<p>You can give them a tag name so you can refer to the type later and declare variables of that type.</p>
<p>Now, since <code>enum</code>s are integer types, why not just use <code>int</code>?</p>
<p>In C, the best reason for this is code clarity–it’s a nice, typed way to describe your thinking in code. C (unlike C++) doesn’t actually enforce any values being in range for a particular <code>enum</code>.</p>
<p>Let’s do an example where we declare a variable <code>r</code> of type <code>enum resource</code> that can hold those values:</p>
<div class="sourceCode" id="cb475"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb475-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb475-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Named enum, type is "enum resource"</span></span>
<span id="cb475-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb475-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb475-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb475-3" aria-hidden="true" tabindex="-1"></a><span class="kw">enum</span> resource <span class="op">{</span></span>
<span id="cb475-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb475-4" aria-hidden="true" tabindex="-1"></a>    SHEEP<span class="op">,</span></span>
<span id="cb475-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb475-5" aria-hidden="true" tabindex="-1"></a>    WHEAT<span class="op">,</span></span>
<span id="cb475-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb475-6" aria-hidden="true" tabindex="-1"></a>    WOOD<span class="op">,</span></span>
<span id="cb475-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb475-7" aria-hidden="true" tabindex="-1"></a>    BRICK<span class="op">,</span></span>
<span id="cb475-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb475-8" aria-hidden="true" tabindex="-1"></a>    ORE</span>
<span id="cb475-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb475-9" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb475-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb475-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb475-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb475-11" aria-hidden="true" tabindex="-1"></a><span class="co">// Declare a variable "r" of type "enum resource"</span></span>
<span id="cb475-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb475-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb475-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb475-13" aria-hidden="true" tabindex="-1"></a><span class="kw">enum</span> resource r <span class="op">=</span> BRICK<span class="op">;</span></span>
<span id="cb475-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb475-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb475-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb475-15" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>r <span class="op">==</span> BRICK<span class="op">)</span> <span class="op">{</span></span>
<span id="cb475-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb475-16" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"I'll trade you a brick for two sheep.</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb475-17"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb475-17" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>You can also <code>typedef</code> these, of course, though I personally don’t like to.</p>
<div class="sourceCode" id="cb476"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb476-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb476-1" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">enum</span> <span class="op">{</span></span>
<span id="cb476-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb476-2" aria-hidden="true" tabindex="-1"></a>    SHEEP<span class="op">,</span></span>
<span id="cb476-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb476-3" aria-hidden="true" tabindex="-1"></a>    WHEAT<span class="op">,</span></span>
<span id="cb476-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb476-4" aria-hidden="true" tabindex="-1"></a>    WOOD<span class="op">,</span></span>
<span id="cb476-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb476-5" aria-hidden="true" tabindex="-1"></a>    BRICK<span class="op">,</span></span>
<span id="cb476-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb476-6" aria-hidden="true" tabindex="-1"></a>    ORE</span>
<span id="cb476-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb476-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> RESOURCE<span class="op">;</span></span>
<span id="cb476-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb476-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb476-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb476-9" aria-hidden="true" tabindex="-1"></a>RESOURCE r <span class="op">=</span> BRICK<span class="op">;</span></span></code></pre></div>
<p>Another shortcut that’s legal but rare is to declare variables when you declare the <code>enum</code>:</p>
<div class="sourceCode" id="cb477"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb477-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb477-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Declare an enum and some initialized variables of that type:</span></span>
<span id="cb477-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb477-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb477-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb477-3" aria-hidden="true" tabindex="-1"></a><span class="kw">enum</span> <span class="op">{</span></span>
<span id="cb477-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb477-4" aria-hidden="true" tabindex="-1"></a>    SHEEP<span class="op">,</span></span>
<span id="cb477-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb477-5" aria-hidden="true" tabindex="-1"></a>    WHEAT<span class="op">,</span></span>
<span id="cb477-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb477-6" aria-hidden="true" tabindex="-1"></a>    WOOD<span class="op">,</span></span>
<span id="cb477-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb477-7" aria-hidden="true" tabindex="-1"></a>    BRICK<span class="op">,</span></span>
<span id="cb477-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb477-8" aria-hidden="true" tabindex="-1"></a>    ORE</span>
<span id="cb477-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb477-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> r <span class="op">=</span> BRICK<span class="op">,</span> s <span class="op">=</span> WOOD<span class="op">;</span></span></code></pre></div>
<p>You can also give the <code>enum</code> a name so you can use it later, which is probably what you want to do in most cases:</p>
<div class="sourceCode" id="cb478"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb478-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb478-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Declare an enum and some initialized variables of that type:</span></span>
<span id="cb478-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb478-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb478-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb478-3" aria-hidden="true" tabindex="-1"></a><span class="kw">enum</span> resource <span class="op">{</span>   <span class="co">// &lt;-- type is now "enum resource"</span></span>
<span id="cb478-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb478-4" aria-hidden="true" tabindex="-1"></a>    SHEEP<span class="op">,</span></span>
<span id="cb478-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb478-5" aria-hidden="true" tabindex="-1"></a>    WHEAT<span class="op">,</span></span>
<span id="cb478-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb478-6" aria-hidden="true" tabindex="-1"></a>    WOOD<span class="op">,</span></span>
<span id="cb478-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb478-7" aria-hidden="true" tabindex="-1"></a>    BRICK<span class="op">,</span></span>
<span id="cb478-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb478-8" aria-hidden="true" tabindex="-1"></a>    ORE</span>
<span id="cb478-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb478-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span> r <span class="op">=</span> BRICK<span class="op">,</span> s <span class="op">=</span> WOOD<span class="op">;</span></span></code></pre></div>
<p>In short, <code>enum</code>s are a great way to write nice, scoped, typed, clean code.</p>
<p></p>
<!-- Beej's guide to C

# vim: ts=4:sw=4:nosi:et:tw=72
-->
<h1 data-number="23" id="pointers-iii-pointers-to-pointers-and-more"><span class="header-section-number">23</span> Pointers III: Pointers to Pointers and More</h1>
<p>Here’s where we cover some intermediate and advanced pointer usage. If you don’t have pointers down well, review the previous chapters on <a href="https://beej.us/guide/bgc/html/index-wide.html#pointers">pointers</a> and <a href="https://beej.us/guide/bgc/html/index-wide.html#pointers2">pointer arithmetic</a> before starting on this stuff.</p>
<h2 data-number="23.1" id="pointers-to-pointers"><span class="header-section-number">23.1</span> Pointers to Pointers</h2>
<p></p>
<p>If you can have a pointer to a variable, and a variable can be a pointer, can you have a pointer to a variable that it itself a pointer?</p>
<p>Yes! This is a pointer to a pointer, and it’s held in variable of type pointer-pointer.</p>
<p>Before we tear into that, I want to try for a <em>gut feel</em> for how pointers to pointers work.</p>
<p>Remember that a pointer is just a number. It’s a number that represents an index in computer memory, typically one that holds a value we’re interested in for some reason.</p>
<p>That pointer, which is a number, has to be stored somewhere. And that place is memory, just like everything else<a href="https://beej.us/guide/bgc/html/index-wide.html#fn139" class="footnote-ref" id="fnref139" role="doc-noteref"><sup>139</sup></a>.</p>
<p>But because it’s stored in memory, it must have an index it’s stored at, right? The pointer must have an index in memory where it is stored. And that index is a number. It’s the address of the pointer. It’s a pointer to the pointer.</p>
<p>Let’s start with a regular pointer to an <code>int</code>, back from the earlier chapters:</p>
<div class="sourceCode" id="cb479"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb479-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb479-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb479-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb479-2"></a></span>
<span id="cb479-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb479-3"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb479-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb479-4"></a><span class="op">{</span></span>
<span id="cb479-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb479-5"></a>    <span class="dt">int</span> x <span class="op">=</span> <span class="dv">3490</span><span class="op">;</span>  <span class="co">// Type: int</span></span>
<span id="cb479-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb479-6"></a>    <span class="dt">int</span> <span class="op">*</span>p <span class="op">=</span> <span class="op">&amp;</span>x<span class="op">;</span>   <span class="co">// Type: pointer to an int</span></span>
<span id="cb479-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb479-7"></a></span>
<span id="cb479-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb479-8"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> <span class="op">*</span>p<span class="op">);</span>  <span class="co">// 3490</span></span>
<span id="cb479-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb479-9"></a><span class="op">}</span></span></code></pre></div>
<p>Straightforward enough, right? We have two types represented: <code>int</code> and <code>int*</code>, and we set up <code>p</code> to point to <code>x</code>. Then we can dereference <code>p</code> on line 8 and print out the value <code>3490</code>.</p>
<p>But, like we said, we can have a pointer to any variable… so does that mean we can have a pointer to <code>p</code>?</p>
<p>In other words, what type is this expression?</p>
<div class="sourceCode" id="cb480"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb480-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb480-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> x <span class="op">=</span> <span class="dv">3490</span><span class="op">;</span>  <span class="co">// Type: int</span></span>
<span id="cb480-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb480-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> <span class="op">*</span>p <span class="op">=</span> <span class="op">&amp;</span>x<span class="op">;</span>   <span class="co">// Type: pointer to an int</span></span>
<span id="cb480-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb480-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb480-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb480-4" aria-hidden="true" tabindex="-1"></a><span class="op">&amp;</span>p  <span class="co">// &lt;-- What type is the address of p? AKA a pointer to p?</span></span></code></pre></div>
<p>If <code>x</code> is an <code>int</code>, then <code>&amp;x</code> is a pointer to an <code>int</code> that we’ve stored in <code>p</code> which is type <code>int*</code>. Follow? (Repeat this paragraph until you do!)</p>
<p>And therefore <code>&amp;p</code> is a pointer to an <code>int*</code>, AKA a “pointer to a pointer to an <code>int</code>”. AKA “<code>int</code>-pointer-pointer”.</p>
<p>Got it? (Repeat the previous paragraph until you do!)</p>
<p>We write this type with two asterisks: <code>int **</code>. Let’s see it in action.</p>
<div class="sourceCode" id="cb481"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb481-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb481-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb481-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb481-2"></a></span>
<span id="cb481-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb481-3"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb481-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb481-4"></a><span class="op">{</span></span>
<span id="cb481-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb481-5"></a>    <span class="dt">int</span> x <span class="op">=</span> <span class="dv">3490</span><span class="op">;</span>  <span class="co">// Type: int</span></span>
<span id="cb481-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb481-6"></a>    <span class="dt">int</span> <span class="op">*</span>p <span class="op">=</span> <span class="op">&amp;</span>x<span class="op">;</span>   <span class="co">// Type: pointer to an int</span></span>
<span id="cb481-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb481-7"></a>    <span class="dt">int</span> <span class="op">**</span>q <span class="op">=</span> <span class="op">&amp;</span>p<span class="op">;</span>  <span class="co">// Type: pointer to pointer to int</span></span>
<span id="cb481-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb481-8"></a></span>
<span id="cb481-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb481-9"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%d</span><span class="st"> </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> <span class="op">*</span>p<span class="op">,</span> <span class="op">**</span>q<span class="op">);</span>  <span class="co">// 3490 3490</span></span>
<span id="cb481-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb481-10"></a><span class="op">}</span></span></code></pre></div>
<p>Let’s make up some pretend addresses for the above values as examples and see what these three variables might look like in memory. The address values, below are just made up by me for example purposes:</p>
<table>
<thead>
<tr class="header">
<th>Variable</th>
<th>Stored at Address</th>
<th>Value Stored There</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>x</code></td>
<td><code>28350</code></td>
<td><code>3490</code>—the value from the code</td>
</tr>
<tr class="even">
<td><code>p</code></td>
<td><code>29122</code></td>
<td><code>28350</code>—the address of <code>x</code>!</td>
</tr>
<tr class="odd">
<td><code>q</code></td>
<td><code>30840</code></td>
<td><code>29122</code>—the address of <code>p</code>!</td>
</tr>
</tbody>
</table>
<p>Indeed, let’s try it for real on my computer<a href="https://beej.us/guide/bgc/html/index-wide.html#fn140" class="footnote-ref" id="fnref140" role="doc-noteref"><sup>140</sup></a> and print out the pointer values with <code>%p</code> and I’ll do the same table again with actual references (printed in hex).</p>
<table>
<thead>
<tr class="header">
<th>Variable</th>
<th>Stored at Address</th>
<th>Value Stored There</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>x</code></td>
<td><code>0x7ffd96a07b94</code></td>
<td><code>3490</code>—the value from the code</td>
</tr>
<tr class="even">
<td><code>p</code></td>
<td><code>0x7ffd96a07b98</code></td>
<td><code>0x7ffd96a07b94</code>—the address of <code>x</code>!</td>
</tr>
<tr class="odd">
<td><code>q</code></td>
<td><code>0x7ffd96a07ba0</code></td>
<td><code>0x7ffd96a07b98</code>—the address of <code>p</code>!</td>
</tr>
</tbody>
</table>
<p>You can see those addresses are the same except the last byte, so just focus on those.</p>
<p>On my system, <code>int</code>s are 4 bytes, which is why we’re seeing the address go up by 4 from <code>x</code> to <code>p</code><a href="https://beej.us/guide/bgc/html/index-wide.html#fn141" class="footnote-ref" id="fnref141" role="doc-noteref"><sup>141</sup></a> and then goes up by 8 from <code>p</code> to <code>q</code>. On my system, all pointers are 8 bytes.</p>
<p>Does it matter if it’s an <code>int*</code> or an <code>int**</code>? Is one more bytes than the other? Nope! Remember that all pointers are addresses, that is indexes into memory. And on my machine you can represent an index with 8 bytes… doesn’t matter what’s stored at that index.</p>
<p>Now check out what we did there on line 9 of the previous example: we <em>double dereferenced</em> <code>q</code> to get back to our <code>3490</code>.</p>
<p>This is the important bit about pointers and pointers to pointers:</p>
<ul>
<li>You can get a pointer to anything with <code>&amp;</code> (including to a pointer!)</li>
<li>You can get the thing a pointer points to with <code>*</code> (including a pointer!)</li>
</ul>
<p>So you can think of <code>&amp;</code> as being used to make pointers, and <code>*</code> being the inverse—it goes the opposite direction of <code>&amp;</code>—to get to the thing pointed to.</p>
<p>In terms of type, each time you <code>&amp;</code>, that adds another pointer level to the type.</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">If you have</th>
<th style="text-align: center;">Then you run</th>
<th style="text-align: left;">The result type is</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>int x</code></td>
<td style="text-align: center;"><code>&amp;x</code></td>
<td style="text-align: left;"><code>int *</code></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>int *x</code></td>
<td style="text-align: center;"><code>&amp;x</code></td>
<td style="text-align: left;"><code>int **</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>int **x</code></td>
<td style="text-align: center;"><code>&amp;x</code></td>
<td style="text-align: left;"><code>int ***</code></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>int ***x</code></td>
<td style="text-align: center;"><code>&amp;x</code></td>
<td style="text-align: left;"><code>int ****</code></td>
</tr>
</tbody>
</table>
<p>And each time you use dereference (<code>*</code>), it does the opposite:</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">If you have</th>
<th style="text-align: center;">Then you run</th>
<th style="text-align: left;">The result type is</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>int ****x</code></td>
<td style="text-align: center;"><code>*x</code></td>
<td style="text-align: left;"><code>int ***</code></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>int ***x</code></td>
<td style="text-align: center;"><code>*x</code></td>
<td style="text-align: left;"><code>int **</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>int **x</code></td>
<td style="text-align: center;"><code>*x</code></td>
<td style="text-align: left;"><code>int *</code></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>int *x</code></td>
<td style="text-align: center;"><code>*x</code></td>
<td style="text-align: left;"><code>int</code></td>
</tr>
</tbody>
</table>
<p>Note that you can use multiple <code>*</code>s in a row to quickly dereference, just like we saw in the example code with <code>**q</code>, above. Each one strips away one level of indirection.</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">If you have</th>
<th style="text-align: center;">Then you run</th>
<th style="text-align: left;">The result type is</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>int ****x</code></td>
<td style="text-align: center;"><code>***x</code></td>
<td style="text-align: left;"><code>int *</code></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>int ***x</code></td>
<td style="text-align: center;"><code>**x</code></td>
<td style="text-align: left;"><code>int *</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>int **x</code></td>
<td style="text-align: center;"><code>**x</code></td>
<td style="text-align: left;"><code>int</code></td>
</tr>
</tbody>
</table>
<p>In general, <code>&amp;*E == E</code><a href="https://beej.us/guide/bgc/html/index-wide.html#fn142" class="footnote-ref" id="fnref142" role="doc-noteref"><sup>142</sup></a>. The dereference “undoes” the address-of.</p>
<p>But <code>&amp;</code> doesn’t work the same way—you can only do those one at a time, and have to store the result in an intermediate variable:</p>
<div class="sourceCode" id="cb482"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb482-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb482-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> x <span class="op">=</span> <span class="dv">3490</span><span class="op">;</span>     <span class="co">// Type: int</span></span>
<span id="cb482-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb482-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> <span class="op">*</span>p <span class="op">=</span> <span class="op">&amp;</span>x<span class="op">;</span>      <span class="co">// Type: int *, pointer to an int</span></span>
<span id="cb482-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb482-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> <span class="op">**</span>q <span class="op">=</span> <span class="op">&amp;</span>p<span class="op">;</span>     <span class="co">// Type: int **, pointer to pointer to int</span></span>
<span id="cb482-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb482-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> <span class="op">***</span>r <span class="op">=</span> <span class="op">&amp;</span>q<span class="op">;</span>    <span class="co">// Type: int ***, pointer to pointer to pointer to int</span></span>
<span id="cb482-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb482-5" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> <span class="op">****</span>s <span class="op">=</span> <span class="op">&amp;</span>r<span class="op">;</span>   <span class="co">// Type: int ****, you get the idea</span></span>
<span id="cb482-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb482-6" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> <span class="op">*****</span>t <span class="op">=</span> <span class="op">&amp;</span>s<span class="op">;</span>  <span class="co">// Type: int *****</span></span></code></pre></div>
<p></p>
<h3 data-number="23.1.1" id="pointer-pointers-and-const"><span class="header-section-number">23.1.1</span> Pointer Pointers and <code>const</code></h3>
<p></p>
<p>If you recall, declaring a pointer like this:</p>
<div class="sourceCode" id="cb483"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb483-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb483-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> <span class="op">*</span><span class="dt">const</span> p<span class="op">;</span></span></code></pre></div>
<p>means that you can’t modify <code>p</code>. Trying to <code>p++</code> would give you a compile-time error.</p>
<p>But how does that work with <code>int **</code> or <code>int ***</code>? Where does the <code>const</code> go, and what does it mean?</p>
<p>Let’s start with the simple bit. The <code>const</code> right next to the variable name refers to that variable. So if you want an <code>int***</code> that you can’t change, you can do this:</p>
<div class="sourceCode" id="cb484"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb484-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb484-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> <span class="op">***</span><span class="dt">const</span> p<span class="op">;</span></span>
<span id="cb484-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb484-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb484-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb484-3" aria-hidden="true" tabindex="-1"></a>p<span class="op">++;</span>  <span class="co">// Not allowed</span></span></code></pre></div>
<p>But here’s where things get a little weird.</p>
<p>What if we had this situation:</p>
<div class="sourceCode" id="cb485"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb485-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb485-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb485-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb485-2"></a><span class="op">{</span></span>
<span id="cb485-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb485-3"></a>    <span class="dt">int</span> x <span class="op">=</span> <span class="dv">3490</span><span class="op">;</span></span>
<span id="cb485-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb485-4"></a>    <span class="dt">int</span> <span class="op">*</span><span class="dt">const</span> p <span class="op">=</span> <span class="op">&amp;</span>x<span class="op">;</span></span>
<span id="cb485-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb485-5"></a>    <span class="dt">int</span> <span class="op">**</span>q <span class="op">=</span> <span class="op">&amp;</span>p<span class="op">;</span></span>
<span id="cb485-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb485-6"></a><span class="op">}</span></span></code></pre></div>
<p>When I build that, I get a warning:</p>
<div class="sourceCode" id="cb486"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb486-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb486-1" aria-hidden="true" tabindex="-1"></a>warning: initialization discards ‘const’ qualifier from pointer target type</span>
<span id="cb486-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb486-2" aria-hidden="true" tabindex="-1"></a>    7 |     int **q = &amp;p;</span>
<span id="cb486-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb486-3" aria-hidden="true" tabindex="-1"></a>      |               ^</span></code></pre></div>
<p>What’s going on? The compiler is telling us here that we had a variable that was <code>const</code>, and we’re assigning its value into another variable that is not <code>const</code> in the same way. The “<code>const</code>ness” is discarded, which probably isn’t what we wanted to do.</p>
<p>The type of <code>p</code> is <code>int *const p</code>, and so <code>&amp;p</code> is type <code>int *const *</code>. And we try to assign that into <code>q</code>.</p>
<p>But <code>q</code> is <code>int **</code>! A type with different <code>const</code>ness on the first <code>*</code>! So we get a warning that the <code>const</code> in <code>p</code>’s <code>int *const *</code> is being ignored and thrown away.</p>
<p>We can fix that by making sure <code>q</code>’s type is at least as <code>const</code> as <code>p</code>.</p>
<div class="sourceCode" id="cb487"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb487-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb487-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> x <span class="op">=</span> <span class="dv">3490</span><span class="op">;</span></span>
<span id="cb487-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb487-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> <span class="op">*</span><span class="dt">const</span> p <span class="op">=</span> <span class="op">&amp;</span>x<span class="op">;</span></span>
<span id="cb487-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb487-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> <span class="op">*</span><span class="dt">const</span> <span class="op">*</span>q <span class="op">=</span> <span class="op">&amp;</span>p<span class="op">;</span></span></code></pre></div>
<p>And now we’re happy.</p>
<p>We could make <code>q</code> even more <code>const</code>. As it is, above, we’re saying, “<code>q</code> isn’t itself <code>const</code>, but the thing it points to is <code>const</code>.” But we could make them both <code>const</code>:</p>
<div class="sourceCode" id="cb488"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb488-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb488-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> x <span class="op">=</span> <span class="dv">3490</span><span class="op">;</span></span>
<span id="cb488-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb488-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> <span class="op">*</span><span class="dt">const</span> p <span class="op">=</span> <span class="op">&amp;</span>x<span class="op">;</span></span>
<span id="cb488-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb488-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> <span class="op">*</span><span class="dt">const</span> <span class="op">*</span><span class="dt">const</span> q <span class="op">=</span> <span class="op">&amp;</span>p<span class="op">;</span>  <span class="co">// More const!</span></span></code></pre></div>
<p>And that works, too. Now we can’t modify <code>q</code>, or the pointer <code>q</code> points to.</p>
<p></p>
<h2 data-number="23.2" id="multibyte-values"><span class="header-section-number">23.2</span> Multibyte Values</h2>
<p></p>
<p>We kinda hinted at this in a variety of places earlier, but clearly not every value can be stored in a single byte of memory. Things take up multiple bytes of memory (assuming they’re not <code>char</code>s). You can tell how many bytes by using <code>sizeof</code>. And you can tell which address in memory is the <em>first</em> byte of the object by using the standard <code>&amp;</code> operator, which always returns the address of the first byte.</p>
<p>And here’s another fun fact! If you iterate over the bytes of any object, you get its <em>object representation</em>. Two things with the same object representation in memory are equal.</p>
<p>If you want to iterate over the object representation, you should do it with pointers to <code>unsigned char</code>.</p>
<p>Let’s make our own version of <a href="https://beej.us/guide/bgclr/html/split/stringref.html#man-memcpy"><code>memcpy()</code></a><a href="https://beej.us/guide/bgc/html/index-wide.html#fn143" class="footnote-ref" id="fnref143" role="doc-noteref"><sup>143</sup></a> that does exactly this:</p>
<div class="sourceCode" id="cb489"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb489-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb489-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="op">*</span>my_memcpy<span class="op">(</span><span class="dt">void</span> <span class="op">*</span>dest<span class="op">,</span> <span class="dt">const</span> <span class="dt">void</span> <span class="op">*</span>src<span class="op">,</span> <span class="dt">size_t</span> n<span class="op">)</span></span>
<span id="cb489-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb489-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb489-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb489-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Make local variables for src and dest, but of type unsigned char</span></span>
<span id="cb489-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb489-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb489-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb489-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">const</span> <span class="dt">unsigned</span> <span class="dt">char</span> <span class="op">*</span>s <span class="op">=</span> src<span class="op">;</span></span>
<span id="cb489-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb489-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">unsigned</span> <span class="dt">char</span> <span class="op">*</span>d <span class="op">=</span> dest<span class="op">;</span></span>
<span id="cb489-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb489-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb489-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb489-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">while</span> <span class="op">(</span>n<span class="op">--</span> <span class="op">&gt;</span> <span class="dv">0</span><span class="op">)</span>   <span class="co">// For the given number of bytes</span></span>
<span id="cb489-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb489-9" aria-hidden="true" tabindex="-1"></a>        <span class="op">*</span>d<span class="op">++</span> <span class="op">=</span> <span class="op">*</span>s<span class="op">++;</span>  <span class="co">// Copy source byte to dest byte</span></span>
<span id="cb489-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb489-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb489-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb489-11" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Most copy functions return a pointer to the dest as a convenience</span></span>
<span id="cb489-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb489-12" aria-hidden="true" tabindex="-1"></a>    <span class="co">// to the caller</span></span>
<span id="cb489-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb489-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb489-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb489-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> dest<span class="op">;</span></span>
<span id="cb489-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb489-15" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>(There are some good examples of post-increment and post-decrement in there for you to study, as well.)</p>
<p>It’s important to note that the version, above, is probably less efficient than the one that comes with your system.</p>
<p>But you can pass pointers to anything into it, and it’ll copy those objects. Could be <code>int*</code>, <code>struct animal*</code>, or anything.</p>
<p>Let’s do another example that prints out the object representation bytes of a <code>struct</code> so we can see if there’s any padding in there and what values it has<a href="https://beej.us/guide/bgc/html/index-wide.html#fn144" class="footnote-ref" id="fnref144" role="doc-noteref"><sup>144</sup></a>.</p>
<div class="sourceCode" id="cb490"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb490-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb490-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb490-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb490-2"></a></span>
<span id="cb490-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb490-3"></a><span class="kw">struct</span> foo <span class="op">{</span></span>
<span id="cb490-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb490-4"></a>    <span class="dt">char</span> a<span class="op">;</span></span>
<span id="cb490-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb490-5"></a>    <span class="dt">int</span> b<span class="op">;</span></span>
<span id="cb490-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb490-6"></a><span class="op">};</span></span>
<span id="cb490-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb490-7"></a></span>
<span id="cb490-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb490-8"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb490-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb490-9"></a><span class="op">{</span></span>
<span id="cb490-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb490-10"></a>    <span class="kw">struct</span> foo x <span class="op">=</span> <span class="op">{</span><span class="bn">0x12</span><span class="op">,</span> <span class="bn">0x12345678</span><span class="op">};</span></span>
<span id="cb490-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb490-11"></a>    <span class="dt">unsigned</span> <span class="dt">char</span> <span class="op">*</span>p <span class="op">=</span> <span class="op">(</span><span class="dt">unsigned</span> <span class="dt">char</span> <span class="op">*)&amp;</span>x<span class="op">;</span></span>
<span id="cb490-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb490-12"></a></span>
<span id="cb490-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb490-13"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">size_t</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="kw">sizeof</span> x<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb490-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb490-14"></a>        printf<span class="op">(</span><span class="st">"</span><span class="sc">%02X\n</span><span class="st">"</span><span class="op">,</span> p<span class="op">[</span>i<span class="op">]);</span></span>
<span id="cb490-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb490-15"></a>    <span class="op">}</span></span>
<span id="cb490-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb490-16"></a><span class="op">}</span></span></code></pre></div>
<p>What we have there is a <code>struct foo</code> that’s built in such a way that should encourage a compiler to inject padding bytes (though it doesn’t have to). And then we get an <code>unsigned char *</code> to the first byte of the <code>struct foo</code> variable <code>x</code>.</p>
<p>From there, all we need to know is the <code>sizeof x</code> and we can loop through that many bytes, printing out the values (in hex for ease).</p>
<p>Running this gives a bunch of numbers as output. I’ve annotated it below to identify where the values were stored:</p>
<div class="sourceCode" id="cb491"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb491-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb491-1" aria-hidden="true" tabindex="-1"></a>12  | x.a == 0x12</span>
<span id="cb491-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb491-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb491-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb491-3" aria-hidden="true" tabindex="-1"></a>AB  |</span>
<span id="cb491-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb491-4" aria-hidden="true" tabindex="-1"></a>BF  | padding bytes with "random" value</span>
<span id="cb491-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb491-5" aria-hidden="true" tabindex="-1"></a>26  |</span>
<span id="cb491-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb491-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb491-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb491-7" aria-hidden="true" tabindex="-1"></a>78  |</span>
<span id="cb491-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb491-8" aria-hidden="true" tabindex="-1"></a>56  | x.b == 0x12345678</span>
<span id="cb491-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb491-9" aria-hidden="true" tabindex="-1"></a>34  |</span>
<span id="cb491-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb491-10" aria-hidden="true" tabindex="-1"></a>12  |</span></code></pre></div>
<p>On all systems, <code>sizeof(char)</code> is 1, and we see that first byte at the top of the output holding the value <code>0x12</code> that we stored there.</p>
<p>Then we have some padding bytes—for me, these varied from run to run.</p>
<p>Finally, on my system, <code>sizeof(int)</code> is 4, and we can see those 4 bytes at the end. Notice how they’re the same bytes as are in the hex value <code>0x12345678</code>, but strangely in reverse order<a href="https://beej.us/guide/bgc/html/index-wide.html#fn145" class="footnote-ref" id="fnref145" role="doc-noteref"><sup>145</sup></a>.</p>
<p>So that’s a little peek under the hood at the bytes of a more complex entity in memory.</p>
<p></p>
<h2 data-number="23.3" id="the-null-pointer-and-zero"><span class="header-section-number">23.3</span> The <code>NULL</code> Pointer and Zero</h2>
<p></p>
<p>These things can be used interchangeably:</p>
<ul>
<li><code>NULL</code></li>
<li><code>0</code></li>
<li><code>'\0'</code></li>
<li><code>(void *)0</code></li>
</ul>
<p>Personally, I always use <code>NULL</code> when I mean <code>NULL</code>, but you might see some other variants from time to time. Though <code>'\0'</code> (a byte with all bits set to zero) will also compare equal, it’s <em>weird</em> to compare it to a pointer; you should compare <code>NULL</code> against the pointer. (Of course, lots of times in string processing, you’re comparing <em>the thing the pointer points to</em> to <code>'\0'</code>, and that’s right.)</p>
<p><code>0</code> is called the <em>null pointer constant</em>, and, when compared to or assigned into another pointer, it is converted to a null pointer of the same type.</p>
<p></p>
<h2 data-number="23.4" id="pointers-as-integers"><span class="header-section-number">23.4</span> Pointers as Integers</h2>
<p></p>
<p>You can cast pointers to integers and vice-versa (since a pointer is just an index into memory), but you probably only ever need to do this if you’re doing some low-level hardware stuff. The results of such machinations are implementation-defined, so they aren’t portable. And <em>weird things</em> could happen.</p>
<p>C does make one guarantee, though: you can convert a pointer to a <code>uintptr_t</code> type and you’ll be able to convert it back to a pointer without losing any data.</p>
<p><code>uintptr_t</code> is defined in <code>&lt;stdint.h&gt;</code><a href="https://beej.us/guide/bgc/html/index-wide.html#fn146" class="footnote-ref" id="fnref146" role="doc-noteref"><sup>146</sup></a>.</p>
<p>Additionally, if you feel like being signed, you can use <code>intptr_t</code> to the same effect.</p>
<p></p>
<h2 data-number="23.5" id="casting-pointers-to-other-pointers"><span class="header-section-number">23.5</span> Casting Pointers to other Pointers</h2>
<p></p>
<p>There’s only one safe pointer conversion:</p>
<ol type="1">
<li>Converting to <code>intptr_t</code> or <code>uintptr_t</code>.</li>
<li>Converting to and from <code>void*</code>.</li>
</ol>
<p>TWO! Two safe pointer conversions.</p>
<ol start="3" type="1">
<li>Converting to and from <code>char*</code>.</li>
</ol>
<p>THREE! Three safe conversions!</p>
<ol start="4" type="1">
<li>Converting to and from a pointer to a <code>struct</code> and a pointer to its first member, and vice-versa.</li>
</ol>
<p>FOUR! Four safe conversions!</p>
<p>If you cast to a pointer of another type and then access the object it points to, the behavior is undefined due to something called <em>strict aliasing</em>.</p>
<p>Plain old <em>aliasing</em> refers to the ability to have more than one way to access the same object. The access points are aliases for each other.</p>
<p><em>Strict aliasing</em> says you are only allowed to access an object via pointers to <em>compatible types</em> to that object.</p>
<p>For example, this is definitely allowed:</p>
<div class="sourceCode" id="cb492"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb492-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb492-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> a <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb492-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb492-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> <span class="op">*</span>p <span class="op">=</span> <span class="op">&amp;</span>a<span class="op">;</span></span></code></pre></div>
<p><code>p</code> is a pointer to an <code>int</code>, and it points to a compatible type—namely <code>int</code>—so we’re golden.</p>
<p>But the following isn’t good because <code>int</code> and <code>float</code> are not compatible types:</p>
<div class="sourceCode" id="cb493"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb493-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb493-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> a <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb493-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb493-2" aria-hidden="true" tabindex="-1"></a><span class="dt">float</span> <span class="op">*</span>p <span class="op">=</span> <span class="op">(</span><span class="dt">float</span> <span class="op">*)&amp;</span>a<span class="op">;</span></span></code></pre></div>
<p>Here’s a demo program that does some aliasing. It takes a variable <code>v</code> of type <code>int32_t</code> and aliases it to a pointer to a <code>struct words</code>. That <code>struct</code> has two <code>int16_t</code>s in it. These types are incompatible, so we’re in violation of strict aliasing rules. The compiler will assume that these two pointers never point to the same object… but we’re making it so they do. Which is naughty of us.</p>
<p>Let’s see if we can break something.</p>
<div class="sourceCode" id="cb494"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb494-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb494-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb494-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb494-2"></a><span class="pp">#include </span><span class="im">&lt;stdint.h&gt;</span></span>
<span id="cb494-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb494-3"></a></span>
<span id="cb494-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb494-4"></a><span class="kw">struct</span> words <span class="op">{</span></span>
<span id="cb494-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb494-5"></a>    <span class="dt">int16_t</span> v<span class="op">[</span><span class="dv">2</span><span class="op">];</span></span>
<span id="cb494-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb494-6"></a><span class="op">};</span></span>
<span id="cb494-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb494-7"></a></span>
<span id="cb494-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb494-8"></a><span class="dt">void</span> fun<span class="op">(</span><span class="dt">int32_t</span> <span class="op">*</span>pv<span class="op">,</span> <span class="kw">struct</span> words <span class="op">*</span>pw<span class="op">)</span></span>
<span id="cb494-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb494-9"></a><span class="op">{</span></span>
<span id="cb494-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb494-10"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">5</span><span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb494-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb494-11"></a>        <span class="op">(*</span>pv<span class="op">)++;</span></span>
<span id="cb494-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb494-12"></a></span>
<span id="cb494-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb494-13"></a>        <span class="co">// Print the 32-bit value and the 16-bit values:</span></span>
<span id="cb494-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb494-14"></a></span>
<span id="cb494-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb494-15"></a>        printf<span class="op">(</span><span class="st">"</span><span class="sc">%x</span><span class="st">, </span><span class="sc">%x</span><span class="st">-</span><span class="sc">%x\n</span><span class="st">"</span><span class="op">,</span> <span class="op">*</span>pv<span class="op">,</span> pw<span class="op">-&gt;</span>v<span class="op">[</span><span class="dv">1</span><span class="op">],</span> pw<span class="op">-&gt;</span>v<span class="op">[</span><span class="dv">0</span><span class="op">]);</span></span>
<span id="cb494-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb494-16"></a>    <span class="op">}</span></span>
<span id="cb494-17"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb494-17"></a><span class="op">}</span></span>
<span id="cb494-18"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb494-18"></a></span>
<span id="cb494-19"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb494-19"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb494-20"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb494-20"></a><span class="op">{</span></span>
<span id="cb494-21"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb494-21"></a>    <span class="dt">int32_t</span> v <span class="op">=</span> <span class="bn">0x12345678</span><span class="op">;</span></span>
<span id="cb494-22"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb494-22"></a></span>
<span id="cb494-23"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb494-23"></a>    <span class="kw">struct</span> words <span class="op">*</span>pw <span class="op">=</span> <span class="op">(</span><span class="kw">struct</span> words <span class="op">*)&amp;</span>v<span class="op">;</span>  <span class="co">// Violates strict aliasing</span></span>
<span id="cb494-24"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb494-24"></a></span>
<span id="cb494-25"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb494-25"></a>    fun<span class="op">(&amp;</span>v<span class="op">,</span> pw<span class="op">);</span></span>
<span id="cb494-26"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb494-26"></a><span class="op">}</span></span></code></pre></div>
<p>See how I pass in the two incompatible pointers to <code>fun()</code>? One of the types is <code>int32_t*</code> and the other is <code>struct words*</code>.</p>
<p>But they both point to the same object: the 32-bit value initialized to <code>0x12345678</code>.</p>
<p>So if we look at the fields in the <code>struct words</code>, we should see the two 16-bit halves of that number. Right?</p>
<p>And in the <code>fun()</code> loop, we increment the pointer to the <code>int32_t</code>. That’s it. But since the <code>struct</code> points to that same memory, it, too, should be updated to the same value.</p>
<p>So let’s run it and get this, with the 32-bit value on the left and the two 16-bit portions on the right. It should match<a href="https://beej.us/guide/bgc/html/index-wide.html#fn147" class="footnote-ref" id="fnref147" role="doc-noteref"><sup>147</sup></a>:</p>
<div class="sourceCode" id="cb495"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb495-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb495-1" aria-hidden="true" tabindex="-1"></a>12345679, 1234-5679</span>
<span id="cb495-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb495-2" aria-hidden="true" tabindex="-1"></a>1234567a, 1234-567a</span>
<span id="cb495-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb495-3" aria-hidden="true" tabindex="-1"></a>1234567b, 1234-567b</span>
<span id="cb495-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb495-4" aria-hidden="true" tabindex="-1"></a>1234567c, 1234-567c</span>
<span id="cb495-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb495-5" aria-hidden="true" tabindex="-1"></a>1234567d, 1234-567d</span></code></pre></div>
<p>and it does… <em>UNTIL TOMORROW!</em></p>
<p>Let’s try it compiling GCC with <code>-O3</code> and <code>-fstrict-aliasing</code>:</p>
<div class="sourceCode" id="cb496"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb496-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb496-1" aria-hidden="true" tabindex="-1"></a>12345679, 1234-5678</span>
<span id="cb496-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb496-2" aria-hidden="true" tabindex="-1"></a>1234567a, 1234-5679</span>
<span id="cb496-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb496-3" aria-hidden="true" tabindex="-1"></a>1234567b, 1234-567a</span>
<span id="cb496-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb496-4" aria-hidden="true" tabindex="-1"></a>1234567c, 1234-567b</span>
<span id="cb496-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb496-5" aria-hidden="true" tabindex="-1"></a>1234567d, 1234-567c</span></code></pre></div>
<p>They’re off by one! But they point to the same memory! How could this be? Answer: it’s undefined behavior to alias memory like that. <em>Anything is possible</em>, except not in a good way.</p>
<p>If your code violates strict aliasing rules, whether it works or not depends on how someone decides to compile it. And that’s a bummer since that’s beyond your control. Unless you’re some kind of omnipotent deity.</p>
<p>Unlikely, sorry.</p>
<p>GCC can be forced to not use the strict aliasing rules with <code>-fno-strict-aliasing</code>. Compiling the demo program, above, with <code>-O3</code> and this flag causes the output to be as expected.</p>
<p>Lastly, <em>type punning</em> is using pointers of different types to look at the same data. Before strict aliasing, this kind of things was fairly common:</p>
<div class="sourceCode" id="cb497"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb497-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb497-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> a <span class="op">=</span> <span class="bn">0x12345678</span><span class="op">;</span></span>
<span id="cb497-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb497-2" aria-hidden="true" tabindex="-1"></a><span class="dt">short</span> b <span class="op">=</span> <span class="op">*((</span><span class="dt">short</span> <span class="op">*)&amp;</span>a<span class="op">);</span>   <span class="co">// Violates strict aliasing</span></span></code></pre></div>
<p>If you want to do type punning (relatively) safely, see the section on <a href="https://beej.us/guide/bgc/html/index-wide.html#union-type-punning">Unions and Type Punning</a>.</p>
<p></p>
<h2 data-number="23.6" id="ptr_differences"><span class="header-section-number">23.6</span> Pointer Differences</h2>
<p></p>
<p>As you know from the section on pointer arithmetic, you can subtract one pointer from another<a href="https://beej.us/guide/bgc/html/index-wide.html#fn148" class="footnote-ref" id="fnref148" role="doc-noteref"><sup>148</sup></a> to get the difference between them in count of array elements.</p>
<p>Now the <em>type of that difference</em> is something that’s up to the implementation, so it could vary from system to system.</p>
<p></p>
<p>To be more portable, you can store the result in a variable of type <code>ptrdiff_t</code> defined in <code>&lt;stddef.h&gt;</code>.</p>
<div class="sourceCode" id="cb498"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb498-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb498-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> cats<span class="op">[</span><span class="dv">100</span><span class="op">];</span></span>
<span id="cb498-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb498-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb498-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb498-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> <span class="op">*</span>f <span class="op">=</span> cats <span class="op">+</span> <span class="dv">20</span><span class="op">;</span></span>
<span id="cb498-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb498-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> <span class="op">*</span>g <span class="op">=</span> cats <span class="op">+</span> <span class="dv">60</span><span class="op">;</span></span>
<span id="cb498-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb498-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb498-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb498-6" aria-hidden="true" tabindex="-1"></a><span class="dt">ptrdiff_t</span> d <span class="op">=</span> g <span class="op">-</span> f<span class="op">;</span>  <span class="co">// difference is 40</span></span></code></pre></div>
<p> And you can print it by prefixing the integer format specifier with <code>t</code>:</p>
<div class="sourceCode" id="cb499"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb499-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb499-1" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">%td\n</span><span class="st">"</span><span class="op">,</span> d<span class="op">);</span>  <span class="co">// Print decimal: 40</span></span>
<span id="cb499-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb499-2" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">%tX\n</span><span class="st">"</span><span class="op">,</span> d<span class="op">);</span>  <span class="co">// Print hex:     28</span></span></code></pre></div>
<p> </p>
<h2 data-number="23.7" id="pointers-to-functions"><span class="header-section-number">23.7</span> Pointers to Functions</h2>
<p></p>
<p>Functions are just collections of machine instructions in memory, so there’s no reason we can’t get a pointer to the first instruction of the function.</p>
<p>And then call it.</p>
<p>This can be useful for passing a pointer to a function into another function as an argument. Then the second one could call whatever was passed in.</p>
<p>The tricky part with these, though, is that C needs to know the type of the variable that is the pointer to the function.</p>
<p>And it would really like to know all the details.</p>
<p>Like “this is a pointer to a function that takes two <code>int</code> arguments and returns <code>void</code>”.</p>
<p>How do you write all that down so you can declare a variable?</p>
<p>Well, it turns out it looks very much like a function prototype, except with some extra parentheses:</p>
<div class="sourceCode" id="cb500"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb500-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb500-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Declare p to be a pointer to a function.</span></span>
<span id="cb500-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb500-2" aria-hidden="true" tabindex="-1"></a><span class="co">// This function returns a float, and takes two ints as arguments.</span></span>
<span id="cb500-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb500-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb500-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb500-4" aria-hidden="true" tabindex="-1"></a><span class="dt">float</span> <span class="op">(*</span>p<span class="op">)(</span><span class="dt">int</span><span class="op">,</span> <span class="dt">int</span><span class="op">);</span></span></code></pre></div>
<p>Also notice that you don’t have to give the parameters names. But you can if you want; they’re just ignored.</p>
<div class="sourceCode" id="cb501"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb501-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb501-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Declare p to be a pointer to a function.</span></span>
<span id="cb501-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb501-2" aria-hidden="true" tabindex="-1"></a><span class="co">// This function returns a float, and takes two ints as arguments.</span></span>
<span id="cb501-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb501-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb501-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb501-4" aria-hidden="true" tabindex="-1"></a><span class="dt">float</span> <span class="op">(*</span>p<span class="op">)(</span><span class="dt">int</span> a<span class="op">,</span> <span class="dt">int</span> b<span class="op">);</span></span></code></pre></div>
<p>So now that we know how to declare a variable, how do we know what to assign into it? How do we get the address of a function?</p>
<p>Turns out there’s a shortcut just like with getting a pointer to an array: you can just refer to the bare function name without parens. (You can put an <code>&amp;</code> in front of this if you like, but it’s unnecessary and not idiomatic.)</p>
<p>Once you have a pointer to a function, you can call it just by adding parens and an argument list.</p>
<p>Let’s do a simple example where I effectively make an alias for a function by setting a pointer to it. Then we’ll call it.</p>
<p>This code prints out <code>3490</code>:</p>
<div class="sourceCode" id="cb502"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb502-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb502-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb502-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb502-2"></a></span>
<span id="cb502-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb502-3"></a><span class="dt">void</span> print_int<span class="op">(</span><span class="dt">int</span> n<span class="op">)</span></span>
<span id="cb502-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb502-4"></a><span class="op">{</span></span>
<span id="cb502-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb502-5"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> n<span class="op">);</span></span>
<span id="cb502-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb502-6"></a><span class="op">}</span></span>
<span id="cb502-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb502-7"></a></span>
<span id="cb502-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb502-8"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb502-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb502-9"></a><span class="op">{</span></span>
<span id="cb502-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb502-10"></a>    <span class="co">// Assign p to point to print_int:</span></span>
<span id="cb502-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb502-11"></a></span>
<span id="cb502-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb502-12"></a>    <span class="dt">void</span> <span class="op">(*</span>p<span class="op">)(</span><span class="dt">int</span><span class="op">)</span> <span class="op">=</span> print_int<span class="op">;</span></span>
<span id="cb502-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb502-13"></a></span>
<span id="cb502-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb502-14"></a>    p<span class="op">(</span><span class="dv">3490</span><span class="op">);</span>          <span class="co">// Call print_int via the pointer</span></span>
<span id="cb502-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb502-15"></a><span class="op">}</span></span></code></pre></div>
<p>Notice how the type of <code>p</code> represents the return value and parameter types of <code>print_int</code>. It has to, or else C will complain about incompatible pointer types.</p>
<p>One more example here shows how we might pass a pointer to a function as an argument to another function.</p>
<p>We’ll write a function that takes a couple integer arguments, plus a pointer to a function that operates on those two arguments. Then it prints the result.</p>
<div class="sourceCode" id="cb503"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb503-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb503-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb503-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb503-2"></a></span>
<span id="cb503-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb503-3"></a><span class="dt">int</span> add<span class="op">(</span><span class="dt">int</span> a<span class="op">,</span> <span class="dt">int</span> b<span class="op">)</span></span>
<span id="cb503-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb503-4"></a><span class="op">{</span></span>
<span id="cb503-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb503-5"></a>    <span class="cf">return</span> a <span class="op">+</span> b<span class="op">;</span></span>
<span id="cb503-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb503-6"></a><span class="op">}</span></span>
<span id="cb503-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb503-7"></a></span>
<span id="cb503-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb503-8"></a><span class="dt">int</span> mult<span class="op">(</span><span class="dt">int</span> a<span class="op">,</span> <span class="dt">int</span> b<span class="op">)</span></span>
<span id="cb503-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb503-9"></a><span class="op">{</span></span>
<span id="cb503-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb503-10"></a>    <span class="cf">return</span> a <span class="op">*</span> b<span class="op">;</span></span>
<span id="cb503-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb503-11"></a><span class="op">}</span></span>
<span id="cb503-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb503-12"></a></span>
<span id="cb503-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb503-13"></a><span class="dt">void</span> print_math<span class="op">(</span><span class="dt">int</span> <span class="op">(*</span>op<span class="op">)(</span><span class="dt">int</span><span class="op">,</span> <span class="dt">int</span><span class="op">),</span> <span class="dt">int</span> x<span class="op">,</span> <span class="dt">int</span> y<span class="op">)</span></span>
<span id="cb503-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb503-14"></a><span class="op">{</span></span>
<span id="cb503-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb503-15"></a>    <span class="dt">int</span> result <span class="op">=</span> op<span class="op">(</span>x<span class="op">,</span> y<span class="op">);</span></span>
<span id="cb503-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb503-16"></a></span>
<span id="cb503-17"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb503-17"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> result<span class="op">);</span></span>
<span id="cb503-18"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb503-18"></a><span class="op">}</span></span>
<span id="cb503-19"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb503-19"></a></span>
<span id="cb503-20"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb503-20"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb503-21"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb503-21"></a><span class="op">{</span></span>
<span id="cb503-22"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb503-22"></a>    print_math<span class="op">(</span>add<span class="op">,</span> <span class="dv">5</span><span class="op">,</span> <span class="dv">7</span><span class="op">);</span>   <span class="co">// 12</span></span>
<span id="cb503-23"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb503-23"></a>    print_math<span class="op">(</span>mult<span class="op">,</span> <span class="dv">5</span><span class="op">,</span> <span class="dv">7</span><span class="op">);</span>  <span class="co">// 35</span></span>
<span id="cb503-24"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb503-24"></a><span class="op">}</span></span></code></pre></div>
<p>Take a moment to digest that. The idea here is that we’re going to pass a pointer to a function to <code>print_math()</code>, and it’s going to call that function to do some math.</p>
<p>This way we can change the behavior of <code>print_math()</code> by passing another function into it. You can see we do that on lines 22-23 when we pass in pointers to functions <code>add</code> and <code>mult</code>, respectively.</p>
<p>Now, on line 13, I think we can all agree the function signature of <code>print_math()</code> is a sight to behold. And, if you can believe it, this one is actually pretty straight-forward compared to some things you can construct<a href="https://beej.us/guide/bgc/html/index-wide.html#fn149" class="footnote-ref" id="fnref149" role="doc-noteref"><sup>149</sup></a>.</p>
<p>But let’s digest it. Turns out there are only three parameters, but they’re a little hard to see:</p>
<div class="sourceCode" id="cb504"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb504-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb504-1" aria-hidden="true" tabindex="-1"></a><span class="co">//                      op             x      y</span></span>
<span id="cb504-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb504-2" aria-hidden="true" tabindex="-1"></a><span class="co">//              |-----------------|  |---|  |---|</span></span>
<span id="cb504-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb504-3" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> print_math<span class="op">(</span><span class="dt">int</span> <span class="op">(*</span>op<span class="op">)(</span><span class="dt">int</span><span class="op">,</span> <span class="dt">int</span><span class="op">),</span> <span class="dt">int</span> x<span class="op">,</span> <span class="dt">int</span> y<span class="op">)</span></span></code></pre></div>
<p>The first, <code>op</code>, is a pointer to a function that takes two <code>int</code>s as arguments and returns an <code>int</code>. This matches the signatures for both <code>add()</code> and <code>mult()</code>.</p>
<p>The second and third, <code>x</code> and <code>y</code>, are just standard <code>int</code> parameters.</p>
<p>Slowly and deliberately let your eyes play over the signature while you identify the working parts. One thing that always stands out for me is the sequence <code>(*op)(</code>, the parens and the asterisk. That’s the giveaway it’s a pointer to a function.</p>
<p>Finally, jump back to the <em>Pointers II</em> chapter for a pointer-to-function <a href="https://beej.us/guide/bgc/html/index-wide.html#qsort-example">example using the built-in <code>qsort()</code></a>.</p>
<p></p>
<!-- Beej's guide to C

# vim: ts=4:sw=4:nosi:et:tw=72
-->
<h1 data-number="24" id="bitwise-operations"><span class="header-section-number">24</span> Bitwise Operations</h1>
<p></p>
<p>These numeric operations effectively allow you to manipulate individual bits in variables, fitting since C is such a low-level langauge<a href="https://beej.us/guide/bgc/html/index-wide.html#fn150" class="footnote-ref" id="fnref150" role="doc-noteref"><sup>150</sup></a>.</p>
<p>If you’re not familiar with bitwise operations, <a href="https://en.wikipedia.org/wiki/Bitwise_operation">Wikipedia has a good bitwise article</a><a href="https://beej.us/guide/bgc/html/index-wide.html#fn151" class="footnote-ref" id="fnref151" role="doc-noteref"><sup>151</sup></a>.</p>
<h2 data-number="24.1" id="bitwise-and-or-xor-and-not"><span class="header-section-number">24.1</span> Bitwise AND, OR, XOR, and NOT</h2>
<p>For each of these, the <a href="https://beej.us/guide/bgc/html/index-wide.html#usual-arithmetic-conversions">usual arithmetic conversions</a> take place on the operands (which in this case must be an integer type), and then the appropriate bitwise operation is performed.</p>
<table>
<colgroup>
<col style="width: 20%">
<col style="width: 60%">
<col style="width: 20%">
</colgroup>
<thead>
<tr class="header">
<th>Operation</th>
<th style="text-align: center;">Operator</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>AND</td>
<td style="text-align: center;"><code>&amp;</code></td>
<td><code>a = b &amp; c</code></td>
</tr>
<tr class="even">
<td>OR</td>
<td style="text-align: center;"><code>|</code></td>
<td><code>a = b | c</code></td>
</tr>
<tr class="odd">
<td>XOR</td>
<td style="text-align: center;"><code>^</code></td>
<td><code>a = b ^ c</code></td>
</tr>
<tr class="even">
<td>NOT</td>
<td style="text-align: center;"><code>~</code></td>
<td><code>a = ~c</code></td>
</tr>
</tbody>
</table>
<p>Note how they’re similar to the Boolean operators <code>&amp;&amp;</code> and <code>||</code>.</p>
<p>These have assignment shorthand variants similar to <code>+=</code> and <code>-=</code>:</p>
<table>
<colgroup>
<col style="width: 33%">
<col style="width: 33%">
<col style="width: 33%">
</colgroup>
<thead>
<tr class="header">
<th>Operator</th>
<th>Example</th>
<th>Longhand equivalent</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>&amp;=</code></td>
<td><code>a &amp;= c</code></td>
<td><code>a = a &amp; c</code></td>
</tr>
<tr class="even">
<td><code>|=</code></td>
<td><code>a |= c</code></td>
<td><code>a = a | c</code></td>
</tr>
<tr class="odd">
<td><code>^=</code></td>
<td><code>a ^= c</code></td>
<td><code>a = a ^ c</code></td>
</tr>
</tbody>
</table>
<h2 data-number="24.2" id="bitwise-shift"><span class="header-section-number">24.2</span> Bitwise Shift</h2>
<p>For these, the <a href="https://beej.us/guide/bgc/html/index-wide.html#integer-promotions">integer promotions</a> are performed on each operand (which must be an integer type) and then a bitwise shift is executed. The type of the result is the type of the promoted left operand.</p>
<p>New bits are filled with zeros, with a possible exception noted in the implementation-defined behavior, below.</p>
<table>
<colgroup>
<col style="width: 20%">
<col style="width: 60%">
<col style="width: 20%">
</colgroup>
<thead>
<tr class="header">
<th>Operation</th>
<th style="text-align: center;">Operator</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Shift left</td>
<td style="text-align: center;"><code>&lt;&lt;</code></td>
<td><code>a = b &lt;&lt; c</code></td>
</tr>
<tr class="even">
<td>Shift right</td>
<td style="text-align: center;"><code>&gt;&gt;</code></td>
<td><code>a = b &gt;&gt; c</code></td>
</tr>
</tbody>
</table>
<p>There’s also the same similar shorthand for shifting:</p>
<table>
<colgroup>
<col style="width: 33%">
<col style="width: 33%">
<col style="width: 33%">
</colgroup>
<thead>
<tr class="header">
<th>Operator</th>
<th>Example</th>
<th>Longhand equivalent</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>&gt;&gt;=</code></td>
<td><code>a &gt;&gt;= c</code></td>
<td><code>a = a &gt;&gt; c</code></td>
</tr>
<tr class="even">
<td><code>&lt;&lt;=</code></td>
<td><code>a &lt;&lt;= c</code></td>
<td><code>a = a &lt;&lt; c</code></td>
</tr>
</tbody>
</table>
<p>Watch for undefined behavior: no negative shifts, and no shifts that are larger than the size of the promoted left operand.</p>
<p>Also watch for implementation-defined behavior: if you right-shift a negative number, the results are implementation-defined. (It’s perfectly fine to right-shift a signed <code>int</code>, just make sure it’s positive.)</p>
<p></p>
<!-- Beej's guide to C

# vim: ts=4:sw=4:nosi:et:tw=72
-->
<h1 data-number="25" id="variadic-functions"><span class="header-section-number">25</span> Variadic Functions</h1>
<p></p>
<p><em>Variadic</em> is a fancy word for functions that take arbitrary numbers of arguments.</p>
<p>A regular function takes a specific number of arguments, for example:</p>
<div class="sourceCode" id="cb505"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb505-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb505-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> add<span class="op">(</span><span class="dt">int</span> x<span class="op">,</span> <span class="dt">int</span> y<span class="op">)</span></span>
<span id="cb505-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb505-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb505-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb505-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x <span class="op">+</span> y<span class="op">;</span></span>
<span id="cb505-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb505-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>You can only call that with exactly two arguments which correspond to parameters <code>x</code> and <code>y</code>.</p>
<div class="sourceCode" id="cb506"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb506-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb506-1" aria-hidden="true" tabindex="-1"></a>add<span class="op">(</span><span class="dv">2</span><span class="op">,</span> <span class="dv">3</span><span class="op">);</span></span>
<span id="cb506-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb506-2" aria-hidden="true" tabindex="-1"></a>add<span class="op">(</span><span class="dv">5</span><span class="op">,</span> <span class="dv">12</span><span class="op">);</span></span></code></pre></div>
<p>But if you try it with more, the compiler won’t let you:</p>
<div class="sourceCode" id="cb507"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb507-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb507-1" aria-hidden="true" tabindex="-1"></a>add<span class="op">(</span><span class="dv">2</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> <span class="dv">4</span><span class="op">);</span>  <span class="co">// ERROR</span></span>
<span id="cb507-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb507-2" aria-hidden="true" tabindex="-1"></a>add<span class="op">(</span><span class="dv">5</span><span class="op">);</span>        <span class="co">// ERROR</span></span></code></pre></div>
<p>Variadic functions get around this limitation to a certain extent.</p>
<p>We’ve already seen a famous example in <code>printf()</code>! You can pass all kinds of things to it.</p>
<div class="sourceCode" id="cb508"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb508-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb508-1" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"Hello, world!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb508-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb508-2" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"The number is </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> <span class="dv">2</span><span class="op">);</span></span>
<span id="cb508-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb508-3" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"The number is </span><span class="sc">%d</span><span class="st"> and pi is </span><span class="sc">%f\n</span><span class="st">"</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="fl">3.14159</span><span class="op">);</span></span></code></pre></div>
<p>It seems to not care how many arguments you give it!</p>
<p>Well, that’s not entirely true. Zero arguments will give you an error:</p>
<div class="sourceCode" id="cb509"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb509-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb509-1" aria-hidden="true" tabindex="-1"></a>printf<span class="op">();</span>  <span class="co">// ERROR</span></span></code></pre></div>
<p>This leads us to one of the limitations of variadic functions in C: they must have at least one argument.</p>
<p>But aside from that, they’re pretty flexible, even allows arguments to have different types just like <code>printf()</code> does.</p>
<p>Let’s see how they work!</p>
<h2 data-number="25.1" id="ellipses-in-function-signatures"><span class="header-section-number">25.1</span> Ellipses in Function Signatures</h2>
<p>So how does it work, syntactically?</p>
<p></p>
<p>What you do is put all the arguments that <em>must</em> be passed first (and remember there has to be at least one) and after that, you put <code>...</code>. Just like this:</p>
<div class="sourceCode" id="cb510"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb510-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb510-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> func<span class="op">(</span><span class="dt">int</span> a<span class="op">,</span> <span class="op">...)</span>   <span class="co">// Literally 3 dots here</span></span></code></pre></div>
<p>Here’s some code to demo that:</p>
<div class="sourceCode" id="cb511"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb511-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb511-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb511-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb511-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb511-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb511-3" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> func<span class="op">(</span><span class="dt">int</span> a<span class="op">,</span> <span class="op">...)</span></span>
<span id="cb511-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb511-4" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb511-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb511-5" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"a is </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> a<span class="op">);</span>  <span class="co">// Prints "a is 2"</span></span>
<span id="cb511-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb511-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb511-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb511-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb511-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb511-8" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb511-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb511-9" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb511-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb511-10" aria-hidden="true" tabindex="-1"></a>    func<span class="op">(</span><span class="dv">2</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> <span class="dv">4</span><span class="op">,</span> <span class="dv">5</span><span class="op">,</span> <span class="dv">6</span><span class="op">);</span></span>
<span id="cb511-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb511-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p></p>
<p>So, great, we can get that first argument that’s in variable <code>a</code>, but what about the rest of the arguments? How do you get to them?</p>
<p>Here’s where the fun begins!</p>
<h2 data-number="25.2" id="getting-the-extra-arguments"><span class="header-section-number">25.2</span> Getting the Extra Arguments</h2>
<p>You’re going to want to include <code>&lt;stdarg.h&gt;</code> to make any of this work.</p>
<p></p>
<p>First things first, we’re going to use a special variable of type <code>va_list</code> (variable argument list) to keep track of which variable we’re accessing at a time.</p>
<p> </p>
<p>The idea is that we first start processing arguments with a call to <code>va_start()</code>, process each argument in turn with <code>va_arg()</code>, and then, when done, wrap it up with <code>va_end()</code>.</p>
<p>When you call <code>va_start()</code>, you need to pass in the <em>last named parameter</em> (the one just before the <code>...</code>) so it knows where to start looking for the additional arguments.</p>
<p>And when you call <code>va_arg()</code> to get the next argument, you have to tell it the type of argument to get next.</p>
<p>Here’s a demo that adds together an arbitrary number of integers. The first argument is the number of integers to add together. We’ll make use of that to figure out how many times we have to call <code>va_arg()</code>.</p>
<div class="sourceCode" id="cb512"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb512-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb512-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb512-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb512-2"></a><span class="pp">#include </span><span class="im">&lt;stdarg.h&gt;</span></span>
<span id="cb512-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb512-3"></a></span>
<span id="cb512-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb512-4"></a><span class="dt">int</span> add<span class="op">(</span><span class="dt">int</span> count<span class="op">,</span> <span class="op">...)</span></span>
<span id="cb512-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb512-5"></a><span class="op">{</span></span>
<span id="cb512-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb512-6"></a>    <span class="dt">int</span> total <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb512-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb512-7"></a>    <span class="dt">va_list</span> va<span class="op">;</span></span>
<span id="cb512-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb512-8"></a></span>
<span id="cb512-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb512-9"></a>    va_start<span class="op">(</span>va<span class="op">,</span> count<span class="op">);</span>   <span class="co">// Start with arguments after "count"</span></span>
<span id="cb512-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb512-10"></a></span>
<span id="cb512-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb512-11"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> count<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb512-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb512-12"></a>        <span class="dt">int</span> n <span class="op">=</span> va_arg<span class="op">(</span>va<span class="op">,</span> <span class="dt">int</span><span class="op">);</span>   <span class="co">// Get the next int</span></span>
<span id="cb512-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb512-13"></a></span>
<span id="cb512-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb512-14"></a>        total <span class="op">+=</span> n<span class="op">;</span></span>
<span id="cb512-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb512-15"></a>    <span class="op">}</span></span>
<span id="cb512-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb512-16"></a></span>
<span id="cb512-17"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb512-17"></a>    va_end<span class="op">(</span>va<span class="op">);</span>  <span class="co">// All done</span></span>
<span id="cb512-18"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb512-18"></a></span>
<span id="cb512-19"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb512-19"></a>    <span class="cf">return</span> total<span class="op">;</span></span>
<span id="cb512-20"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb512-20"></a><span class="op">}</span></span>
<span id="cb512-21"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb512-21"></a></span>
<span id="cb512-22"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb512-22"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb512-23"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb512-23"></a><span class="op">{</span></span>
<span id="cb512-24"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb512-24"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> add<span class="op">(</span><span class="dv">4</span><span class="op">,</span> <span class="dv">6</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="op">-</span><span class="dv">4</span><span class="op">,</span> <span class="dv">17</span><span class="op">));</span>  <span class="co">// 6 + 2 - 4 + 17 = 21</span></span>
<span id="cb512-25"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb512-25"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> add<span class="op">(</span><span class="dv">2</span><span class="op">,</span> <span class="dv">22</span><span class="op">,</span> <span class="dv">44</span><span class="op">));</span>        <span class="co">// 22 + 44 = 66</span></span>
<span id="cb512-26"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb512-26"></a><span class="op">}</span></span></code></pre></div>
<p> </p>
<p>(Note that when <code>printf()</code> is called, it uses the number of <code>%d</code>s (or whatever) in the format string to know how many more arguments there are!)</p>
<p>If the syntax of <code>va_arg()</code> is looking strange to you (because of that loose type name floating around in there), you’re not alone. These are implemented with preprocessor macros in order to get all the proper magic in there.</p>
<h2 data-number="25.3" id="va_list-functionality"><span class="header-section-number">25.3</span> <code>va_list</code> Functionality</h2>
<p>What is that <code>va_list</code> variable we’re using up there? It’s an opaque variable<a href="https://beej.us/guide/bgc/html/index-wide.html#fn152" class="footnote-ref" id="fnref152" role="doc-noteref"><sup>152</sup></a> that holds information about which argument we’re going to get next with <code>va_arg()</code>. You see how we just call <code>va_arg()</code> over and over? The <code>va_list</code> variable is a placeholder that’s keeping track of progress so far.</p>
<p></p>
<p>But we have to initialize that variable to some sensible value. That’s where <code>va_start()</code> comes into play.</p>
<p>When we called <code>va_start(va, count)</code>, above, we were saying, “Initialize the <code>va</code> variable to point to the variable argument <em>immediately after</em> <code>count</code>.”</p>
<p></p>
<p>And that’s <em>why</em> we need to have at least one named variable in our argument list<a href="https://beej.us/guide/bgc/html/index-wide.html#fn153" class="footnote-ref" id="fnref153" role="doc-noteref"><sup>153</sup></a>.</p>
<p>Once you have that pointer to the initial parameter, you can easily get subsequent argument values by calling <code>va_arg()</code> repeatedly. When you do, you have to pass in your <code>va_list</code> variable (so it can keep on keeping track of where you are), as well as the type of argument you’re about to copy off.</p>
<p>It’s up to you as a programmer to figure out which type you’re going to pass to <code>va_arg()</code>. In the above example, we just did <code>int</code>s. But in the case of <code>printf()</code>, it uses the format specifier to determine which type to pull off next.</p>
<p>And when you’re done, call <code>va_end()</code> to wrap it up. You <strong>must</strong> (the spec says) call this on a particular <code>va_list</code> variable before you decide to call either <code>va_start()</code> or <code>va_copy()</code> on it again. I know we haven’t talked about <code>va_copy()</code> yet.</p>
<p>So the standard progression is:</p>
<ul>
<li><code>va_start()</code> to initialize your <code>va_list</code> variable</li>
<li>Repeatedly <code>va_arg()</code> to get the values</li>
<li><code>va_end()</code> to deinitialize your <code>va_list</code> variable</li>
</ul>
<p> </p>
<p></p>
<p>I also mentioned <code>va_copy()</code> up there; it makes a copy of your <code>va_list</code> variable in the exact same state. That is, if you haven’t started with <code>va_arg()</code> with the source variable, the new one won’t be started, either. If you’ve consumed 5 variables with <code>va_arg()</code> so far, the copy will also reflect that.</p>
<p><code>va_copy()</code> can be useful if you need to scan ahead through the arguments but need to also remember your current place.</p>
<p></p>
<h2 data-number="25.4" id="library-functions-that-use-va_lists"><span class="header-section-number">25.4</span> Library Functions That Use <code>va_list</code>s</h2>
<p></p>
<p>One of the other uses for these is pretty cool: writing your own custom <code>printf()</code> variant. It would be a pain to have to handle all those format specifiers right? All zillion of them?</p>
<p>Luckily, there are <code>printf()</code> variants that accept a working <code>va_list</code> as an argument. You can use these to wrap up and make your own custom <code>printf()</code>s!</p>
<p></p>
<p>These functions start with the letter <code>v</code>, such as <code>vprintf()</code>, <code>vfprintf()</code>, <code>vsprintf()</code>, and <code>vsnprintf()</code>. Basically all your <code>printf()</code> golden oldies except with a <code>v</code> in front.</p>
<p>Let’s make a function <code>my_printf()</code> that works just like <code>printf()</code> except it takes an extra argument up front.</p>
<div class="sourceCode" id="cb513"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb513-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb513-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb513-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb513-2"></a><span class="pp">#include </span><span class="im">&lt;stdarg.h&gt;</span></span>
<span id="cb513-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb513-3"></a></span>
<span id="cb513-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb513-4"></a><span class="dt">int</span> my_printf<span class="op">(</span><span class="dt">int</span> serial<span class="op">,</span> <span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>format<span class="op">,</span> <span class="op">...)</span></span>
<span id="cb513-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb513-5"></a><span class="op">{</span></span>
<span id="cb513-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb513-6"></a>    <span class="dt">va_list</span> va<span class="op">;</span></span>
<span id="cb513-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb513-7"></a></span>
<span id="cb513-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb513-8"></a>    <span class="co">// Do my custom work</span></span>
<span id="cb513-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb513-9"></a>    printf<span class="op">(</span><span class="st">"The serial number is: </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> serial<span class="op">);</span></span>
<span id="cb513-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb513-10"></a></span>
<span id="cb513-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb513-11"></a>    <span class="co">// Then pass the rest off to vprintf()</span></span>
<span id="cb513-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb513-12"></a>    va_start<span class="op">(</span>va<span class="op">,</span> format<span class="op">);</span></span>
<span id="cb513-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb513-13"></a>    <span class="dt">int</span> rv <span class="op">=</span> vprintf<span class="op">(</span>format<span class="op">,</span> va<span class="op">);</span></span>
<span id="cb513-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb513-14"></a>    va_end<span class="op">(</span>va<span class="op">);</span></span>
<span id="cb513-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb513-15"></a></span>
<span id="cb513-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb513-16"></a>    <span class="cf">return</span> rv<span class="op">;</span></span>
<span id="cb513-17"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb513-17"></a><span class="op">}</span></span>
<span id="cb513-18"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb513-18"></a></span>
<span id="cb513-19"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb513-19"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb513-20"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb513-20"></a><span class="op">{</span></span>
<span id="cb513-21"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb513-21"></a>    <span class="dt">int</span> x <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb513-22"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb513-22"></a>    <span class="dt">float</span> y <span class="op">=</span> <span class="fl">3.2</span><span class="op">;</span></span>
<span id="cb513-23"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb513-23"></a></span>
<span id="cb513-24"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb513-24"></a>    my_printf<span class="op">(</span><span class="dv">3490</span><span class="op">,</span> <span class="st">"x is </span><span class="sc">%d</span><span class="st">, y is </span><span class="sc">%f\n</span><span class="st">"</span><span class="op">,</span> x<span class="op">,</span> y<span class="op">);</span></span>
<span id="cb513-25"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb513-25"></a><span class="op">}</span></span></code></pre></div>
<p>See what we did there? On lines 12-14 we started a new <code>va_list</code> variable, and then just passed it right into <code>vprintf()</code>. And it knows just want to do with it, because it has all the <code>printf()</code> smarts built-in.</p>
<p></p>
<p>We still have to call <code>va_end()</code> when we’re done, though, so don’t forget that!</p>
<p> </p>
<!-- Beej's guide to C

# vim: ts=4:sw=4:nosi:et:tw=72
-->
<h1 data-number="26" id="locale-and-internationalization"><span class="header-section-number">26</span> Locale and Internationalization</h1>
<p></p>
<p><em>Localization</em> is the process of making your app ready to work well in different locales (or countries).</p>
<p>As you might know, not everyone uses the same character for decimal points or for thousands separators… or for currency.</p>
<p>These locales have names, and you can select one to use. For example, a US locale might write a number like:</p>
<p>100,000.00</p>
<p>Whereas in Brazil, the same might be written with the commas and decimal points swapped:</p>
<p>100.000,00</p>
<p>Makes it easier to write your code so it ports to other nationalities with ease!</p>
<p>Well, sort of. Turns out C only has one built-in locale, and it’s limited. The spec really leaves a lot of ambiguity here; it’s hard to be completely portable.</p>
<p>But we’ll do our best!</p>
<h2 data-number="26.1" id="setting-the-localization-quick-and-dirty"><span class="header-section-number">26.1</span> Setting the Localization, Quick and Dirty</h2>
<p>For these calls, include <code>&lt;locale.h&gt;</code>.</p>
<p>There is basically one thing you can portably do here in terms of declaring a specific locale. This is likely what you want to do if you’re going to do locale anything:</p>
<p></p>
<div class="sourceCode" id="cb514"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb514-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb514-1" aria-hidden="true" tabindex="-1"></a>setlocale<span class="op">(</span>LC_ALL<span class="op">,</span> <span class="st">""</span><span class="op">);</span>  <span class="co">// Use this environment's locale for everything</span></span></code></pre></div>
<p>You’ll want to call that so that the program gets initialized with your current locale.</p>
<p>Getting into more details, there is one more thing you can do and stay portable:</p>
<div class="sourceCode" id="cb515"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb515-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb515-1" aria-hidden="true" tabindex="-1"></a>setlocale<span class="op">(</span>LC_ALL<span class="op">,</span> <span class="st">"C"</span><span class="op">);</span>  <span class="co">// Use the default C locale</span></span></code></pre></div>
<p>but that’s called by default every time your program starts, so there’s not much need to do it yourself.</p>
<p>In that second string, you can specify any locale supported by your system. This is completely system-dependent, so it will vary. On my system, I can specify this:</p>
<div class="sourceCode" id="cb516"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb516-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb516-1" aria-hidden="true" tabindex="-1"></a>setlocale<span class="op">(</span>LC_ALL<span class="op">,</span> <span class="st">"en_US.UTF-8"</span><span class="op">);</span>  <span class="co">// Non-portable!</span></span></code></pre></div>
<p>And that’ll work. But it’s only portable to systems which have that exact same name for that exact same locale, and you can’t guarantee it.</p>
<p>By passing in an empty string (<code>""</code>) for the second argument, you’re telling C, “Hey, figure out what the current locale on this system is so I don’t have to tell you.”</p>
<p></p>
<h2 data-number="26.2" id="getting-the-monetary-locale-settings"><span class="header-section-number">26.2</span> Getting the Monetary Locale Settings</h2>
<p></p>
<p>Because moving green pieces of paper around promises to be the key to happiness<a href="https://beej.us/guide/bgc/html/index-wide.html#fn154" class="footnote-ref" id="fnref154" role="doc-noteref"><sup>154</sup></a>, let’s talk about monetary locale. When you’re writing portable code, you have to know what to type for cash, right? Whether that’s “$”, “€”, “¥”, or “£”.</p>
<p></p>
<p>How can you write that code without going insane? Luckily, once you call <code>setlocale(LC_ALL, "")</code>, you can just look these up with a call to <code>localeconv()</code>:</p>
<div class="sourceCode" id="cb517"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb517-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb517-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> lconv <span class="op">*</span>x <span class="op">=</span> localeconv<span class="op">();</span></span></code></pre></div>
<p>This function returns a pointer to a statically-allocated <code>struct lconv</code> that has all that juicy information you’re looking for.</p>
<p>Here are the fields of <code>struct lconv</code> and their meanings.</p>
<p>First, some conventions. An <code>_p_</code> means “positive”, and <code>_n_</code> means “negative”, and <code>int_</code> means “international”. Though a lot of these are type <code>char</code> or <code>char*</code>, most (or the strings they point to) are actually treated as integers<a href="https://beej.us/guide/bgc/html/index-wide.html#fn155" class="footnote-ref" id="fnref155" role="doc-noteref"><sup>155</sup></a>.</p>
<p>Before we go further, know that <code>CHAR_MAX</code> (from <code>&lt;limits.h&gt;</code>) is the maximum value that can be held in a <code>char</code>. And that many of the following <code>char</code> values use that to indicate the value isn’t available in the given locale.</p>
<table>
<colgroup>
<col style="width: 31%">
<col style="width: 68%">
</colgroup>
<thead>
<tr class="header">
<th>Field</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>char *mon_decimal_point</code></td>
<td>Decimal pointer character for money, e.g.&nbsp;<code>"."</code>.</td>
</tr>
<tr class="even">
<td><code>char *mon_thousands_sep</code></td>
<td>Thousands separator character for money, e.g.&nbsp;<code>","</code>.</td>
</tr>
<tr class="odd">
<td><code>char *mon_grouping</code></td>
<td>Grouping description for money (see below).</td>
</tr>
<tr class="even">
<td><code>char *positive_sign</code></td>
<td>Positive sign for money, e.g.&nbsp;<code>"+"</code> or <code>""</code>.</td>
</tr>
<tr class="odd">
<td><code>char *negative_sign</code></td>
<td>Negative sign for money, e.g.&nbsp;<code>"-"</code>.</td>
</tr>
<tr class="even">
<td><code>char *currency_symbol</code></td>
<td>Currency symbol, e.g.&nbsp;<code>"$"</code>.</td>
</tr>
<tr class="odd">
<td><code>char frac_digits</code></td>
<td>When printing monetary amounts, how many digits to print past the decimal point, e.g.&nbsp;<code>2</code>.</td>
</tr>
<tr class="even">
<td><code>char p_cs_precedes</code></td>
<td><code>1</code> if the <code>currency_symbol</code> comes before the value for a non-negative monetary amount, <code>0</code> if after.</td>
</tr>
<tr class="odd">
<td><code>char n_cs_precedes</code></td>
<td><code>1</code> if the <code>currency_symbol</code> comes before the value for a negative monetary amount, <code>0</code> if after.</td>
</tr>
<tr class="even">
<td><code>char p_sep_by_space</code></td>
<td>Determines the separation of the <code>currency symbol</code> from the value for non-negative amounts (see below).</td>
</tr>
<tr class="odd">
<td><code>char n_sep_by_space</code></td>
<td>Determines the separation of the <code>currency symbol</code> from the value for negative amounts (see below).</td>
</tr>
<tr class="even">
<td><code>char p_sign_posn</code></td>
<td>Determines the <code>positive_sign</code> position for non-negative values.</td>
</tr>
<tr class="odd">
<td><code>char p_sign_posn</code></td>
<td>Determines the <code>positive_sign</code> position for negative values.</td>
</tr>
<tr class="even">
<td><code>char *int_curr_symbol</code></td>
<td>International currency symbol, e.g.&nbsp;<code>"USD "</code>.</td>
</tr>
<tr class="odd">
<td><code>char int_frac_digits</code></td>
<td>International value for <code>frac_digits</code>.</td>
</tr>
<tr class="even">
<td><code>char int_p_cs_precedes</code></td>
<td>International value for <code>p_cs_precedes</code>.</td>
</tr>
<tr class="odd">
<td><code>char int_n_cs_precedes</code></td>
<td>International value for <code>n_cs_precedes</code>.</td>
</tr>
<tr class="even">
<td><code>char int_p_sep_by_space</code></td>
<td>International value for <code>p_sep_by_space</code>.</td>
</tr>
<tr class="odd">
<td><code>char int_n_sep_by_space</code></td>
<td>International value for <code>n_sep_by_space</code>.</td>
</tr>
<tr class="even">
<td><code>char int_p_sign_posn</code></td>
<td>International value for <code>p_sign_posn</code>.</td>
</tr>
<tr class="odd">
<td><code>char int_n_sign_posn</code></td>
<td>International value for <code>n_sign_posn</code>.</td>
</tr>
</tbody>
</table>
<p></p>
<h3 data-number="26.2.1" id="monetary-digit-grouping"><span class="header-section-number">26.2.1</span> Monetary Digit Grouping</h3>
<p></p>
<p>OK, this is a trippy one. <code>mon_grouping</code> is a <code>char*</code>, so you might be thinking it’s a string. But in this case, no, it’s really an array of <code>char</code>s. It should always end either with a <code>0</code> or <code>CHAR_MAX</code>.</p>
<p>These values describe how to group sets of numbers in currency to the <em>left</em> of the decimal (the whole number part).</p>
<p>For example, we might have:</p>
<div class="sourceCode" id="cb518"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb518-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb518-1" aria-hidden="true" tabindex="-1"></a>  2   1   0</span>
<span id="cb518-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb518-2" aria-hidden="true" tabindex="-1"></a> --- --- ---</span>
<span id="cb518-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb518-3" aria-hidden="true" tabindex="-1"></a>$100,000,000.00</span></code></pre></div>
<p>These are groups of three. Group 0 (just left of the decimal) has 3 digits. Group 1 (next group to the left) has 3 digits, and the last one also has 3.</p>
<p>So we could describe these groups, from the right (the decimal) to the left with a bunch of integer values representing the group sizes:</p>
<div class="sourceCode" id="cb519"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb519-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb519-1" aria-hidden="true" tabindex="-1"></a>3 3 3</span></code></pre></div>
<p>And that would work for values up to $100,000,000.</p>
<p>But what if we had more? We could keep adding <code>3</code>s…</p>
<div class="sourceCode" id="cb520"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb520-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb520-1" aria-hidden="true" tabindex="-1"></a>3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3</span></code></pre></div>
<p>but that’s crazy. Luckily, we can specify <code>0</code> to indicate that the previous group size repeats:</p>
<div class="sourceCode" id="cb521"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb521-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb521-1" aria-hidden="true" tabindex="-1"></a>3 0</span></code></pre></div>
<p>Which means to repeat every 3. That would handle $100, $1,000, $10,000, $10,000,000, $100,000,000,000, and so on.</p>
<p>You can go legitimately crazy with these to indicate some weird groupings.</p>
<p>For example:</p>
<div class="sourceCode" id="cb522"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb522-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb522-1" aria-hidden="true" tabindex="-1"></a>4 3 2 1 0</span></code></pre></div>
<p>would indicate:</p>
<div class="sourceCode" id="cb523"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb523-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb523-1" aria-hidden="true" tabindex="-1"></a>$1,0,0,0,0,00,000,0000.00</span></code></pre></div>
<p>One more value that can occur is <code>CHAR_MAX</code>. This indicates that no more grouping should occur, and can appear anywhere in the array, including the first value.</p>
<div class="sourceCode" id="cb524"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb524-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb524-1" aria-hidden="true" tabindex="-1"></a>3 2 CHAR_MAX</span></code></pre></div>
<p>would indicate:</p>
<div class="sourceCode" id="cb525"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb525-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb525-1" aria-hidden="true" tabindex="-1"></a>100000000,00,000.00</span></code></pre></div>
<p>for example.</p>
<p>And simply having <code>CHAR_MAX</code> in the first array position would tell you there was to be no grouping at all.</p>
<p></p>
<h3 data-number="26.2.2" id="separators-and-sign-position"><span class="header-section-number">26.2.2</span> Separators and Sign Position</h3>
<p></p>
<p>All the <code>sep_by_space</code> variants deal with spacing around the currency sign. Valid values are:</p>
<table>
<colgroup>
<col style="width: 25%">
<col style="width: 75%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><code>0</code></td>
<td>No space between currency symbol and value.</td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>1</code></td>
<td>Separate the currency symbol (and sign, if any) from the value with a space.</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code>2</code></td>
<td>Separate the sign symbol from the currency symbol (if adjacent) with a space, otherwise separate the sign symbol from the value with a space.</td>
</tr>
</tbody>
</table>
<p>The <code>sign_posn</code> variants are determined by the following values:</p>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><code>0</code></td>
<td>Put parens around the value and the currency symbol.</td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>1</code></td>
<td>Put the sign string in front of the currency symbol and value.</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code>2</code></td>
<td>Put the sign string after the currency symbol and value.</td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>3</code></td>
<td>Put the sign string directly in front of the currency symbol.</td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code>4</code></td>
<td>Put the sign string directly behind the currency symbol.</td>
</tr>
</tbody>
</table>
<p> </p>
<h3 data-number="26.2.3" id="example-values"><span class="header-section-number">26.2.3</span> Example Values</h3>
<p>When I get the values on my system, this is what I see (grouping string displayed as individual byte values):</p>
<div class="sourceCode" id="cb526"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb526-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb526-1" aria-hidden="true" tabindex="-1"></a>mon_decimal_point  <span class="op">=</span> <span class="st">"."</span></span>
<span id="cb526-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb526-2" aria-hidden="true" tabindex="-1"></a>mon_thousands_sep  <span class="op">=</span> <span class="st">","</span></span>
<span id="cb526-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb526-3" aria-hidden="true" tabindex="-1"></a>mon_grouping       <span class="op">=</span> <span class="dv">3</span> <span class="dv">3</span> <span class="dv">0</span></span>
<span id="cb526-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb526-4" aria-hidden="true" tabindex="-1"></a>positive_sign      <span class="op">=</span> <span class="st">""</span></span>
<span id="cb526-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb526-5" aria-hidden="true" tabindex="-1"></a>negative_sign      <span class="op">=</span> <span class="st">"-"</span></span>
<span id="cb526-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb526-6" aria-hidden="true" tabindex="-1"></a>currency_symbol    <span class="op">=</span> <span class="st">"$"</span></span>
<span id="cb526-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb526-7" aria-hidden="true" tabindex="-1"></a>frac_digits        <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb526-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb526-8" aria-hidden="true" tabindex="-1"></a>p_cs_precedes      <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb526-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb526-9" aria-hidden="true" tabindex="-1"></a>n_cs_precedes      <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb526-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb526-10" aria-hidden="true" tabindex="-1"></a>p_sep_by_space     <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb526-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb526-11" aria-hidden="true" tabindex="-1"></a>n_sep_by_space     <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb526-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb526-12" aria-hidden="true" tabindex="-1"></a>p_sign_posn        <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb526-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb526-13" aria-hidden="true" tabindex="-1"></a>n_sign_posn        <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb526-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb526-14" aria-hidden="true" tabindex="-1"></a>int_curr_symbol    <span class="op">=</span> <span class="st">"USD "</span></span>
<span id="cb526-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb526-15" aria-hidden="true" tabindex="-1"></a>int_frac_digits    <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb526-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb526-16" aria-hidden="true" tabindex="-1"></a>int_p_cs_precedes  <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb526-17"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb526-17" aria-hidden="true" tabindex="-1"></a>int_n_cs_precedes  <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb526-18"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb526-18" aria-hidden="true" tabindex="-1"></a>int_p_sep_by_space <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb526-19"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb526-19" aria-hidden="true" tabindex="-1"></a>int_n_sep_by_space <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb526-20"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb526-20" aria-hidden="true" tabindex="-1"></a>int_p_sign_posn    <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb526-21"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb526-21" aria-hidden="true" tabindex="-1"></a>int_n_sign_posn    <span class="op">=</span> <span class="dv">1</span></span></code></pre></div>
<h2 data-number="26.3" id="localization-specifics"><span class="header-section-number">26.3</span> Localization Specifics</h2>
<p>Notice how we passed the macro <code>LC_ALL</code> to <code>setlocale()</code> earlier… this hints that there might be some variant that allows you to be more precise about which <em>parts</em> of the locale you’re setting.</p>
<p>Let’s take a look at the values you can see for these:</p>
<table>
<colgroup>
<col style="width: 22%">
<col style="width: 77%">
</colgroup>
<thead>
<tr class="header">
<th>Macro</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>LC_ALL</code></td>
<td>Set all of the following to the given locale.</td>
</tr>
<tr class="even">
<td><code>LC_COLLATE</code></td>
<td>Controls the behavior of the <code>strcoll()</code> and <code>strxfrm()</code> functions.</td>
</tr>
<tr class="odd">
<td><code>LC_CTYPE</code></td>
<td>Controls the behavior of the character-handling functions<a href="https://beej.us/guide/bgc/html/index-wide.html#fn156" class="footnote-ref" id="fnref156" role="doc-noteref"><sup>156</sup></a>.</td>
</tr>
<tr class="even">
<td><code>LC_MONETARY</code></td>
<td>Controls the values returned by <code>localeconv()</code>.</td>
</tr>
<tr class="odd">
<td><code>LC_NUMERIC</code></td>
<td>Controls the decimal point for the <code>printf()</code> family of functions.</td>
</tr>
<tr class="even">
<td><code>LC_TIME</code></td>
<td>Controls time formatting of the <code>strftime()</code> and <code>wcsftime()</code> time and date printing functions.</td>
</tr>
</tbody>
</table>
<p>It’s pretty common to see <code>LC_ALL</code> being set, but, hey, at least you have options.</p>
<p>Also I should point out that <code>LC_CTYPE</code> is one of the biggies because it ties into wide characters, a significant can of worms that we’ll talk about later.</p>
<p></p>
<!-- Beej's guide to C

# vim: ts=4:sw=4:nosi:et:tw=72
-->
<h1 data-number="27" id="unicode-wide-characters-and-all-that"><span class="header-section-number">27</span> Unicode, Wide Characters, and All That</h1>
<p></p>
<p>Before we begin, note that this is an active area of language development in C as it works to get past some, erm, <em>growing pains</em>. When C2x comes out, updates here are probable.</p>
<p>Most people are basically interested in the deceptively simple question, “How do I use such-and-such character set in C?” We’ll get to that. But as we’ll see, it might already work on your system. Or you might have to punt to a third-party library.</p>
<p>We’re going to talk about a lot of things this chapter—some are platform agnostic, and some are C-specific.</p>
<p>Let’s get an outline first of what we’re going to look at:</p>
<ul>
<li>Unicode background</li>
<li>Character encoding background</li>
<li>Source and Execution character Sets</li>
<li>Using Unicode and UTF-8</li>
<li>Using other character types like <code>wchar_t</code>, <code>char16_t</code>, and <code>char32_t</code></li>
</ul>
<p>Let’s dive in!</p>
<h2 data-number="27.1" id="what-is-unicode"><span class="header-section-number">27.1</span> What is Unicode?</h2>
<p>Back in the day, it was popular in the US and much of the world to use a 7-bit or 8-bit encoding for characters in memory. This meant we could have 128 or 256 characters (including non-printable characters) total. That was fine for a US-centric world, but it turns out there are actually other alphabets out there—who knew? Chinese has over 50,000 characters, and that’s not fitting in a byte.</p>
<p>So people came up with all kinds of alternate ways to represent their own custom character sets. And that was fine, but turned into a compatibility nightmare.</p>
<p>To escape it, Unicode was invented. One character set to rule them all. It extends off into infinity (effectively) so we’ll never run out of space for new characters. It has Chinese, Latin, Greek, cuneiform, chess symbols, emojis… just about everything, really! And more is being added all the time!</p>
<h2 data-number="27.2" id="code-points"><span class="header-section-number">27.2</span> Code Points</h2>
<p></p>
<p>I want to talk about two concepts here. It’s confusing because they’re both numbers… different numbers for the same thing. But bear with me.</p>
<p>Let’s loosely define <em>code point</em> to mean a numeric value representing a character. (Code points can also represent unprintable control characters, but just assume I mean something like the letter “B” or the character “π”.)</p>
<p>Each code point represents a unique character. And each character has a unique numeric code point associated with it.</p>
<p>For example, in Unicode, the numeric value 66 represents “B”, and 960 represents “π”. Other character mappings that aren’t Unicode use different values, potentially, but let’s forget them and concentrate on Unicode, the future!</p>
<p>So that’s one thing: there’s a number that represents each character. In Unicode, these numbers run from 0 to over 1 million.</p>
<p></p>
<p>Got it?</p>
<p>Because we’re about to flip the table a little.</p>
<h2 data-number="27.3" id="encoding"><span class="header-section-number">27.3</span> Encoding</h2>
<p></p>
<p>If you recall, an 8-bit byte can hold values from 0-255, inclusive. That’s great for “B” which is 66—that fits in a byte. But “π” is 960, and that doesn’t fit in a byte! We need another byte. How do we store all that in memory? Or what about bigger numbers, like 195,024? That’s going to need a number of bytes to hold.</p>
<p>The Big Question: how are these numbers represented in memory? This is what we call the <em>encoding</em> of the characters.</p>
<p>So we have two things: one is the code point which tells us effectively the serial number of a particular character. And we have the encoding which tells us how we’re going to represent that number in memory.</p>
<p>There are plenty of encodings. You can make up your own right now, if you want<a href="https://beej.us/guide/bgc/html/index-wide.html#fn157" class="footnote-ref" id="fnref157" role="doc-noteref"><sup>157</sup></a>. But we’re going to look at some really common encodings that are in use with Unicode.</p>
<p> </p>
<table>
<colgroup>
<col style="width: 23%">
<col style="width: 76%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: center;">Encoding</th>
<th style="text-align: left;">Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">UTF-8</td>
<td style="text-align: left;">A byte-oriented encoding that uses a variable number of bytes per character. This is the one to use.</td>
</tr>
<tr class="even">
<td style="text-align: center;">UTF-16</td>
<td style="text-align: left;">A 16-bit per character<a href="https://beej.us/guide/bgc/html/index-wide.html#fn158" class="footnote-ref" id="fnref158" role="doc-noteref"><sup>158</sup></a> encoding.</td>
</tr>
<tr class="odd">
<td style="text-align: center;">UTF-32</td>
<td style="text-align: left;">A 32-bit per character encoding.</td>
</tr>
</tbody>
</table>
<p>With UTF-16 and UTF-32, the byte order matters, so you might see UTF-16BE for big-endian and UTF-16LE for little-endian. Same for UTF-32. Technically, if unspecified, you should assume big-endian. But since Windows uses UTF-16 extensively and is little-endian, sometimes that is assumed<a href="https://beej.us/guide/bgc/html/index-wide.html#fn159" class="footnote-ref" id="fnref159" role="doc-noteref"><sup>159</sup></a>.</p>
<p>Let’s look at some examples. I’m going to write the values in hex because that’s exactly two digits per 8-bit byte, and it makes it easier to see how things are arranged in memory.</p>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">Character</th>
<th style="text-align: center;">Code Point</th>
<th style="text-align: center;">UTF-16BE</th>
<th style="text-align: center;">UTF-32BE</th>
<th style="text-align: center;">UTF-16LE</th>
<th style="text-align: center;">UTF-32LE</th>
<th style="text-align: center;">UTF-8</th>
<th style="text-align: center;"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><code>A</code></td>
<td style="text-align: center;">41</td>
<td style="text-align: center;">0041</td>
<td style="text-align: center;">00000041</td>
<td style="text-align: center;">4100</td>
<td style="text-align: center;">41000000</td>
<td style="text-align: center;">41</td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>B</code></td>
<td style="text-align: center;">42</td>
<td style="text-align: center;">0042</td>
<td style="text-align: center;">00000042</td>
<td style="text-align: center;">4200</td>
<td style="text-align: center;">42000000</td>
<td style="text-align: center;">42</td>
<td style="text-align: center;"></td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code>~</code></td>
<td style="text-align: center;">7E</td>
<td style="text-align: center;">007E</td>
<td style="text-align: center;">0000007E</td>
<td style="text-align: center;">7E00</td>
<td style="text-align: center;">7E000000</td>
<td style="text-align: center;">7E</td>
<td style="text-align: center;"></td>
</tr>
<tr class="even">
<td style="text-align: center;"><code>π</code></td>
<td style="text-align: center;">3C0</td>
<td style="text-align: center;">03C0</td>
<td style="text-align: center;">000003C0</td>
<td style="text-align: center;">C003</td>
<td style="text-align: center;">C0030000</td>
<td style="text-align: center;">CF80</td>
<td style="text-align: center;"></td>
</tr>
<tr class="odd">
<td style="text-align: center;"><code>€</code></td>
<td style="text-align: center;">20AC</td>
<td style="text-align: center;">20AC</td>
<td style="text-align: center;">000020AC</td>
<td style="text-align: center;">AC20</td>
<td style="text-align: center;">AC200000</td>
<td style="text-align: center;">E282AC</td>
<td style="text-align: center;"></td>
</tr>
</tbody>
</table>
<p></p>
<p>Look in there for the patterns. Note that UTF-16BE and UTF-32BE are simply the code point represented directly as 16- and 32-bit values<a href="https://beej.us/guide/bgc/html/index-wide.html#fn160" class="footnote-ref" id="fnref160" role="doc-noteref"><sup>160</sup></a>.</p>
<p> </p>
<p>Little-endian is the same, except the bytes are in little-endian order.</p>
<p></p>
<p>Then we have UTF-8 at the end. First you might notice that the single-byte code points are represented as a single byte. That’s nice. You might also notice that different code points take different number of bytes. This is a variable-width encoding.</p>
<p>So as soon as we get above a certain value, UTF-8 starts using additional bytes to store the values. And they don’t appear to correlate with the code point value, either.</p>
<p><a href="https://en.wikipedia.org/wiki/UTF-8">The details of UTF-8 encoding</a><a href="https://beej.us/guide/bgc/html/index-wide.html#fn161" class="footnote-ref" id="fnref161" role="doc-noteref"><sup>161</sup></a> are beyond the scope of this guide, but it’s enough to know that it has a variable number of bytes per code point, and those byte values don’t match up with the code point <em>except for the first 128 code points</em>. If you really want to learn more, <a href="https://www.youtube.com/watch?v=MijmeoH9LT4">Computerphile has a great UTF-8 video with Tom Scott</a><a href="https://beej.us/guide/bgc/html/index-wide.html#fn162" class="footnote-ref" id="fnref162" role="doc-noteref"><sup>162</sup></a>.</p>
<p>That last bit is a neat thing about Unicode and UTF-8 from a North American perspective: it’s backward compatible with 7-bit ASCII encoding! So if you’re used to ASCII, UTF-8 is the same! Every ASCII-encoded document is also UTF-8 encoded! (But not the other way around, obviously.)</p>
<p>It’s probably that last point more than any other that is driving UTF-8 to take over the world.</p>
<p> </p>
<h2 data-number="27.4" id="src-exec-charset"><span class="header-section-number">27.4</span> Source and Execution Character Sets</h2>
<p></p>
<p>When programming in C, there are (at least) three character sets that are in play:</p>
<ul>
<li>The one that your code exists on disk as.</li>
<li>The one the compiler translates that into just as compilation begins (the <em>source character set</em>). This might be the same as the one on disk, or it might not.</li>
<li>The one the compiler translates the source character set into for execution (the <em>execution character set</em>). This might be the same as the source character set, or it might not.</li>
</ul>
<p>Your compiler probably has options to select these character sets at build-time.</p>
<p></p>
<p>The basic character set for both source and execution will contain the following characters:</p>
<div class="sourceCode" id="cb527"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb527-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb527-1" aria-hidden="true" tabindex="-1"></a>A B C D E F G H I J K L M</span>
<span id="cb527-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb527-2" aria-hidden="true" tabindex="-1"></a>N O P Q R S T U V W X Y Z</span>
<span id="cb527-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb527-3" aria-hidden="true" tabindex="-1"></a>a b c d e f g h i j k l m</span>
<span id="cb527-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb527-4" aria-hidden="true" tabindex="-1"></a>n o p q r s t u v w x y z</span>
<span id="cb527-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb527-5" aria-hidden="true" tabindex="-1"></a>0 1 2 3 4 5 6 7 8 9</span>
<span id="cb527-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb527-6" aria-hidden="true" tabindex="-1"></a>! " # % &amp; ' ( ) * + , - . / :</span>
<span id="cb527-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb527-7" aria-hidden="true" tabindex="-1"></a>; &lt; = &gt; ? [ \ ] ^ _ { | } ~</span>
<span id="cb527-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb527-8" aria-hidden="true" tabindex="-1"></a>space tab vertical-tab</span>
<span id="cb527-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb527-9" aria-hidden="true" tabindex="-1"></a>form-feed end-of-line</span></code></pre></div>
<p>Those are the characters you can use in your source and remain 100% portable.</p>
<p>The execution character set will additionally have characters for alert (bell/flash), backspace, carriage return, and newline.</p>
<p>But most people don’t go to that extreme and freely use their extended character sets in source and executable, especially now that Unicode and UTF-8 are getting more common. I mean, the basic character set doesn’t even allow for <code>@</code>, <code>$</code>, or <code>`</code>!</p>
<p>Notably, it’s a pain (though possible with escape sequences) to enter Unicode characters using only the basic character set.</p>
<p> </p>
<h2 data-number="27.5" id="unicode-in-c"><span class="header-section-number">27.5</span> Unicode in C</h2>
<p>Before I get into encoding in C, let’s talk about Unicode from a code point standpoint. There is a way in C to specify Unicode characters and these will get translated by the compiler into the execution character set<a href="https://beej.us/guide/bgc/html/index-wide.html#fn163" class="footnote-ref" id="fnref163" role="doc-noteref"><sup>163</sup></a>.</p>
<p>So how do we do it?</p>
<p>How about the euro symbol, code point 0x20AC. (I’ve written it in hex because both ways of representing it in C require hex.) How can we put that in our C code?</p>
<p> Use the <code>\u</code> escape to put it in a string, e.g.&nbsp;<code>"\u20AC"</code> (case for the hex doesn’t matter). You must put <strong>exactly four</strong> hex digits after the <code>\u</code>, padding with leading zeros if necessary.</p>
<p>Here’s an example:</p>
<div class="sourceCode" id="cb528"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb528-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb528-1" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span> <span class="op">*</span>s <span class="op">=</span> <span class="st">"</span><span class="sc">\u20AC</span><span class="st">1.23"</span><span class="op">;</span></span>
<span id="cb528-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb528-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb528-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb528-3" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> s<span class="op">);</span>  <span class="co">// €1.23</span></span></code></pre></div>
<p></p>
<p>So <code>\u</code> works for 16-bit Unicode code points, but what about ones bigger than 16 bits? For that, we need capitals: <code>\U</code>.</p>
<p>For example:</p>
<div class="sourceCode" id="cb529"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb529-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb529-1" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span> <span class="op">*</span>s <span class="op">=</span> <span class="st">"</span><span class="sc">\U0001D4D1</span><span class="st">"</span><span class="op">;</span></span>
<span id="cb529-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb529-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb529-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb529-3" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> s<span class="op">);</span>  <span class="co">// Prints a mathematical letter "B"</span></span></code></pre></div>
<p>It’s the same as <code>\u</code>, just with 32 bits instead of 16. These are equivalent:</p>
<div class="sourceCode" id="cb530"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb530-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb530-1" aria-hidden="true" tabindex="-1"></a>\u03C0</span>
<span id="cb530-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb530-2" aria-hidden="true" tabindex="-1"></a>\U000003C0</span></code></pre></div>
<p> </p>
<p>Again, these are translated into the execution character set during compilation. They represent Unicode code points, not any specific encoding. Furthermore, if a Unicode code point is not representable in the execution character set, the compiler can do whatever it wants with it.</p>
<p>Now, you might wonder why you can’t just do this:</p>
<div class="sourceCode" id="cb531"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb531-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb531-1" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span> <span class="op">*</span>s <span class="op">=</span> <span class="st">"€1.23"</span><span class="op">;</span></span>
<span id="cb531-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb531-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb531-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb531-3" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> s<span class="op">);</span>  <span class="co">// €1.23</span></span></code></pre></div>
<p>And you probably can, given a modern compiler. The source character set will be translated for you into the execution character set by the compiler. But compilers are free to puke out if they find any characters that aren’t included in their extended character set, and the € symbol certainly isn’t in the basic character set.</p>
<p> </p>
<p>Caveat from the spec: you can’t use <code>\u</code> or <code>\U</code> to encode any code points below 0xA0 except for 0x24 (<code>$</code>), 0x40 (<code>@</code>), and 0x60 (<code>`</code>)—yes, those are precisely the trio of common punctuation marks missing from the basic character set. Apparently this restriction is relaxed in the upcoming version of the spec.</p>
<p> </p>
<p>Finally, you can also use these in identifiers in your code, with some restrictions. But I don’t want to get into that here. We’re all about string handling in this chapter.</p>
<p>And that’s about it for Unicode in C (except encoding).</p>
<h2 data-number="27.6" id="utf8-quick"><span class="header-section-number">27.6</span> A Quick Note on UTF-8 Before We Swerve into the Weeds</h2>
<p></p>
<p>It could be that your source file on disk, the extended source characters, and the extended execution characters are all in UTF-8 format. And the libraries you use expect UTF-8. This is the glorious future of UTF-8 everywhere.</p>
<p>If that’s the case, and you don’t mind being non-portable to systems that aren’t like that, then just run with it. Stick Unicode characters in your source and data at will. Use regular C strings and be happy.</p>
<p>A lot of things will just work (albeit non-portably) because UTF-8 strings can safely be NUL-terminated just like any other C string. But maybe losing portability in exchange for easier character handling is a tradeoff that’s worth it to you.</p>
<p>There are some caveats, however:</p>
<ul>
<li><p>Things like <code>strlen()</code> report the number of bytes in a string, not the number of characters, necessarily. (The <code>mbstowcs()</code> returns the number of characters in a string when you convert it to wide characters. POSIX extends this so you can pass <code>NULL</code> for the first argument if you just want the character count.)</p></li>
<li><p>The following won’t work properly with characters of more than one byte: <code>strtok()</code>, <code>strchr()</code> (use <code>strstr()</code> instead), <code>strspn()</code>-type functions, <code>toupper()</code>, <code>tolower()</code>, <code>isalpha()</code>-type functions, and probably more. Beware anything that operates on bytes.</p></li>
<li><p><code>printf()</code> variants allow for a way to only print so many bytes of a string<a href="https://beej.us/guide/bgc/html/index-wide.html#fn164" class="footnote-ref" id="fnref164" role="doc-noteref"><sup>164</sup></a>. You want to make certain you print the correct number of bytes to end on a character boundary.</p></li>
<li><p>If you want to <code>malloc()</code> space for a string, or declare an array of <code>char</code>s for one, be aware that the maximum size could be more than you were expecting. Each character could take up to <code>MB_LEN_MAX</code> bytes (from <code>&lt;limits.h&gt;</code>)—except characters in the basic character set which are guaranteed to be one byte.</p></li>
</ul>
<p>And probably others I haven’t discovered. Let me know what pitfalls there are out there…</p>
<p></p>
<h2 data-number="27.7" id="different-character-types"><span class="header-section-number">27.7</span> Different Character Types</h2>
<p>I want to introduce more character types. We’re used to <code>char</code>, right?</p>
<p>But that’s too easy. Let’s make things a lot more difficult! Yay!</p>
<h3 data-number="27.7.1" id="multibyte-characters"><span class="header-section-number">27.7.1</span> Multibyte Characters</h3>
<p></p>
<p>First of all, I want to potentially change your thinking about what a string (array of <code>char</code>s) is. These are <em>multibyte strings</em> made up of <em>multibyte characters</em>.</p>
<p>That’s right—your run-of-the-mill string of characters is multibyte. When someone says “C string”, they mean “C multibyte string”.</p>
<p>Even if a particular character in the string is only a single byte, or if a string is made up of only single characters, it’s known as a multibyte string.</p>
<p>For example:</p>
<div class="sourceCode" id="cb532"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb532-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb532-1" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span> c<span class="op">[</span><span class="dv">128</span><span class="op">]</span> <span class="op">=</span> <span class="st">"Hello, world!"</span><span class="op">;</span>  <span class="co">// Multibyte string</span></span></code></pre></div>
<p>What we’re saying here is that a particular character that’s not in the basic character set could be composed of multiple bytes. Up to <code>MB_LEN_MAX</code> of them (from <code>&lt;limits.h&gt;</code>). Sure, it only looks like one character on the screen, but it could be multiple bytes.</p>
<p>You can throw Unicode values in there, as well, as we saw earlier:</p>
<div class="sourceCode" id="cb533"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb533-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb533-1" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span> <span class="op">*</span>s <span class="op">=</span> <span class="st">"</span><span class="sc">\u20AC</span><span class="st">1.23"</span><span class="op">;</span></span>
<span id="cb533-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb533-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb533-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb533-3" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> s<span class="op">);</span>  <span class="co">// €1.23</span></span></code></pre></div>
<p>But here we’re getting into some weirdness, because check this out:</p>
<p></p>
<div class="sourceCode" id="cb534"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb534-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb534-1" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span> <span class="op">*</span>s <span class="op">=</span> <span class="st">"</span><span class="sc">\u20AC</span><span class="st">1.23"</span><span class="op">;</span>  <span class="co">// €1.23</span></span>
<span id="cb534-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb534-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb534-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb534-3" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">%zu\n</span><span class="st">"</span><span class="op">,</span> strlen<span class="op">(</span>s<span class="op">));</span>  <span class="co">// 7!</span></span></code></pre></div>
<p>The string length of <code>"€1.23"</code> is <code>7</code>?! Yes! Well, on my system, yes! Remember that <code>strlen()</code> returns the number of bytes in the string, not the number of characters. (When we get to “wide characters”, coming up, we’ll see a way to get the number of characters in the string.)</p>
<p></p>
<p>Note that while C allows individual multibyte <code>char</code> constants (as opposed to <code>char*</code>), the behavior of these varies by implementation and your compiler might warn on it.</p>
<p>GCC, for example, warns of multi-character character constants for the following two lines (and, on my system, prints out the UTF-8 encoding):</p>
<div class="sourceCode" id="cb535"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb535-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb535-1" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">%x\n</span><span class="st">"</span><span class="op">,</span> <span class="ch">'€'</span><span class="op">);</span></span>
<span id="cb535-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb535-2" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">%x\n</span><span class="st">"</span><span class="op">,</span> <span class="ch">'\</span><span class="er">u20ac</span><span class="ch">'</span><span class="op">);</span></span></code></pre></div>
<p></p>
<h3 data-number="27.7.2" id="wide-characters"><span class="header-section-number">27.7.2</span> Wide Characters</h3>
<p></p>
<p>If you’re not a multibyte character, then you’re a <em>wide character</em>.</p>
<p>A wide character is a single value that can uniquely represent any character in the current locale. It’s analogous to Unicode code points. But it might not be. Or it might be.</p>
<p>Basically, where multibyte character strings are arrays of bytes, wide character strings are arrays of <em>characters</em>. So you can start thinking on a character-by-character basis rather than a byte-by-byte basis (the latter of which gets all messy when characters start taking up variable numbers of bytes).</p>
<p></p>
<p>Wide characters can be represented by a number of types, but the big standout one is <code>wchar_t</code>. It’s the main one. It’s like <code>char</code>, except wide.</p>
<p>You might be wondering if you can’t tell if it’s Unicode or not, how does that allow you much flexibility in terms of writing code? <code>wchar_t</code> opens some of those doors, as there are a rich set of functions you can use to deal with <code>wchar_t</code> strings (like getting the length, etc.) without caring about the encoding.</p>
<h2 data-number="27.8" id="using-wide-characters-and-wchar_t"><span class="header-section-number">27.8</span> Using Wide Characters and <code>wchar_t</code></h2>
<p>Time for a new type: <code>wchar_t</code>. This is the main wide character type. Remember how a <code>char</code> is only one byte? And a byte’s not enough to represent all characters, potentially? Well, this one is enough.</p>
<p>To use <code>wchar_t</code>, include <code>&lt;wchar.h&gt;</code>.</p>
<p>How many bytes big is it? Well, it’s not totally clear. Could be 16 bits. Could be 32 bits.</p>
<p>But wait, you’re saying—if it’s only 16 bits, it’s not big enough to hold all the Unicode code points, is it? You’re right—it’s not. The spec doesn’t require it to be. It just has to be able to represent all the characters in the current locale.</p>
<p>This can cause grief with Unicode on platforms with 16-bit <code>wchar_t</code>s (ahem—Windows). But that’s out of scope for this guide.</p>
<p></p>
<p>You can declare a string or character of this type with the <code>L</code> prefix, and you can print them with the <code>%ls</code> (“ell ess”) format specifier. Or print an individual <code>wchar_t</code> with <code>%lc</code>.</p>
<div class="sourceCode" id="cb536"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb536-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb536-1" aria-hidden="true" tabindex="-1"></a><span class="dt">wchar_t</span> <span class="op">*</span>s <span class="op">=</span> <span class="st">L"Hello, world!"</span><span class="op">;</span></span>
<span id="cb536-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb536-2" aria-hidden="true" tabindex="-1"></a><span class="dt">wchar_t</span> c <span class="op">=</span> <span class="ch">L'B'</span><span class="op">;</span></span>
<span id="cb536-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb536-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb536-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb536-4" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">%ls</span><span class="st"> </span><span class="sc">%lc\n</span><span class="st">"</span><span class="op">,</span> s<span class="op">,</span> c<span class="op">);</span></span></code></pre></div>
<p></p>
<p>Now—are those characters stored as Unicode code points, or not? Depends on the implementation. But you can test if they are with the macro <code>__STDC_ISO_10646__</code>. If this is defined, the answer is, “It’s Unicode!”</p>
<p>More detailedly, the value in that macro is an integer in the form <code>yyyymm</code> that lets you know what Unicode standard you can rely on—whatever was in effect on that date.</p>
<p>But how do you use them?</p>
<h3 data-number="27.8.1" id="multibyte-to-wchar_t-conversions"><span class="header-section-number">27.8.1</span> Multibyte to <code>wchar_t</code> Conversions</h3>
<p>So how do we get from the byte-oriented standard strings to the character-oriented wide strings and back?</p>
<p>We can use a couple string conversion functions to make this happen.</p>
<p>First, some naming conventions you’ll see in these functions:</p>
<ul>
<li><code>mb</code>: multibyte</li>
<li><code>wc</code>: wide character</li>
<li><code>mbs</code>: multibyte string</li>
<li><code>wcs</code>: wide character string</li>
</ul>
<p>So if we want to convert a multibyte string to a wide character string, we can call the <code>mbstowcs()</code>. And the other way around: <code>wcstombs()</code>.</p>
<table>
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th>Conversion Function</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>mbtowc()</code></td>
<td>Convert a multibyte character to a wide character.</td>
</tr>
<tr class="even">
<td><code>wctomb()</code></td>
<td>Convert a wide character to a multibyte character.</td>
</tr>
<tr class="odd">
<td><code>mbstowcs()</code></td>
<td>Convert a multibyte string to a wide string.</td>
</tr>
<tr class="even">
<td><code>wcstombs()</code></td>
<td>Convert a wide string to a multibyte string.</td>
</tr>
</tbody>
</table>
<p>Let’s do a quick demo where we convert a multibyte string to a wide character string, and compare the string lengths of the two using their respective functions.</p>
<p></p>
<div class="sourceCode" id="cb537"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb537-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb537-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb537-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb537-2"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb537-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb537-3"></a><span class="pp">#include </span><span class="im">&lt;wchar.h&gt;</span></span>
<span id="cb537-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb537-4"></a><span class="pp">#include </span><span class="im">&lt;string.h&gt;</span></span>
<span id="cb537-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb537-5"></a><span class="pp">#include </span><span class="im">&lt;locale.h&gt;</span></span>
<span id="cb537-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb537-6"></a></span>
<span id="cb537-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb537-7"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb537-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb537-8"></a><span class="op">{</span></span>
<span id="cb537-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb537-9"></a>    <span class="co">// Get out of the C locale to one that likely has the euro symbol</span></span>
<span id="cb537-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb537-10"></a>    setlocale<span class="op">(</span>LC_ALL<span class="op">,</span> <span class="st">""</span><span class="op">);</span></span>
<span id="cb537-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb537-11"></a></span>
<span id="cb537-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb537-12"></a>    <span class="co">// Original multibyte string with a euro symbol (Unicode point 20ac)</span></span>
<span id="cb537-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb537-13"></a>    <span class="dt">char</span> <span class="op">*</span>mb_string <span class="op">=</span> <span class="st">"The cost is </span><span class="sc">\u20ac</span><span class="st">1.23"</span><span class="op">;</span>  <span class="co">// €1.23</span></span>
<span id="cb537-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb537-14"></a>    <span class="dt">size_t</span> mb_len <span class="op">=</span> strlen<span class="op">(</span>mb_string<span class="op">);</span></span>
<span id="cb537-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb537-15"></a></span>
<span id="cb537-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb537-16"></a>    <span class="co">// Wide character array that will hold the converted string</span></span>
<span id="cb537-17"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb537-17"></a>    <span class="dt">wchar_t</span> wc_string<span class="op">[</span><span class="dv">128</span><span class="op">];</span>  <span class="co">// Holds up to 128 wide characters</span></span>
<span id="cb537-18"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb537-18"></a></span>
<span id="cb537-19"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb537-19"></a>    <span class="co">// Convert the MB string to WC; this returns the number of wide chars</span></span>
<span id="cb537-20"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb537-20"></a>    <span class="dt">size_t</span> wc_len <span class="op">=</span> mbstowcs<span class="op">(</span>wc_string<span class="op">,</span> mb_string<span class="op">,</span> <span class="dv">128</span><span class="op">);</span></span>
<span id="cb537-21"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb537-21"></a></span>
<span id="cb537-22"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb537-22"></a>    <span class="co">// Print result--note the %ls for wide char strings</span></span>
<span id="cb537-23"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb537-23"></a>    printf<span class="op">(</span><span class="st">"multibyte: </span><span class="sc">\"%s\"</span><span class="st"> (</span><span class="sc">%zu</span><span class="st"> bytes)</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> mb_string<span class="op">,</span> mb_len<span class="op">);</span></span>
<span id="cb537-24"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb537-24"></a>    printf<span class="op">(</span><span class="st">"wide char: </span><span class="sc">\"%ls\"</span><span class="st"> (</span><span class="sc">%zu</span><span class="st"> characters)</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> wc_string<span class="op">,</span> wc_len<span class="op">);</span></span>
<span id="cb537-25"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb537-25"></a><span class="op">}</span></span></code></pre></div>
<p></p>
<p>On my system, this outputs:</p>
<div class="sourceCode" id="cb538"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb538-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb538-1" aria-hidden="true" tabindex="-1"></a>multibyte: "The cost is €1.23" (19 bytes)</span>
<span id="cb538-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb538-2" aria-hidden="true" tabindex="-1"></a>wide char: "The cost is €1.23" (17 characters)</span></code></pre></div>
<p>(Your system might vary on the number of bytes depending on your locale.)</p>
<p>One interesting thing to note is that <code>mbstowcs()</code>, in addition to converting the multibyte string to wide, returns the length (in characters) of the wide character string. On POSIX-compliant systems, you can take advantage of a special mode where it <em>only</em> returns the length-in-characters of a given multibyte string: you just pass <code>NULL</code> to the destination, and <code>0</code> to the maximum number of characters to convert (this value is ignored).</p>
<p>(In the code below, I’m using my extended source character set—you might have to replace those with <code>\u</code> escapes.)</p>
<div class="sourceCode" id="cb539"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb539-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb539-1" aria-hidden="true" tabindex="-1"></a>setlocale<span class="op">(</span>LC_ALL<span class="op">,</span> <span class="st">""</span><span class="op">);</span></span>
<span id="cb539-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb539-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb539-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb539-3" aria-hidden="true" tabindex="-1"></a><span class="co">// The following string has 7 characters</span></span>
<span id="cb539-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb539-4" aria-hidden="true" tabindex="-1"></a><span class="dt">size_t</span> len_in_chars <span class="op">=</span> mbstowcs<span class="op">(</span>NULL<span class="op">,</span> <span class="st">"§¶°±π€•"</span><span class="op">,</span> <span class="dv">0</span><span class="op">);</span></span>
<span id="cb539-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb539-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb539-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb539-6" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">%zu</span><span class="st">"</span><span class="op">,</span> len_in_chars<span class="op">);</span>  <span class="co">// 7</span></span></code></pre></div>
<p></p>
<p>Again, that’s a non-portable POSIX extension.</p>
<p>And, of course, if you want to convert the other way, it’s <code>wcstombs()</code>.</p>
<h2 data-number="27.9" id="wide-character-functionality"><span class="header-section-number">27.9</span> Wide Character Functionality</h2>
<p>Once we’re in wide character land, we have all kinds of functionality at our disposal. I’m just going to summarize a bunch of the functions here, but basically what we have here are the wide character versions of the multibyte string functions that we’re use to. (For example, we know <code>strlen()</code> for multibyte strings; there’s a <code>wcslen()</code> for wide character strings.)</p>
<h3 data-number="27.9.1" id="wint_t"><span class="header-section-number">27.9.1</span> <code>wint_t</code></h3>
<p></p>
<p>A lot of these functions use a <code>wint_t</code> to hold single characters, whether they are passed in or returned.</p>
<p>It is related to <code>wchar_t</code> in nature. A <code>wint_t</code> is an integer that can represent all values in the extended character set, and also a special end-of-file character, <code>WEOF</code>.</p>
<p></p>
<p>This is used by a number of single-character-oriented wide character functions.</p>
<h3 data-number="27.9.2" id="io-stream-orientation"><span class="header-section-number">27.9.2</span> I/O Stream Orientation</h3>
<p></p>
<p>The tl;dr here is to not mix and match byte-oriented functions (like <code>fprintf()</code>) with wide-oriented functions (like <code>fwprintf()</code>). Decide if a stream will be byte-oriented or wide-oriented and stick with those types of I/O functions.</p>
<p>In more detail: streams can be either byte-oriented or wide-oriented. When a stream is first created, it has no orientation, but the first read or write will set the orientation.</p>
<p>If you first use a wide operation (like <code>fwprintf()</code>) it will orient the stream wide.</p>
<p>If you first use a byte operation (like <code>fprintf()</code>) it will orient the stream by bytes.</p>
<p>You can manually set an unoriented stream one way or the other with a call to <code>fwide()</code>. You can use that same function to get the orientation of a stream.</p>
<p>If you need to change the orientation mid-flight, you can do it with <code>freopen()</code>.</p>
<p></p>
<h3 data-number="27.9.3" id="io-functions"><span class="header-section-number">27.9.3</span> I/O Functions</h3>
<p>Typically include <code>&lt;stdio.h&gt;</code> and <code>&lt;wchar.h&gt;</code> for these.</p>
<table>
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th>I/O Function</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>wprintf()</code></td>
<td>Formatted console output.</td>
</tr>
<tr class="even">
<td><code>wscanf()</code></td>
<td>Formatted console input.</td>
</tr>
<tr class="odd">
<td><code>getwchar()</code></td>
<td>Character-based console input.</td>
</tr>
<tr class="even">
<td><code>putwchar()</code></td>
<td>Character-based console output.</td>
</tr>
<tr class="odd">
<td><code>fwprintf()</code></td>
<td>Formatted file output.</td>
</tr>
<tr class="even">
<td><code>fwscanf()</code></td>
<td>Formatted file input.</td>
</tr>
<tr class="odd">
<td><code>fgetwc()</code></td>
<td>Character-based file input.</td>
</tr>
<tr class="even">
<td><code>fputwc()</code></td>
<td>Character-based file output.</td>
</tr>
<tr class="odd">
<td><code>fgetws()</code></td>
<td>String-based file input.</td>
</tr>
<tr class="even">
<td><code>fputws()</code></td>
<td>String-based file output.</td>
</tr>
<tr class="odd">
<td><code>swprintf()</code></td>
<td>Formatted string output.</td>
</tr>
<tr class="even">
<td><code>swscanf()</code></td>
<td>Formatted string input.</td>
</tr>
<tr class="odd">
<td><code>vfwprintf()</code></td>
<td>Variadic formatted file output.</td>
</tr>
<tr class="even">
<td><code>vfwscanf()</code></td>
<td>Variadic formatted file input.</td>
</tr>
<tr class="odd">
<td><code>vswprintf()</code></td>
<td>Variadic formatted string output.</td>
</tr>
<tr class="even">
<td><code>vswscanf()</code></td>
<td>Variadic formatted string input.</td>
</tr>
<tr class="odd">
<td><code>vwprintf()</code></td>
<td>Variadic formatted console output.</td>
</tr>
<tr class="even">
<td><code>vwscanf()</code></td>
<td>Variadic formatted console input.</td>
</tr>
<tr class="odd">
<td><code>ungetwc()</code></td>
<td>Push a wide character back on an output stream.</td>
</tr>
<tr class="even">
<td><code>fwide()</code></td>
<td>Get or set stream multibyte/wide orientation.</td>
</tr>
</tbody>
</table>
<h3 data-number="27.9.4" id="type-conversion-functions"><span class="header-section-number">27.9.4</span> Type Conversion Functions</h3>
<p>Typically include <code>&lt;wchar.h&gt;</code> for these.</p>
<table>
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th>Conversion Function</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>wcstod()</code></td>
<td>Convert string to <code>double</code>.</td>
</tr>
<tr class="even">
<td><code>wcstof()</code></td>
<td>Convert string to <code>float</code>.</td>
</tr>
<tr class="odd">
<td><code>wcstold()</code></td>
<td>Convert string to <code>long double</code>.</td>
</tr>
<tr class="even">
<td><code>wcstol()</code></td>
<td>Convert string to <code>long</code>.</td>
</tr>
<tr class="odd">
<td><code>wcstoll()</code></td>
<td>Convert string to <code>long long</code>.</td>
</tr>
<tr class="even">
<td><code>wcstoul()</code></td>
<td>Convert string to <code>unsigned long</code>.</td>
</tr>
<tr class="odd">
<td><code>wcstoull()</code></td>
<td>Convert string to <code>unsigned long long</code>.</td>
</tr>
</tbody>
</table>
<h3 data-number="27.9.5" id="string-and-memory-copying-functions"><span class="header-section-number">27.9.5</span> String and Memory Copying Functions</h3>
<p>Typically include <code>&lt;wchar.h&gt;</code> for these.</p>
<table>
<colgroup>
<col style="width: 8%">
<col style="width: 92%">
</colgroup>
<thead>
<tr class="header">
<th>Copying Function</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>wcscpy()</code></td>
<td>Copy string.</td>
</tr>
<tr class="even">
<td><code>wcsncpy()</code></td>
<td>Copy string, length-limited.</td>
</tr>
<tr class="odd">
<td><code>wmemcpy()</code></td>
<td>Copy memory.</td>
</tr>
<tr class="even">
<td><code>wmemmove()</code></td>
<td>Copy potentially-overlapping memory.</td>
</tr>
<tr class="odd">
<td><code>wcscat()</code></td>
<td>Concatenate strings.</td>
</tr>
<tr class="even">
<td><code>wcsncat()</code></td>
<td>Concatenate strings, length-limited.</td>
</tr>
</tbody>
</table>
<h3 data-number="27.9.6" id="string-and-memory-comparing-functions"><span class="header-section-number">27.9.6</span> String and Memory Comparing Functions</h3>
<p>Typically include <code>&lt;wchar.h&gt;</code> for these.</p>
<table>
<colgroup>
<col style="width: 23%">
<col style="width: 76%">
</colgroup>
<thead>
<tr class="header">
<th>Comparing Function</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>wcscmp()</code></td>
<td>Compare strings lexicographically.</td>
</tr>
<tr class="even">
<td><code>wcsncmp()</code></td>
<td>Compare strings lexicographically, length-limited.</td>
</tr>
<tr class="odd">
<td><code>wcscoll()</code></td>
<td>Compare strings in dictionary order by locale.</td>
</tr>
<tr class="even">
<td><code>wmemcmp()</code></td>
<td>Compare memory lexicographically.</td>
</tr>
<tr class="odd">
<td><code>wcsxfrm()</code></td>
<td>Transform strings into versions such that <code>wcscmp()</code> behaves like <code>wcscoll()</code><a href="https://beej.us/guide/bgc/html/index-wide.html#fn165" class="footnote-ref" id="fnref165" role="doc-noteref"><sup>165</sup></a>.</td>
</tr>
</tbody>
</table>
<h3 data-number="27.9.7" id="string-searching-functions"><span class="header-section-number">27.9.7</span> String Searching Functions</h3>
<p>Typically include <code>&lt;wchar.h&gt;</code> for these.</p>
<table>
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th>Searching Function</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>wcschr()</code></td>
<td>Find a character in a string.</td>
</tr>
<tr class="even">
<td><code>wcsrchr()</code></td>
<td>Find a character in a string from the back.</td>
</tr>
<tr class="odd">
<td><code>wmemchr()</code></td>
<td>Find a character in memory.</td>
</tr>
<tr class="even">
<td><code>wcsstr()</code></td>
<td>Find a substring in a string.</td>
</tr>
<tr class="odd">
<td><code>wcspbrk()</code></td>
<td>Find any of a set of characters in a string.</td>
</tr>
<tr class="even">
<td><code>wcsspn()</code></td>
<td>Find length of substring including any of a set of characters.</td>
</tr>
<tr class="odd">
<td><code>wcscspn()</code></td>
<td>Find length of substring before any of a set of characters.</td>
</tr>
<tr class="even">
<td><code>wcstok()</code></td>
<td>Find tokens in a string.</td>
</tr>
</tbody>
</table>
<h3 data-number="27.9.8" id="lengthmiscellaneous-functions"><span class="header-section-number">27.9.8</span> Length/Miscellaneous Functions</h3>
<p>Typically include <code>&lt;wchar.h&gt;</code> for these.</p>
<table>
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th>Length/Misc Function</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>wcslen()</code></td>
<td>Return the length of the string.</td>
</tr>
<tr class="even">
<td><code>wmemset()</code></td>
<td>Set characters in memory.</td>
</tr>
<tr class="odd">
<td><code>wcsftime()</code></td>
<td>Formatted date and time output.</td>
</tr>
</tbody>
</table>
<h3 data-number="27.9.9" id="character-classification-functions"><span class="header-section-number">27.9.9</span> Character Classification Functions</h3>
<p>Include <code>&lt;wctype.h&gt;</code> for these.</p>
<table>
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th>Length/Misc Function</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>iswalnum()</code></td>
<td>True if the character is alphanumeric.</td>
</tr>
<tr class="even">
<td><code>iswalpha()</code></td>
<td>True if the character is alphabetic.</td>
</tr>
<tr class="odd">
<td><code>iswblank()</code></td>
<td>True if the character is blank (space-ish, but not a newline).</td>
</tr>
<tr class="even">
<td><code>iswcntrl()</code></td>
<td>True if the character is a control character.</td>
</tr>
<tr class="odd">
<td><code>iswdigit()</code></td>
<td>True if the character is a digit.</td>
</tr>
<tr class="even">
<td><code>iswgraph()</code></td>
<td>True if the character is printable (except space).</td>
</tr>
<tr class="odd">
<td><code>iswlower()</code></td>
<td>True if the character is lowercase.</td>
</tr>
<tr class="even">
<td><code>iswprint()</code></td>
<td>True if the character is printable (including space).</td>
</tr>
<tr class="odd">
<td><code>iswpunct()</code></td>
<td>True if the character is punctuation.</td>
</tr>
<tr class="even">
<td><code>iswspace()</code></td>
<td>True if the character is whitespace.</td>
</tr>
<tr class="odd">
<td><code>iswupper()</code></td>
<td>True if the character is uppercase.</td>
</tr>
<tr class="even">
<td><code>iswxdigit()</code></td>
<td>True if the character is a hex digit.</td>
</tr>
<tr class="odd">
<td><code>towlower()</code></td>
<td>Convert character to lowercase.</td>
</tr>
<tr class="even">
<td><code>towupper()</code></td>
<td>Convert character to uppercase.</td>
</tr>
</tbody>
</table>
<h2 data-number="27.10" id="parse-state-restartable-functions"><span class="header-section-number">27.10</span> Parse State, Restartable Functions</h2>
<p></p>
<p>We’re going to get a little bit into the guts of multibyte conversion, but this is a good thing to understand, conceptually.</p>
<p>Imagine how your program takes a sequence of multibyte characters and turns them into wide characters, or vice-versa. It might, at some point, be partway through parsing a character, or it might have to wait for more bytes before it makes the determination of the final value.</p>
<p>This parse state is stored in an opaque variable of type <code>mbstate_t</code> and is used every time conversion is performed. That’s how the conversion functions keep track of where they are mid-work.</p>
<p>And if you change to a different character sequence mid-stream, or try to seek to a different place in your input sequence, it could get confused over that.</p>
<p>Now you might want to call me on this one: we just did some conversions, above, and I never mentioned any <code>mbstate_t</code> anywhere.</p>
<p>That’s because the conversion functions like <code>mbstowcs()</code>, <code>wctomb()</code>, etc. each have their own <code>mbstate_t</code> variable that they use. There’s only one per function, though, so if you’re writing multithreaded code, they’re not safe to use.</p>
<p>Fortunately, C defines <em>restartable</em> versions of these functions where you can pass in your own <code>mbstate_t</code> on per-thread basis if you need to. If you’re doing multithreaded stuff, use these!</p>
<p>Quick note on initializing an <code>mbstate_t</code> variable: just <code>memset()</code> it to zero. There is no built-in function to force it to be initialized.</p>
<div class="sourceCode" id="cb540"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb540-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb540-1" aria-hidden="true" tabindex="-1"></a>mbstate_t mbs<span class="op">;</span></span>
<span id="cb540-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb540-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb540-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb540-3" aria-hidden="true" tabindex="-1"></a><span class="co">// Set the state to the initial state</span></span>
<span id="cb540-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb540-4" aria-hidden="true" tabindex="-1"></a>memset<span class="op">(&amp;</span>mbs<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="kw">sizeof</span> mbs<span class="op">);</span></span></code></pre></div>
<p>Here is a list of the restartable conversion functions—note the naming convension of putting an “<code>r</code>” after the “from” type:</p>
<ul>
<li><code>mbrtowc()</code>—multibyte to wide character</li>
<li><code>wcrtomb()</code>—wide character to multibyte</li>
<li><code>mbsrtowcs()</code>—multibyte string to wide character string</li>
<li><code>wcsrtombs()</code>—wide character string to multibyte string</li>
</ul>
<p>These are really similar to their non-restartable counterparts, except they require you pass in a pointer to your own <code>mbstate_t</code> variable. And also they modify the source string pointer (to help you out if invalid bytes are found), so it might be useful to save a copy of the original.</p>
<p>Here’s the example from earlier in the chapter reworked to pass in our own <code>mbstate_t</code>.</p>
<div class="sourceCode" id="cb541"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb541-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb541-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb541-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb541-2"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb541-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb541-3"></a><span class="pp">#include </span><span class="im">&lt;stddef.h&gt;</span></span>
<span id="cb541-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb541-4"></a><span class="pp">#include </span><span class="im">&lt;wchar.h&gt;</span></span>
<span id="cb541-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb541-5"></a><span class="pp">#include </span><span class="im">&lt;string.h&gt;</span></span>
<span id="cb541-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb541-6"></a><span class="pp">#include </span><span class="im">&lt;locale.h&gt;</span></span>
<span id="cb541-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb541-7"></a></span>
<span id="cb541-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb541-8"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb541-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb541-9"></a><span class="op">{</span></span>
<span id="cb541-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb541-10"></a>    <span class="co">// Get out of the C locale to one that likely has the euro symbol</span></span>
<span id="cb541-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb541-11"></a>    setlocale<span class="op">(</span>LC_ALL<span class="op">,</span> <span class="st">""</span><span class="op">);</span></span>
<span id="cb541-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb541-12"></a></span>
<span id="cb541-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb541-13"></a>    <span class="co">// Original multibyte string with a euro symbol (Unicode point 20ac)</span></span>
<span id="cb541-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb541-14"></a>    <span class="dt">char</span> <span class="op">*</span>mb_string <span class="op">=</span> <span class="st">"The cost is </span><span class="sc">\u20ac</span><span class="st">1.23"</span><span class="op">;</span>  <span class="co">// €1.23</span></span>
<span id="cb541-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb541-15"></a>    <span class="dt">size_t</span> mb_len <span class="op">=</span> strlen<span class="op">(</span>mb_string<span class="op">);</span></span>
<span id="cb541-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb541-16"></a></span>
<span id="cb541-17"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb541-17"></a>    <span class="co">// Wide character array that will hold the converted string</span></span>
<span id="cb541-18"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb541-18"></a>    <span class="dt">wchar_t</span> wc_string<span class="op">[</span><span class="dv">128</span><span class="op">];</span>  <span class="co">// Holds up to 128 wide characters</span></span>
<span id="cb541-19"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb541-19"></a></span>
<span id="cb541-20"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb541-20"></a>    <span class="co">// Set up the conversion state</span></span>
<span id="cb541-21"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb541-21"></a>    mbstate_t mbs<span class="op">;</span></span>
<span id="cb541-22"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb541-22"></a>    memset<span class="op">(&amp;</span>mbs<span class="op">,</span> <span class="dv">0</span><span class="op">,</span> <span class="kw">sizeof</span> mbs<span class="op">);</span>  <span class="co">// Initial state</span></span>
<span id="cb541-23"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb541-23"></a></span>
<span id="cb541-24"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb541-24"></a>    <span class="co">// mbsrtowcs() modifies the input pointer to point at the first</span></span>
<span id="cb541-25"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb541-25"></a>    <span class="co">// invalid character, or NULL if successful. Let's make a copy of</span></span>
<span id="cb541-26"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb541-26"></a>    <span class="co">// the pointer for mbsrtowcs() to mess with so our original is</span></span>
<span id="cb541-27"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb541-27"></a>    <span class="co">// unchanged.</span></span>
<span id="cb541-28"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb541-28"></a>    <span class="co">//</span></span>
<span id="cb541-29"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb541-29"></a>    <span class="co">// This example will probably be successful, but we check farther</span></span>
<span id="cb541-30"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb541-30"></a>    <span class="co">// down to see.</span></span>
<span id="cb541-31"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb541-31"></a>    <span class="dt">const</span> <span class="dt">char</span> <span class="op">*</span>invalid <span class="op">=</span> mb_string<span class="op">;</span></span>
<span id="cb541-32"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb541-32"></a></span>
<span id="cb541-33"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb541-33"></a>    <span class="co">// Convert the MB string to WC; this returns the number of wide chars</span></span>
<span id="cb541-34"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb541-34"></a>    <span class="dt">size_t</span> wc_len <span class="op">=</span> mbsrtowcs<span class="op">(</span>wc_string<span class="op">,</span> <span class="op">&amp;</span>invalid<span class="op">,</span> <span class="dv">128</span><span class="op">,</span> <span class="op">&amp;</span>mbs<span class="op">);</span></span>
<span id="cb541-35"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb541-35"></a></span>
<span id="cb541-36"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb541-36"></a>    <span class="cf">if</span> <span class="op">(</span>invalid <span class="op">==</span> NULL<span class="op">)</span> <span class="op">{</span></span>
<span id="cb541-37"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb541-37"></a>        printf<span class="op">(</span><span class="st">"No invalid characters found</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb541-38"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb541-38"></a></span>
<span id="cb541-39"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb541-39"></a>        <span class="co">// Print result--note the %ls for wide char strings</span></span>
<span id="cb541-40"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb541-40"></a>        printf<span class="op">(</span><span class="st">"multibyte: </span><span class="sc">\"%s\"</span><span class="st"> (</span><span class="sc">%zu</span><span class="st"> bytes)</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> mb_string<span class="op">,</span> mb_len<span class="op">);</span></span>
<span id="cb541-41"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb541-41"></a>        printf<span class="op">(</span><span class="st">"wide char: </span><span class="sc">\"%ls\"</span><span class="st"> (</span><span class="sc">%zu</span><span class="st"> characters)</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> wc_string<span class="op">,</span> wc_len<span class="op">);</span></span>
<span id="cb541-42"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb541-42"></a>    <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span></span>
<span id="cb541-43"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb541-43"></a>        <span class="dt">ptrdiff_t</span> offset <span class="op">=</span> invalid <span class="op">-</span> mb_string<span class="op">;</span></span>
<span id="cb541-44"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb541-44"></a>        printf<span class="op">(</span><span class="st">"Invalid character at offset </span><span class="sc">%td\n</span><span class="st">"</span><span class="op">,</span> offset<span class="op">);</span></span>
<span id="cb541-45"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb541-45"></a>    <span class="op">}</span></span>
<span id="cb541-46"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb541-46"></a><span class="op">}</span></span></code></pre></div>
<p>For the conversion functions that manage their own state, you can reset their internal state to the initial one by passing in <code>NULL</code> for their <code>char*</code> arguments, for example:</p>
<div class="sourceCode" id="cb542"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb542-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb542-1" aria-hidden="true" tabindex="-1"></a>mbstowcs<span class="op">(</span>NULL<span class="op">,</span> NULL<span class="op">,</span> <span class="dv">0</span><span class="op">);</span>   <span class="co">// Reset the parse state for mbstowcs()</span></span>
<span id="cb542-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb542-2" aria-hidden="true" tabindex="-1"></a>mbstowcs<span class="op">(</span>dest<span class="op">,</span> src<span class="op">,</span> <span class="dv">100</span><span class="op">);</span>  <span class="co">// Parse some stuff</span></span></code></pre></div>
<p>For I/O, each wide stream manages its own <code>mbstate_t</code> and uses that for input and output conversions as it goes.</p>
<p>And some of the byte-oriented I/O functions like <code>printf()</code> and <code>scanf()</code> keep their own internal state while doing their work.</p>
<p>Finally, these restartable conversion functions do actually have their own internal state if you pass in <code>NULL</code> for the <code>mbstate_t</code> parameter. This makes them behave more like their non-restartable counterparts.</p>
<p> </p>
<h2 data-number="27.11" id="unicode-encodings-and-c"><span class="header-section-number">27.11</span> Unicode Encodings and C</h2>
<p>In this section, we’ll see what C can (and can’t) do when it comes to three specific Unicode encodings: UTF-8, UTF-16, and UTF-32.</p>
<h3 data-number="27.11.1" id="utf-8"><span class="header-section-number">27.11.1</span> UTF-8</h3>
<p></p>
<p>To refresh before this section, read the <a href="https://beej.us/guide/bgc/html/index-wide.html#utf8-quick">UTF-8 quick note, above</a>.</p>
<p>Aside from that, what are C’s UTF-8 capabilities?</p>
<p>Well, not much, unfortunately.</p>
<p></p>
<p>You can tell C that you specifically want a string literal to be UTF-8 encoded, and it’ll do it for you. You can prefix a string with <code>u8</code>:</p>
<div class="sourceCode" id="cb543"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb543-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb543-1" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span> <span class="op">*</span>s <span class="op">=</span> <span class="st">u8"Hello, world!"</span><span class="op">;</span></span>
<span id="cb543-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb543-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb543-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb543-3" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> s<span class="op">);</span>   <span class="co">// Hello, world!--if you can output UTF-8</span></span></code></pre></div>
<p>Now, can you put Unicode characters in there?</p>
<div class="sourceCode" id="cb544"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb544-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb544-1" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span> <span class="op">*</span>s <span class="op">=</span> <span class="st">u8"€123"</span><span class="op">;</span></span></code></pre></div>
<p></p>
<p>Sure! If the extended source character set supports it. (gcc does.)</p>
<p>What if it doesn’t? You can specify a Unicode code point with your friendly neighborhood <code>\u</code> and <code>\U</code>, <a href="https://beej.us/guide/bgc/html/index-wide.html#unicode-in-c">as noted above</a>.</p>
<p>But that’s about it. There’s no portable way in the standard library to take arbirary input and turn it into UTF-8 unless your locale is UTF-8. Or to parse UTF-8 unless your locale is UTF-8.</p>
<p>So if you want to do it, either be in a UTF-8 locale and:</p>
<p></p>
<div class="sourceCode" id="cb545"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb545-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb545-1" aria-hidden="true" tabindex="-1"></a>setlocale<span class="op">(</span>LC_ALL<span class="op">,</span> <span class="st">""</span><span class="op">);</span></span></code></pre></div>
<p>or figure out a UTF-8 locale name on your local machine and set it explicitly like so:</p>
<div class="sourceCode" id="cb546"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb546-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb546-1" aria-hidden="true" tabindex="-1"></a>setlocale<span class="op">(</span>LC_ALL<span class="op">,</span> <span class="st">"en_US.UTF-8"</span><span class="op">);</span>  <span class="co">// Non-portable name</span></span></code></pre></div>
<p></p>
<p>Or use a <a href="https://beej.us/guide/bgc/html/index-wide.html#utf-3rd-party">third-party library</a>.</p>
<p></p>
<h3 data-number="27.11.2" id="utf-16-utf-32-char16_t-and-char32_t"><span class="header-section-number">27.11.2</span> UTF-16, UTF-32, <code>char16_t</code>, and <code>char32_t</code></h3>
<p> </p>
<p><code>char16_t</code> and <code>char32_t</code> are a couple other potentially wide character types with sizes of 16 bits and 32 bits, respectively. Not necessarily wide, because if they can’t represent every character in the current locale, they lose their wide character nature. But the spec refers them as “wide character” types all over the place, so there we are.</p>
<p>These are here to make things a little more Unicode-friendly, potentially.</p>
<p>To use, include <code>&lt;uchar.h&gt;</code>. (That’s “u”, not “w”.)</p>
<p>This header file doesn’t exist on OS X—bummer. If you just want the types, you can:</p>
<div class="sourceCode" id="cb547"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb547-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb547-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdint.h&gt;</span></span>
<span id="cb547-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb547-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb547-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb547-3" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="dt">int_least16_t</span> <span class="dt">char16_t</span><span class="op">;</span></span>
<span id="cb547-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb547-4" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="dt">int_least32_t</span> <span class="dt">char32_t</span><span class="op">;</span></span></code></pre></div>
<p>But if you also want the functions, that’s all on you.</p>
<p> </p>
<p>Assuming you’re still good to go, you can declare a string or character of these types with the <code>u</code> and <code>U</code> prefixes:</p>
<div class="sourceCode" id="cb548"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb548-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb548-1" aria-hidden="true" tabindex="-1"></a><span class="dt">char16_t</span> <span class="op">*</span>s <span class="op">=</span> <span class="st">u"Hello, world!"</span><span class="op">;</span></span>
<span id="cb548-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb548-2" aria-hidden="true" tabindex="-1"></a><span class="dt">char16_t</span> c <span class="op">=</span> <span class="ch">u'B'</span><span class="op">;</span></span>
<span id="cb548-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb548-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb548-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb548-4" aria-hidden="true" tabindex="-1"></a><span class="dt">char32_t</span> <span class="op">*</span>t <span class="op">=</span> <span class="st">U"Hello, world!"</span><span class="op">;</span></span>
<span id="cb548-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb548-5" aria-hidden="true" tabindex="-1"></a><span class="dt">char32_t</span> d <span class="op">=</span> <span class="ch">U'B'</span><span class="op">;</span></span></code></pre></div>
<p> </p>
<p>Now—are values in these stored in UTF-16 or UTF-32? Depends on the implementation.</p>
<p>But you can test to see if they are. If the macros <code>__STDC_UTF_16__</code> or <code>__STDC_UTF_32__</code> are defined (to <code>1</code>) it means the types hold UTF-16 or UTF-32, respectively.</p>
<p>If you’re curious, and I know you are, the values, if UTF-16 or UTF-32, are stored in the native endianess. That is, you should be able to compare them straight up to Unicode code point values:</p>
<div class="sourceCode" id="cb549"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb549-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb549-1" aria-hidden="true" tabindex="-1"></a><span class="dt">char16_t</span> pi <span class="op">=</span> <span class="st">u"</span><span class="sc">\u03C0</span><span class="st">"</span><span class="op">;</span>  <span class="co">// pi symbol</span></span>
<span id="cb549-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb549-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb549-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb549-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#if __STDC_UTF_16__</span></span>
<span id="cb549-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb549-4" aria-hidden="true" tabindex="-1"></a>pi <span class="op">==</span> <span class="bn">0x3C0</span><span class="op">;</span>  <span class="co">// Always true</span></span>
<span id="cb549-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb549-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#else</span></span>
<span id="cb549-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb549-6" aria-hidden="true" tabindex="-1"></a>pi <span class="op">==</span> <span class="bn">0x3C0</span><span class="op">;</span>  <span class="co">// Probably not true</span></span>
<span id="cb549-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb549-7" aria-hidden="true" tabindex="-1"></a><span class="pp">#endif</span></span></code></pre></div>
<p> </p>
<h3 data-number="27.11.3" id="multibyte-conversions"><span class="header-section-number">27.11.3</span> Multibyte Conversions</h3>
<p>You can convert from your multibyte encoding to <code>char16_t</code> or <code>char32_t</code> with a number of helper functions.</p>
<p>(Like I said, though, the result might not be UTF-16 or UTF-32 unless the corresponding macro is set to <code>1</code>.)</p>
<p>All of these functions are restartable (i.e.&nbsp;you pass in your own <code>mbstate_t</code>), and all of them operate character by character<a href="https://beej.us/guide/bgc/html/index-wide.html#fn166" class="footnote-ref" id="fnref166" role="doc-noteref"><sup>166</sup></a>.</p>
<table>
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th>Conversion Function</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>mbrtoc16()</code></td>
<td>Convert a multibyte character to a <code>char16_t</code> character.</td>
</tr>
<tr class="even">
<td><code>mbrtoc32()</code></td>
<td>Convert a multibyte character to a <code>char32_t</code> character.</td>
</tr>
<tr class="odd">
<td><code>c16rtomb()</code></td>
<td>Convert a <code>char16_t</code> character to a multibyte character.</td>
</tr>
<tr class="even">
<td><code>c32rtomb()</code></td>
<td>Convert a <code>char32_t</code> character to a multibyte character.</td>
</tr>
</tbody>
</table>
<h3 data-number="27.11.4" id="utf-3rd-party"><span class="header-section-number">27.11.4</span> Third-Party Libraries</h3>
<p>For heavy-duty conversion between different specific encodings, there are a couple mature libraries worth checking out. Note that I haven’t used either of these.</p>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Iconv">iconv</a><a href="https://beej.us/guide/bgc/html/index-wide.html#fn167" class="footnote-ref" id="fnref167" role="doc-noteref"><sup>167</sup></a>—Internationalization Conversion, a common POSIX-standard API available on the major platforms.</li>
<li><a href="http://site.icu-project.org/">ICU</a><a href="https://beej.us/guide/bgc/html/index-wide.html#fn168" class="footnote-ref" id="fnref168" role="doc-noteref"><sup>168</sup></a>—International Components for Unicode. At least one blogger found this easy to use.</li>
</ul>
<p>If you have more noteworthy libraries, let me know.</p>
<p></p>
<!-- Beej's guide to C

# vim: ts=4:sw=4:nosi:et:tw=72
-->
<h1 data-number="28" id="exiting-a-program"><span class="header-section-number">28</span> Exiting a Program</h1>
<p></p>
<p>Turns out there are a lot of ways to do this, and even ways to set up “hooks” so that a function runs when a program exits.</p>
<p>In this chapter we’ll dive in and check them out.</p>
<p>We already covered the meaning of the exit status code in the <a href="https://beej.us/guide/bgc/html/index-wide.html#exit-status">Exit Status</a> section, so jump back there and review if you have to.</p>
<p>All the functions in this section are in <code>&lt;stdlib.h&gt;</code>.</p>
<h2 data-number="28.1" id="normal-exits"><span class="header-section-number">28.1</span> Normal Exits</h2>
<p>We’ll start with the regular ways to exit a program, and then jump to some of the rarer, more esoteric ones.</p>
<p>When you exit a program normally, all open I/O streams are flushed and temporary files removed. Basically it’s a nice exit where everything gets cleaned up and handled. It’s what you want to do almost all the time unless you have reasons to do otherwise.</p>
<h3 data-number="28.1.1" id="returning-from-main"><span class="header-section-number">28.1.1</span> Returning From <code>main()</code></h3>
<p></p>
<p>If you’ve noticed, <code>main()</code> has a return type of <code>int</code>… and yet I’ve rarely, if ever, been <code>return</code>ing anything from <code>main()</code> at all.</p>
<p>This is because for <code>main()</code> only (and I can’t stress enough this special case <em>only</em> applies to <code>main()</code> and no other functions anywhere) has an <em>implicit</em> <code>return 0</code> if you fall off the end.</p>
<p>You can explicitly <code>return</code> from <code>main()</code> any time you want, and some programmers feel it’s more <em>Right</em> to always have a <code>return</code> at the end of <code>main()</code>. But if you leave it off, C will put one there for you.</p>
<p>So… here are the <code>return</code> rules for <code>main()</code>:</p>
<ul>
<li>You can return an exit status from <code>main()</code> with a <code>return</code> statement. <code>main()</code> is the only function with this special behavior. Using <code>return</code> in any other function just returns from that function to the caller.</li>
<li>If you don’t explicitly <code>return</code> and just fall off the end of <code>main()</code>, it’s just as if you’d returned <code>0</code> or <code>EXIT_SUCCESS</code>.</li>
</ul>
<p></p>
<h3 data-number="28.1.2" id="exit"><span class="header-section-number">28.1.2</span> <code>exit()</code></h3>
<p></p>
<p>This one has also made an appearance a few times. If you call <code>exit()</code> from anywhere in your program, it will exit at that point.</p>
<p>The argument you pass to <code>exit()</code> is the exit status.</p>
<h3 data-number="28.1.3" id="setting-up-exit-handlers-with-atexit"><span class="header-section-number">28.1.3</span> Setting Up Exit Handlers with <code>atexit()</code></h3>
<p></p>
<p>You can register functions to be called when a program exits whether by returning from <code>main()</code> or calling the <code>exit()</code> function.</p>
<p>A call to <code>atexit()</code> with the handler function name will get it done. You can register multiple exit handlers, and they’ll be called in the reverse order of registration.</p>
<p>Here’s an example:</p>
<div class="sourceCode" id="cb550"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb550-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb550-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb550-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb550-2"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb550-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb550-3"></a></span>
<span id="cb550-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb550-4"></a><span class="dt">void</span> on_exit_1<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb550-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb550-5"></a><span class="op">{</span></span>
<span id="cb550-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb550-6"></a>    printf<span class="op">(</span><span class="st">"Exit handler 1 called!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb550-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb550-7"></a><span class="op">}</span></span>
<span id="cb550-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb550-8"></a></span>
<span id="cb550-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb550-9"></a><span class="dt">void</span> on_exit_2<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb550-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb550-10"></a><span class="op">{</span></span>
<span id="cb550-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb550-11"></a>    printf<span class="op">(</span><span class="st">"Exit handler 2 called!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb550-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb550-12"></a><span class="op">}</span></span>
<span id="cb550-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb550-13"></a></span>
<span id="cb550-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb550-14"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb550-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb550-15"></a><span class="op">{</span></span>
<span id="cb550-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb550-16"></a>    atexit<span class="op">(</span>on_exit_1<span class="op">);</span></span>
<span id="cb550-17"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb550-17"></a>    atexit<span class="op">(</span>on_exit_2<span class="op">);</span></span>
<span id="cb550-18"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb550-18"></a>    </span>
<span id="cb550-19"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb550-19"></a>    printf<span class="op">(</span><span class="st">"About to exit...</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb550-20"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb550-20"></a><span class="op">}</span></span></code></pre></div>
<p>And the output is:</p>
<div class="sourceCode" id="cb551"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb551-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb551-1" aria-hidden="true" tabindex="-1"></a>About to exit...</span>
<span id="cb551-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb551-2" aria-hidden="true" tabindex="-1"></a>Exit handler 2 called!</span>
<span id="cb551-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb551-3" aria-hidden="true" tabindex="-1"></a>Exit handler 1 called!</span></code></pre></div>
<p></p>
<h2 data-number="28.2" id="quicker-exits-with-quick_exit"><span class="header-section-number">28.2</span> Quicker Exits with <code>quick_exit()</code></h2>
<p></p>
<p>This is similar to a normal exit, except:</p>
<ul>
<li>Open files might not be flushed.</li>
<li>Temporary files might not be removed.</li>
<li><code>atexit()</code> handlers won’t be called.</li>
</ul>
<p>But there is a way to register exit handlers: call <code>at_quick_exit()</code> analogously to how you’d call <code>atexit()</code>.</p>
<div class="sourceCode" id="cb552"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb552-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb552-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb552-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb552-2"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb552-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb552-3"></a></span>
<span id="cb552-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb552-4"></a><span class="dt">void</span> on_quick_exit_1<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb552-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb552-5"></a><span class="op">{</span></span>
<span id="cb552-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb552-6"></a>    printf<span class="op">(</span><span class="st">"Quick exit handler 1 called!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb552-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb552-7"></a><span class="op">}</span></span>
<span id="cb552-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb552-8"></a></span>
<span id="cb552-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb552-9"></a><span class="dt">void</span> on_quick_exit_2<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb552-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb552-10"></a><span class="op">{</span></span>
<span id="cb552-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb552-11"></a>    printf<span class="op">(</span><span class="st">"Quick exit handler 2 called!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb552-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb552-12"></a><span class="op">}</span></span>
<span id="cb552-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb552-13"></a></span>
<span id="cb552-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb552-14"></a><span class="dt">void</span> on_exit<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb552-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb552-15"></a><span class="op">{</span></span>
<span id="cb552-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb552-16"></a>    printf<span class="op">(</span><span class="st">"Normal exit--I won't be called!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb552-17"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb552-17"></a><span class="op">}</span></span>
<span id="cb552-18"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb552-18"></a></span>
<span id="cb552-19"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb552-19"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb552-20"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb552-20"></a><span class="op">{</span></span>
<span id="cb552-21"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb552-21"></a>    at_quick_exit<span class="op">(</span>on_quick_exit_1<span class="op">);</span></span>
<span id="cb552-22"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb552-22"></a>    at_quick_exit<span class="op">(</span>on_quick_exit_2<span class="op">);</span></span>
<span id="cb552-23"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb552-23"></a></span>
<span id="cb552-24"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb552-24"></a>    atexit<span class="op">(</span>on_exit<span class="op">);</span>  <span class="co">// This won't be called</span></span>
<span id="cb552-25"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb552-25"></a></span>
<span id="cb552-26"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb552-26"></a>    printf<span class="op">(</span><span class="st">"About to quick exit...</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb552-27"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb552-27"></a></span>
<span id="cb552-28"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb552-28"></a>    quick_exit<span class="op">(</span><span class="dv">0</span><span class="op">);</span></span>
<span id="cb552-29"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb552-29"></a><span class="op">}</span></span></code></pre></div>
<p>Which gives this output:</p>
<div class="sourceCode" id="cb553"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb553-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb553-1" aria-hidden="true" tabindex="-1"></a>About to quick exit...</span>
<span id="cb553-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb553-2" aria-hidden="true" tabindex="-1"></a>Quick exit handler 2 called!</span>
<span id="cb553-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb553-3" aria-hidden="true" tabindex="-1"></a>Quick exit handler 1 called!</span></code></pre></div>
<p>It works just like <code>exit()</code>/<code>atexit()</code>, except for the fact that file flushing and cleanup might not be done.</p>
<p></p>
<h2 data-number="28.3" id="nuke-it-from-orbit-_exit"><span class="header-section-number">28.3</span> Nuke it from Orbit: <code>_Exit()</code></h2>
<p></p>
<p>Calling <code>_Exit()</code> exits immediately, period. No on-exit callback functions are executed. Files won’t be flushed. Temp files won’t be removed.</p>
<p>Use this if you have to exit <em>right fargin’ now</em>.</p>
<h2 data-number="28.4" id="exiting-sometimes-assert"><span class="header-section-number">28.4</span> Exiting Sometimes: <code>assert()</code></h2>
<p>The <code>assert()</code> statement is used to insist that something be true, or else the program will exit.</p>
<p>Devs often use an assert to catch Should-Never-Happen type errors.</p>
<div class="sourceCode" id="cb554"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb554-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb554-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#define PI </span><span class="fl">3.14159</span></span>
<span id="cb554-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb554-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb554-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb554-3" aria-hidden="true" tabindex="-1"></a>assert<span class="op">(</span>PI <span class="op">&gt;</span> <span class="dv">3</span><span class="op">);</span>   <span class="co">// Sure enough, it is, so carry on</span></span></code></pre></div>
<p>versus:</p>
<div class="sourceCode" id="cb555"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb555-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb555-1" aria-hidden="true" tabindex="-1"></a>goats <span class="op">-=</span> <span class="dv">100</span><span class="op">;</span></span>
<span id="cb555-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb555-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb555-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb555-3" aria-hidden="true" tabindex="-1"></a>assert<span class="op">(</span>goats <span class="op">&gt;=</span> <span class="dv">0</span><span class="op">);</span>  <span class="co">// Can't have negative goats</span></span></code></pre></div>
<p>In that case, if I try to run it and <code>goats</code> falls under <code>0</code>, this happens:</p>
<div class="sourceCode" id="cb556"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb556-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb556-1" aria-hidden="true" tabindex="-1"></a>goat_counter: goat_counter.c:8: main: Assertion `goats &gt;= 0' failed.</span>
<span id="cb556-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb556-2" aria-hidden="true" tabindex="-1"></a>Aborted</span></code></pre></div>
<p>and I’m dropped back to the command line.</p>
<p>This isn’t very user-friendly, so it’s only used for things the user will never see. And often people <a href="https://beej.us/guide/bgc/html/index-wide.html#my-assert">write their own assert macros that can more easily be turned off</a>.</p>
<p></p>
<h2 data-number="28.5" id="abnormal-exit-abort"><span class="header-section-number">28.5</span> Abnormal Exit: <code>abort()</code></h2>
<p></p>
<p>You can use this if something has gone horribly wrong and you want to indicate as much to the outside environment. This also won’t necessarily clean up any open files, etc.</p>
<p>I’ve rarely seen this used.</p>
<p>Some foreshadowing about <em>signals</em>: this actually works by raising a <code>SIGABRT</code> which will end the process.</p>
<p>What happens after that is up to the system, but on Unix-likes, it was common to <a href="https://en.wikipedia.org/wiki/Core_dump">dump core</a><a href="https://beej.us/guide/bgc/html/index-wide.html#fn169" class="footnote-ref" id="fnref169" role="doc-noteref"><sup>169</sup></a> as the program terminated.</p>
<p> </p>
<!-- Beej's guide to C

# vim: ts=4:sw=4:nosi:et:tw=72
-->
<h1 data-number="29" id="signal-handling"><span class="header-section-number">29</span> Signal Handling</h1>
<p></p>
<p>Before we start, I’m just going to advise you to generally ignore this entire chapter and use your OS’s (very likely) superior signal handling functions. Unix-likes have the <code>sigaction()</code> family of functions, and Windows has… whatever it does<a href="https://beej.us/guide/bgc/html/index-wide.html#fn170" class="footnote-ref" id="fnref170" role="doc-noteref"><sup>170</sup></a>.</p>
<p>With that out of the way, what are signals?</p>
<h2 data-number="29.1" id="what-are-signals"><span class="header-section-number">29.1</span> What Are Signals?</h2>
<p>A <em>signal</em> is <em>raised</em> on a variety of external events. Your program can be configured to be interrupted to <em>handle</em> the signal, and, optionally, continue where it left off once the signal has been handled.</p>
<p>Think of it like a function that’s automatically called when one of these external events occurs.</p>
<p>What are these events? On your system, there are probably a lot of them, but in the C spec there are just a few:</p>
<table>
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th>Signal</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>SIGABRT</code></td>
<td>Abnormal termination—what happens when <code>abort()</code> is called.</td>
</tr>
<tr class="even">
<td><code>SIGFPE</code></td>
<td>Floating point exception.</td>
</tr>
<tr class="odd">
<td><code>SIGILL</code></td>
<td>Illegal instruction.</td>
</tr>
<tr class="even">
<td><code>SIGINT</code></td>
<td>Interrupt—usually the result of <code>CTRL-C</code> being hit.</td>
</tr>
<tr class="odd">
<td><code>SIGSEGV</code></td>
<td>“Segmentation Violation”: invalid memory access.</td>
</tr>
<tr class="even">
<td><code>SIGTERM</code></td>
<td>Termination requested.</td>
</tr>
</tbody>
</table>
<p>You can set up your program to ignore, handle, or allow the default action for each of these by using the <code>signal()</code> function.</p>
<h2 data-number="29.2" id="handling-signals-with-signal"><span class="header-section-number">29.2</span> Handling Signals with <code>signal()</code></h2>
<p></p>
<p>The <code>signal()</code> call takes two parameters: the signal in question, and an action to take when that signal is raised.</p>
<p>The action can be one of three things:</p>
<ul>
<li>A pointer to a handler function.</li>
<li><code>SIG_IGN</code> to ignore the signal.</li>
<li><code>SIG_DFL</code> to restore the default handler for the signal.</li>
</ul>
<p>Let’s write a program that you can’t <code>CTRL-C</code> out of. (Don’t fret—in the following program, you can also hit <code>RETURN</code> and it’ll exit.)</p>
<p></p>
<div class="sourceCode" id="cb557"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb557-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb557-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb557-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb557-2"></a><span class="pp">#include </span><span class="im">&lt;signal.h&gt;</span></span>
<span id="cb557-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb557-3"></a></span>
<span id="cb557-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb557-4"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb557-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb557-5"></a><span class="op">{</span></span>
<span id="cb557-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb557-6"></a>    <span class="dt">char</span> s<span class="op">[</span><span class="dv">1024</span><span class="op">];</span></span>
<span id="cb557-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb557-7"></a></span>
<span id="cb557-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb557-8"></a>    signal<span class="op">(</span>SIGINT<span class="op">,</span> SIG_IGN<span class="op">);</span>    <span class="co">// Ignore SIGINT, caused by ^C</span></span>
<span id="cb557-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb557-9"></a></span>
<span id="cb557-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb557-10"></a>    printf<span class="op">(</span><span class="st">"Try hitting ^C... (hit RETURN to exit)</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb557-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb557-11"></a></span>
<span id="cb557-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb557-12"></a>    <span class="co">// Wait for a line of input so the program doesn't just exit</span></span>
<span id="cb557-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb557-13"></a>    fgets<span class="op">(</span>s<span class="op">,</span> <span class="kw">sizeof</span> s<span class="op">,</span> stdin<span class="op">);</span></span>
<span id="cb557-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb557-14"></a><span class="op">}</span></span></code></pre></div>
<p>Check out line 8—we tell the program to ignore <code>SIGINT</code>, the interrupt signal that’s raised when <code>CTRL-C</code> is hit. No matter how much you hit it, the signal remains ignored. If you comment out line 8, you’ll see you can <code>CTRL-C</code> with impunity and quit the program on the spot.</p>
<p> </p>
<h2 data-number="29.3" id="writing-signal-handlers"><span class="header-section-number">29.3</span> Writing Signal Handlers</h2>
<p>I mentioned you could also write a handler function that gets called when the signal is raised.</p>
<p>These are pretty straightforward, are also very capability-limited when it comes to the spec.</p>
<p></p>
<p>Before we start, let’s look at the function prototype for the <code>signal()</code> call:</p>
<div class="sourceCode" id="cb558"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb558-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb558-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="op">(*</span>signal<span class="op">(</span><span class="dt">int</span> sig<span class="op">,</span> <span class="dt">void</span> <span class="op">(*</span>func<span class="op">)(</span><span class="dt">int</span><span class="op">)))(</span><span class="dt">int</span><span class="op">);</span></span></code></pre></div>
<p>Pretty easy to read, right?</p>
<p><em>WRONG!</em> <code>:)</code></p>
<p>Let’s take a moment to take it apart for practice.</p>
<p><code>signal()</code> takes two arguments: an integer <code>sig</code> representing the signal, and a pointer <code>func</code> to the handler (the handler returns <code>void</code> and takes an <code>int</code> as an argument), highlighted below:</p>
<div class="sourceCode" id="cb559"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb559-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb559-1" aria-hidden="true" tabindex="-1"></a>                sig          func</span>
<span id="cb559-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb559-2" aria-hidden="true" tabindex="-1"></a>              <span class="op">|-----|</span>  <span class="op">|---------------|</span></span>
<span id="cb559-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb559-3" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="op">(*</span>signal<span class="op">(</span><span class="dt">int</span> sig<span class="op">,</span> <span class="dt">void</span> <span class="op">(*</span>func<span class="op">)(</span><span class="dt">int</span><span class="op">)))(</span><span class="dt">int</span><span class="op">);</span></span></code></pre></div>
<p></p>
<p>Basically, we’re going to pass in the signal number we’re interested in catching, and we’re going to pass a pointer to a function of the form:</p>
<div class="sourceCode" id="cb560"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb560-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb560-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> f<span class="op">(</span><span class="dt">int</span> x<span class="op">);</span></span></code></pre></div>
<p>that will do the actual catching.</p>
<p>Now—what about the rest of that prototype? It’s basically all the return type. See, <code>signal()</code> will return whatever you passed as <code>func</code> on success… so that means it’s returning a pointer to a function that returns <code>void</code> and takes an <code>int</code> as an argument.</p>
<div class="sourceCode" id="cb561"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb561-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb561-1" aria-hidden="true" tabindex="-1"></a>returned</span>
<span id="cb561-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb561-2" aria-hidden="true" tabindex="-1"></a>function    indicates we<span class="ch">'r</span><span class="er">e              and</span></span>
<span id="cb561-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb561-3" aria-hidden="true" tabindex="-1"></a>returns     returning a                  that function</span>
<span id="cb561-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb561-4" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span>        pointer to function          takes an <span class="dt">int</span></span>
<span id="cb561-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb561-5" aria-hidden="true" tabindex="-1"></a><span class="op">|--|</span>        <span class="op">|</span>                                   <span class="op">|---|</span></span>
<span id="cb561-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb561-6" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span>       <span class="op">(*</span>signal<span class="op">(</span><span class="dt">int</span> sig<span class="op">,</span> <span class="dt">void</span> <span class="op">(*</span>func<span class="op">)(</span><span class="dt">int</span><span class="op">)))(</span><span class="dt">int</span><span class="op">);</span></span></code></pre></div>
<p>Also, it can return <code>SIG_ERR</code> in case of an error.</p>
<p>Let’s do an example where we make it so you have to hit <code>CTRL-C</code> twice to exit.</p>
<p>I want to be clear that this program engages in undefined behavior in a couple ways. But it’ll probably work for you, and it’s hard to come up with portable non-trivial demos.</p>
<p> </p>
<div class="sourceCode" id="cb562"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb562-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb562-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb562-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb562-2"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb562-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb562-3"></a><span class="pp">#include </span><span class="im">&lt;signal.h&gt;</span></span>
<span id="cb562-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb562-4"></a></span>
<span id="cb562-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb562-5"></a><span class="dt">int</span> count <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb562-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb562-6"></a></span>
<span id="cb562-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb562-7"></a><span class="dt">void</span> sigint_handler<span class="op">(</span><span class="dt">int</span> signum<span class="op">)</span></span>
<span id="cb562-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb562-8"></a><span class="op">{</span></span>
<span id="cb562-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb562-9"></a>    <span class="co">// The compiler is allowed to run:</span></span>
<span id="cb562-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb562-10"></a>    <span class="co">//</span></span>
<span id="cb562-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb562-11"></a>    <span class="co">//   signal(signum, SIG_DFL)</span></span>
<span id="cb562-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb562-12"></a>    <span class="co">//</span></span>
<span id="cb562-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb562-13"></a>    <span class="co">// when the handler is called. So we reset the handler here:</span></span>
<span id="cb562-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb562-14"></a>    signal<span class="op">(</span>SIGINT<span class="op">,</span> sigint_handler<span class="op">);</span></span>
<span id="cb562-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb562-15"></a></span>
<span id="cb562-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb562-16"></a>    <span class="op">(</span><span class="dt">void</span><span class="op">)</span>signum<span class="op">;</span>   <span class="co">// Get rid of unused variable warning</span></span>
<span id="cb562-17"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb562-17"></a></span>
<span id="cb562-18"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb562-18"></a>    count<span class="op">++;</span>                       <span class="co">// Undefined behavior</span></span>
<span id="cb562-19"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb562-19"></a>    printf<span class="op">(</span><span class="st">"Count: </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> count<span class="op">);</span>  <span class="co">// Undefined behavior</span></span>
<span id="cb562-20"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb562-20"></a></span>
<span id="cb562-21"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb562-21"></a>    <span class="cf">if</span> <span class="op">(</span>count <span class="op">==</span> <span class="dv">2</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb562-22"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb562-22"></a>        printf<span class="op">(</span><span class="st">"Exiting!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span>      <span class="co">// Undefined behavior</span></span>
<span id="cb562-23"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb562-23"></a>        exit<span class="op">(</span><span class="dv">0</span><span class="op">);</span></span>
<span id="cb562-24"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb562-24"></a>    <span class="op">}</span></span>
<span id="cb562-25"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb562-25"></a><span class="op">}</span></span>
<span id="cb562-26"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb562-26"></a></span>
<span id="cb562-27"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb562-27"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb562-28"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb562-28"></a><span class="op">{</span></span>
<span id="cb562-29"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb562-29"></a>    signal<span class="op">(</span>SIGINT<span class="op">,</span> sigint_handler<span class="op">);</span></span>
<span id="cb562-30"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb562-30"></a></span>
<span id="cb562-31"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb562-31"></a>    printf<span class="op">(</span><span class="st">"Try hitting ^C...</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb562-32"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb562-32"></a></span>
<span id="cb562-33"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb562-33"></a>    <span class="cf">for</span><span class="op">(;;);</span>  <span class="co">// Wait here forever</span></span>
<span id="cb562-34"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb562-34"></a><span class="op">}</span></span></code></pre></div>
<p></p>
<p>One of the things you’ll notice is that on line 14 we reset the signal handler. This is because C has the option of resetting the signal handler to its <code>SIG_DFL</code> behavior before running your custom handler. In other words, it could be a one-off. So we reset it first thing so that we handle it again for the next one.</p>
<p>We’re ignoring the return value from <code>signal()</code> in this case. If we’d set it to a different handler earlier, it would return a pointer to that handler, which we could get like this:</p>
<div class="sourceCode" id="cb563"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb563-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb563-1" aria-hidden="true" tabindex="-1"></a><span class="co">// old_handler is type "pointer to function that takes a single</span></span>
<span id="cb563-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb563-2" aria-hidden="true" tabindex="-1"></a><span class="co">// int parameter and returns void":</span></span>
<span id="cb563-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb563-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb563-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb563-4" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="op">(*</span>old_handler<span class="op">)(</span><span class="dt">int</span><span class="op">);</span></span>
<span id="cb563-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb563-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb563-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb563-6" aria-hidden="true" tabindex="-1"></a>old_handler <span class="op">=</span> signal<span class="op">(</span>SIGINT<span class="op">,</span> sigint_handler<span class="op">);</span></span></code></pre></div>
<p></p>
<p>That said, I’m not sure of a common use case for this. But if you need the old handler for some reason, you can get it that way.</p>
<p>Quick note on line 16—that’s just to tell the compiler to not warn that we’re not using this variable. It’s like saying, “I know I’m not using it; you don’t have to warn me.”</p>
<p>And lastly you’ll see that I’ve marked undefined behavior in a couple places. More on that in the next section.</p>
<h2 data-number="29.4" id="what-can-we-actually-do"><span class="header-section-number">29.4</span> What Can We Actually Do?</h2>
<p>Turns out we’re pretty limited in what we can and can’t do in our signal handlers. This is one of the reasons why I say you shouldn’t even bother with this and instead use your OS’s signal handling instead (e.g. <code>sigaction()</code> for Unix-like systems).</p>
<p>Wikipedia goes so far as to say the only really portable thing you can do is call <code>signal()</code> with <code>SIG_IGN</code> or <code>SIG_DFL</code> and that’s it.</p>
<p>Here’s what we <strong>can’t</strong> portably do:</p>
<p></p>
<ul>
<li>Call any standard library function.
<ul>
<li>Like <code>printf()</code>, for example.</li>
<li>I think it’s probably safe to call restartable/reentrant functions, but the spec doesn’t allow that liberty.</li>
</ul></li>
<li>Get or set values from a local <code>static</code>, file scope, or thread-local variable.
<ul>
<li>Unless it’s a lock-free atomic object or…</li>
<li>You’re assigning into a variable of type <code>volatile sig_atomic_t</code>.</li>
</ul></li>
</ul>
<p></p>
<p>That last bit–<code>sig_atomic_t</code>–is your ticket to getting data out of a signal handler. (Unless you want to use lock-free atomic objects, which is outside the scope of this section<a href="https://beej.us/guide/bgc/html/index-wide.html#fn171" class="footnote-ref" id="fnref171" role="doc-noteref"><sup>171</sup></a>.) It’s an integer type that might or might not be signed. And it’s bounded by what you can put in there.</p>
<p>You can look at the minimum and maximum allowable values in the macros <code>SIG_ATOMIC_MIN</code> and <code>SIG_ATOMIC_MAX</code><a href="https://beej.us/guide/bgc/html/index-wide.html#fn172" class="footnote-ref" id="fnref172" role="doc-noteref"><sup>172</sup></a>.</p>
<p>Confusingly, the spec also says you can’t refer “to any object with static or thread storage duration that is not a lock-free atomic object other than by assigning a value to an object declared as <code>volatile sig_atomic_t</code> […]”</p>
<p>My read on this is that you can’t read or write anything that’s not a lock-free atomic object. Also you can assign to an object that’s <code>volatile sig_atomic_t</code>.</p>
<p>But can you read from it? I honestly don’t see why not, except that the spec is very pointed about mentioning assigning into. But if you have to read it and make any kind of decision based on it, you might be opening up room for some kind of race conditions.</p>
<p></p>
<p>With that in mind, we can rewrite our “hit <code>CTRL-C</code> twice to exit” code to be a little more portable, albeit less verbose on the output.</p>
<p>Let’s change our <code>SIGINT</code> handler to do nothing except increment a value that’s of type <code>volatile sig_atomic_t</code>. So it’ll count the number of <code>CTRL-C</code>s that have been hit.</p>
<p>Then in our main loop, we’ll check to see if that counter is over <code>2</code>, then bail out if it is.</p>
<div class="sourceCode" id="cb564"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb564-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb564-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb564-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb564-2"></a><span class="pp">#include </span><span class="im">&lt;signal.h&gt;</span></span>
<span id="cb564-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb564-3"></a></span>
<span id="cb564-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb564-4"></a><span class="dt">volatile</span> <span class="dt">sig_atomic_t</span> count <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb564-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb564-5"></a></span>
<span id="cb564-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb564-6"></a><span class="dt">void</span> sigint_handler<span class="op">(</span><span class="dt">int</span> signum<span class="op">)</span></span>
<span id="cb564-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb564-7"></a><span class="op">{</span></span>
<span id="cb564-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb564-8"></a>    <span class="op">(</span><span class="dt">void</span><span class="op">)</span>signum<span class="op">;</span>                    <span class="co">// Unused variable warning</span></span>
<span id="cb564-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb564-9"></a></span>
<span id="cb564-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb564-10"></a>    signal<span class="op">(</span>SIGINT<span class="op">,</span> sigint_handler<span class="op">);</span>  <span class="co">// Reset signal handler</span></span>
<span id="cb564-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb564-11"></a></span>
<span id="cb564-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb564-12"></a>    count<span class="op">++;</span>                         <span class="co">// Undefined behavior</span></span>
<span id="cb564-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb564-13"></a><span class="op">}</span></span>
<span id="cb564-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb564-14"></a></span>
<span id="cb564-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb564-15"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb564-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb564-16"></a><span class="op">{</span></span>
<span id="cb564-17"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb564-17"></a>    signal<span class="op">(</span>SIGINT<span class="op">,</span> sigint_handler<span class="op">);</span></span>
<span id="cb564-18"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb564-18"></a></span>
<span id="cb564-19"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb564-19"></a>    printf<span class="op">(</span><span class="st">"Hit ^C twice to exit.</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb564-20"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb564-20"></a></span>
<span id="cb564-21"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb564-21"></a>    <span class="cf">while</span><span class="op">(</span>count <span class="op">&lt;</span> <span class="dv">2</span><span class="op">);</span></span>
<span id="cb564-22"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb564-22"></a><span class="op">}</span></span></code></pre></div>
<p></p>
<p>Undefined behavior again? It’s my read that this is, because we have to read the value in order to increment and store it.</p>
<p>If we only want to postpone the exit by one hitting of <code>CTRL-C</code>, we can do that without too much trouble. But any more postponement would require some ridiculous function chaining.</p>
<p>What we’ll do is handle it once, and the handler will reset the signal to its default behavior (that is, to exit):</p>
<p></p>
<div class="sourceCode" id="cb565"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb565-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb565-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb565-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb565-2"></a><span class="pp">#include </span><span class="im">&lt;signal.h&gt;</span></span>
<span id="cb565-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb565-3"></a></span>
<span id="cb565-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb565-4"></a><span class="dt">void</span> sigint_handler<span class="op">(</span><span class="dt">int</span> signum<span class="op">)</span></span>
<span id="cb565-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb565-5"></a><span class="op">{</span></span>
<span id="cb565-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb565-6"></a>    <span class="op">(</span><span class="dt">void</span><span class="op">)</span>signum<span class="op">;</span>                      <span class="co">// Unused variable warning</span></span>
<span id="cb565-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb565-7"></a>    signal<span class="op">(</span>SIGINT<span class="op">,</span> SIG_DFL<span class="op">);</span>           <span class="co">// Reset signal handler</span></span>
<span id="cb565-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb565-8"></a><span class="op">}</span></span>
<span id="cb565-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb565-9"></a></span>
<span id="cb565-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb565-10"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb565-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb565-11"></a><span class="op">{</span></span>
<span id="cb565-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb565-12"></a>    signal<span class="op">(</span>SIGINT<span class="op">,</span> sigint_handler<span class="op">);</span></span>
<span id="cb565-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb565-13"></a></span>
<span id="cb565-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb565-14"></a>    printf<span class="op">(</span><span class="st">"Hit ^C twice to exit.</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb565-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb565-15"></a></span>
<span id="cb565-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb565-16"></a>    <span class="cf">while</span><span class="op">(</span><span class="dv">1</span><span class="op">);</span></span>
<span id="cb565-17"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb565-17"></a><span class="op">}</span></span></code></pre></div>
<p></p>
<p>Later when we look at lock-free atomic variables, we’ll see a way to fix the <code>count</code> version (assuming lock-free atomic variables are available on your particular system).</p>
<p>This is why at the beginning, I was suggesting checking out your OS’s built-in signal system as a probably-superior alternative.</p>
<h2 data-number="29.5" id="friends-dont-let-friends-signal"><span class="header-section-number">29.5</span> Friends Don’t Let Friends <code>signal()</code></h2>
<p>Again, use your OS’s built-in signal handling or the equivalent. It’s not in the spec, not as portable, but probably is far more capable. Plus your OS probably has a number of signals defined that aren’t in the C spec. And it’s difficult to write portable code using <code>signal()</code> anyway.</p>
<p> </p>
<!-- Beej's guide to C

# vim: ts=4:sw=4:nosi:et:tw=72
-->
<h1 data-number="30" id="variable-length-arrays-vlas"><span class="header-section-number">30</span> Variable-Length Arrays (VLAs)</h1>
<p></p>
<p>C provides a way for you to declare an array whose size is determined at runtime. This gives you the benefits of dynamic runtime sizing like you get with <code>malloc()</code>, but without needing to worry about <code>free()</code>ing the memory after.</p>
<p>Now, a lot of people don’t like VLAs. They’ve been banned from the Linux kernel, for example. We’ll dig into more of that rationale <a href="https://beej.us/guide/bgc/html/index-wide.html#vla-general-issues">later</a>.</p>
<p></p>
<p>This is an optional feature of the language. The macro <code>__STDC_NO_VLA__</code> is set to <code>1</code> if VLAs are <em>not</em> present. (They were mandatory in C99, and then became optional in C11.)</p>
<div class="sourceCode" id="cb566"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb566-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb566-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#if __STDC_NO_VLA__ == 1</span></span>
<span id="cb566-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb566-2" aria-hidden="true" tabindex="-1"></a>   <span class="pp">#error Sorry, need VLAs for this program!</span></span>
<span id="cb566-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb566-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#endif</span></span></code></pre></div>
<p></p>
<p>But since neither GCC nor Clang bother to define this macro, you may get limited mileage from this.</p>
<p>Let’s dive in first with an example, and then we’ll look for the devil in the details.</p>
<h2 data-number="30.1" id="the-basics"><span class="header-section-number">30.1</span> The Basics</h2>
<p>A normal array is declared with a constant size, like this:</p>
<div class="sourceCode" id="cb567"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb567-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb567-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> v<span class="op">[</span><span class="dv">10</span><span class="op">];</span></span></code></pre></div>
<p></p>
<p>But with VLAs, we can use a size determined at runtime to set the array, like this:</p>
<div class="sourceCode" id="cb568"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb568-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb568-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> n <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb568-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb568-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> v<span class="op">[</span>n<span class="op">];</span></span></code></pre></div>
<p>Now, that looks like the same thing, and in many ways is, but this gives you the flexibility to compute the size you need, and then get an array of exactly that size.</p>
<p>Let’s ask the user to input the size of the array, and then store the index-times-10 in each of those array elements:</p>
<div class="sourceCode" id="cb569"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb569-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb569-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb569-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb569-2"></a></span>
<span id="cb569-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb569-3"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb569-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb569-4"></a><span class="op">{</span></span>
<span id="cb569-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb569-5"></a>    <span class="dt">int</span> n<span class="op">;</span></span>
<span id="cb569-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb569-6"></a></span>
<span id="cb569-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb569-7"></a>    printf<span class="op">(</span><span class="st">"Enter a number: "</span><span class="op">);</span> fflush<span class="op">(</span>stdout<span class="op">);</span></span>
<span id="cb569-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb569-8"></a>    scanf<span class="op">(</span><span class="st">" </span><span class="sc">%d</span><span class="st">"</span><span class="op">,</span> <span class="op">&amp;</span>n<span class="op">);</span></span>
<span id="cb569-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb569-9"></a></span>
<span id="cb569-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb569-10"></a>    <span class="dt">int</span> v<span class="op">[</span>n<span class="op">];</span></span>
<span id="cb569-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb569-11"></a></span>
<span id="cb569-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb569-12"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> n<span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb569-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb569-13"></a>        v<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> i <span class="op">*</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb569-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb569-14"></a></span>
<span id="cb569-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb569-15"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> n<span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb569-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb569-16"></a>        printf<span class="op">(</span><span class="st">"v[</span><span class="sc">%d</span><span class="st">] = </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> i<span class="op">,</span> v<span class="op">[</span>i<span class="op">]);</span></span>
<span id="cb569-17"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb569-17"></a><span class="op">}</span></span></code></pre></div>
<p>(On line 7, I have an <code>fflush()</code> that should force the line to output even though I don’t have a newline at the end.)</p>
<p>Line 10 is where we declare the VLA—once execution gets past that line, the size of the array is set to whatever <code>n</code> was at that moment. The array length can’t be changed later.</p>
<p>You can put an expression in the brackets, as well:</p>
<div class="sourceCode" id="cb570"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb570-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb570-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> v<span class="op">[</span>x <span class="op">*</span> <span class="dv">100</span><span class="op">];</span></span></code></pre></div>
<p>Some restrictions:</p>
<ul>
<li>You can’t declare a VLA at file scope, and you can’t make a <code>static</code> one in block scope<a href="https://beej.us/guide/bgc/html/index-wide.html#fn173" class="footnote-ref" id="fnref173" role="doc-noteref"><sup>173</sup></a>.</li>
<li>You can’t use an initializer list to initialize the array.</li>
</ul>
<p>Also, entering a negative value for the size of the array invokes undefined behavior—in this universe, anyway.</p>
<p></p>
<h2 data-number="30.2" id="sizeof-and-vlas"><span class="header-section-number">30.2</span> <code>sizeof</code> and VLAs</h2>
<p></p>
<p>We’re used to <code>sizeof</code> giving us the size in bytes of any particular object, including arrays. And VLAs are no exception.</p>
<p>The main difference is that <code>sizeof</code> on a VLA is executed at <em>runtime</em>, whereas on a non-variably-sized variable it is computed at <em>compile time</em>.</p>
<p>But the usage is the same.</p>
<p>You can even compute the number of elements in a VLA with the usual array trick:</p>
<div class="sourceCode" id="cb571"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb571-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb571-1" aria-hidden="true" tabindex="-1"></a><span class="dt">size_t</span> num_elems <span class="op">=</span> <span class="kw">sizeof</span> v <span class="op">/</span> <span class="kw">sizeof</span> v<span class="op">[</span><span class="dv">0</span><span class="op">];</span></span></code></pre></div>
<p>There’s a subtle and correct implication from the above line: pointer arithmetic works just like you’d expect for a regular array. So go ahead and use it to your heart’s content:</p>
<div class="sourceCode" id="cb572"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb572-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb572-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb572-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb572-2"></a></span>
<span id="cb572-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb572-3"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb572-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb572-4"></a><span class="op">{</span></span>
<span id="cb572-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb572-5"></a>    <span class="dt">int</span> n <span class="op">=</span> <span class="dv">5</span><span class="op">;</span></span>
<span id="cb572-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb572-6"></a>    <span class="dt">int</span> v<span class="op">[</span>n<span class="op">];</span></span>
<span id="cb572-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb572-7"></a></span>
<span id="cb572-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb572-8"></a>    <span class="dt">int</span> <span class="op">*</span>p <span class="op">=</span> v<span class="op">;</span></span>
<span id="cb572-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb572-9"></a></span>
<span id="cb572-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb572-10"></a>    <span class="op">*(</span>p<span class="op">+</span><span class="dv">2</span><span class="op">)</span> <span class="op">=</span> <span class="dv">12</span><span class="op">;</span></span>
<span id="cb572-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb572-11"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> v<span class="op">[</span><span class="dv">2</span><span class="op">]);</span>  <span class="co">// 12</span></span>
<span id="cb572-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb572-12"></a></span>
<span id="cb572-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb572-13"></a>    p<span class="op">[</span><span class="dv">3</span><span class="op">]</span> <span class="op">=</span> <span class="dv">34</span><span class="op">;</span></span>
<span id="cb572-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb572-14"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> v<span class="op">[</span><span class="dv">3</span><span class="op">]);</span>  <span class="co">// 34</span></span>
<span id="cb572-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb572-15"></a><span class="op">}</span></span></code></pre></div>
<p>Like with regular arrays, you can use parentheses with <code>sizeof()</code> to get the size of a would-be VLA without actually declaring one:</p>
<div class="sourceCode" id="cb573"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb573-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb573-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> x <span class="op">=</span> <span class="dv">12</span><span class="op">;</span></span>
<span id="cb573-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb573-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb573-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb573-3" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">%zu\n</span><span class="st">"</span><span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span><span class="dt">int</span> <span class="op">[</span>x<span class="op">]));</span>  <span class="co">// Prints 48 on my system</span></span></code></pre></div>
<p></p>
<h2 data-number="30.3" id="multidimensional-vlas"><span class="header-section-number">30.3</span> Multidimensional VLAs</h2>
<p></p>
<p>You can go ahead and make all kinds of VLAs with one or more dimensions set to a variable</p>
<div class="sourceCode" id="cb574"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb574-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb574-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> w <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb574-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb574-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> h <span class="op">=</span> <span class="dv">20</span><span class="op">;</span></span>
<span id="cb574-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb574-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb574-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb574-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> x<span class="op">[</span>h<span class="op">][</span>w<span class="op">];</span></span>
<span id="cb574-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb574-5" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> y<span class="op">[</span><span class="dv">5</span><span class="op">][</span>w<span class="op">];</span></span>
<span id="cb574-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb574-6" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> z<span class="op">[</span><span class="dv">10</span><span class="op">][</span>w<span class="op">][</span><span class="dv">20</span><span class="op">];</span></span></code></pre></div>
<p>Again, you can navigate these just like you would a regular array.</p>
<p></p>
<h2 data-number="30.4" id="passing-one-dimensional-vlas-to-functions"><span class="header-section-number">30.4</span> Passing One-Dimensional VLAs to Functions</h2>
<p></p>
<p>Passing single-dimensional VLAs into a function can be no different than passing a regular array in. You just go for it.</p>
<div class="sourceCode" id="cb575"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb575-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb575-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb575-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb575-2"></a></span>
<span id="cb575-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb575-3"></a><span class="dt">int</span> sum<span class="op">(</span><span class="dt">int</span> count<span class="op">,</span> <span class="dt">int</span> <span class="op">*</span>v<span class="op">)</span></span>
<span id="cb575-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb575-4"></a><span class="op">{</span></span>
<span id="cb575-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb575-5"></a>    <span class="dt">int</span> total <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb575-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb575-6"></a></span>
<span id="cb575-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb575-7"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> count<span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb575-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb575-8"></a>        total <span class="op">+=</span> v<span class="op">[</span>i<span class="op">];</span></span>
<span id="cb575-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb575-9"></a></span>
<span id="cb575-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb575-10"></a>    <span class="cf">return</span> total<span class="op">;</span></span>
<span id="cb575-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb575-11"></a><span class="op">}</span></span>
<span id="cb575-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb575-12"></a></span>
<span id="cb575-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb575-13"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb575-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb575-14"></a><span class="op">{</span></span>
<span id="cb575-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb575-15"></a>    <span class="dt">int</span> x<span class="op">[</span><span class="dv">5</span><span class="op">];</span>   <span class="co">// Standard array</span></span>
<span id="cb575-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb575-16"></a></span>
<span id="cb575-17"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb575-17"></a>    <span class="dt">int</span> a <span class="op">=</span> <span class="dv">5</span><span class="op">;</span></span>
<span id="cb575-18"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb575-18"></a>    <span class="dt">int</span> y<span class="op">[</span>a<span class="op">];</span>   <span class="co">// VLA</span></span>
<span id="cb575-19"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb575-19"></a></span>
<span id="cb575-20"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb575-20"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> a<span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb575-21"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb575-21"></a>        x<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> y<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> i <span class="op">+</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb575-22"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb575-22"></a></span>
<span id="cb575-23"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb575-23"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> sum<span class="op">(</span><span class="dv">5</span><span class="op">,</span> x<span class="op">));</span></span>
<span id="cb575-24"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb575-24"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> sum<span class="op">(</span>a<span class="op">,</span> y<span class="op">));</span></span>
<span id="cb575-25"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb575-25"></a><span class="op">}</span></span></code></pre></div>
<p>But there’s a bit more to it than that. You can also let C know that the array is a specific VLA size by passing that in first and then giving that dimension in the parameter list:</p>
<div class="sourceCode" id="cb576"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb576-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb576-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> sum<span class="op">(</span><span class="dt">int</span> count<span class="op">,</span> <span class="dt">int</span> v<span class="op">[</span>count<span class="op">])</span></span>
<span id="cb576-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb576-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb576-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb576-3" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ...</span></span>
<span id="cb576-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb576-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p> </p>
<p>Incidentally, there are a couple ways of listing a prototype for the above function; one of them involves an <code>*</code> if you don’t want to specifically name the value in the VLA. It just indicates that the type is a VLA as opposed to a regular pointer.</p>
<p>VLA prototypes:</p>
<div class="sourceCode" id="cb577"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb577-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb577-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> do_something<span class="op">(</span><span class="dt">int</span> count<span class="op">,</span> <span class="dt">int</span> v<span class="op">[</span>count<span class="op">]);</span>  <span class="co">// With names</span></span>
<span id="cb577-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb577-2" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> do_something<span class="op">(</span><span class="dt">int</span><span class="op">,</span> <span class="dt">int</span> v<span class="op">[*]);</span>            <span class="co">// Without names</span></span></code></pre></div>
<p>Again, that <code>*</code> thing only works with the prototype—in the function itself, you’ll have to put the explicit size.</p>
<p> </p>
<p>Now—<em>let’s get multidimensional</em>! This is where the fun begins.</p>
<h2 data-number="30.5" id="passing-multi-dimensional-vlas-to-functions"><span class="header-section-number">30.5</span> Passing Multi-Dimensional VLAs to Functions</h2>
<p>Same thing as we did with the second form of one-dimensional VLAs, above, but this time we’re passing in two dimensions and using those.</p>
<p>In the following example, we build a multiplication table matrix of a variable width and height, and then pass it to a function to print it out.</p>
<div class="sourceCode" id="cb578"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb578-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb578-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb578-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb578-2"></a></span>
<span id="cb578-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb578-3"></a><span class="dt">void</span> print_matrix<span class="op">(</span><span class="dt">int</span> h<span class="op">,</span> <span class="dt">int</span> w<span class="op">,</span> <span class="dt">int</span> m<span class="op">[</span>h<span class="op">][</span>w<span class="op">])</span></span>
<span id="cb578-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb578-4"></a><span class="op">{</span></span>
<span id="cb578-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb578-5"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> row <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> row <span class="op">&lt;</span> h<span class="op">;</span> row<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb578-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb578-6"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> col <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> col <span class="op">&lt;</span> w<span class="op">;</span> col<span class="op">++)</span></span>
<span id="cb578-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb578-7"></a>            printf<span class="op">(</span><span class="st">"</span><span class="sc">%2d</span><span class="st"> "</span><span class="op">,</span> m<span class="op">[</span>row<span class="op">][</span>col<span class="op">]);</span></span>
<span id="cb578-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb578-8"></a>        printf<span class="op">(</span><span class="st">"</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb578-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb578-9"></a>    <span class="op">}</span></span>
<span id="cb578-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb578-10"></a><span class="op">}</span></span>
<span id="cb578-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb578-11"></a></span>
<span id="cb578-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb578-12"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb578-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb578-13"></a><span class="op">{</span></span>
<span id="cb578-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb578-14"></a>    <span class="dt">int</span> rows <span class="op">=</span> <span class="dv">4</span><span class="op">;</span></span>
<span id="cb578-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb578-15"></a>    <span class="dt">int</span> cols <span class="op">=</span> <span class="dv">7</span><span class="op">;</span></span>
<span id="cb578-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb578-16"></a></span>
<span id="cb578-17"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb578-17"></a>    <span class="dt">int</span> matrix<span class="op">[</span>rows<span class="op">][</span>cols<span class="op">];</span></span>
<span id="cb578-18"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb578-18"></a></span>
<span id="cb578-19"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb578-19"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> row <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> row <span class="op">&lt;</span> rows<span class="op">;</span> row<span class="op">++)</span></span>
<span id="cb578-20"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb578-20"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> col <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> col <span class="op">&lt;</span> cols<span class="op">;</span> col<span class="op">++)</span></span>
<span id="cb578-21"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb578-21"></a>            matrix<span class="op">[</span>row<span class="op">][</span>col<span class="op">]</span> <span class="op">=</span> row <span class="op">*</span> col<span class="op">;</span></span>
<span id="cb578-22"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb578-22"></a></span>
<span id="cb578-23"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb578-23"></a>    print_matrix<span class="op">(</span>rows<span class="op">,</span> cols<span class="op">,</span> matrix<span class="op">);</span></span>
<span id="cb578-24"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb578-24"></a><span class="op">}</span></span></code></pre></div>
<h3 data-number="30.5.1" id="partial-multidimensional-vlas"><span class="header-section-number">30.5.1</span> Partial Multidimensional VLAs</h3>
<p>You can have some of the dimensions fixed and some variable. Let’s say we have a record length fixed at 5 elements, but we don’t know how many records there are.</p>
<div class="sourceCode" id="cb579"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb579-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb579-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb579-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb579-2"></a></span>
<span id="cb579-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb579-3"></a><span class="dt">void</span> print_records<span class="op">(</span><span class="dt">int</span> count<span class="op">,</span> <span class="dt">int</span> record<span class="op">[</span>count<span class="op">][</span><span class="dv">5</span><span class="op">])</span></span>
<span id="cb579-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb579-4"></a><span class="op">{</span></span>
<span id="cb579-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb579-5"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> count<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb579-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb579-6"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> j <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> j <span class="op">&lt;</span> <span class="dv">5</span><span class="op">;</span> j<span class="op">++)</span></span>
<span id="cb579-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb579-7"></a>            printf<span class="op">(</span><span class="st">"</span><span class="sc">%2d</span><span class="st"> "</span><span class="op">,</span> record<span class="op">[</span>i<span class="op">][</span>j<span class="op">]);</span></span>
<span id="cb579-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb579-8"></a>        printf<span class="op">(</span><span class="st">"</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb579-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb579-9"></a>    <span class="op">}</span></span>
<span id="cb579-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb579-10"></a><span class="op">}</span></span>
<span id="cb579-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb579-11"></a></span>
<span id="cb579-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb579-12"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb579-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb579-13"></a><span class="op">{</span></span>
<span id="cb579-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb579-14"></a>    <span class="dt">int</span> rec_count <span class="op">=</span> <span class="dv">3</span><span class="op">;</span></span>
<span id="cb579-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb579-15"></a>    <span class="dt">int</span> records<span class="op">[</span>rec_count<span class="op">][</span><span class="dv">5</span><span class="op">];</span></span>
<span id="cb579-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb579-16"></a></span>
<span id="cb579-17"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb579-17"></a>    <span class="co">// Fill with some dummy data</span></span>
<span id="cb579-18"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb579-18"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> rec_count<span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb579-19"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb579-19"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> j <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> j <span class="op">&lt;</span> <span class="dv">5</span><span class="op">;</span> j<span class="op">++)</span></span>
<span id="cb579-20"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb579-20"></a>            records<span class="op">[</span>i<span class="op">][</span>j<span class="op">]</span> <span class="op">=</span> <span class="op">(</span>i<span class="op">+</span><span class="dv">1</span><span class="op">)*(</span>j<span class="op">+</span><span class="dv">2</span><span class="op">);</span></span>
<span id="cb579-21"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb579-21"></a></span>
<span id="cb579-22"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb579-22"></a>    print_records<span class="op">(</span>rec_count<span class="op">,</span> records<span class="op">);</span></span>
<span id="cb579-23"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb579-23"></a><span class="op">}</span></span></code></pre></div>
<p></p>
<h2 data-number="30.6" id="compatibility-with-regular-arrays"><span class="header-section-number">30.6</span> Compatibility with Regular Arrays</h2>
<p></p>
<p>Because VLAs are just like regular arrays in memory, it’s perfectly permissible to pass them interchangeably… as long as the dimensions match.</p>
<p>For example, if we have a function that specifically wants a <span class="math inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="46" style="font-size: 101.6%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c33"></mjx-c></mjx-mn><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-cD7"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="3"><mjx-c class="mjx-c35"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>3</mn><mo>×</mo><mn>5</mn></math></mjx-assistive-mml></mjx-container></span> array, we can still pass a VLA into it.</p>
<div class="sourceCode" id="cb580"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb580-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb580-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> foo<span class="op">(</span><span class="dt">int</span> m<span class="op">[</span><span class="dv">5</span><span class="op">][</span><span class="dv">3</span><span class="op">])</span> <span class="op">{...}</span></span>
<span id="cb580-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb580-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb580-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb580-3" aria-hidden="true" tabindex="-1"></a>\\ <span class="op">...</span></span>
<span id="cb580-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb580-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb580-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb580-5" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> w <span class="op">=</span> <span class="dv">3</span><span class="op">,</span> h <span class="op">=</span> <span class="dv">5</span><span class="op">;</span></span>
<span id="cb580-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb580-6" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> matrix<span class="op">[</span>h<span class="op">][</span>w<span class="op">];</span></span>
<span id="cb580-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb580-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb580-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb580-8" aria-hidden="true" tabindex="-1"></a>foo<span class="op">(</span>matrix<span class="op">);</span>   <span class="co">// OK!</span></span></code></pre></div>
<p>Likewise, if you have a VLA function, you can pass a regular array into it:</p>
<div class="sourceCode" id="cb581"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb581-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb581-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> foo<span class="op">(</span><span class="dt">int</span> h<span class="op">,</span> <span class="dt">int</span> w<span class="op">,</span> <span class="dt">int</span> m<span class="op">[</span>h<span class="op">][</span>w<span class="op">])</span> <span class="op">{...}</span></span>
<span id="cb581-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb581-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb581-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb581-3" aria-hidden="true" tabindex="-1"></a>\\ <span class="op">...</span></span>
<span id="cb581-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb581-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb581-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb581-5" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> matrix<span class="op">[</span><span class="dv">3</span><span class="op">][</span><span class="dv">5</span><span class="op">];</span></span>
<span id="cb581-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb581-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb581-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb581-7" aria-hidden="true" tabindex="-1"></a>foo<span class="op">(</span><span class="dv">3</span><span class="op">,</span> <span class="dv">5</span><span class="op">,</span> matrix<span class="op">);</span>   <span class="co">// OK!</span></span></code></pre></div>
<p>Beware, though: if your dimensions mismatch, you’re going to have some undefined behavior going on, likely.</p>
<p></p>
<h2 data-number="30.7" id="typedef-and-vlas"><span class="header-section-number">30.7</span> <code>typedef</code> and VLAs</h2>
<p></p>
<p>You can <code>typedef</code> a VLA, but the behavior might not be as you expect.</p>
<p>Basically, <code>typedef</code> makes a new type with the values as they existed the moment the <code>typedef</code> was executed.</p>
<p>So it’s not a <code>typedef</code> of a VLA so much as a new fixed size array type of the dimensions at the time.</p>
<div class="sourceCode" id="cb582"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb582-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb582-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb582-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb582-2"></a></span>
<span id="cb582-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb582-3"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb582-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb582-4"></a><span class="op">{</span></span>
<span id="cb582-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb582-5"></a>    <span class="dt">int</span> w <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb582-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb582-6"></a></span>
<span id="cb582-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb582-7"></a>    <span class="kw">typedef</span> <span class="dt">int</span> goat<span class="op">[</span>w<span class="op">];</span></span>
<span id="cb582-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb582-8"></a></span>
<span id="cb582-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb582-9"></a>    <span class="co">// goat is an array of 10 ints</span></span>
<span id="cb582-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb582-10"></a>    goat x<span class="op">;</span></span>
<span id="cb582-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb582-11"></a></span>
<span id="cb582-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb582-12"></a>    <span class="co">// Init with squares of numbers</span></span>
<span id="cb582-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb582-13"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> w<span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb582-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb582-14"></a>        x<span class="op">[</span>i<span class="op">]</span> <span class="op">=</span> i<span class="op">*</span>i<span class="op">;</span></span>
<span id="cb582-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb582-15"></a></span>
<span id="cb582-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb582-16"></a>    <span class="co">// Print them</span></span>
<span id="cb582-17"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb582-17"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> w<span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb582-18"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb582-18"></a>        printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> x<span class="op">[</span>i<span class="op">]);</span></span>
<span id="cb582-19"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb582-19"></a></span>
<span id="cb582-20"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb582-20"></a>    <span class="co">// Now let's change w...</span></span>
<span id="cb582-21"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb582-21"></a></span>
<span id="cb582-22"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb582-22"></a>    w <span class="op">=</span> <span class="dv">20</span><span class="op">;</span></span>
<span id="cb582-23"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb582-23"></a></span>
<span id="cb582-24"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb582-24"></a>    <span class="co">// But goat is STILL an array of 10 ints, because that was the</span></span>
<span id="cb582-25"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb582-25"></a>    <span class="co">// value of w when the typedef executed.</span></span>
<span id="cb582-26"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb582-26"></a><span class="op">}</span></span></code></pre></div>
<p>So it acts like an array of fixed size.</p>
<p>But you still can’t use an initializer list on it.</p>
<p></p>
<h2 data-number="30.8" id="jumping-pitfalls"><span class="header-section-number">30.8</span> Jumping Pitfalls</h2>
<p></p>
<p>You have to watch out when using <code>goto</code> near VLAs because a lot of things aren’t legal.</p>
<p> </p>
<p>And when you’re using <code>longjmp()</code> there’s a case where you could leak memory with VLAs.</p>
<p></p>
<p>But both of these things we’ll cover in their respective chapters.</p>
<h2 data-number="30.9" id="vla-general-issues"><span class="header-section-number">30.9</span> General Issues</h2>
<p></p>
<p>VLAs have been banned from the Linux kernel for a few reasons:</p>
<ul>
<li>Lots of places they were used should have just been fixed-size.</li>
<li>The code behind VLAs is slower (to a degree that most people wouldn’t notice, but makes a difference in an operating system).</li>
<li>VLAs are not supported to the same degree by all C compilers.</li>
<li>Stack size is limited, and VLAs go on the stack. If some code accidentally (or maliciously) passes a large value into a kernel function that allocates a VLA, <em>Bad Things</em>™ could happen.</li>
</ul>
<p>Other folks online point out that there’s no way to detect a VLA’s failure to allocate, and programs that suffered such problems would likely just crash. While fixed-size arrays also have the same issue, it’s far more likely that someone accidentally make a <em>VLA Of Unusual Size</em> than somehow accidentally declare a fixed-size, say, 30 megabyte array.</p>
<p> </p>
<!-- Beej's guide to C

# vim: ts=4:sw=4:nosi:et:tw=72
-->
<h1 data-number="31" id="goto"><span class="header-section-number">31</span> <code>goto</code></h1>
<p></p>
<p>The <code>goto</code> statement is universally revered and can be here presented without contest.</p>
<p>Just kidding! Over the years, there has been a lot of back-and-forth over whether or not (often not) <code>goto</code> is <a href="https://en.wikipedia.org/wiki/Goto#Criticism">considered harmful</a><a href="https://beej.us/guide/bgc/html/index-wide.html#fn174" class="footnote-ref" id="fnref174" role="doc-noteref"><sup>174</sup></a>.</p>
<p>In this programmer’s opinion, you should use whichever constructs leads to the <em>best</em> code, factoring in maintainability and speed. And sometimes this might be <code>goto</code>!</p>
<p>In this chapter, we’ll see how <code>goto</code> works in C, and then check out some of the common cases where it is used<a href="https://beej.us/guide/bgc/html/index-wide.html#fn175" class="footnote-ref" id="fnref175" role="doc-noteref"><sup>175</sup></a>.</p>
<h2 data-number="31.1" id="a-simple-example"><span class="header-section-number">31.1</span> A Simple Example</h2>
<p></p>
<p>In this example, we’re going to use <code>goto</code> to skip a line of code and jump to a <em>label</em>. The label is the identifier that can be a <code>goto</code> target—it ends with a colon (<code>:</code>).</p>
<div class="sourceCode" id="cb583"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb583-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb583-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb583-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb583-2"></a></span>
<span id="cb583-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb583-3"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb583-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb583-4"></a><span class="op">{</span></span>
<span id="cb583-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb583-5"></a>    printf<span class="op">(</span><span class="st">"One</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb583-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb583-6"></a>    printf<span class="op">(</span><span class="st">"Two</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb583-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb583-7"></a></span>
<span id="cb583-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb583-8"></a>    <span class="cf">goto</span> skip_3<span class="op">;</span></span>
<span id="cb583-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb583-9"></a></span>
<span id="cb583-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb583-10"></a>    printf<span class="op">(</span><span class="st">"Three</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb583-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb583-11"></a></span>
<span id="cb583-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb583-12"></a>skip_3<span class="op">:</span></span>
<span id="cb583-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb583-13"></a></span>
<span id="cb583-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb583-14"></a>    printf<span class="op">(</span><span class="st">"Five!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb583-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb583-15"></a><span class="op">}</span></span></code></pre></div>
<p>The output is:</p>
<div class="sourceCode" id="cb584"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb584-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb584-1" aria-hidden="true" tabindex="-1"></a>One</span>
<span id="cb584-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb584-2" aria-hidden="true" tabindex="-1"></a>Two</span>
<span id="cb584-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb584-3" aria-hidden="true" tabindex="-1"></a>Five!</span></code></pre></div>
<p><code>goto</code> sends execution jumping to the specified label, skipping everything in between.</p>
<p>You can jump forward or backward with <code>goto</code>.</p>
<div class="sourceCode" id="cb585"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb585-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb585-1" aria-hidden="true" tabindex="-1"></a>infinite_loop<span class="op">:</span></span>
<span id="cb585-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb585-2" aria-hidden="true" tabindex="-1"></a>    print<span class="op">(</span><span class="st">"Hello, world!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb585-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb585-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">goto</span> infinite_loop<span class="op">;</span></span></code></pre></div>
<p>Labels are skipped over during execution. The following will print all three numbers in order just as if the labels weren’t there:</p>
<div class="sourceCode" id="cb586"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb586-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb586-1" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Zero</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb586-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb586-2" aria-hidden="true" tabindex="-1"></a>label_1<span class="op">:</span></span>
<span id="cb586-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb586-3" aria-hidden="true" tabindex="-1"></a>label_2<span class="op">:</span></span>
<span id="cb586-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb586-4" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"One</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb586-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb586-5" aria-hidden="true" tabindex="-1"></a>label_3<span class="op">:</span></span>
<span id="cb586-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb586-6" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Two</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb586-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb586-7" aria-hidden="true" tabindex="-1"></a>label_4<span class="op">:</span></span>
<span id="cb586-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb586-8" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Three</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span></code></pre></div>
<p>As you’ve noticed, it’s common convention to justify the labels all the way on the left. This increases readability because a reader can quickly scan to find the destination.</p>
<p>Labels have <em>function scope</em>. That is, no matter how many levels deep in blocks they appear, you can still <code>goto</code> them from anywhere in the function.</p>
<p>It also means you can only <code>goto</code> labels that are in the same function as the <code>goto</code> itself. Labels in other functions are out of scope from <code>goto</code>’s perspective. And it means you can use the same label name in two functions—just not the same label name in the same function.</p>
<p></p>
<h2 data-number="31.2" id="labeled-continue"><span class="header-section-number">31.2</span> Labeled <code>continue</code></h2>
<p></p>
<p>In some languages, you can actually specify a label for a <code>continue</code> statement. C doesn’t allow it, but you can easily use <code>goto</code> instead.</p>
<p>To show the issue, check out <code>continue</code> in this nested loop:</p>
<div class="sourceCode" id="cb587"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb587-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb587-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">3</span><span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb587-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb587-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> j <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> j <span class="op">&lt;</span> <span class="dv">3</span><span class="op">;</span> j<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb587-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb587-3" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"</span><span class="sc">%d</span><span class="st">, </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> i<span class="op">,</span> j<span class="op">);</span></span>
<span id="cb587-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb587-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">continue</span><span class="op">;</span>   <span class="co">// Always goes to next j</span></span>
<span id="cb587-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb587-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb587-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb587-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>As we see, that <code>continue</code>, like all <code>continues</code>, goes to the next iteration of the nearest enclosing loop. What if we want to <code>continue</code> in the next loop out, the loop with <code>i</code>?</p>
<p>Well, we can <code>break</code> to get back to the outer loop, right?</p>
<div class="sourceCode" id="cb588"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb588-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb588-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">3</span><span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb588-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb588-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> j <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> j <span class="op">&lt;</span> <span class="dv">3</span><span class="op">;</span> j<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb588-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb588-3" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"</span><span class="sc">%d</span><span class="st">, </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> i<span class="op">,</span> j<span class="op">);</span></span>
<span id="cb588-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb588-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">break</span><span class="op">;</span>     <span class="co">// Gets us to the next iteration of i</span></span>
<span id="cb588-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb588-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb588-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb588-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>That gets us two levels of nested loop. But then if we nest another loop, we’re out of options. What about this, where we don’t have any statement that will get us out to the next iteration of <code>i</code>?</p>
<div class="sourceCode" id="cb589"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb589-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb589-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">3</span><span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb589-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb589-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> j <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> j <span class="op">&lt;</span> <span class="dv">3</span><span class="op">;</span> j<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb589-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb589-3" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> k <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> k <span class="op">&lt;</span> <span class="dv">3</span><span class="op">;</span> k<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb589-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb589-4" aria-hidden="true" tabindex="-1"></a>            printf<span class="op">(</span><span class="st">"</span><span class="sc">%d</span><span class="st">, </span><span class="sc">%d</span><span class="st">, </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> i<span class="op">,</span> j<span class="op">,</span> k<span class="op">);</span></span>
<span id="cb589-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb589-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb589-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb589-6" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span><span class="op">;</span>  <span class="co">// Gets us to the next iteration of k</span></span>
<span id="cb589-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb589-7" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span><span class="op">;</span>     <span class="co">// Gets us to the next iteration of j</span></span>
<span id="cb589-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb589-8" aria-hidden="true" tabindex="-1"></a>            <span class="op">????;</span>      <span class="co">// Gets us to the next iteration of i???</span></span>
<span id="cb589-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb589-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb589-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb589-10" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb589-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb589-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb589-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb589-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>The <code>goto</code> statement offers us a way!</p>
<div class="sourceCode" id="cb590"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb590-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb590-1" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">3</span><span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb590-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb590-2" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> j <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> j <span class="op">&lt;</span> <span class="dv">3</span><span class="op">;</span> j<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb590-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb590-3" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> k <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> k <span class="op">&lt;</span> <span class="dv">3</span><span class="op">;</span> k<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb590-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb590-4" aria-hidden="true" tabindex="-1"></a>                printf<span class="op">(</span><span class="st">"</span><span class="sc">%d</span><span class="st">, </span><span class="sc">%d</span><span class="st">, </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> i<span class="op">,</span> j<span class="op">,</span> k<span class="op">);</span></span>
<span id="cb590-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb590-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb590-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb590-6" aria-hidden="true" tabindex="-1"></a>                <span class="cf">goto</span> continue_i<span class="op">;</span>   <span class="co">// Now continuing the i loop!!</span></span>
<span id="cb590-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb590-7" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb590-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb590-8" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb590-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb590-9" aria-hidden="true" tabindex="-1"></a>continue_i<span class="op">:</span> <span class="op">;</span></span>
<span id="cb590-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb590-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div>
<p>We have a <code>;</code> at the end there—that’s because you can’t have a label pointing to the plain end of a compound statement (or before a variable declaration).</p>
<p></p>
<h2 data-number="31.3" id="bailing-out"><span class="header-section-number">31.3</span> Bailing Out</h2>
<p></p>
<p>When you’re super nested in the middle of some code, you can use <code>goto</code> to get out of it in a manner that’s often cleaner than nesting more <code>if</code>s and using flag variables.</p>
<div class="sourceCode" id="cb591"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb591-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb591-1" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Pseudocode</span></span>
<span id="cb591-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb591-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb591-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb591-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span><span class="op">(...)</span> <span class="op">{</span></span>
<span id="cb591-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb591-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(...)</span> <span class="op">{</span></span>
<span id="cb591-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb591-5" aria-hidden="true" tabindex="-1"></a>            <span class="cf">while</span> <span class="op">(...)</span> <span class="op">{</span></span>
<span id="cb591-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb591-6" aria-hidden="true" tabindex="-1"></a>                <span class="cf">do</span> <span class="op">{</span></span>
<span id="cb591-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb591-7" aria-hidden="true" tabindex="-1"></a>                    <span class="cf">if</span> <span class="op">(</span>some_error_condition<span class="op">)</span></span>
<span id="cb591-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb591-8" aria-hidden="true" tabindex="-1"></a>                        <span class="cf">goto</span> bail<span class="op">;</span></span>
<span id="cb591-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb591-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb591-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb591-10" aria-hidden="true" tabindex="-1"></a>                <span class="op">}</span> <span class="cf">while</span><span class="op">(...);</span></span>
<span id="cb591-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb591-11" aria-hidden="true" tabindex="-1"></a>            <span class="op">}</span></span>
<span id="cb591-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb591-12" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb591-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb591-13" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb591-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb591-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb591-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb591-15" aria-hidden="true" tabindex="-1"></a>bail<span class="op">:</span></span>
<span id="cb591-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb591-16" aria-hidden="true" tabindex="-1"></a>    <span class="co">// Cleanup here</span></span></code></pre></div>
<p>Without <code>goto</code>, you’d have to check an error condition flag in all of the loops to get all the way out.</p>
<p></p>
<h2 data-number="31.4" id="labeled-break"><span class="header-section-number">31.4</span> Labeled <code>break</code></h2>
<p></p>
<p>This is a very similar situation to how <code>continue</code> only continues the innermost loop. <code>break</code> also only breaks out of the innermost loop.</p>
<div class="sourceCode" id="cb592"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb592-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb592-1" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">3</span><span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb592-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb592-2" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> j <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> j <span class="op">&lt;</span> <span class="dv">3</span><span class="op">;</span> j<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb592-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb592-3" aria-hidden="true" tabindex="-1"></a>            printf<span class="op">(</span><span class="st">"</span><span class="sc">%d</span><span class="st">, </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> i<span class="op">,</span> j<span class="op">);</span></span>
<span id="cb592-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb592-4" aria-hidden="true" tabindex="-1"></a>            <span class="cf">break</span><span class="op">;</span>   <span class="co">// Only breaks out of the j loop</span></span>
<span id="cb592-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb592-5" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb592-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb592-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb592-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb592-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb592-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb592-8" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Done!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span></code></pre></div>
<p>But we can use <code>goto</code> to break farther:</p>
<div class="sourceCode" id="cb593"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb593-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb593-1" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">3</span><span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb593-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb593-2" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> j <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> j <span class="op">&lt;</span> <span class="dv">3</span><span class="op">;</span> j<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb593-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb593-3" aria-hidden="true" tabindex="-1"></a>            printf<span class="op">(</span><span class="st">"</span><span class="sc">%d</span><span class="st">, </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> i<span class="op">,</span> j<span class="op">);</span></span>
<span id="cb593-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb593-4" aria-hidden="true" tabindex="-1"></a>            <span class="cf">goto</span> break_i<span class="op">;</span>   <span class="co">// Now breaking out of the i loop!</span></span>
<span id="cb593-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb593-5" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span>
<span id="cb593-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb593-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb593-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb593-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb593-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb593-8" aria-hidden="true" tabindex="-1"></a>break_i<span class="op">:</span></span>
<span id="cb593-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb593-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb593-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb593-10" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Done!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span></code></pre></div>
<p></p>
<h2 data-number="31.5" id="multi-level-cleanup"><span class="header-section-number">31.5</span> Multi-level Cleanup</h2>
<p></p>
<p>If you’re calling multiple functions to initialize multiple systems and one of them fails, you should only de-initialize the ones that you’ve gotten to so far.</p>
<p>Let’s do a fake example where we start initializing systems and checking to see if any returns an error (we’ll use <code>-1</code> to indicate an error). If one of them does, we have to shutdown only the systems we’ve initialized so far.</p>
<div class="sourceCode" id="cb594"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb594-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb594-1" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>init_system_1<span class="op">()</span> <span class="op">==</span> <span class="op">-</span><span class="dv">1</span><span class="op">)</span></span>
<span id="cb594-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb594-2" aria-hidden="true" tabindex="-1"></a>        <span class="cf">goto</span> shutdown<span class="op">;</span></span>
<span id="cb594-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb594-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb594-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb594-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>init_system_2<span class="op">()</span> <span class="op">==</span> <span class="op">-</span><span class="dv">1</span><span class="op">)</span></span>
<span id="cb594-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb594-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">goto</span> shutdown_1<span class="op">;</span></span>
<span id="cb594-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb594-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb594-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb594-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>init_system_3<span class="op">()</span> <span class="op">==</span> <span class="op">-</span><span class="dv">1</span><span class="op">)</span></span>
<span id="cb594-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb594-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">goto</span> shutdown_2<span class="op">;</span></span>
<span id="cb594-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb594-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb594-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb594-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>init_system_4<span class="op">()</span> <span class="op">==</span> <span class="op">-</span><span class="dv">1</span><span class="op">)</span></span>
<span id="cb594-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb594-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">goto</span> shutdown_3<span class="op">;</span></span>
<span id="cb594-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb594-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb594-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb594-13" aria-hidden="true" tabindex="-1"></a>    do_main_thing<span class="op">();</span>   <span class="co">// Run our program</span></span>
<span id="cb594-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb594-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb594-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb594-15" aria-hidden="true" tabindex="-1"></a>    shutdown_system4<span class="op">();</span></span>
<span id="cb594-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb594-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb594-17"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb594-17" aria-hidden="true" tabindex="-1"></a>shutdown_3<span class="op">:</span></span>
<span id="cb594-18"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb594-18" aria-hidden="true" tabindex="-1"></a>    shutdown_system3<span class="op">();</span></span>
<span id="cb594-19"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb594-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb594-20"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb594-20" aria-hidden="true" tabindex="-1"></a>shutdown_2<span class="op">:</span></span>
<span id="cb594-21"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb594-21" aria-hidden="true" tabindex="-1"></a>    shutdown_system2<span class="op">();</span></span>
<span id="cb594-22"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb594-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb594-23"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb594-23" aria-hidden="true" tabindex="-1"></a>shutdown_1<span class="op">:</span></span>
<span id="cb594-24"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb594-24" aria-hidden="true" tabindex="-1"></a>    shutdown_system1<span class="op">();</span></span>
<span id="cb594-25"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb594-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb594-26"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb594-26" aria-hidden="true" tabindex="-1"></a>shutdown<span class="op">:</span></span>
<span id="cb594-27"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb594-27" aria-hidden="true" tabindex="-1"></a>    print<span class="op">(</span><span class="st">"All subsystems shut down.</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span></code></pre></div>
<p>Note that we’re shutting down in the reverse order that we initialized the subsystems. So if subsystem 4 fails to start up, it will shut down 3, 2, then 1 in that order.</p>
<p></p>
<h2 data-number="31.6" id="tail-call-optimization"><span class="header-section-number">31.6</span> Tail Call Optimization</h2>
<p> </p>
<p>Kinda. For recursive functions only.</p>
<p>If you’re unfamiliar, <a href="https://en.wikipedia.org/wiki/Tail_call">Tail Call Optimization (TCO)</a><a href="https://beej.us/guide/bgc/html/index-wide.html#fn176" class="footnote-ref" id="fnref176" role="doc-noteref"><sup>176</sup></a> is a way to not waste stack space when calling other functions under very specific circumstances. Unfortunately the details are beyond the scope of this guide.</p>
<p>But if you have a recursive function you know can be optimized in this way, you can make use of this technique. (Note that you can’t tail call other functions due to the function scope of labels.)</p>
<p>Let’s do a straightforward example, factorial.</p>
<p>Here’s a recursive version that’s not TCO, but it can be!</p>
<div class="sourceCode" id="cb595"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb595-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb595-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb595-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb595-2"></a><span class="pp">#include </span><span class="im">&lt;complex.h&gt;</span></span>
<span id="cb595-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb595-3"></a></span>
<span id="cb595-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb595-4"></a><span class="dt">int</span> factorial<span class="op">(</span><span class="dt">int</span> n<span class="op">,</span> <span class="dt">int</span> a<span class="op">)</span></span>
<span id="cb595-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb595-5"></a><span class="op">{</span></span>
<span id="cb595-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb595-6"></a>    <span class="cf">if</span> <span class="op">(</span>n <span class="op">==</span> <span class="dv">0</span><span class="op">)</span></span>
<span id="cb595-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb595-7"></a>        <span class="cf">return</span> a<span class="op">;</span></span>
<span id="cb595-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb595-8"></a></span>
<span id="cb595-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb595-9"></a>    <span class="cf">return</span> factorial<span class="op">(</span>n <span class="op">-</span> <span class="dv">1</span><span class="op">,</span> a <span class="op">*</span> n<span class="op">);</span></span>
<span id="cb595-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb595-10"></a><span class="op">}</span></span>
<span id="cb595-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb595-11"></a></span>
<span id="cb595-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb595-12"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb595-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb595-13"></a><span class="op">{</span></span>
<span id="cb595-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb595-14"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">8</span><span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb595-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb595-15"></a>        printf<span class="op">(</span><span class="st">"</span><span class="sc">%d</span><span class="st">! == </span><span class="sc">%ld\n</span><span class="st">"</span><span class="op">,</span> i<span class="op">,</span> factorial<span class="op">(</span>i<span class="op">,</span> <span class="dv">1</span><span class="op">));</span></span>
<span id="cb595-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb595-16"></a><span class="op">}</span></span></code></pre></div>
<p>To make it happen, you can replace the call with two steps:</p>
<ol type="1">
<li>Set the values of the parameters to what they’d be on the next call.</li>
<li><code>goto</code> a label on the first line of the function.</li>
</ol>
<p>Let’s try it:</p>
<div class="sourceCode" id="cb596"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb596-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb596-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb596-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb596-2"></a></span>
<span id="cb596-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb596-3"></a><span class="dt">int</span> factorial<span class="op">(</span><span class="dt">int</span> n<span class="op">,</span> <span class="dt">int</span> a<span class="op">)</span></span>
<span id="cb596-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb596-4"></a><span class="op">{</span></span>
<span id="cb596-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb596-5"></a>tco<span class="op">:</span>  <span class="co">// add this</span></span>
<span id="cb596-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb596-6"></a></span>
<span id="cb596-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb596-7"></a>    <span class="cf">if</span> <span class="op">(</span>n <span class="op">==</span> <span class="dv">0</span><span class="op">)</span></span>
<span id="cb596-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb596-8"></a>        <span class="cf">return</span> a<span class="op">;</span></span>
<span id="cb596-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb596-9"></a></span>
<span id="cb596-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb596-10"></a>    <span class="co">// replace return by setting new parameter values and</span></span>
<span id="cb596-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb596-11"></a>    <span class="co">// goto-ing the beginning of the function</span></span>
<span id="cb596-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb596-12"></a></span>
<span id="cb596-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb596-13"></a>    <span class="co">//return factorial(n - 1, a * n);</span></span>
<span id="cb596-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb596-14"></a></span>
<span id="cb596-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb596-15"></a>    <span class="dt">int</span> next_n <span class="op">=</span> n <span class="op">-</span> <span class="dv">1</span><span class="op">;</span>  <span class="co">// See how these match up with</span></span>
<span id="cb596-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb596-16"></a>    <span class="dt">int</span> next_a <span class="op">=</span> a <span class="op">*</span> n<span class="op">;</span>  <span class="co">// the recursive arguments, above?</span></span>
<span id="cb596-17"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb596-17"></a></span>
<span id="cb596-18"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb596-18"></a>    n <span class="op">=</span> next_n<span class="op">;</span>   <span class="co">// Set the parameters to the new values</span></span>
<span id="cb596-19"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb596-19"></a>    a <span class="op">=</span> next_a<span class="op">;</span></span>
<span id="cb596-20"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb596-20"></a></span>
<span id="cb596-21"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb596-21"></a>    <span class="cf">goto</span> tco<span class="op">;</span>   <span class="co">// And repeat!</span></span>
<span id="cb596-22"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb596-22"></a><span class="op">}</span></span>
<span id="cb596-23"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb596-23"></a></span>
<span id="cb596-24"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb596-24"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb596-25"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb596-25"></a><span class="op">{</span></span>
<span id="cb596-26"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb596-26"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> <span class="dv">8</span><span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb596-27"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb596-27"></a>        printf<span class="op">(</span><span class="st">"</span><span class="sc">%d</span><span class="st">! == </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> i<span class="op">,</span> factorial<span class="op">(</span>i<span class="op">,</span> <span class="dv">1</span><span class="op">));</span></span>
<span id="cb596-28"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb596-28"></a><span class="op">}</span></span></code></pre></div>
<p>I used temporary variables up there to set the next values of the parameters before jumping to the start of the function. See how they correspond to the recursive arguments that were in the recursive call?</p>
<p>Now, why use temp variables? I could have done this instead:</p>
<div class="sourceCode" id="cb597"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb597-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb597-1" aria-hidden="true" tabindex="-1"></a>    a <span class="op">*=</span> n<span class="op">;</span></span>
<span id="cb597-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb597-2" aria-hidden="true" tabindex="-1"></a>    n <span class="op">-=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb597-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb597-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb597-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb597-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">goto</span> tco<span class="op">;</span></span></code></pre></div>
<p>and that actually works just fine. But if I carelessly reverse those two lines of code:</p>
<div class="sourceCode" id="cb598"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb598-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb598-1" aria-hidden="true" tabindex="-1"></a>    n <span class="op">-=</span> <span class="dv">1</span><span class="op">;</span>  <span class="co">// BAD NEWS</span></span>
<span id="cb598-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb598-2" aria-hidden="true" tabindex="-1"></a>    a <span class="op">*=</span> n<span class="op">;</span></span></code></pre></div>
<p>—now we’re in trouble. We modified <code>n</code> before using it to modify <code>a</code>. That’s Bad because that’s not how it works when you call recursively. Using the temporary variables avoids this problem even if you’re not looking out for it. And the compiler likely optimizes them out, anyway.</p>
<p> </p>
<h2 data-number="31.7" id="restarting-interrupted-system-calls"><span class="header-section-number">31.7</span> Restarting Interrupted System Calls</h2>
<p></p>
<p>This is outside the spec, but commonly seen in Unix-like systems.</p>
<p>Certain long-lived system calls might return an error if they’re interrupted by a signal, and <code>errno</code> will be set to <code>EINTR</code> to indicate the syscall was doing fine; it was just interrupted.</p>
<p>In those cases, it’s really common for the programmer to want to restart the call and try it again.</p>
<div class="sourceCode" id="cb599"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb599-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb599-1" aria-hidden="true" tabindex="-1"></a>retry<span class="op">:</span></span>
<span id="cb599-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb599-2" aria-hidden="true" tabindex="-1"></a>    byte_count <span class="op">=</span> read<span class="op">(</span><span class="dv">0</span><span class="op">,</span> buf<span class="op">,</span> <span class="kw">sizeof</span><span class="op">(</span>buf<span class="op">)</span> <span class="op">-</span> <span class="dv">1</span><span class="op">);</span>  <span class="co">// Unix read() syscall</span></span>
<span id="cb599-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb599-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb599-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb599-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>byte_count <span class="op">==</span> <span class="op">-</span><span class="dv">1</span><span class="op">)</span> <span class="op">{</span>            <span class="co">// An error occurred...</span></span>
<span id="cb599-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb599-5" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="op">(</span>errno <span class="op">==</span> EINTR<span class="op">)</span> <span class="op">{</span>          <span class="co">// But it was just interrupted</span></span>
<span id="cb599-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb599-6" aria-hidden="true" tabindex="-1"></a>            printf<span class="op">(</span><span class="st">"Restarting...</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb599-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb599-7" aria-hidden="true" tabindex="-1"></a>            <span class="cf">goto</span> retry<span class="op">;</span></span>
<span id="cb599-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb599-8" aria-hidden="true" tabindex="-1"></a>        <span class="op">}</span></span></code></pre></div>
<p>Many Unix-likes have an <code>SA_RESTART</code> flag you can pass to <code>sigaction()</code> to request the OS automatically restart any slow syscalls instead of failing with <code>EINTR</code>.</p>
<p>Again, this is Unix-specific and is outside the C standard.</p>
<p>That said, it’s possible to use a similar technique any time any function should be restarted.</p>
<p></p>
<h2 data-number="31.8" id="goto-and-thread-preemption"><span class="header-section-number">31.8</span> <code>goto</code> and Thread Preemption</h2>
<p></p>
<p>This example is ripped directly from <a href="http://www.ostep.org/"><em>Operating Systems: Three Easy Pieces</em></a>, another excellent book from like-minded authors who also feel that quality books should be free to download. Not that I’m opinionated, or anything.</p>
<div class="sourceCode" id="cb600"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb600-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb600-1" aria-hidden="true" tabindex="-1"></a>retry<span class="op">:</span></span>
<span id="cb600-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb600-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb600-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb600-3" aria-hidden="true" tabindex="-1"></a>    pthread_mutex_lock<span class="op">(</span>L1<span class="op">);</span></span>
<span id="cb600-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb600-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb600-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb600-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="op">(</span>pthread_mutex_trylock<span class="op">(</span>L2<span class="op">)</span> <span class="op">!=</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb600-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb600-6" aria-hidden="true" tabindex="-1"></a>        pthread_mutex_unlock<span class="op">(</span>L1<span class="op">);</span></span>
<span id="cb600-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb600-7" aria-hidden="true" tabindex="-1"></a>        <span class="cf">goto</span> retry<span class="op">;</span></span>
<span id="cb600-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb600-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb600-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb600-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb600-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb600-10" aria-hidden="true" tabindex="-1"></a>    save_the_day<span class="op">();</span></span>
<span id="cb600-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb600-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb600-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb600-12" aria-hidden="true" tabindex="-1"></a>    pthread_mutex_unlock<span class="op">(</span>L2<span class="op">);</span></span>
<span id="cb600-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb600-13" aria-hidden="true" tabindex="-1"></a>    pthread_mutex_unlock<span class="op">(</span>L1<span class="op">);</span></span></code></pre></div>
<p>There the thread happily acquires the mutex <code>L1</code>, but then potentially fails to get the second resource guarded by mutex <code>L2</code> (if some other uncooperative thread holds it, say). If our thread can’t get the <code>L2</code> lock, it unlocks <code>L1</code> and then uses <code>goto</code> to cleanly retry.</p>
<p>We hope our heroic thread eventually manages to acquire both mutexes and save the day, all while avoiding evil deadlock.</p>
<p></p>
<h2 data-number="31.9" id="goto-and-variable-scope"><span class="header-section-number">31.9</span> <code>goto</code> and Variable Scope</h2>
<p></p>
<p>We’ve already seen that labels have function scope, but weird things can happen if we jump past some variable initialization.</p>
<p>Look at this example where we jump from a place where the variable <code>x</code> is out of scope into the middle of its scope (in the block).</p>
<div class="sourceCode" id="cb601"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb601-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb601-1" aria-hidden="true" tabindex="-1"></a>    <span class="cf">goto</span> label<span class="op">;</span></span>
<span id="cb601-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb601-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb601-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb601-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb601-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb601-4" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> x <span class="op">=</span> <span class="dv">12345</span><span class="op">;</span></span>
<span id="cb601-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb601-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb601-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb601-6" aria-hidden="true" tabindex="-1"></a>label<span class="op">:</span></span>
<span id="cb601-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb601-7" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> x<span class="op">);</span></span>
<span id="cb601-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb601-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div>
<p>This will compile and run, but gives me a warning:</p>
<div class="sourceCode" id="cb602"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb602-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb602-1" aria-hidden="true" tabindex="-1"></a>warning: ‘x’ is used uninitialized in this function</span></code></pre></div>
<p>And then it prints out <code>0</code> when I run it (your mileage may vary).</p>
<p>Basically what has happened is that we jumped into <code>x</code>’s scope (so it was OK to reference it in the <code>printf()</code>) but we jumped over the line that actually initialized it to <code>12345</code>. So the value was indeterminate.</p>
<p>The fix is, of course, to get the initialization <em>after</em> the label one way or another.</p>
<div class="sourceCode" id="cb603"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb603-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb603-1" aria-hidden="true" tabindex="-1"></a>    <span class="cf">goto</span> label<span class="op">;</span></span>
<span id="cb603-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb603-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb603-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb603-3" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb603-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb603-4" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> x<span class="op">;</span></span>
<span id="cb603-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb603-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb603-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb603-6" aria-hidden="true" tabindex="-1"></a>label<span class="op">:</span></span>
<span id="cb603-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb603-7" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> <span class="dv">12345</span><span class="op">;</span></span>
<span id="cb603-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb603-8" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> x<span class="op">);</span></span>
<span id="cb603-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb603-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div>
<p>Let’s look at one more example.</p>
<div class="sourceCode" id="cb604"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb604-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb604-1" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb604-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb604-2" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> x <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb604-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb604-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb604-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb604-4" aria-hidden="true" tabindex="-1"></a>label<span class="op">:</span></span>
<span id="cb604-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb604-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb604-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb604-6" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> x<span class="op">);</span></span>
<span id="cb604-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb604-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb604-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb604-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb604-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb604-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">goto</span> label<span class="op">;</span></span></code></pre></div>
<p>What happens here?</p>
<p>The first time through the block, we’re good. <code>x</code> is <code>10</code> and that’s what prints.</p>
<p>But after the <code>goto</code>, we’re jumping into the scope of <code>x</code>, but past its initialization. Which means we can still print it, but the value is indeterminate (since it hasn’t been reinitialized).</p>
<p>On my machine, it prints <code>10</code> again (to infinity), but that’s just luck. It could print any value after the <code>goto</code> since <code>x</code> is uninitialized.</p>
<p></p>
<h2 data-number="31.10" id="goto-and-variable-length-arrays"><span class="header-section-number">31.10</span> <code>goto</code> and Variable-Length Arrays</h2>
<p></p>
<p>When it comes to VLAs and <code>goto</code>, there’s one rule: you can’t jump from outside the scope of a VLA into the scope of that VLA.</p>
<p>If I try to do this:</p>
<div class="sourceCode" id="cb605"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb605-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb605-1" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> x <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb605-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb605-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb605-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb605-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">goto</span> label<span class="op">;</span></span>
<span id="cb605-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb605-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb605-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb605-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb605-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb605-6" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> v<span class="op">[</span>x<span class="op">];</span></span>
<span id="cb605-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb605-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb605-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb605-8" aria-hidden="true" tabindex="-1"></a>label<span class="op">:</span></span>
<span id="cb605-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb605-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb605-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb605-10" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"Hi!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb605-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb605-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div>
<p>I get an error:</p>
<div class="sourceCode" id="cb606"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb606-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb606-1" aria-hidden="true" tabindex="-1"></a>error: jump into scope of identifier with variably modified type</span></code></pre></div>
<p>You can jump in ahead of the VLA declaration, like this:</p>
<div class="sourceCode" id="cb607"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb607-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb607-1" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> x <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb607-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb607-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb607-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb607-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">goto</span> label<span class="op">;</span></span>
<span id="cb607-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb607-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb607-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb607-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb607-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb607-6" aria-hidden="true" tabindex="-1"></a>label<span class="op">:</span>  <span class="op">;</span></span>
<span id="cb607-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb607-7" aria-hidden="true" tabindex="-1"></a>        <span class="dt">int</span> v<span class="op">[</span>x<span class="op">];</span></span>
<span id="cb607-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb607-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb607-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb607-9" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"Hi!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb607-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb607-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span></code></pre></div>
<p>Because that way the VLA gets allocated properly before its inevitable deallocation once it falls out of scope.</p>
<p> </p>
<!-- Beej's guide to C

# vim: ts=4:sw=4:nosi:et:tw=72
-->
<h1 data-number="32" id="types-part-v-compound-literals-and-generic-selections"><span class="header-section-number">32</span> Types Part V: Compound Literals and Generic Selections</h1>
<p>This is the final chapter for types! We’re going to talk about two things:</p>
<ul>
<li>How to have “anonymous” unnamed objects and how that’s useful.</li>
<li>How to generate type-dependent code.</li>
</ul>
<p>They’re not particularly related, but don’t really each warrant their own chapters. So I crammed them in here like a rebel!</p>
<h2 data-number="32.1" id="compound-literals"><span class="header-section-number">32.1</span> Compound Literals</h2>
<p></p>
<p>This is a neat feature of the language that allows you to create an object of some type on the fly without ever assigning it to a variable. You can make simple types, arrays, <code>struct</code>s, you name it.</p>
<p>One of the main uses for this is passing complex arguments to functions when you don’t want to make a temporary variable to hold the value.</p>
<p>The way you create a compound literal is to put the type name in parentheses, and then put an initializer list after. For example, an unnamed array of <code>int</code>s, might look like this:</p>
<div class="sourceCode" id="cb608"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb608-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb608-1" aria-hidden="true" tabindex="-1"></a><span class="op">(</span><span class="dt">int</span> <span class="op">[]){</span><span class="dv">1</span><span class="op">,</span><span class="dv">2</span><span class="op">,</span><span class="dv">3</span><span class="op">,</span><span class="dv">4</span><span class="op">}</span></span></code></pre></div>
<p>Now, that line of code doesn’t do anything on its own. It creates an unnamed array of 4 <code>int</code>s, and then throws them away without using them.</p>
<p>We could use a pointer to store a reference to the array…</p>
<div class="sourceCode" id="cb609"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb609-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb609-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> <span class="op">*</span>p <span class="op">=</span> <span class="op">(</span><span class="dt">int</span> <span class="op">[]){</span><span class="dv">1</span> <span class="op">,</span><span class="dv">2</span> <span class="op">,</span><span class="dv">3</span> <span class="op">,</span><span class="dv">4</span><span class="op">};</span></span>
<span id="cb609-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb609-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb609-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb609-3" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> p<span class="op">[</span><span class="dv">1</span><span class="op">]);</span>  <span class="co">// 2</span></span></code></pre></div>
<p>But that seems a little like a long-winded way to have an array. I mean, we could have just done this<a href="https://beej.us/guide/bgc/html/index-wide.html#fn177" class="footnote-ref" id="fnref177" role="doc-noteref"><sup>177</sup></a>:</p>
<div class="sourceCode" id="cb610"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb610-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb610-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> p<span class="op">[]</span> <span class="op">=</span> <span class="op">{</span><span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> <span class="dv">4</span><span class="op">};</span></span>
<span id="cb610-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb610-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb610-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb610-3" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> p<span class="op">[</span><span class="dv">1</span><span class="op">]);</span>  <span class="co">// 2</span></span></code></pre></div>
<p>So let’s take a look at a more useful example.</p>
<h3 data-number="32.1.1" id="passing-unnamed-objects-to-functions"><span class="header-section-number">32.1.1</span> Passing Unnamed Objects to Functions</h3>
<p></p>
<p>Let’s say we have a function to sum an array of <code>int</code>s:</p>
<div class="sourceCode" id="cb611"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb611-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb611-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> sum<span class="op">(</span><span class="dt">int</span> p<span class="op">[],</span> <span class="dt">int</span> count<span class="op">)</span></span>
<span id="cb611-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb611-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb611-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb611-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> total <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb611-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb611-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb611-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb611-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> count<span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb611-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb611-6" aria-hidden="true" tabindex="-1"></a>        total <span class="op">+=</span> p<span class="op">[</span>i<span class="op">];</span></span>
<span id="cb611-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb611-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb611-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb611-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> total<span class="op">;</span></span>
<span id="cb611-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb611-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>If we wanted to call it, we’d normally have to do something like this, declaring an array and storing values in it to pass to the function:</p>
<div class="sourceCode" id="cb612"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb612-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb612-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> a<span class="op">[]</span> <span class="op">=</span> <span class="op">{</span><span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> <span class="dv">4</span><span class="op">};</span></span>
<span id="cb612-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb612-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb612-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb612-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> s <span class="op">=</span> sum<span class="op">(</span>a<span class="op">,</span> <span class="dv">4</span><span class="op">);</span></span></code></pre></div>
<p>But unnamed objects give us a way to skip the variable by passing it directly in (parameter names listed above). Check it out—we’re going to replace the variable <code>a</code> with an unnamed array that we pass in as the first argument:</p>
<div class="sourceCode" id="cb613"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb613-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb613-1" aria-hidden="true" tabindex="-1"></a><span class="co">//                   p[]         count</span></span>
<span id="cb613-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb613-2" aria-hidden="true" tabindex="-1"></a><span class="co">//           |-----------------|  |</span></span>
<span id="cb613-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb613-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> s <span class="op">=</span> sum<span class="op">((</span><span class="dt">int</span> <span class="op">[]){</span><span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> <span class="dv">4</span><span class="op">},</span> <span class="dv">4</span><span class="op">);</span></span></code></pre></div>
<p>Pretty slick!</p>
<p></p>
<h3 data-number="32.1.2" id="unnamed-structs"><span class="header-section-number">32.1.2</span> Unnamed <code>struct</code>s</h3>
<p> </p>
<p>We can do something similar with <code>struct</code>s.</p>
<p>First, let’s do things without unnamed objects. We’ll define a <code>struct</code> to hold some <code>x</code>/<code>y</code> coordinates. Then we’ll define one, passing in values into its initializer. Finally, we’ll pass it to a function to print the values:</p>
<div class="sourceCode" id="cb614"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb614-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb614-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb614-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb614-2"></a></span>
<span id="cb614-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb614-3"></a><span class="kw">struct</span> coord <span class="op">{</span></span>
<span id="cb614-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb614-4"></a>    <span class="dt">int</span> x<span class="op">,</span> y<span class="op">;</span></span>
<span id="cb614-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb614-5"></a><span class="op">};</span></span>
<span id="cb614-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb614-6"></a></span>
<span id="cb614-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb614-7"></a><span class="dt">void</span> print_coord<span class="op">(</span><span class="kw">struct</span> coord c<span class="op">)</span></span>
<span id="cb614-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb614-8"></a><span class="op">{</span></span>
<span id="cb614-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb614-9"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%d</span><span class="st">, </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> c<span class="op">.</span>x<span class="op">,</span> c<span class="op">.</span>y<span class="op">);</span></span>
<span id="cb614-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb614-10"></a><span class="op">}</span></span>
<span id="cb614-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb614-11"></a></span>
<span id="cb614-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb614-12"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb614-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb614-13"></a><span class="op">{</span></span>
<span id="cb614-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb614-14"></a>    <span class="kw">struct</span> coord t <span class="op">=</span> <span class="op">{.</span>x<span class="op">=</span><span class="dv">10</span><span class="op">,</span> <span class="op">.</span>y<span class="op">=</span><span class="dv">20</span><span class="op">};</span></span>
<span id="cb614-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb614-15"></a></span>
<span id="cb614-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb614-16"></a>    print_coord<span class="op">(</span>t<span class="op">);</span>   <span class="co">// prints "10, 20"</span></span>
<span id="cb614-17"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb614-17"></a><span class="op">}</span></span></code></pre></div>
<p>Straightforward enough?</p>
<p>Let’s modify it to use an unnamed object instead of the variable <code>t</code> we’re passing to <code>print_coord()</code>.</p>
<p>We’ll just take <code>t</code> out of there and replace it with an unnamed <code>struct</code>:</p>
<div class="sourceCode" id="cb615" data-startfrom="7"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c" style="counter-reset: source-line 6;"><span id="cb615-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb615-7"></a>    <span class="co">//struct coord t = {.x=10, .y=20};</span></span>
<span id="cb615-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb615-8"></a></span>
<span id="cb615-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb615-9"></a>    print_coord<span class="op">((</span><span class="kw">struct</span> coord<span class="op">){.</span>x<span class="op">=</span><span class="dv">10</span><span class="op">,</span> <span class="op">.</span>y<span class="op">=</span><span class="dv">20</span><span class="op">});</span>   <span class="co">// prints "10, 20"</span></span></code></pre></div>
<p>Still works!</p>
<p> </p>
<h3 data-number="32.1.3" id="pointers-to-unnamed-objects"><span class="header-section-number">32.1.3</span> Pointers to Unnamed Objects</h3>
<p></p>
<p>You might have noticed in the last example that even through we were using a <code>struct</code>, we were passing a copy of the <code>struct</code> to <code>print_coord()</code> as opposed to passing a pointer to the <code>struct</code>.</p>
<p>Turns out, we can just take the address of an unnamed object with <code>&amp;</code> like always.</p>
<p>This is because, in general, if an operator would have worked on a variable of that type, you can use that operator on an unnamed object of that type.</p>
<p>Let’s modify the above code so that we pass a pointer to an unnamed object</p>
<div class="sourceCode" id="cb616"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb616-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb616-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb616-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb616-2"></a></span>
<span id="cb616-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb616-3"></a><span class="kw">struct</span> coord <span class="op">{</span></span>
<span id="cb616-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb616-4"></a>    <span class="dt">int</span> x<span class="op">,</span> y<span class="op">;</span></span>
<span id="cb616-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb616-5"></a><span class="op">};</span></span>
<span id="cb616-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb616-6"></a></span>
<span id="cb616-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb616-7"></a><span class="dt">void</span> print_coord<span class="op">(</span><span class="kw">struct</span> coord <span class="op">*</span>c<span class="op">)</span></span>
<span id="cb616-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb616-8"></a><span class="op">{</span></span>
<span id="cb616-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb616-9"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%d</span><span class="st">, </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> c<span class="op">-&gt;</span>x<span class="op">,</span> c<span class="op">-&gt;</span>y<span class="op">);</span></span>
<span id="cb616-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb616-10"></a><span class="op">}</span></span>
<span id="cb616-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb616-11"></a></span>
<span id="cb616-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb616-12"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb616-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb616-13"></a><span class="op">{</span></span>
<span id="cb616-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb616-14"></a>    <span class="co">//     Note the &amp;</span></span>
<span id="cb616-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb616-15"></a>    <span class="co">//          |</span></span>
<span id="cb616-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb616-16"></a>    print_coord<span class="op">(&amp;(</span><span class="kw">struct</span> coord<span class="op">){.</span>x<span class="op">=</span><span class="dv">10</span><span class="op">,</span> <span class="op">.</span>y<span class="op">=</span><span class="dv">20</span><span class="op">});</span>   <span class="co">// prints "10, 20"</span></span>
<span id="cb616-17"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb616-17"></a><span class="op">}</span></span></code></pre></div>
<p>Additionally, this can be a nice way to pass even pointers to simple objects:</p>
<div class="sourceCode" id="cb617"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb617-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb617-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Pass a pointer to an int with value 3490</span></span>
<span id="cb617-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb617-2" aria-hidden="true" tabindex="-1"></a>foo<span class="op">(&amp;(</span><span class="dt">int</span><span class="op">){</span><span class="dv">3490</span><span class="op">});</span></span></code></pre></div>
<p>Easy as that.</p>
<p></p>
<h3 data-number="32.1.4" id="unnamed-objects-and-scope"><span class="header-section-number">32.1.4</span> Unnamed Objects and Scope</h3>
<p></p>
<p>The lifetime of an unnamed object ends at the end of its scope. The biggest way this could bite you is if you make a new unnamed object, get a pointer to it, and then leave the object’s scope. In that case, the pointer will refer to a dead object.</p>
<p>So this is undefined behavior:</p>
<div class="sourceCode" id="cb618"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb618-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb618-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> <span class="op">*</span>p<span class="op">;</span></span>
<span id="cb618-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb618-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb618-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb618-3" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb618-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb618-4" aria-hidden="true" tabindex="-1"></a>    p <span class="op">=</span> <span class="op">&amp;(</span><span class="dt">int</span><span class="op">){</span><span class="dv">10</span><span class="op">};</span></span>
<span id="cb618-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb618-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb618-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb618-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb618-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb618-7" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> <span class="op">*</span>p<span class="op">);</span>  <span class="co">// INVALID: The (int){10} fell out of scope</span></span></code></pre></div>
<p>Likewise, you can’t return a pointer to an unnamed object from a function. The object is deallocated when it falls out of scope:</p>
<div class="sourceCode" id="cb619"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb619-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb619-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb619-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb619-2"></a></span>
<span id="cb619-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb619-3"></a><span class="dt">int</span> <span class="op">*</span>get3490<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb619-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb619-4"></a><span class="op">{</span></span>
<span id="cb619-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb619-5"></a>    <span class="co">// Don't do this</span></span>
<span id="cb619-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb619-6"></a>    <span class="cf">return</span> <span class="op">&amp;(</span><span class="dt">int</span><span class="op">){</span><span class="dv">3490</span><span class="op">};</span></span>
<span id="cb619-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb619-7"></a><span class="op">}</span></span>
<span id="cb619-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb619-8"></a></span>
<span id="cb619-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb619-9"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb619-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb619-10"></a><span class="op">{</span></span>
<span id="cb619-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb619-11"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> <span class="op">*</span>get3490<span class="op">());</span>  <span class="co">// INVALID: (int){3490} fell out of scope</span></span>
<span id="cb619-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb619-12"></a><span class="op">}</span></span></code></pre></div>
<p>Just think of their scope like that of an ordinary local variable. You can’t return a pointer to a local variable, either.</p>
<p></p>
<h3 data-number="32.1.5" id="silly-unnamed-object-example"><span class="header-section-number">32.1.5</span> Silly Unnamed Object Example</h3>
<p>You can put any type in there and make an unnamed object.</p>
<p>For example, these are effectively equivalent:</p>
<div class="sourceCode" id="cb620"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb620-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb620-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> x <span class="op">=</span> <span class="dv">3490</span><span class="op">;</span></span>
<span id="cb620-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb620-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb620-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb620-3" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> x<span class="op">);</span>               <span class="co">// 3490 (variable)</span></span>
<span id="cb620-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb620-4" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> <span class="dv">3490</span><span class="op">);</span>            <span class="co">// 3490 (constant)</span></span>
<span id="cb620-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb620-5" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> <span class="op">(</span><span class="dt">int</span><span class="op">){</span><span class="dv">3490</span><span class="op">});</span>     <span class="co">// 3490 (unnamed object)</span></span></code></pre></div>
<p>That last one is unnamed, but it’s silly. Might as well do the simple one on the line before.</p>
<p>But hopefully that provides a little more clarity on the syntax.</p>
<p></p>
<h2 data-number="32.2" id="type-generics"><span class="header-section-number">32.2</span> Generic Selections</h2>
<p></p>
<p>This is an expression that allows you to select different pieces of code depending on the <em>type</em> of the first argument to the expression.</p>
<p>We’ll look at an example in just a second, but it’s important to know this is processed at compile time, <em>not at runtime</em>. There’s no runtime analysis going on here.</p>
<p></p>
<p>The expression begins with <code>_Generic</code>, works kinda like a <code>switch</code>, and it takes at least two arguments.</p>
<p>The first argument is an expression (or variable<a href="https://beej.us/guide/bgc/html/index-wide.html#fn178" class="footnote-ref" id="fnref178" role="doc-noteref"><sup>178</sup></a>) that has a <em>type</em>. All expressions have a type. The remaining arguments to <code>_Generic</code> are the cases of what to substitute in for the result of the expression if the first argument is that type.</p>
<p>Wat?</p>
<p>Let’s try it out and see.</p>
<div class="sourceCode" id="cb621"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb621-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb621-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb621-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb621-2"></a></span>
<span id="cb621-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb621-3"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb621-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb621-4"></a><span class="op">{</span></span>
<span id="cb621-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb621-5"></a>    <span class="dt">int</span> i<span class="op">;</span></span>
<span id="cb621-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb621-6"></a>    <span class="dt">float</span> f<span class="op">;</span></span>
<span id="cb621-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb621-7"></a>    <span class="dt">char</span> c<span class="op">;</span></span>
<span id="cb621-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb621-8"></a></span>
<span id="cb621-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb621-9"></a>    <span class="dt">char</span> <span class="op">*</span>s <span class="op">=</span> <span class="dt">_Generic</span><span class="op">(</span>i<span class="op">,</span></span>
<span id="cb621-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb621-10"></a>                    <span class="dt">int</span><span class="op">:</span> <span class="st">"that variable is an int"</span><span class="op">,</span></span>
<span id="cb621-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb621-11"></a>                    <span class="dt">float</span><span class="op">:</span> <span class="st">"that variable is a float"</span><span class="op">,</span></span>
<span id="cb621-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb621-12"></a>                    <span class="cf">default</span><span class="op">:</span> <span class="st">"that variable is some type"</span></span>
<span id="cb621-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb621-13"></a>                <span class="op">);</span></span>
<span id="cb621-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb621-14"></a></span>
<span id="cb621-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb621-15"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> s<span class="op">);</span></span>
<span id="cb621-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb621-16"></a><span class="op">}</span></span></code></pre></div>
<p>Check out the <code>_Generic</code> expression starting on line 9.</p>
<p>When the compiler sees it, it looks at the type of the first argument. (In this example, the type of the variable <code>i</code>.) It then looks through the cases for something of that type. And then it substitutes the argument in place of the entire <code>_Generic</code> expression.</p>
<p>In this case, <code>i</code> is an <code>int</code>, so it matches that case. Then the string is substituted in for the expression. So the line turns into this when the compiler sees it:</p>
<div class="sourceCode" id="cb622"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb622-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb622-1" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> <span class="op">*</span>s <span class="op">=</span> <span class="st">"that variable is an int"</span><span class="op">;</span></span></code></pre></div>
<p>If the compiler can’t find a type match in the <code>_Generic</code>, it looks for the optional <code>default</code> case and uses that.</p>
<p>If it can’t find a type match and there’s no <code>default</code>, you’ll get a compile error. The first expression <strong>must</strong> match one of the types or <code>default</code>.</p>
<p>Because it’s inconvenient to write <code>_Generic</code> over and over, it’s often used to make the body of a macro that can be easily repeatedly reused.</p>
<p>Let’s make a macro <code>TYPESTR(x)</code> that takes an argument and returns a string with the type of the argument.</p>
<p>So <code>TYPESTR(1)</code> will return the string <code>"int"</code>, for example.</p>
<p>Here we go:</p>
<div class="sourceCode" id="cb623"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb623-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb623-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb623-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb623-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb623-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb623-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#define TYPESTR</span><span class="op">(</span><span class="pp">x</span><span class="op">)</span><span class="pp"> </span><span class="dt">_Generic</span><span class="op">((</span><span class="pp">x</span><span class="op">),</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb623-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb623-4" aria-hidden="true" tabindex="-1"></a><span class="pp">                        </span><span class="dt">int</span><span class="op">:</span><span class="pp"> </span><span class="st">"int"</span><span class="op">,</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb623-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb623-5" aria-hidden="true" tabindex="-1"></a><span class="pp">                        </span><span class="dt">long</span><span class="op">:</span><span class="pp"> </span><span class="st">"long"</span><span class="op">,</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb623-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb623-6" aria-hidden="true" tabindex="-1"></a><span class="pp">                        </span><span class="dt">float</span><span class="op">:</span><span class="pp"> </span><span class="st">"float"</span><span class="op">,</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb623-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb623-7" aria-hidden="true" tabindex="-1"></a><span class="pp">                        </span><span class="dt">double</span><span class="op">:</span><span class="pp"> </span><span class="st">"double"</span><span class="op">,</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb623-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb623-8" aria-hidden="true" tabindex="-1"></a><span class="pp">                        </span><span class="cf">default</span><span class="op">:</span><span class="pp"> </span><span class="st">"something else"</span><span class="op">)</span></span>
<span id="cb623-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb623-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb623-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb623-10" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb623-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb623-11" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb623-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb623-12" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> i<span class="op">;</span></span>
<span id="cb623-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb623-13" aria-hidden="true" tabindex="-1"></a>    <span class="dt">long</span> l<span class="op">;</span></span>
<span id="cb623-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb623-14" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> f<span class="op">;</span></span>
<span id="cb623-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb623-15" aria-hidden="true" tabindex="-1"></a>    <span class="dt">double</span> d<span class="op">;</span></span>
<span id="cb623-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb623-16" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> c<span class="op">;</span></span>
<span id="cb623-17"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb623-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb623-18"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb623-18" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"i is type </span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> TYPESTR<span class="op">(</span>i<span class="op">));</span></span>
<span id="cb623-19"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb623-19" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"l is type </span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> TYPESTR<span class="op">(</span>l<span class="op">));</span></span>
<span id="cb623-20"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb623-20" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"f is type </span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> TYPESTR<span class="op">(</span>f<span class="op">));</span></span>
<span id="cb623-21"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb623-21" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"d is type </span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> TYPESTR<span class="op">(</span>d<span class="op">));</span></span>
<span id="cb623-22"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb623-22" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"c is type </span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> TYPESTR<span class="op">(</span>c<span class="op">));</span></span>
<span id="cb623-23"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb623-23" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>This outputs:</p>
<div class="sourceCode" id="cb624"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb624-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb624-1" aria-hidden="true" tabindex="-1"></a>i is type int</span>
<span id="cb624-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb624-2" aria-hidden="true" tabindex="-1"></a>l is type long</span>
<span id="cb624-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb624-3" aria-hidden="true" tabindex="-1"></a>f is type float</span>
<span id="cb624-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb624-4" aria-hidden="true" tabindex="-1"></a>d is type double</span>
<span id="cb624-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb624-5" aria-hidden="true" tabindex="-1"></a>c is type something else</span></code></pre></div>
<p>Which should be no surprise, because, like we said, that code in <code>main()</code> is replaced with the following when it is compiled:</p>
<div class="sourceCode" id="cb625"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb625-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb625-1" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"i is type </span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> <span class="st">"int"</span><span class="op">);</span></span>
<span id="cb625-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb625-2" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"l is type </span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> <span class="st">"long"</span><span class="op">);</span></span>
<span id="cb625-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb625-3" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"f is type </span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> <span class="st">"float"</span><span class="op">);</span></span>
<span id="cb625-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb625-4" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"d is type </span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> <span class="st">"double"</span><span class="op">);</span></span>
<span id="cb625-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb625-5" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"c is type </span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> <span class="st">"something else"</span><span class="op">);</span></span></code></pre></div>
<p>And that’s exactly the output we see.</p>
<p>Let’s do one more. I’ve included some macros here so that when you run:</p>
<div class="sourceCode" id="cb626"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb626-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb626-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> i <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb626-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb626-2" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span> <span class="op">*</span>s <span class="op">=</span> <span class="st">"Foo!"</span><span class="op">;</span></span>
<span id="cb626-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb626-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb626-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb626-4" aria-hidden="true" tabindex="-1"></a>PRINT_VAL<span class="op">(</span>i<span class="op">);</span></span>
<span id="cb626-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb626-5" aria-hidden="true" tabindex="-1"></a>PRINT_VAL<span class="op">(</span>s<span class="op">);</span></span></code></pre></div>
<p>you get the output:</p>
<div class="sourceCode" id="cb627"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb627-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb627-1" aria-hidden="true" tabindex="-1"></a>i = 10</span>
<span id="cb627-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb627-2" aria-hidden="true" tabindex="-1"></a>s = Foo!</span></code></pre></div>
<p>We’ll have to make use of some macro magic to do that.</p>
<div class="sourceCode" id="cb628"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb628-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb628-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb628-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb628-2"></a><span class="pp">#include </span><span class="im">&lt;string.h&gt;</span></span>
<span id="cb628-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb628-3"></a></span>
<span id="cb628-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb628-4"></a><span class="co">// Macro that gives back a format specifier for a type</span></span>
<span id="cb628-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb628-5"></a><span class="pp">#define FMTSPEC</span><span class="op">(</span><span class="pp">x</span><span class="op">)</span><span class="pp"> </span><span class="dt">_Generic</span><span class="op">((</span><span class="pp">x</span><span class="op">),</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb628-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb628-6"></a><span class="pp">                        </span><span class="dt">int</span><span class="op">:</span><span class="pp"> </span><span class="st">"</span><span class="sc">%d</span><span class="st">"</span><span class="op">,</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb628-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb628-7"></a><span class="pp">                        </span><span class="dt">long</span><span class="op">:</span><span class="pp"> </span><span class="st">"</span><span class="sc">%ld</span><span class="st">"</span><span class="op">,</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb628-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb628-8"></a><span class="pp">                        </span><span class="dt">float</span><span class="op">:</span><span class="pp"> </span><span class="st">"</span><span class="sc">%f</span><span class="st">"</span><span class="op">,</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb628-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb628-9"></a><span class="pp">                        </span><span class="dt">double</span><span class="op">:</span><span class="pp"> </span><span class="st">"</span><span class="sc">%f</span><span class="st">"</span><span class="op">,</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb628-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb628-10"></a><span class="pp">                        </span><span class="dt">char</span><span class="pp"> </span><span class="op">*:</span><span class="pp"> </span><span class="st">"</span><span class="sc">%s</span><span class="st">"</span><span class="op">)</span></span>
<span id="cb628-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb628-11"></a>                        <span class="co">// </span><span class="al">TODO</span><span class="co">: add more types</span></span>
<span id="cb628-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb628-12"></a>                        </span>
<span id="cb628-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb628-13"></a><span class="co">// Macro that prints a variable in the form "name = value"</span></span>
<span id="cb628-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb628-14"></a><span class="pp">#define PRINT_VAL</span><span class="op">(</span><span class="pp">x</span><span class="op">)</span><span class="pp"> </span><span class="cf">do</span><span class="pp"> </span><span class="op">{</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb628-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb628-15"></a><span class="pp">    </span><span class="dt">char</span><span class="pp"> fmt</span><span class="op">[</span><span class="dv">512</span><span class="op">];</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb628-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb628-16"></a><span class="pp">    snprintf</span><span class="op">(</span><span class="pp">fmt</span><span class="op">,</span><span class="pp"> </span><span class="kw">sizeof</span><span class="pp"> fmt</span><span class="op">,</span><span class="pp"> </span><span class="op">#</span><span class="pp">x </span><span class="st">" = </span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span><span class="pp"> FMTSPEC</span><span class="op">(</span><span class="pp">x</span><span class="op">));</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb628-17"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb628-17"></a><span class="pp">    printf</span><span class="op">(</span><span class="pp">fmt</span><span class="op">,</span><span class="pp"> </span><span class="op">(</span><span class="pp">x</span><span class="op">));</span><span class="pp"> </span><span class="op">\</span></span>
<span id="cb628-18"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb628-18"></a><span class="op">}</span><span class="pp"> </span><span class="cf">while</span><span class="op">(</span><span class="dv">0</span><span class="op">)</span></span>
<span id="cb628-19"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb628-19"></a></span>
<span id="cb628-20"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb628-20"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb628-21"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb628-21"></a><span class="op">{</span></span>
<span id="cb628-22"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb628-22"></a>    <span class="dt">int</span> i <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb628-23"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb628-23"></a>    <span class="dt">float</span> f <span class="op">=</span> <span class="fl">3.14159</span><span class="op">;</span></span>
<span id="cb628-24"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb628-24"></a>    <span class="dt">char</span> <span class="op">*</span>s <span class="op">=</span> <span class="st">"Hello, world!"</span><span class="op">;</span></span>
<span id="cb628-25"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb628-25"></a></span>
<span id="cb628-26"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb628-26"></a>    PRINT_VAL<span class="op">(</span>i<span class="op">);</span></span>
<span id="cb628-27"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb628-27"></a>    PRINT_VAL<span class="op">(</span>f<span class="op">);</span></span>
<span id="cb628-28"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb628-28"></a>    PRINT_VAL<span class="op">(</span>s<span class="op">);</span></span>
<span id="cb628-29"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb628-29"></a><span class="op">}</span></span></code></pre></div>
<p></p>
<p>for the output:</p>
<div class="sourceCode" id="cb629"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb629-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb629-1" aria-hidden="true" tabindex="-1"></a>i = 10</span>
<span id="cb629-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb629-2" aria-hidden="true" tabindex="-1"></a>f = 3.141590</span>
<span id="cb629-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb629-3" aria-hidden="true" tabindex="-1"></a>s = Hello, world!</span></code></pre></div>
<p>We could have crammed that all in one big macro, but I broke it into two to prevent eye bleeding.</p>
<p></p>
<!-- Beej's guide to C

# vim: ts=4:sw=4:nosi:et:tw=72
-->
<h1 data-number="33" id="arrays-part-ii"><span class="header-section-number">33</span> Arrays Part II</h1>
<p>We’re going to go over a few extra misc things this chapter concerning arrays.</p>
<ul>
<li>Type qualifiers with array parameters</li>
<li>The <code>static</code> keyword with array parameters</li>
<li>Partial multi-dimensional array initializers</li>
</ul>
<p>They’re not super-commonly seen, but we’ll peek at them since they’re part of the newer spec.</p>
<h2 data-number="33.1" id="type-qualifiers-for-arrays-in-parameter-lists"><span class="header-section-number">33.1</span> Type Qualifiers for Arrays in Parameter Lists</h2>
<p> </p>
<p>If you recall from earlier, these two things are equivalent in function parameter lists:</p>
<div class="sourceCode" id="cb630"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb630-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb630-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> func<span class="op">(</span><span class="dt">int</span> <span class="op">*</span>p<span class="op">)</span> <span class="op">{...}</span></span>
<span id="cb630-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb630-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> func<span class="op">(</span><span class="dt">int</span> p<span class="op">[])</span> <span class="op">{...}</span></span></code></pre></div>
<p>And you might also recall that you can add type qualifiers to a pointer variable like so:</p>
<div class="sourceCode" id="cb631"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb631-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb631-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> <span class="op">*</span><span class="dt">const</span> p<span class="op">;</span></span>
<span id="cb631-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb631-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> <span class="op">*</span><span class="dt">volatile</span> p<span class="op">;</span></span>
<span id="cb631-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb631-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> <span class="op">*</span><span class="dt">const</span> <span class="dt">volatile</span> p<span class="op">;</span></span>
<span id="cb631-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb631-4" aria-hidden="true" tabindex="-1"></a><span class="co">// etc.</span></span></code></pre></div>
<p>But how can we do that when we’re using array notation in your parameter list?</p>
<p>Turns out it goes in the brackets. And you can put the optional count after. The two following lines are equivalent:</p>
<div class="sourceCode" id="cb632"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb632-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb632-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> func<span class="op">(</span><span class="dt">int</span> <span class="op">*</span><span class="dt">const</span> <span class="dt">volatile</span> p<span class="op">)</span> <span class="op">{...}</span></span>
<span id="cb632-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb632-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> func<span class="op">(</span><span class="dt">int</span> p<span class="op">[</span><span class="dt">const</span> <span class="dt">volatile</span><span class="op">])</span> <span class="op">{...}</span></span>
<span id="cb632-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb632-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> func<span class="op">(</span><span class="dt">int</span> p<span class="op">[</span><span class="dt">const</span> <span class="dt">volatile</span> <span class="dv">10</span><span class="op">])</span> <span class="op">{...}</span></span></code></pre></div>
<p>If you have a multidimensional array, you need to put the type qualifiers in the first set of brackets.</p>
<p> </p>
<h2 data-number="33.2" id="static-for-arrays-in-parameter-lists"><span class="header-section-number">33.2</span> <code>static</code> for Arrays in Parameter Lists</h2>
<p></p>
<p>Similarly, you can use the keyword static in the array in a parameter list.</p>
<p>This is something I’ve never seen in the wild. It is <strong>always</strong> followed by a dimension:</p>
<div class="sourceCode" id="cb633"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb633-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb633-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> func<span class="op">(</span><span class="dt">int</span> p<span class="op">[</span><span class="dt">static</span> <span class="dv">4</span><span class="op">])</span> <span class="op">{...}</span></span></code></pre></div>
<p>What this means, in the above example, is the compiler is going to assume that any array you pass to the function will be <em>at least</em> 4 elements.</p>
<p>Anything else is undefined behavior.</p>
<div class="sourceCode" id="cb634"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb634-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb634-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> func<span class="op">(</span><span class="dt">int</span> p<span class="op">[</span><span class="dt">static</span> <span class="dv">4</span><span class="op">])</span> <span class="op">{...}</span></span>
<span id="cb634-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb634-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb634-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb634-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb634-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb634-4" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb634-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb634-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> a<span class="op">[]</span> <span class="op">=</span> <span class="op">{</span><span class="dv">11</span><span class="op">,</span> <span class="dv">22</span><span class="op">,</span> <span class="dv">33</span><span class="op">,</span> <span class="dv">44</span><span class="op">};</span></span>
<span id="cb634-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb634-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> b<span class="op">[]</span> <span class="op">=</span> <span class="op">{</span><span class="dv">11</span><span class="op">,</span> <span class="dv">22</span><span class="op">,</span> <span class="dv">33</span><span class="op">,</span> <span class="dv">44</span><span class="op">,</span> <span class="dv">55</span><span class="op">};</span></span>
<span id="cb634-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb634-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> c<span class="op">[]</span> <span class="op">=</span> <span class="op">{</span><span class="dv">11</span><span class="op">,</span> <span class="dv">22</span><span class="op">};</span></span>
<span id="cb634-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb634-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb634-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb634-9" aria-hidden="true" tabindex="-1"></a>    func<span class="op">(</span>a<span class="op">);</span>  <span class="co">// OK! a is 4 elements, the minimum</span></span>
<span id="cb634-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb634-10" aria-hidden="true" tabindex="-1"></a>    func<span class="op">(</span>b<span class="op">);</span>  <span class="co">// OK! b is at least 4 elements</span></span>
<span id="cb634-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb634-11" aria-hidden="true" tabindex="-1"></a>    func<span class="op">(</span>c<span class="op">);</span>  <span class="co">// Undefined behavior! c is under 4 elements!</span></span>
<span id="cb634-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb634-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>This basically sets the minimum size array you can have.</p>
<p>Important note: there is nothing in the compiler that prohibits you from passing in a smaller array. The compiler probably won’t warn you, and it won’t detect it at runtime.</p>
<p>By putting <code>static</code> in there, you’re saying, “I double secret PROMISE that I will never pass in a smaller array than this.” And the compiler says, “Yeah, fine,” and trusts you to not do it.</p>
<p>And then the compiler can make certain code optimizations, safe in the knowledge that you, the programmer, will always do the right thing.</p>
<p></p>
<h2 data-number="33.3" id="equivalent-initializers"><span class="header-section-number">33.3</span> Equivalent Initializers</h2>
<p></p>
<p>C is a little bit, shall we say, <em>flexible</em> when it comes to array initializers.</p>
<p>We’ve already seen some of this, where any missing values are replaced with zero.</p>
<p>For example, we can initialize a 5 element array to <code>1,2,0,0,0</code> with this:</p>
<div class="sourceCode" id="cb635"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb635-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb635-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> a<span class="op">[</span><span class="dv">5</span><span class="op">]</span> <span class="op">=</span> <span class="op">{</span><span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">};</span></span></code></pre></div>
<p>Or set an array entirely to zero with:</p>
<div class="sourceCode" id="cb636"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb636-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb636-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> a<span class="op">[</span><span class="dv">5</span><span class="op">]</span> <span class="op">=</span> <span class="op">{</span><span class="dv">0</span><span class="op">};</span></span></code></pre></div>
<p>But things get interesting when initializing multidimensional arrays.</p>
<p>Let’s make an array of 3 rows and 2 columns:</p>
<div class="sourceCode" id="cb637"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb637-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb637-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> a<span class="op">[</span><span class="dv">3</span><span class="op">][</span><span class="dv">2</span><span class="op">];</span></span></code></pre></div>
<p>Let’s write some code to initialize it and print the result:</p>
<div class="sourceCode" id="cb638"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb638-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb638-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb638-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb638-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb638-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb638-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb638-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb638-4" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb638-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb638-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> a<span class="op">[</span><span class="dv">3</span><span class="op">][</span><span class="dv">2</span><span class="op">]</span> <span class="op">=</span> <span class="op">{</span></span>
<span id="cb638-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb638-6" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span><span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">},</span></span>
<span id="cb638-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb638-7" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span><span class="dv">3</span><span class="op">,</span> <span class="dv">4</span><span class="op">},</span></span>
<span id="cb638-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb638-8" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span><span class="dv">5</span><span class="op">,</span> <span class="dv">6</span><span class="op">}</span></span>
<span id="cb638-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb638-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span>
<span id="cb638-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb638-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb638-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb638-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> row <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> row <span class="op">&lt;</span> <span class="dv">3</span><span class="op">;</span> row<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb638-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb638-12" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> col <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> col <span class="op">&lt;</span> <span class="dv">2</span><span class="op">;</span> col<span class="op">++)</span></span>
<span id="cb638-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb638-13" aria-hidden="true" tabindex="-1"></a>            printf<span class="op">(</span><span class="st">"</span><span class="sc">%d</span><span class="st"> "</span><span class="op">,</span> a<span class="op">[</span>row<span class="op">][</span>col<span class="op">]);</span></span>
<span id="cb638-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb638-14" aria-hidden="true" tabindex="-1"></a>        printf<span class="op">(</span><span class="st">"</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb638-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb638-15" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb638-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb638-16" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>And when we run it, we get the expected:</p>
<div class="sourceCode" id="cb639"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb639-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb639-1" aria-hidden="true" tabindex="-1"></a>1 2</span>
<span id="cb639-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb639-2" aria-hidden="true" tabindex="-1"></a>3 4</span>
<span id="cb639-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb639-3" aria-hidden="true" tabindex="-1"></a>5 6</span></code></pre></div>
<p>Let’s leave off some of the initializer elements and see they get set to zero:</p>
<div class="sourceCode" id="cb640"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb640-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb640-1" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> a<span class="op">[</span><span class="dv">3</span><span class="op">][</span><span class="dv">2</span><span class="op">]</span> <span class="op">=</span> <span class="op">{</span></span>
<span id="cb640-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb640-2" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span><span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">},</span></span>
<span id="cb640-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb640-3" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span><span class="dv">3</span><span class="op">},</span>    <span class="co">// Left off the 4!</span></span>
<span id="cb640-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb640-4" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span><span class="dv">5</span><span class="op">,</span> <span class="dv">6</span><span class="op">}</span></span>
<span id="cb640-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb640-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span></code></pre></div>
<p>which produces:</p>
<div class="sourceCode" id="cb641"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb641-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb641-1" aria-hidden="true" tabindex="-1"></a>1 2</span>
<span id="cb641-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb641-2" aria-hidden="true" tabindex="-1"></a>3 0</span>
<span id="cb641-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb641-3" aria-hidden="true" tabindex="-1"></a>5 6</span></code></pre></div>
<p>Now let’s leave off the entire last middle element:</p>
<div class="sourceCode" id="cb642"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb642-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb642-1" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> a<span class="op">[</span><span class="dv">3</span><span class="op">][</span><span class="dv">2</span><span class="op">]</span> <span class="op">=</span> <span class="op">{</span></span>
<span id="cb642-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb642-2" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span><span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">},</span></span>
<span id="cb642-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb642-3" aria-hidden="true" tabindex="-1"></a>        <span class="co">// {3, 4},   // Just cut this whole thing out</span></span>
<span id="cb642-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb642-4" aria-hidden="true" tabindex="-1"></a>        <span class="op">{</span><span class="dv">5</span><span class="op">,</span> <span class="dv">6</span><span class="op">}</span></span>
<span id="cb642-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb642-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">};</span></span></code></pre></div>
<p>And now we get this, which might not be what you expect:</p>
<div class="sourceCode" id="cb643"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb643-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb643-1" aria-hidden="true" tabindex="-1"></a>1 2</span>
<span id="cb643-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb643-2" aria-hidden="true" tabindex="-1"></a>5 6</span>
<span id="cb643-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb643-3" aria-hidden="true" tabindex="-1"></a>0 0</span></code></pre></div>
<p>But if you stop to think about it, we only provided enough initializers for two rows, so they got used for the first two rows. And the remaining elements were initialized to zero.</p>
<p>So far so good. Generally, if we leave off parts of the initializer, the compiler sets the corresponding elements to <code>0</code>.</p>
<p>But let’s get <em>crazy</em>.</p>
<div class="sourceCode" id="cb644"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb644-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb644-1" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> a<span class="op">[</span><span class="dv">3</span><span class="op">][</span><span class="dv">2</span><span class="op">]</span> <span class="op">=</span> <span class="op">{</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> <span class="dv">4</span><span class="op">,</span> <span class="dv">5</span><span class="op">,</span> <span class="dv">6</span> <span class="op">};</span></span></code></pre></div>
<p>What—? That’s a 2D array, but it only has a 1D initializer!</p>
<p>Turns out that’s legal (though GCC will warn about it with the proper warnings turned on).</p>
<p>Basically, what it does is starts filling in elements in row 0, then row 1, then row 2 from left to right.</p>
<p>So when we print, it prints in order:</p>
<div class="sourceCode" id="cb645"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb645-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb645-1" aria-hidden="true" tabindex="-1"></a>1 2</span>
<span id="cb645-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb645-2" aria-hidden="true" tabindex="-1"></a>3 4</span>
<span id="cb645-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb645-3" aria-hidden="true" tabindex="-1"></a>5 6</span></code></pre></div>
<p>If we leave some off:</p>
<div class="sourceCode" id="cb646"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb646-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb646-1" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> a<span class="op">[</span><span class="dv">3</span><span class="op">][</span><span class="dv">2</span><span class="op">]</span> <span class="op">=</span> <span class="op">{</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">3</span> <span class="op">};</span></span></code></pre></div>
<p>they fill with <code>0</code>:</p>
<div class="sourceCode" id="cb647"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb647-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb647-1" aria-hidden="true" tabindex="-1"></a>1 2</span>
<span id="cb647-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb647-2" aria-hidden="true" tabindex="-1"></a>3 0</span>
<span id="cb647-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb647-3" aria-hidden="true" tabindex="-1"></a>0 0</span></code></pre></div>
<p>So if you want to fill the whole array with <code>0</code>, then go ahead and:</p>
<div class="sourceCode" id="cb648"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb648-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb648-1" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> a<span class="op">[</span><span class="dv">3</span><span class="op">][</span><span class="dv">2</span><span class="op">]</span> <span class="op">=</span> <span class="op">{</span><span class="dv">0</span><span class="op">};</span></span></code></pre></div>
<p>But my recommendation is if you have a 2D array, use a 2D initializer. It just makes the code more readable. (Except for initializing the whole array with <code>0</code>, in which case it’s idiomatic to use <code>{0}</code> no matter the dimension of the array.)</p>
<p></p>
<!-- Beej's guide to C

# vim: ts=4:sw=4:nosi:et:tw=72
-->
<h1 data-number="34" id="setjmp-longjmp"><span class="header-section-number">34</span> Long Jumps with <code>setjmp</code>, <code>longjmp</code></h1>
<p></p>
<p>We’ve already seen <code>goto</code>, which jumps in function scope. But <code>longjmp()</code> allows you to jump back to an earlier point in execution, back to a function that called this one.</p>
<p>There are a lot of limitations and caveats, but this can be a useful function for bailing out from deep in the call stack back up to an earlier state.</p>
<p>In my experience, this is very rarely-used functionality.</p>
<h2 data-number="34.1" id="using-setjmp-and-longjmp"><span class="header-section-number">34.1</span> Using <code>setjmp</code> and <code>longjmp</code></h2>
<p> </p>
<p>The dance we’re going to do here is to basically put a bookmark in execution with <code>setjmp()</code>. Later on, we’ll call <code>longjmp()</code> and it’ll jump back to the earlier point in execution where we set the bookmark with <code>setjmp()</code>.</p>
<p>And it can do this even if you’ve called subfunctions.</p>
<p>Here’s a quick demo where we call into functions a couple levels deep and then bail out of it.</p>
<p>We’re going to use a file scope variable <code>env</code> to keep the <em>state</em> of things when we call <code>setjmp()</code> so we can restore them when we call <code>longjmp()</code> later. This is the variable in which we remember our “place”.</p>
<p>The variable <code>env</code> is of type <code>jmp_buf</code>, an opaque type declared in <code>&lt;setjmp.h&gt;</code>.</p>
<div class="sourceCode" id="cb649"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb649-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb649-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb649-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb649-2"></a><span class="pp">#include </span><span class="im">&lt;setjmp.h&gt;</span></span>
<span id="cb649-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb649-3"></a></span>
<span id="cb649-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb649-4"></a>jmp_buf env<span class="op">;</span></span>
<span id="cb649-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb649-5"></a></span>
<span id="cb649-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb649-6"></a><span class="dt">void</span> depth2<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb649-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb649-7"></a><span class="op">{</span></span>
<span id="cb649-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb649-8"></a>    printf<span class="op">(</span><span class="st">"Entering depth 2</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb649-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb649-9"></a>    longjmp<span class="op">(</span>env<span class="op">,</span> <span class="dv">3490</span><span class="op">);</span>           <span class="co">// Bail out</span></span>
<span id="cb649-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb649-10"></a>    printf<span class="op">(</span><span class="st">"Leaving depth 2</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span>  <span class="co">// This won't happen</span></span>
<span id="cb649-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb649-11"></a><span class="op">}</span></span>
<span id="cb649-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb649-12"></a></span>
<span id="cb649-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb649-13"></a><span class="dt">void</span> depth1<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb649-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb649-14"></a><span class="op">{</span></span>
<span id="cb649-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb649-15"></a>    printf<span class="op">(</span><span class="st">"Entering depth 1</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb649-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb649-16"></a>    depth2<span class="op">();</span></span>
<span id="cb649-17"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb649-17"></a>    printf<span class="op">(</span><span class="st">"Leaving depth 1</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span>  <span class="co">// This won't happen</span></span>
<span id="cb649-18"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb649-18"></a><span class="op">}</span></span>
<span id="cb649-19"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb649-19"></a></span>
<span id="cb649-20"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb649-20"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb649-21"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb649-21"></a><span class="op">{</span></span>
<span id="cb649-22"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb649-22"></a>    <span class="cf">switch</span> <span class="op">(</span>setjmp<span class="op">(</span>env<span class="op">))</span> <span class="op">{</span></span>
<span id="cb649-23"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb649-23"></a>      <span class="cf">case</span> <span class="dv">0</span><span class="op">:</span></span>
<span id="cb649-24"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb649-24"></a>          printf<span class="op">(</span><span class="st">"Calling into functions, setjmp() returned 0</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb649-25"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb649-25"></a>          depth1<span class="op">();</span></span>
<span id="cb649-26"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb649-26"></a>          printf<span class="op">(</span><span class="st">"Returned from functions</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span>  <span class="co">// This won't happen</span></span>
<span id="cb649-27"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb649-27"></a>          <span class="cf">break</span><span class="op">;</span></span>
<span id="cb649-28"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb649-28"></a></span>
<span id="cb649-29"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb649-29"></a>      <span class="cf">case</span> <span class="dv">3490</span><span class="op">:</span></span>
<span id="cb649-30"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb649-30"></a>          printf<span class="op">(</span><span class="st">"Bailed back to main, setjmp() returned 3490</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb649-31"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb649-31"></a>          <span class="cf">break</span><span class="op">;</span></span>
<span id="cb649-32"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb649-32"></a>    <span class="op">}</span></span>
<span id="cb649-33"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb649-33"></a><span class="op">}</span></span></code></pre></div>
<p>When run, this outputs:</p>
<div class="sourceCode" id="cb650"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb650-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb650-1" aria-hidden="true" tabindex="-1"></a>Calling into functions, setjmp() returned 0</span>
<span id="cb650-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb650-2" aria-hidden="true" tabindex="-1"></a>Entering depth 1</span>
<span id="cb650-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb650-3" aria-hidden="true" tabindex="-1"></a>Entering depth 2</span>
<span id="cb650-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb650-4" aria-hidden="true" tabindex="-1"></a>Bailed back to main, setjmp() returned 3490</span></code></pre></div>
<p>If you try to take that output and match it up with the code, it’s clear there’s some really <em>funky</em> stuff going on.</p>
<p>One of the most notable things is that <code>setjmp()</code> returns <em>twice</em>. What the actual frank? What is this sorcery?!</p>
<p>So here’s the deal: if <code>setjmp()</code> returns <code>0</code>, it means that you’ve successfully set the “bookmark” at that point.</p>
<p>If it returns non-zero, it means you’ve just returned to the “bookmark” set earlier. (And the value returned is the one you pass to <code>longjmp()</code>.)</p>
<p>This way you can tell the difference between setting the bookmark and returning to it later.</p>
<p>So when the code, above, calls <code>setjmp()</code> the first time, <code>setjmp()</code> <em>stores</em> the state in the <code>env</code> variable and returns <code>0</code>. Later when we call <code>longjmp()</code> with that same <code>env</code>, it restores the state and <code>setjmp()</code> returns the value <code>longjmp()</code> was passed.</p>
<p> </p>
<h2 data-number="34.2" id="pitfalls"><span class="header-section-number">34.2</span> Pitfalls</h2>
<p>Under the hood, this is pretty straightforward. Typically the <em>stack pointer</em> keeps track of the locations in memory that local variables are stored, and the <em>program counter</em> keeps track of the address of the currently-executing instruction<a href="https://beej.us/guide/bgc/html/index-wide.html#fn179" class="footnote-ref" id="fnref179" role="doc-noteref"><sup>179</sup></a>.</p>
<p>So if we want to jump back to an earlier function, it’s basically only a matter of restoring the stack pointer and program counter to the values kept in the <code>jmp_buf</code> variable, and making sure the return value is set correctly. And then execution will resume there.</p>
<p>But a variety of factors confound this, making a significant number of undefined behavior traps.</p>
<h3 data-number="34.2.1" id="the-values-of-local-variables"><span class="header-section-number">34.2.1</span> The Values of Local Variables</h3>
<p></p>
<p>If you want the values of automatic (non-<code>static</code> and non-<code>extern</code>) local variables to persist in the function that called <code>setjmp()</code> after a <code>longjmp()</code> happens, you must declare those variables to be <code>volatile</code>.</p>
<p>Technically, they only have to be <code>volatile</code> if they change between the time <code>setjmp()</code> is called and <code>longjmp()</code> is called<a href="https://beej.us/guide/bgc/html/index-wide.html#fn180" class="footnote-ref" id="fnref180" role="doc-noteref"><sup>180</sup></a>.</p>
<p>For example, if we run this code:</p>
<div class="sourceCode" id="cb651"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb651-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb651-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> x <span class="op">=</span> <span class="dv">20</span><span class="op">;</span></span>
<span id="cb651-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb651-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb651-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb651-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>setjmp<span class="op">(</span>env<span class="op">)</span> <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb651-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb651-4" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="dv">30</span><span class="op">;</span></span>
<span id="cb651-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb651-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>and then later <code>longjmp()</code> back, the value of <code>x</code> will be indeterminate.</p>
<p>If we want to fix this, <code>x</code> must be <code>volatile</code>:</p>
<div class="sourceCode" id="cb652"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb652-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb652-1" aria-hidden="true" tabindex="-1"></a><span class="dt">volatile</span> <span class="dt">int</span> x <span class="op">=</span> <span class="dv">20</span><span class="op">;</span></span>
<span id="cb652-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb652-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb652-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb652-3" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>setjmp<span class="op">(</span>env<span class="op">)</span> <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb652-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb652-4" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> <span class="dv">30</span><span class="op">;</span></span>
<span id="cb652-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb652-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p></p>
<p></p>
<p>Now the value will be the correct <code>30</code> after a <code>longjmp()</code> returns us to this point.</p>
<h3 data-number="34.2.2" id="how-much-state-is-saved"><span class="header-section-number">34.2.2</span> How Much State is Saved?</h3>
<p> </p>
<p>When you <code>longjmp()</code>, execution resumes at the point of the corresponding <code>setjmp()</code>. And that’s it.</p>
<p></p>
<p>The spec points out that it’s just as if you’d jumped back into the function at that point with local variables set to whatever values they had when the <code>longjmp()</code> call was made.</p>
<p></p>
<p>Things that aren’t restored include, paraphrasing the spec:</p>
<ul>
<li>Floating point status flags</li>
<li>Open files</li>
<li>Any other component of the abstract machine</li>
</ul>
<h3 data-number="34.2.3" id="you-cant-name-anything-setjmp"><span class="header-section-number">34.2.3</span> You Can’t Name Anything <code>setjmp</code></h3>
<p>You can’t have any <code>extern</code> identifiers with the name <code>setjmp</code>. Or, if <code>setjmp</code> is a macro, you can’t undefine it.</p>
<p>Both are undefined behavior.</p>
<h3 data-number="34.2.4" id="you-cant-setjmp-in-a-larger-expression"><span class="header-section-number">34.2.4</span> You Can’t <code>setjmp()</code> in a Larger Expression</h3>
<p></p>
<p>That is, you can’t do something like this:</p>
<div class="sourceCode" id="cb653"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb653-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb653-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>x <span class="op">==</span> <span class="dv">12</span> <span class="op">&amp;&amp;</span> setjmp<span class="op">(</span>env<span class="op">)</span> <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span> <span class="op">...</span> <span class="op">}</span></span></code></pre></div>
<p>That’s too complex to be allowed by the spec due to the machinations that must occur when unrolling the stack and all that. We can’t <code>longjmp()</code> back into some complex expression that’s only been partially executed.</p>
<p>So there are limits on the complexity of that expression.</p>
<ul>
<li><p>It can be the entire controlling expression of the conditional.</p>
<div class="sourceCode" id="cb654"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb654-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb654-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>setjmp<span class="op">(</span>env<span class="op">))</span> <span class="op">{...}</span></span></code></pre></div>
<div class="sourceCode" id="cb655"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb655-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb655-1" aria-hidden="true" tabindex="-1"></a><span class="cf">switch</span> <span class="op">(</span>setjmp<span class="op">(</span>env<span class="op">))</span> <span class="op">{...}</span></span></code></pre></div></li>
<li><p>It can be part of a relational or equality expression, as long as the other operand is an integer constant. And the whole thing is the controlling expression of the conditional.</p>
<div class="sourceCode" id="cb656"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb656-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb656-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>setjmp<span class="op">(</span>env<span class="op">)</span> <span class="op">==</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{...}</span></span></code></pre></div></li>
<li><p>The operand to a logical NOT (<code>!</code>) operation, being the entire controlling expression.</p>
<div class="sourceCode" id="cb657"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb657-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb657-1" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(!</span>setjmp<span class="op">(</span>env<span class="op">))</span> <span class="op">{...}</span></span></code></pre></div></li>
<li><p>A standalone expression, possibly cast to <code>void</code>.</p>
<div class="sourceCode" id="cb658"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb658-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb658-1" aria-hidden="true" tabindex="-1"></a>setjmp<span class="op">(</span>env<span class="op">);</span></span></code></pre></div>
<div class="sourceCode" id="cb659"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb659-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb659-1" aria-hidden="true" tabindex="-1"></a><span class="op">(</span><span class="dt">void</span><span class="op">)</span>setjmp<span class="op">(</span>env<span class="op">);</span></span></code></pre></div></li>
</ul>
<p></p>
<h3 data-number="34.2.5" id="when-cant-you-longjmp"><span class="header-section-number">34.2.5</span> When Can’t You <code>longjmp()</code>?</h3>
<p></p>
<p>It’s undefined behavior if:</p>
<ul>
<li>You didn’t call <code>setjmp()</code> earlier</li>
<li>You called <code>setjmp()</code> from another thread</li>
<li>You called <code>setjmp()</code> in the scope of a variable length array (VLA), and execution left the scope of that VLA before <code>longjmp()</code> was called.</li>
<li>The function containing the <code>setjmp()</code> exited before <code>longjmp()</code> was called.</li>
</ul>
<p>On that last one, “exited” includes normal returns from the function, as well as the case if another <code>longjmp()</code> jumped back to “earlier” in the call stack than the function in question.</p>
<h3 data-number="34.2.6" id="you-cant-pass-0-to-longjmp"><span class="header-section-number">34.2.6</span> You Can’t Pass <code>0</code> to <code>longjmp()</code></h3>
<p>If you try to pass the value <code>0</code> to <code>longjmp()</code>, it will silently change that value to <code>1</code>.</p>
<p>Since <code>setjmp()</code> ultimately returns this value, and having <code>setjmp()</code> return <code>0</code> has special meaning, returning <code>0</code> is prohibited.</p>
<h3 data-number="34.2.7" id="longjmp-and-variable-length-arrays"><span class="header-section-number">34.2.7</span> <code>longjmp()</code> and Variable Length Arrays</h3>
<p>If you are in scope of a VLA and <code>longjmp()</code> out there, the memory allocated to the VLA could leak<a href="https://beej.us/guide/bgc/html/index-wide.html#fn181" class="footnote-ref" id="fnref181" role="doc-noteref"><sup>181</sup></a>.</p>
<p>Same thing happens if you <code>longjmp()</code> back over any earlier functions that had VLAs still in scope.</p>
<p>This is one thing that really bugged me able VLAs—that you could write perfectly legitimate C code that squandered memory. But, hey—I’m not in charge of the spec.</p>
<p> </p>
<!-- Beej's guide to C

# vim: ts=4:sw=4:nosi:et:tw=72
-->
<h1 data-number="35" id="incomplete-types"><span class="header-section-number">35</span> Incomplete Types</h1>
<p></p>
<p>It might surprise you to learn that this builds without error:</p>
<div class="sourceCode" id="cb660"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb660-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb660-1" aria-hidden="true" tabindex="-1"></a><span class="kw">extern</span> <span class="dt">int</span> a<span class="op">[];</span></span>
<span id="cb660-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb660-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb660-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb660-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb660-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb660-4" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb660-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb660-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> foo <span class="op">*</span>x<span class="op">;</span></span>
<span id="cb660-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb660-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">union</span> bar <span class="op">*</span>y<span class="op">;</span></span>
<span id="cb660-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb660-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">enum</span> baz <span class="op">*</span>z<span class="op">;</span></span>
<span id="cb660-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb660-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>We never gave a size for <code>a</code>. And we have pointers to <code>struct</code>s <code>foo</code>, <code>bar</code>, and <code>baz</code> that never seem to be declared anywhere.</p>
<p>And the only warnings I get are that <code>x</code>, <code>y</code>, and <code>z</code> are unused.</p>
<p>These are examples of <em>incomplete types</em>.</p>
<p>An incomplete type is a type the size (i.e.&nbsp;the size you’d get back from <code>sizeof</code>) for which is not known. Another way to think of it is a type that you haven’t finished declaring.</p>
<p>You can have a pointer to an incomplete type, but you can’t dereference it or use pointer arithmetic on it. And you can’t <code>sizeof</code> it.</p>
<p>So what can you do with it?</p>
<h2 data-number="35.1" id="use-case-self-referential-structures"><span class="header-section-number">35.1</span> Use Case: Self-Referential Structures</h2>
<p></p>
<p>I only know of one real use case: forward references to <code>struct</code>s or <code>union</code>s with self-referential or co-dependent structures. (I’m going to use <code>struct</code> for the rest of these examples, but they all apply equally to <code>union</code>s, as well.)</p>
<p>Let’s do the classic example first.</p>
<p>But before I do, know this! As you declare a <code>struct</code>, the <code>struct</code> is incomplete until the closing brace is reached!</p>
<div class="sourceCode" id="cb661"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb661-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb661-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> antelope <span class="op">{</span>              <span class="co">// struct antelope is incomplete here</span></span>
<span id="cb661-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb661-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> leg_count<span class="op">;</span>             <span class="co">// Still incomplete</span></span>
<span id="cb661-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb661-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> stomach_fullness<span class="op">;</span>    <span class="co">// Still incomplete</span></span>
<span id="cb661-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb661-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">float</span> top_speed<span class="op">;</span>           <span class="co">// Still incomplete</span></span>
<span id="cb661-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb661-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">char</span> <span class="op">*</span>nickname<span class="op">;</span>            <span class="co">// Still incomplete</span></span>
<span id="cb661-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb661-6" aria-hidden="true" tabindex="-1"></a><span class="op">};</span>                             <span class="co">// NOW it's complete.</span></span></code></pre></div>
<p>So what? Seems sane enough.</p>
<p>But what if we’re doing a linked list? Each linked list node needs to have a reference to another node. But how can we create a reference to another node if we haven’t finished even declaring the node yet?</p>
<p>C’s allowance for incomplete types makes it possible. We can’t declare a node, but we <em>can</em> declare a pointer to one, even if it’s incomplete!</p>
<div class="sourceCode" id="cb662"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb662-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb662-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> node <span class="op">{</span></span>
<span id="cb662-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb662-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> val<span class="op">;</span></span>
<span id="cb662-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb662-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> node <span class="op">*</span>next<span class="op">;</span>  <span class="co">// struct node is incomplete, but that's OK!</span></span>
<span id="cb662-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb662-4" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
<p>Even though the <code>struct node</code> is incomplete on line 3, we can still declare a pointer to one<a href="https://beej.us/guide/bgc/html/index-wide.html#fn182" class="footnote-ref" id="fnref182" role="doc-noteref"><sup>182</sup></a>.</p>
<p>We can do the same thing if we have two different <code>struct</code>s that refer to each other:</p>
<div class="sourceCode" id="cb663"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb663-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb663-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> a <span class="op">{</span></span>
<span id="cb663-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb663-2" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> b <span class="op">*</span>x<span class="op">;</span>  <span class="co">// Refers to a `struct b`</span></span>
<span id="cb663-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb663-3" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb663-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb663-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb663-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb663-5" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> b <span class="op">{</span></span>
<span id="cb663-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb663-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">struct</span> a <span class="op">*</span>x<span class="op">;</span>  <span class="co">// Refers to a `struct a`</span></span>
<span id="cb663-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb663-7" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
<p>We’d never be able to make that pair of structures without the relaxed rules for incomplete types.</p>
<p></p>
<h2 data-number="35.2" id="incomplete-type-error-messages"><span class="header-section-number">35.2</span> Incomplete Type Error Messages</h2>
<p>Are you getting errors like these?</p>
<div class="sourceCode" id="cb664"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb664-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb664-1" aria-hidden="true" tabindex="-1"></a>invalid application of ‘sizeof’ to incomplete type</span>
<span id="cb664-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb664-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb664-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb664-3" aria-hidden="true" tabindex="-1"></a>invalid use of undefined type</span>
<span id="cb664-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb664-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb664-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb664-5" aria-hidden="true" tabindex="-1"></a>dereferencing pointer to incomplete type</span></code></pre></div>
<p>Most likely culprit: you probably forgot to <code>#include</code> the header file that declares the type.</p>
<h2 data-number="35.3" id="other-incomplete-types"><span class="header-section-number">35.3</span> Other Incomplete Types</h2>
<p>Declaring a <code>struct</code> or <code>union</code> with no body makes an incomplete type, e.g.&nbsp;<code>struct foo;</code>.</p>
<p><code>enums</code> are incomplete until the closing brace.</p>
<p><code>void</code> is an incomplete type.</p>
<p>Arrays declared <code>extern</code> with no size are incomplete, e.g.:</p>
<div class="sourceCode" id="cb665"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb665-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb665-1" aria-hidden="true" tabindex="-1"></a><span class="kw">extern</span> <span class="dt">int</span> a<span class="op">[];</span></span></code></pre></div>
<p>If it’s a non-<code>extern</code> array with no size followed by an initializer, it’s incomplete until the closing brace of the initializer.</p>
<h2 data-number="35.4" id="use-case-arrays-in-header-files"><span class="header-section-number">35.4</span> Use Case: Arrays in Header Files</h2>
<p>It can be useful to declare incomplete array types in header files. In those cases, the actual storage (where the complete array is declared) should be in a single <code>.c</code> file. If you put it in the <code>.h</code> file, it will be duplicated every time the header file is included.</p>
<p>So what you can do is make a header file with an incomplete type that refers to the array, like so:</p>
<div class="sourceCode" id="cb666"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb666-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb666-1"></a><span class="co">// File: bar.h</span></span>
<span id="cb666-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb666-2"></a></span>
<span id="cb666-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb666-3"></a><span class="pp">#ifndef BAR_H</span></span>
<span id="cb666-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb666-4"></a><span class="pp">#define BAR_H</span></span>
<span id="cb666-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb666-5"></a></span>
<span id="cb666-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb666-6"></a><span class="kw">extern</span> <span class="dt">int</span> my_array<span class="op">[];</span>  <span class="co">// Incomplete type</span></span>
<span id="cb666-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb666-7"></a></span>
<span id="cb666-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb666-8"></a><span class="pp">#endif</span></span></code></pre></div>
<p>And the in the <code>.c</code> file, actually define the array:</p>
<div class="sourceCode" id="cb667"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb667-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb667-1"></a><span class="co">// File: bar.c</span></span>
<span id="cb667-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb667-2"></a></span>
<span id="cb667-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb667-3"></a><span class="dt">int</span> my_array<span class="op">[</span><span class="dv">1024</span><span class="op">];</span>     <span class="co">// Complete type!</span></span></code></pre></div>
<p>Then you can include the header from as many places as you’d like, and every one of those places will refer to the same underlying <code>my_array</code>.</p>
<div class="sourceCode" id="cb668"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb668-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb668-1"></a><span class="co">// File: foo.c</span></span>
<span id="cb668-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb668-2"></a></span>
<span id="cb668-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb668-3"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb668-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb668-4"></a><span class="pp">#include </span><span class="im">"bar.h"</span><span class="pp">    </span><span class="co">// includes the incomplete type for my_array</span></span>
<span id="cb668-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb668-5"></a></span>
<span id="cb668-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb668-6"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb668-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb668-7"></a><span class="op">{</span></span>
<span id="cb668-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb668-8"></a>    my_array<span class="op">[</span><span class="dv">0</span><span class="op">]</span> <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb668-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb668-9"></a></span>
<span id="cb668-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb668-10"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> my_array<span class="op">[</span><span class="dv">0</span><span class="op">]);</span></span>
<span id="cb668-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb668-11"></a><span class="op">}</span></span></code></pre></div>
<p>When compiling multiple files, remember to specify all the <code>.c</code> files to the compiler, but not the <code>.h</code> files, e.g.:</p>
<div class="sourceCode" id="cb669"><pre class="sourceCode zsh"><code class="sourceCode zsh"><span id="cb669-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb669-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-o</span> foo foo.c bar.c</span></code></pre></div>
<h2 data-number="35.5" id="completing-incomplete-types"><span class="header-section-number">35.5</span> Completing Incomplete Types</h2>
<p>If you have an incomplete type, you can complete it by defining the complete <code>struct</code>, <code>union</code>, <code>enum</code>, or array in the same scope.</p>
<div class="sourceCode" id="cb670"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb670-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb670-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> foo<span class="op">;</span>        <span class="co">// incomplete type</span></span>
<span id="cb670-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb670-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb670-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb670-3" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> foo <span class="op">*</span>p<span class="op">;</span>     <span class="co">// pointer, no problem</span></span>
<span id="cb670-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb670-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb670-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb670-5" aria-hidden="true" tabindex="-1"></a><span class="co">// struct foo f;   // Error: incomplete type!</span></span>
<span id="cb670-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb670-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb670-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb670-7" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> foo <span class="op">{</span></span>
<span id="cb670-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb670-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> x<span class="op">,</span> y<span class="op">,</span> z<span class="op">;</span></span>
<span id="cb670-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb670-9" aria-hidden="true" tabindex="-1"></a><span class="op">};</span>                 <span class="co">// Now the struct foo is complete!</span></span>
<span id="cb670-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb670-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb670-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb670-11" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> foo f<span class="op">;</span>      <span class="co">// Success!</span></span></code></pre></div>
<p>Note that though <code>void</code> is an incomplete type, there’s no way to complete it. Not that anyone ever thinks of doing that weird thing. But it does explain why you can do this:</p>
<div class="sourceCode" id="cb671"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb671-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb671-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> <span class="op">*</span>p<span class="op">;</span>             <span class="co">// OK: pointer to incomplete type</span></span></code></pre></div>
<p>and not either of these:</p>
<div class="sourceCode" id="cb672"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb672-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb672-1" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> v<span class="op">;</span>              <span class="co">// Error: declare variable of incomplete type</span></span>
<span id="cb672-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb672-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb672-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb672-3" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> <span class="op">*</span>p<span class="op">);</span>  <span class="co">// Error: dereference incomplete type</span></span></code></pre></div>
<p>The more you know…</p>
<p></p>
<!-- Beej's guide to C

# vim: ts=4:sw=4:nosi:et:tw=72
-->
<h1 data-number="36" id="complex-numbers"><span class="header-section-number">36</span> Complex Numbers</h1>
<p></p>
<p>A tiny primer on <a href="https://en.wikipedia.org/wiki/Complex_number">Complex numbers</a><a href="https://beej.us/guide/bgc/html/index-wide.html#fn183" class="footnote-ref" id="fnref183" role="doc-noteref"><sup>183</sup></a> stolen directly from Wikipedia:</p>
<blockquote>
<p>A <strong>complex number</strong> is a number that can be expressed in the form <span class="math inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="47" style="font-size: 101.6%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D44E TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-mi class="mjx-i" space="3"><mjx-c class="mjx-c1D44F TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D456 TEX-I"></mjx-c></mjx-mi></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>a</mi><mo>+</mo><mi>b</mi><mi>i</mi></math></mjx-assistive-mml></mjx-container></span>, where <span class="math inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="48" style="font-size: 101.6%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D44E TEX-I"></mjx-c></mjx-mi></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>a</mi></math></mjx-assistive-mml></mjx-container></span> and <span class="math inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="49" style="font-size: 101.6%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D44F TEX-I"></mjx-c></mjx-mi></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>b</mi></math></mjx-assistive-mml></mjx-container></span> are real numbers [i.e.&nbsp;floating point types in C], and <span class="math inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="50" style="font-size: 101.6%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D456 TEX-I"></mjx-c></mjx-mi></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>i</mi></math></mjx-assistive-mml></mjx-container></span> represents the imaginary unit, satisfying the equation <span class="math inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="51" style="font-size: 101.6%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-msup><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D456 TEX-I"></mjx-c></mjx-mi><mjx-script style="vertical-align: 0.363em;"><mjx-mn class="mjx-n" size="s"><mjx-c class="mjx-c32"></mjx-c></mjx-mn></mjx-script></mjx-msup><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c3D"></mjx-c></mjx-mo><mjx-mo class="mjx-n" space="4"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi>i</mi><mn>2</mn></msup><mo>=</mo><mo>−</mo><mn>1</mn></math></mjx-assistive-mml></mjx-container></span>. Because no real number satisfies this equation, <span class="math inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="52" style="font-size: 101.6%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D456 TEX-I"></mjx-c></mjx-mi></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>i</mi></math></mjx-assistive-mml></mjx-container></span> is called an imaginary number. For the complex number <span class="math inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="53" style="font-size: 101.6%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D44E TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-mi class="mjx-i" space="3"><mjx-c class="mjx-c1D44F TEX-I"></mjx-c></mjx-mi><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D456 TEX-I"></mjx-c></mjx-mi></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>a</mi><mo>+</mo><mi>b</mi><mi>i</mi></math></mjx-assistive-mml></mjx-container></span>, <span class="math inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="54" style="font-size: 101.6%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D44E TEX-I"></mjx-c></mjx-mi></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>a</mi></math></mjx-assistive-mml></mjx-container></span> is called the <strong>real part</strong>, and <span class="math inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="55" style="font-size: 101.6%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D44F TEX-I"></mjx-c></mjx-mi></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>b</mi></math></mjx-assistive-mml></mjx-container></span> is called the <strong>imaginary part</strong>.</p>
</blockquote>
<p>But that’s as far as I’m going to go. We’ll assume that if you’re reading this chapter, you know what a complex number is and what you want to do with them.</p>
<p>And all we need to cover is C’s faculties for doing so.</p>
<p>Turns out, though, that complex number support in a compiler is an <em>optional</em> feature. Not all compliant compilers can do it. And the ones that do, might do it to various degrees of completeness.</p>
<p>You can test if your system supports complex numbers with:</p>
<p></p>
<div class="sourceCode" id="cb673"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb673-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb673-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#ifdef __STDC_NO_COMPLEX__</span></span>
<span id="cb673-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb673-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#error Complex numbers not supported!</span></span>
<span id="cb673-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb673-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#endif</span></span></code></pre></div>
<p></p>
<p></p>
<p>Furthermore, there is a macro that indicates adherence to the ISO 60559 (IEEE 754) standard for floating point math with complex numbers, as well as the presence of the <code>_Imaginary</code> type.</p>
<div class="sourceCode" id="cb674"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb674-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb674-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#if __STDC_IEC_559_COMPLEX__ != 1</span></span>
<span id="cb674-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb674-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#error Need IEC 60559 complex support!</span></span>
<span id="cb674-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb674-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#endif</span></span></code></pre></div>
<p></p>
<p>More details on that are spelled out in Annex G in the C11 spec.</p>
<h2 data-number="36.1" id="complex-types"><span class="header-section-number">36.1</span> Complex Types</h2>
<p>To use complex numbers, <code>#include &lt;complex.h&gt;</code>.</p>
<p>With that, you get at least two types:</p>
<p> </p>
<div class="sourceCode" id="cb675"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb675-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb675-1" aria-hidden="true" tabindex="-1"></a><span class="dt">_Complex</span></span>
<span id="cb675-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb675-2" aria-hidden="true" tabindex="-1"></a><span class="dt">complex</span></span></code></pre></div>
<p>Those both mean the same thing, so you might as well use the prettier <code>complex</code>.</p>
<p></p>
<p>You also get some types for imaginary numbers if you implementation is IEC 60559-compliant:</p>
<p> </p>
<div class="sourceCode" id="cb676"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb676-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb676-1" aria-hidden="true" tabindex="-1"></a><span class="dt">_Imaginary</span></span>
<span id="cb676-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb676-2" aria-hidden="true" tabindex="-1"></a><span class="dt">imaginary</span></span></code></pre></div>
<p>These also both mean the same thing, so you might as well use the prettier <code>imaginary</code>.</p>
<p></p>
<p>You also get values for the imaginary number <span class="math inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="56" style="font-size: 101.6%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D456 TEX-I"></mjx-c></mjx-mi></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>i</mi></math></mjx-assistive-mml></mjx-container></span>, itself:</p>
<p> </p>
<div class="sourceCode" id="cb677"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb677-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb677-1" aria-hidden="true" tabindex="-1"></a>I</span>
<span id="cb677-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb677-2" aria-hidden="true" tabindex="-1"></a>_Complex_I</span>
<span id="cb677-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb677-3" aria-hidden="true" tabindex="-1"></a>_Imaginary_I</span></code></pre></div>
<p>The macro <code>I</code> is set to <code>_Imaginary_I</code> (if available), or <code>_Complex_I</code>. So just use <code>I</code> for the imaginary number.</p>
<p> </p>
<p></p>
<p>One aside: I’ve said that if a compiler has <code>__STDC_IEC_559_COMPLEX__</code> set to <code>1</code>, it must support <code>_Imaginary</code> types to be compliant. That’s my read of the spec. However, I don’t know of a single compiler that actually supports <code>_Imaginary</code> even though they have <code>__STDC_IEC_559_COMPLEX__</code> set. So I’m going to write some code with that type in here I have no way of testing. Sorry!</p>
<p> </p>
<p>OK, so now we know there’s a <code>complex</code> type, how can we use it?</p>
<h2 data-number="36.2" id="assigning-complex-numbers"><span class="header-section-number">36.2</span> Assigning Complex Numbers</h2>
<p></p>
<p>Since the complex number has a real and imaginary part, but both of them rely on floating point numbers to store values, we need to also tell C what precision to use for those parts of the complex number.</p>
<p> </p>
<p>We do that by just pinning a <code>float</code>, <code>double</code>, or <code>long double</code> to the <code>complex</code>, either before or after it.</p>
<p></p>
<p>Let’s define a complex number that uses <code>float</code> for its components:</p>
<div class="sourceCode" id="cb678"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb678-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb678-1" aria-hidden="true" tabindex="-1"></a><span class="dt">float</span> <span class="dt">complex</span> c<span class="op">;</span>   <span class="co">// Spec prefers this way</span></span>
<span id="cb678-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb678-2" aria-hidden="true" tabindex="-1"></a><span class="dt">complex</span> <span class="dt">float</span> c<span class="op">;</span>   <span class="co">// Same thing--order doesn't matter</span></span></code></pre></div>
<p>So that’s great for declarations, but how do we initialize them or assign to them?</p>
<p>Turns out we get to use some pretty natural notation. Example!</p>
<p></p>
<div class="sourceCode" id="cb679"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb679-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb679-1" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> <span class="dt">complex</span> x <span class="op">=</span> <span class="dv">5</span> <span class="op">+</span> <span class="dv">2</span><span class="op">*</span>I<span class="op">;</span></span>
<span id="cb679-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb679-2" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> <span class="dt">complex</span> y <span class="op">=</span> <span class="dv">10</span> <span class="op">+</span> <span class="dv">3</span><span class="op">*</span>I<span class="op">;</span></span></code></pre></div>
<p></p>
<p>For <span class="math inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="57" style="font-size: 101.6%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c35"></mjx-c></mjx-mn><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="3"><mjx-c class="mjx-c32"></mjx-c></mjx-mn><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D456 TEX-I"></mjx-c></mjx-mi></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>5</mn><mo>+</mo><mn>2</mn><mi>i</mi></math></mjx-assistive-mml></mjx-container></span> and <span class="math inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="58" style="font-size: 101.6%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c30"></mjx-c></mjx-mn><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2B"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="3"><mjx-c class="mjx-c33"></mjx-c></mjx-mn><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D456 TEX-I"></mjx-c></mjx-mi></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>10</mn><mo>+</mo><mn>3</mn><mi>i</mi></math></mjx-assistive-mml></mjx-container></span>, respectively.</p>
<p> </p>
<h2 data-number="36.3" id="constructing-deconstructing-and-printing"><span class="header-section-number">36.3</span> Constructing, Deconstructing, and Printing</h2>
<p>We’re getting there…</p>
<p>We’ve already seen one way to write a complex number:</p>
<div class="sourceCode" id="cb680"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb680-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb680-1" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> <span class="dt">complex</span> x <span class="op">=</span> <span class="dv">5</span> <span class="op">+</span> <span class="dv">2</span><span class="op">*</span>I<span class="op">;</span></span></code></pre></div>
<p>There’s also no problem using other floating point numbers to build it:</p>
<div class="sourceCode" id="cb681"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb681-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb681-1" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> a <span class="op">=</span> <span class="dv">5</span><span class="op">;</span></span>
<span id="cb681-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb681-2" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> b <span class="op">=</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb681-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb681-3" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> <span class="dt">complex</span> x <span class="op">=</span> a <span class="op">+</span> b<span class="op">*</span>I<span class="op">;</span></span></code></pre></div>
<p></p>
<p>There is also a set of macros to help build these. The above code could be written using the <code>CMPLX()</code> macro, like so:</p>
<div class="sourceCode" id="cb682"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb682-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb682-1" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> <span class="dt">complex</span> x <span class="op">=</span> CMPLX<span class="op">(</span><span class="dv">5</span><span class="op">,</span> <span class="dv">2</span><span class="op">);</span></span></code></pre></div>
<p>As far as I can tell in my research, these are <em>almost</em> equivalent:</p>
<div class="sourceCode" id="cb683"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb683-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb683-1" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> <span class="dt">complex</span> x <span class="op">=</span> <span class="dv">5</span> <span class="op">+</span> <span class="dv">2</span><span class="op">*</span>I<span class="op">;</span></span>
<span id="cb683-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb683-2" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> <span class="dt">complex</span> x <span class="op">=</span> CMPLX<span class="op">(</span><span class="dv">5</span><span class="op">,</span> <span class="dv">2</span><span class="op">);</span></span></code></pre></div>
<p>But the <code>CMPLX()</code> macro will handle negative zeros in the imaginary part correctly every time, whereas the other way might convert them to positive zeros. I <em>think</em><a href="https://beej.us/guide/bgc/html/index-wide.html#fn184" class="footnote-ref" id="fnref184" role="doc-noteref"><sup>184</sup></a> This seems to imply that if there’s a chance the imaginary part will be zero, you should use the macro… but someone should correct me on this if I’m mistaken!</p>
<p>The <code>CMPLX()</code> macro works on <code>double</code> types. There are two other macros for <code>float</code> and <code>long double</code>: <code>CMPLXF()</code> and <code>CMPLXL()</code>. (These “f” and “l” suffixes appear in virtually all the complex-number-related functions.)</p>
<p></p>
<p>Now let’s try the reverse: if we have a complex number, how do we break it apart into its real and imaginary parts?</p>
<p> </p>
<p>Here we have a couple functions that will extract the real and imaginary parts from the number: <code>creal()</code> and <code>cimag()</code>:</p>
<div class="sourceCode" id="cb684"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb684-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb684-1" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> <span class="dt">complex</span> x <span class="op">=</span> <span class="dv">5</span> <span class="op">+</span> <span class="dv">2</span><span class="op">*</span>I<span class="op">;</span></span>
<span id="cb684-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb684-2" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> <span class="dt">complex</span> y <span class="op">=</span> <span class="dv">10</span> <span class="op">+</span> <span class="dv">3</span><span class="op">*</span>I<span class="op">;</span></span>
<span id="cb684-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb684-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb684-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb684-4" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"x = </span><span class="sc">%f</span><span class="st"> + </span><span class="sc">%f</span><span class="st">i</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> creal<span class="op">(</span>x<span class="op">),</span> cimag<span class="op">(</span>x<span class="op">));</span></span>
<span id="cb684-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb684-5" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"y = </span><span class="sc">%f</span><span class="st"> + </span><span class="sc">%f</span><span class="st">i</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> creal<span class="op">(</span>y<span class="op">),</span> cimag<span class="op">(</span>y<span class="op">));</span></span></code></pre></div>
<p>for the output:</p>
<div class="sourceCode" id="cb685"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb685-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb685-1" aria-hidden="true" tabindex="-1"></a>x = 5.000000 + 2.000000i</span>
<span id="cb685-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb685-2" aria-hidden="true" tabindex="-1"></a>y = 10.000000 + 3.000000i</span></code></pre></div>
<p>Note that the <code>i</code> I have in the <code>printf()</code> format string is a literal <code>i</code> that gets printed—it’s not part of the format specifier. Both return values from <code>creal()</code> and <code>cimag()</code> are <code>double</code>.</p>
<p>And as usual, there are <code>float</code> and <code>long double</code> variants of these functions: <code>crealf()</code>, <code>cimagf()</code>, <code>creall()</code>, and <code>cimagl()</code>.</p>
<p> </p>
<h2 data-number="36.4" id="complex-arithmetic-and-comparisons"><span class="header-section-number">36.4</span> Complex Arithmetic and Comparisons</h2>
<p></p>
<p>Arithmetic can be performed on complex numbers, though how this works mathematically is beyond the scope of the guide.</p>
<div class="sourceCode" id="cb686"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb686-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb686-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb686-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb686-2"></a><span class="pp">#include </span><span class="im">&lt;complex.h&gt;</span></span>
<span id="cb686-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb686-3"></a></span>
<span id="cb686-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb686-4"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb686-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb686-5"></a><span class="op">{</span></span>
<span id="cb686-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb686-6"></a>    <span class="dt">double</span> <span class="dt">complex</span> x <span class="op">=</span> <span class="dv">1</span> <span class="op">+</span> <span class="dv">2</span><span class="op">*</span>I<span class="op">;</span></span>
<span id="cb686-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb686-7"></a>    <span class="dt">double</span> <span class="dt">complex</span> y <span class="op">=</span> <span class="dv">3</span> <span class="op">+</span> <span class="dv">4</span><span class="op">*</span>I<span class="op">;</span></span>
<span id="cb686-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb686-8"></a>    <span class="dt">double</span> <span class="dt">complex</span> z<span class="op">;</span></span>
<span id="cb686-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb686-9"></a></span>
<span id="cb686-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb686-10"></a>    z <span class="op">=</span> x <span class="op">+</span> y<span class="op">;</span></span>
<span id="cb686-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb686-11"></a>    printf<span class="op">(</span><span class="st">"x + y = </span><span class="sc">%f</span><span class="st"> + </span><span class="sc">%f</span><span class="st">i</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> creal<span class="op">(</span>z<span class="op">),</span> cimag<span class="op">(</span>z<span class="op">));</span></span>
<span id="cb686-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb686-12"></a></span>
<span id="cb686-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb686-13"></a>    z <span class="op">=</span> x <span class="op">-</span> y<span class="op">;</span></span>
<span id="cb686-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb686-14"></a>    printf<span class="op">(</span><span class="st">"x - y = </span><span class="sc">%f</span><span class="st"> + </span><span class="sc">%f</span><span class="st">i</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> creal<span class="op">(</span>z<span class="op">),</span> cimag<span class="op">(</span>z<span class="op">));</span></span>
<span id="cb686-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb686-15"></a></span>
<span id="cb686-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb686-16"></a>    z <span class="op">=</span> x <span class="op">*</span> y<span class="op">;</span></span>
<span id="cb686-17"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb686-17"></a>    printf<span class="op">(</span><span class="st">"x * y = </span><span class="sc">%f</span><span class="st"> + </span><span class="sc">%f</span><span class="st">i</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> creal<span class="op">(</span>z<span class="op">),</span> cimag<span class="op">(</span>z<span class="op">));</span></span>
<span id="cb686-18"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb686-18"></a></span>
<span id="cb686-19"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb686-19"></a>    z <span class="op">=</span> x <span class="op">/</span> y<span class="op">;</span></span>
<span id="cb686-20"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb686-20"></a>    printf<span class="op">(</span><span class="st">"x / y = </span><span class="sc">%f</span><span class="st"> + </span><span class="sc">%f</span><span class="st">i</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> creal<span class="op">(</span>z<span class="op">),</span> cimag<span class="op">(</span>z<span class="op">));</span></span>
<span id="cb686-21"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb686-21"></a><span class="op">}</span></span></code></pre></div>
<p>for a result of:</p>
<div class="sourceCode" id="cb687"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb687-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb687-1" aria-hidden="true" tabindex="-1"></a>x + y = 4.000000 + 6.000000i</span>
<span id="cb687-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb687-2" aria-hidden="true" tabindex="-1"></a>x - y = -2.000000 + -2.000000i</span>
<span id="cb687-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb687-3" aria-hidden="true" tabindex="-1"></a>x * y = -5.000000 + 10.000000i</span>
<span id="cb687-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb687-4" aria-hidden="true" tabindex="-1"></a>x / y = 0.440000 + 0.080000i</span></code></pre></div>
<p>You can also compare two complex numbers for equality (or inequality):</p>
<div class="sourceCode" id="cb688"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb688-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb688-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb688-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb688-2"></a><span class="pp">#include </span><span class="im">&lt;complex.h&gt;</span></span>
<span id="cb688-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb688-3"></a></span>
<span id="cb688-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb688-4"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb688-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb688-5"></a><span class="op">{</span></span>
<span id="cb688-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb688-6"></a>    <span class="dt">double</span> <span class="dt">complex</span> x <span class="op">=</span> <span class="dv">1</span> <span class="op">+</span> <span class="dv">2</span><span class="op">*</span>I<span class="op">;</span></span>
<span id="cb688-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb688-7"></a>    <span class="dt">double</span> <span class="dt">complex</span> y <span class="op">=</span> <span class="dv">3</span> <span class="op">+</span> <span class="dv">4</span><span class="op">*</span>I<span class="op">;</span></span>
<span id="cb688-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb688-8"></a></span>
<span id="cb688-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb688-9"></a>    printf<span class="op">(</span><span class="st">"x == y = </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> x <span class="op">==</span> y<span class="op">);</span>  <span class="co">// 0</span></span>
<span id="cb688-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb688-10"></a>    printf<span class="op">(</span><span class="st">"x != y = </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> x <span class="op">!=</span> y<span class="op">);</span>  <span class="co">// 1</span></span>
<span id="cb688-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb688-11"></a><span class="op">}</span></span></code></pre></div>
<p>with the output:</p>
<div class="sourceCode" id="cb689"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb689-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb689-1" aria-hidden="true" tabindex="-1"></a>x == y = 0</span>
<span id="cb689-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb689-2" aria-hidden="true" tabindex="-1"></a>x != y = 1</span></code></pre></div>
<p>They are equal if both components test equal. Note that as with all floating point, they could be equal if they’re close enough due to rounding error<a href="https://beej.us/guide/bgc/html/index-wide.html#fn185" class="footnote-ref" id="fnref185" role="doc-noteref"><sup>185</sup></a>.</p>
<p></p>
<h2 data-number="36.5" id="complex-math"><span class="header-section-number">36.5</span> Complex Math</h2>
<p>But wait! There’s more than just simple complex arithmetic!</p>
<p>Here’s a summary table of all the math functions available to you with complex numbers.</p>
<p>I’m only going to list the <code>double</code> version of each function, but for all of them there is a <code>float</code> version that you can get by appending <code>f</code> to the function name, and a <code>long double</code> version that you can get by appending <code>l</code>.</p>
<p>For example, the <code>cabs()</code> function for computing the absolute value of a complex number also has <code>cabsf()</code> and <code>cabsl()</code> variants. I’m omitting them for brevity.</p>
<h3 data-number="36.5.1" id="trigonometry-functions"><span class="header-section-number">36.5.1</span> Trigonometry Functions</h3>
<table>
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th>Function</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>ccos()</code></td>
<td>Cosine</td>
</tr>
<tr class="even">
<td><code>csin()</code></td>
<td>Sine</td>
</tr>
<tr class="odd">
<td><code>ctan()</code></td>
<td>Tangent</td>
</tr>
<tr class="even">
<td><code>cacos()</code></td>
<td>Arc cosine</td>
</tr>
<tr class="odd">
<td><code>casin()</code></td>
<td>Arc sine</td>
</tr>
<tr class="even">
<td><code>catan()</code></td>
<td>Play <em>Settlers of Catan</em></td>
</tr>
<tr class="odd">
<td><code>ccosh()</code></td>
<td>Hyperbolic cosine</td>
</tr>
<tr class="even">
<td><code>csinh()</code></td>
<td>Hyperbolic sine</td>
</tr>
<tr class="odd">
<td><code>ctanh()</code></td>
<td>Hyperbolic tangent</td>
</tr>
<tr class="even">
<td><code>cacosh()</code></td>
<td>Arc hyperbolic cosine</td>
</tr>
<tr class="odd">
<td><code>casinh()</code></td>
<td>Arc hyperbolic sine</td>
</tr>
<tr class="even">
<td><code>catanh()</code></td>
<td>Arc hyperbolic tangent</td>
</tr>
</tbody>
</table>
<h3 data-number="36.5.2" id="exponential-and-logarithmic-functions"><span class="header-section-number">36.5.2</span> Exponential and Logarithmic Functions</h3>
<table>
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th>Function</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>cexp()</code></td>
<td>Base-<span class="math inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="59" style="font-size: 101.6%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D452 TEX-I"></mjx-c></mjx-mi></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>e</mi></math></mjx-assistive-mml></mjx-container></span> exponential</td>
</tr>
<tr class="even">
<td><code>clog()</code></td>
<td>Natural (base-<span class="math inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="60" style="font-size: 101.6%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D452 TEX-I"></mjx-c></mjx-mi></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>e</mi></math></mjx-assistive-mml></mjx-container></span>) logarithm</td>
</tr>
</tbody>
</table>
<h3 data-number="36.5.3" id="power-and-absolute-value-functions"><span class="header-section-number">36.5.3</span> Power and Absolute Value Functions</h3>
<table>
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th>Function</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>cabs()</code></td>
<td>Absolute value</td>
</tr>
<tr class="even">
<td><code>cpow()</code></td>
<td>Power</td>
</tr>
<tr class="odd">
<td><code>csqrt()</code></td>
<td>Square root</td>
</tr>
</tbody>
</table>
<h3 data-number="36.5.4" id="manipulation-functions"><span class="header-section-number">36.5.4</span> Manipulation Functions</h3>
<table>
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th>Function</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>creal()</code></td>
<td>Return real part</td>
</tr>
<tr class="even">
<td><code>cimag()</code></td>
<td>Return imaginary part</td>
</tr>
<tr class="odd">
<td><code>CMPLX()</code></td>
<td>Construct a complex number</td>
</tr>
<tr class="even">
<td><code>carg()</code></td>
<td>Argument/phase angle</td>
</tr>
<tr class="odd">
<td><code>conj()</code></td>
<td>Conjugate<a href="https://beej.us/guide/bgc/html/index-wide.html#fn186" class="footnote-ref" id="fnref186" role="doc-noteref"><sup>186</sup></a></td>
</tr>
<tr class="even">
<td><code>cproj()</code></td>
<td>Projection on Riemann sphere</td>
</tr>
</tbody>
</table>
<p></p>
<!-- Beej's guide to C

# vim: ts=4:sw=4:nosi:et:tw=72
-->
<h1 data-number="37" id="fixed-width-integer-types"><span class="header-section-number">37</span> Fixed Width Integer Types</h1>
<p></p>
<p>C has all those small, bigger, and biggest integer types like <code>int</code> and <code>long</code> and all that. And you can look in <a href="https://beej.us/guide/bgc/html/index-wide.html#limits-macros">the section on limits</a> to see what the largest int is with <code>INT_MAX</code> and so on.</p>
<p>How big are those types? That is, how many bytes do they take up? We could use <code>sizeof</code> to get that answer.</p>
<p>But what if I wanted to go the other way? What if I needed a type that was exactly 32 bits (4 bytes) or at least 16 bits or somesuch?</p>
<p>How can we declare a type that’s a certain size?</p>
<p>The header <code>&lt;stdint.h&gt;</code> gives us a way.</p>
<h2 data-number="37.1" id="the-bit-sized-types"><span class="header-section-number">37.1</span> The Bit-Sized Types</h2>
<p>For both signed and unsigned integers, we can specify a type that is a certain number of bits, with some caveats, of course.</p>
<p>And there are three main classes of these types (in these examples, the <code>N</code> would be replaced by a certain number of bits):</p>
<ul>
<li>Integers of exactly a certain size (<code>intN_t</code>)</li>
<li>Integers that are at least a certain size (<code>int_leastN_t</code>)</li>
<li>Integers that are at least a certain size and are as fast as possible (<code>int_fastN_t</code>)<a href="https://beej.us/guide/bgc/html/index-wide.html#fn187" class="footnote-ref" id="fnref187" role="doc-noteref"><sup>187</sup></a></li>
</ul>
<p>How much faster is <code>fast</code>? Definitely maybe some amount faster. Probably. The spec doesn’t say how much faster, just that they’ll be the fastest on this architecture. Most C compilers are pretty good, though, so you’ll probably only see this used in places where the most possible speed needs to be guaranteed (rather than just hoping the compiler is producing pretty-dang-fast code, which it is).</p>
<p>Finally, these unsigned number types have a leading <code>u</code> to differentiate them.</p>
<p>For example, these types have the corresponding listed meaning:</p>
<p> </p>
<div class="sourceCode" id="cb690"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb690-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb690-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int32_t</span> w<span class="op">;</span>        <span class="co">// x is exactly 32 bits, signed</span></span>
<span id="cb690-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb690-2" aria-hidden="true" tabindex="-1"></a><span class="dt">uint16_t</span> x<span class="op">;</span>       <span class="co">// y is exactly 16 bits, unsigned</span></span>
<span id="cb690-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb690-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb690-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb690-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int_least8_t</span> y<span class="op">;</span>   <span class="co">// y is at least 8 bits, signed</span></span>
<span id="cb690-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb690-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb690-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb690-6" aria-hidden="true" tabindex="-1"></a><span class="dt">uint_fast64_t</span> z<span class="op">;</span>  <span class="co">// z is the fastest representation at least 64 bits, unsigned</span></span></code></pre></div>
<p>The following types are guaranteed to be defined:</p>
<div class="sourceCode" id="cb691"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb691-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb691-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int_least8_t</span>      <span class="dt">uint_least8_t</span></span>
<span id="cb691-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb691-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int_least16_t</span>     <span class="dt">uint_least16_t</span></span>
<span id="cb691-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb691-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int_least32_t</span>     <span class="dt">uint_least32_t</span></span>
<span id="cb691-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb691-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int_least64_t</span>     <span class="dt">uint_least64_t</span></span>
<span id="cb691-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb691-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb691-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb691-6" aria-hidden="true" tabindex="-1"></a><span class="dt">int_fast8_t</span>       <span class="dt">uint_fast8_t</span></span>
<span id="cb691-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb691-7" aria-hidden="true" tabindex="-1"></a><span class="dt">int_fast16_t</span>      <span class="dt">uint_fast16_t</span></span>
<span id="cb691-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb691-8" aria-hidden="true" tabindex="-1"></a><span class="dt">int_fast32_t</span>      <span class="dt">uint_fast32_t</span></span>
<span id="cb691-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb691-9" aria-hidden="true" tabindex="-1"></a><span class="dt">int_fast64_t</span>      <span class="dt">uint_fast64_t</span></span></code></pre></div>
<p>There might be others of different widths, as well, but those are optional.</p>
<p>Hey! Where are the fixed types like <code>int16_t</code>? Turns out those are entirely optional…unless certain conditions are met<a href="https://beej.us/guide/bgc/html/index-wide.html#fn188" class="footnote-ref" id="fnref188" role="doc-noteref"><sup>188</sup></a>. And if you have an average run-of-the-mill modern computer system, those conditions probably are met. And if they are, you’ll have these types:</p>
<div class="sourceCode" id="cb692"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb692-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb692-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int8_t</span>      <span class="dt">uint8_t</span></span>
<span id="cb692-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb692-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int16_t</span>     <span class="dt">uint16_t</span></span>
<span id="cb692-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb692-3" aria-hidden="true" tabindex="-1"></a><span class="dt">int32_t</span>     <span class="dt">uint32_t</span></span>
<span id="cb692-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb692-4" aria-hidden="true" tabindex="-1"></a><span class="dt">int64_t</span>     <span class="dt">uint64_t</span></span></code></pre></div>
<p>Other variants with different widths might be defined, but they’re optional.</p>
<p> </p>
<h2 data-number="37.2" id="maximum-integer-size-type"><span class="header-section-number">37.2</span> Maximum Integer Size Type</h2>
<p>There’s a type you can use that holds the largest representable integers available on the system, both signed and unsigned:</p>
<p> </p>
<div class="sourceCode" id="cb693"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb693-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb693-1" aria-hidden="true" tabindex="-1"></a><span class="dt">intmax_t</span></span>
<span id="cb693-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb693-2" aria-hidden="true" tabindex="-1"></a><span class="dt">uintmax_t</span></span></code></pre></div>
<p> </p>
<p>Use these types when you want to go as big as possible.</p>
<p>Obviously values from any other integer types of the same sign will fit in this type, necessarily.</p>
<h2 data-number="37.3" id="using-fixed-size-constants"><span class="header-section-number">37.3</span> Using Fixed Size Constants</h2>
<p>If you have a constant that you want to have fit in a certain number of bits, you can use these macros to automatically append the proper suffix onto the number (e.g.&nbsp;<code>22L</code> or <code>3490ULL</code>).</p>
<p> </p>
<div class="sourceCode" id="cb694"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb694-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb694-1" aria-hidden="true" tabindex="-1"></a>INT8_C<span class="op">(</span>x<span class="op">)</span>     UINT8_C<span class="op">(</span>x<span class="op">)</span></span>
<span id="cb694-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb694-2" aria-hidden="true" tabindex="-1"></a>INT16_C<span class="op">(</span>x<span class="op">)</span>    UINT16_C<span class="op">(</span>x<span class="op">)</span></span>
<span id="cb694-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb694-3" aria-hidden="true" tabindex="-1"></a>INT32_C<span class="op">(</span>x<span class="op">)</span>    UINT32_C<span class="op">(</span>x<span class="op">)</span></span>
<span id="cb694-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb694-4" aria-hidden="true" tabindex="-1"></a>INT64_C<span class="op">(</span>x<span class="op">)</span>    UINT64_C<span class="op">(</span>x<span class="op">)</span></span>
<span id="cb694-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb694-5" aria-hidden="true" tabindex="-1"></a>INTMAX_C<span class="op">(</span>x<span class="op">)</span>   UINTMAX_C<span class="op">(</span>x<span class="op">)</span></span></code></pre></div>
<p> </p>
<p>Again, these work only with constant integer values.</p>
<p>For example, we can use one of these to assign constant values like so:</p>
<div class="sourceCode" id="cb695"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb695-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb695-1" aria-hidden="true" tabindex="-1"></a><span class="dt">uint16_t</span> x <span class="op">=</span> UINT16_C<span class="op">(</span><span class="dv">12</span><span class="op">);</span></span>
<span id="cb695-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb695-2" aria-hidden="true" tabindex="-1"></a><span class="dt">intmax_t</span> y <span class="op">=</span> INTMAX_C<span class="op">(</span><span class="dv">3490</span><span class="op">);</span></span></code></pre></div>
<p> </p>
<h2 data-number="37.4" id="limits-of-fixed-size-integers"><span class="header-section-number">37.4</span> Limits of Fixed Size Integers</h2>
<p>We also have some limits defined so you can get the maximum and minimum values for these types:</p>
<p> </p>
<div class="sourceCode" id="cb696"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb696-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb696-1" aria-hidden="true" tabindex="-1"></a>INT8_MAX           INT8_MIN           UINT8_MAX</span>
<span id="cb696-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb696-2" aria-hidden="true" tabindex="-1"></a>INT16_MAX          INT16_MIN          UINT16_MAX</span>
<span id="cb696-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb696-3" aria-hidden="true" tabindex="-1"></a>INT32_MAX          INT32_MIN          UINT32_MAX</span>
<span id="cb696-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb696-4" aria-hidden="true" tabindex="-1"></a>INT64_MAX          INT64_MIN          UINT64_MAX</span>
<span id="cb696-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb696-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb696-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb696-6" aria-hidden="true" tabindex="-1"></a>INT_LEAST8_MAX     INT_LEAST8_MIN     UINT_LEAST8_MAX</span>
<span id="cb696-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb696-7" aria-hidden="true" tabindex="-1"></a>INT_LEAST16_MAX    INT_LEAST16_MIN    UINT_LEAST16_MAX</span>
<span id="cb696-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb696-8" aria-hidden="true" tabindex="-1"></a>INT_LEAST32_MAX    INT_LEAST32_MIN    UINT_LEAST32_MAX</span>
<span id="cb696-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb696-9" aria-hidden="true" tabindex="-1"></a>INT_LEAST64_MAX    INT_LEAST64_MIN    UINT_LEAST64_MAX</span>
<span id="cb696-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb696-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb696-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb696-11" aria-hidden="true" tabindex="-1"></a>INT_FAST8_MAX      INT_FAST8_MIN      UINT_FAST8_MAX</span>
<span id="cb696-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb696-12" aria-hidden="true" tabindex="-1"></a>INT_FAST16_MAX     INT_FAST16_MIN     UINT_FAST16_MAX</span>
<span id="cb696-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb696-13" aria-hidden="true" tabindex="-1"></a>INT_FAST32_MAX     INT_FAST32_MIN     UINT_FAST32_MAX</span>
<span id="cb696-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb696-14" aria-hidden="true" tabindex="-1"></a>INT_FAST64_MAX     INT_FAST64_MIN     UINT_FAST64_MAX</span>
<span id="cb696-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb696-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb696-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb696-16" aria-hidden="true" tabindex="-1"></a>INTMAX_MAX         INTMAX_MIN         UINTMAX_MAX</span></code></pre></div>
<p> </p>
<p>Note the <code>MIN</code> for all the unsigned types is <code>0</code>, so, as such, there’s no macro for it.</p>
<p> </p>
<h2 data-number="37.5" id="format-specifiers"><span class="header-section-number">37.5</span> Format Specifiers</h2>
<p>In order to print these types, you need to send the right format specifier to <code>printf()</code>. (And the same issue for getting input with <code>scanf()</code>.)</p>
<p>But how are you going to know what size the types are under the hood? Luckily, once again, C provides some macros to help with this.</p>
<p>All this can be found in <code>&lt;inttypes.h&gt;</code>.</p>
<p>Now, we have a bunch of macros. Like a complexity explosion of macros. So I’m going to stop listing out every one and just put the lowercase letter <code>n</code> in the place where you should put <code>8</code>, <code>16</code>, <code>32</code>, or <code>64</code> depending on your needs.</p>
<p>Let’s look at the macros for printing signed integers:</p>
<p> </p>
<div class="sourceCode" id="cb697"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb697-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb697-1" aria-hidden="true" tabindex="-1"></a>PRIdn    PRIdLEASTn    PRIdFASTn    PRIdMAX</span>
<span id="cb697-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb697-2" aria-hidden="true" tabindex="-1"></a>PRIin    PRIiLEASTn    PRIiFASTn    PRIiMAX</span></code></pre></div>
<p>Look for the patterns there. You can see there are variants for the fixed, least, fast, and max types.</p>
<p>And you also have a lowercase <code>d</code> and a lowercase <code>i</code>. Those correspond to the <code>printf()</code> format specifiers <code>%d</code> and <code>%i</code>.</p>
<p>So if I have something of type:</p>
<div class="sourceCode" id="cb698"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb698-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb698-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int_least16_t</span> x <span class="op">=</span> <span class="dv">3490</span><span class="op">;</span></span></code></pre></div>
<p>I can print that with the equivalent format specifier for <code>%d</code> by using <code>PRIdLEAST16</code>.</p>
<p>But how? How do we use that macro?</p>
<p>First of all, that macro specifies a string containing the letter or letters <code>printf()</code> needs to use to print that type. Like, for example, it could be <code>"d"</code> or <code>"ld"</code>.</p>
<p>So all we need to do is embed that in our format string to the <code>printf()</code> call.</p>
<p>To do this, we can take advantage of a fact about C that you might have forgotten: adjacent string literals are automatically concatenated to a single string. E.g.:</p>
<div class="sourceCode" id="cb699"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb699-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb699-1" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"Hello, "</span> <span class="st">"world!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span>   <span class="co">// Prints "Hello, world!"</span></span></code></pre></div>
<p>And since these macros are string literals, we can use them like so:</p>
<div class="sourceCode" id="cb700"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb700-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb700-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb700-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb700-2"></a><span class="pp">#include </span><span class="im">&lt;stdint.h&gt;</span></span>
<span id="cb700-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb700-3"></a><span class="pp">#include </span><span class="im">&lt;inttypes.h&gt;</span></span>
<span id="cb700-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb700-4"></a></span>
<span id="cb700-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb700-5"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb700-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb700-6"></a><span class="op">{</span></span>
<span id="cb700-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb700-7"></a>    <span class="dt">int_least16_t</span> x <span class="op">=</span> <span class="dv">3490</span><span class="op">;</span></span>
<span id="cb700-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb700-8"></a></span>
<span id="cb700-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb700-9"></a>    printf<span class="op">(</span><span class="st">"The value is %"</span> PRIdLEAST16 <span class="st">"!</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> x<span class="op">);</span></span>
<span id="cb700-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb700-10"></a><span class="op">}</span></span></code></pre></div>
<p> </p>
<p>We also have a pile of macros for printing unsigned types:</p>
<p> </p>
<div class="sourceCode" id="cb701"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb701-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb701-1" aria-hidden="true" tabindex="-1"></a>PRIon    PRIoLEASTn    PRIoFASTn    PRIoMAX</span>
<span id="cb701-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb701-2" aria-hidden="true" tabindex="-1"></a>PRIun    PRIuLEASTn    PRIuFASTn    PRIuMAX</span>
<span id="cb701-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb701-3" aria-hidden="true" tabindex="-1"></a>PRIxn    PRIxLEASTn    PRIxFASTn    PRIxMAX</span>
<span id="cb701-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb701-4" aria-hidden="true" tabindex="-1"></a>PRIXn    PRIXLEASTn    PRIXFASTn    PRIXMAX</span></code></pre></div>
<p>In this case, <code>o</code>, <code>u</code>, <code>x</code>, and <code>X</code> correspond to the documented format specifiers in <code>printf()</code>.</p>
<p>And, as before, the lowercase <code>n</code> should be substituted with <code>8</code>, <code>16</code>, <code>32</code>, or <code>64</code>.</p>
<p> </p>
<p>But just when you think you had enough of the macros, it turns out we have a complete complementary set of them for <code>scanf()</code>!</p>
<p> </p>
<div class="sourceCode" id="cb702"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb702-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb702-1" aria-hidden="true" tabindex="-1"></a>SCNdn    SCNdLEASTn    SCNdFASTn    SCNdMAX</span>
<span id="cb702-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb702-2" aria-hidden="true" tabindex="-1"></a>SCNin    SCNiLEASTn    SCNiFASTn    SCNiMAX</span>
<span id="cb702-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb702-3" aria-hidden="true" tabindex="-1"></a>SCNon    SCNoLEASTn    SCNoFASTn    SCNoMAX</span>
<span id="cb702-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb702-4" aria-hidden="true" tabindex="-1"></a>SCNun    SCNuLEASTn    SCNuFASTn    SCNuMAX</span>
<span id="cb702-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb702-5" aria-hidden="true" tabindex="-1"></a>SCNxn    SCNxLEASTn    SCNxFASTn    SCNxMAX</span></code></pre></div>
<p> </p>
<p>Remember: when you want to print out a fixed size integer type with <code>printf()</code> or <code>scanf()</code>, grab the correct corresponding format specifer from <code>&lt;inttypes.h&gt;</code>.</p>
<p></p>
<!-- Beej's guide to C

# vim: ts=4:sw=4:nosi:et:tw=72
-->
<h1 data-number="38" id="date-and-time-functionality"><span class="header-section-number">38</span> Date and Time Functionality</h1>
<blockquote>
<p>“Time is an illusion. Lunchtime doubly so.”<br>
—Ford Prefect, The Hitchhikers Guide to the Galaxy</p>
</blockquote>
<p></p>
<p>This isn’t too complex, but it can be a little intimidating at first, both with the different types available and the way we can convert between them.</p>
<p>Mix in GMT (UTC) and local time and we have all the <em>Usual Fun</em>™ one gets with times and dates.</p>
<p>And of course never forget the golden rule of dates and times: <em>Never attempt to write your own date and time functionality. Only use what the library gives you.</em></p>
<p>Time is too complex for mere mortal programmers to handle correctly. Seriously, we all owe a point to everyone who worked on any date and time library, so put that in your budget.</p>
<h2 data-number="38.1" id="quick-terminology-and-information"><span class="header-section-number">38.1</span> Quick Terminology and Information</h2>
<p>Just a couple quick terms in case you don’t have them down.</p>
<ul>
<li><p> <strong>UTC</strong>: Coordinated Universal Time is a universally<a href="https://beej.us/guide/bgc/html/index-wide.html#fn189" class="footnote-ref" id="fnref189" role="doc-noteref"><sup>189</sup></a> agreed upon, absolute time. Everyone on the planet thinks it’s the same time right now in UTC… even though they have different local times.</p></li>
<li><p> <strong>GMT</strong>: Greenwich Mean Time, effectively the same as UTC<a href="https://beej.us/guide/bgc/html/index-wide.html#fn190" class="footnote-ref" id="fnref190" role="doc-noteref"><sup>190</sup></a>. You probably want to say UTC, or “universal time”. If you’re talking specifically about the GMT time zone, say GMT. Confusingly, many of C’s UTC functions predate UTC and still refer to Greenwich Mean Time. When you see that, know that C means UTC.</p></li>
<li><p> <strong>Local time</strong>: what time it is where the computer running the program is located. This is described as an offset from UTC. Although there are many time zones in the world, most computers do work in either local time or UTC.</p></li>
</ul>
<p></p>
<p>As a general rule, if you are describing an event that happens one time, like a log entry, or a rocket launch, or when pointers finally clicked for you, use UTC.</p>
<p></p>
<p>On the other hand, if it’s something that happens the same time <em>in every time zone</em>, like New Year’s Eve or dinner time, use local time.</p>
<p>Since a lot of languages are only good at converting between UTC and local time, you can cause yourself a lot of pain by choosing to store your dates in the wrong form. (Ask me how I know.)</p>
<p> </p>
<h2 data-number="38.2" id="date-types"><span class="header-section-number">38.2</span> Date Types</h2>
<p>There are two<a href="https://beej.us/guide/bgc/html/index-wide.html#fn191" class="footnote-ref" id="fnref191" role="doc-noteref"><sup>191</sup></a> main types in C when it comes to dates: <code>time_t</code> and <code>struct tm</code>.</p>
<p>The spec doesn’t actually say much about them:</p>
<ul>
<li><p> <code>time_t</code>: a real type capable of holding a time. So by the spec, this could be a floating type or integer type. In POSIX (Unix-likes), it’s an integer. This holds <em>calendar time</em>. Which you can think of as UTC time.</p></li>
<li><p> <code>struct tm</code>: holds the components of a calendar time. This is a <em>broken-down time</em>, i.e.&nbsp;the components of the time, like hour, minute, second, day, month, year, etc.</p></li>
</ul>
<p></p>
<p>On a lot of systems, <code>time_t</code> represents the number of seconds since <a href="https://en.wikipedia.org/wiki/Unix_time"><em>Epoch</em></a><a href="https://beej.us/guide/bgc/html/index-wide.html#fn192" class="footnote-ref" id="fnref192" role="doc-noteref"><sup>192</sup></a>. Epoch is in some ways the start of time from the computer’s perspective, which is commonly January 1, 1970 UTC. <code>time_t</code> can go negative to represent times before Epoch. Windows behaves the same way as Unix from what I can tell.</p>
<p> </p>
<p>And what’s in a <code>struct tm</code>? The following fields:</p>
<div class="sourceCode" id="cb703"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb703-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb703-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> tm <span class="op">{</span></span>
<span id="cb703-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb703-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> tm_sec<span class="op">;</span>    <span class="co">// seconds after the minute -- [0, 60]</span></span>
<span id="cb703-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb703-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> tm_min<span class="op">;</span>    <span class="co">// minutes after the hour -- [0, 59]</span></span>
<span id="cb703-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb703-4" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> tm_hour<span class="op">;</span>   <span class="co">// hours since midnight -- [0, 23]</span></span>
<span id="cb703-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb703-5" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> tm_mday<span class="op">;</span>   <span class="co">// day of the month -- [1, 31]</span></span>
<span id="cb703-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb703-6" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> tm_mon<span class="op">;</span>    <span class="co">// months since January -- [0, 11]</span></span>
<span id="cb703-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb703-7" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> tm_year<span class="op">;</span>   <span class="co">// years since 1900</span></span>
<span id="cb703-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb703-8" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> tm_wday<span class="op">;</span>   <span class="co">// days since Sunday -- [0, 6]</span></span>
<span id="cb703-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb703-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> tm_yday<span class="op">;</span>   <span class="co">// days since January 1 -- [0, 365]</span></span>
<span id="cb703-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb703-10" aria-hidden="true" tabindex="-1"></a>    <span class="dt">int</span> tm_isdst<span class="op">;</span>  <span class="co">// Daylight Saving Time flag</span></span>
<span id="cb703-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb703-11" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
<p>Note that everything is zero-based except the day of the month.</p>
<p>It’s important to know that you can put any values in these types you want. There are functions to help get the time <em>now</em>, but the types hold <em>a</em> time, not <em>the</em> time.</p>
<p></p>
<p>So the question becomes: “How do you initialize data of these types, and how do you convert between them?”</p>
<h2 data-number="38.3" id="initialization-and-conversion-between-types"><span class="header-section-number">38.3</span> Initialization and Conversion Between Types</h2>
<p></p>
<p>First, you can get the current time and store it in a <code>time_t</code> with the <code>time()</code> function.</p>
<div class="sourceCode" id="cb704"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb704-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb704-1" aria-hidden="true" tabindex="-1"></a><span class="dt">time_t</span> now<span class="op">;</span>  <span class="co">// Variable to hold the time now</span></span>
<span id="cb704-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb704-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb704-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb704-3" aria-hidden="true" tabindex="-1"></a>now <span class="op">=</span> time<span class="op">(</span>NULL<span class="op">);</span>  <span class="co">// You can get it like this...</span></span>
<span id="cb704-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb704-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb704-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb704-5" aria-hidden="true" tabindex="-1"></a>time<span class="op">(&amp;</span>now<span class="op">);</span>        <span class="co">// ...or this. Same as the previous line.</span></span></code></pre></div>
<p>Great! You have a variable that gets you the time now.</p>
<p> </p>
<p>Amusingly, there’s only one portable way to print out what’s in a <code>time_t</code>, and that’s the rarely-used <code>ctime()</code> function that prints the value in local time:</p>
<div class="sourceCode" id="cb705"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb705-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb705-1" aria-hidden="true" tabindex="-1"></a>now <span class="op">=</span> time<span class="op">(</span>NULL<span class="op">);</span></span>
<span id="cb705-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb705-2" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">%s</span><span class="st">"</span><span class="op">,</span> ctime<span class="op">(&amp;</span>now<span class="op">));</span></span></code></pre></div>
<p>This returns a string with a very specific form that includes a newline at the end:</p>
<div class="sourceCode" id="cb706"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb706-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb706-1" aria-hidden="true" tabindex="-1"></a>Sun Feb 28 18:47:25 2021</span></code></pre></div>
<p></p>
<p>So that’s kind of inflexible. If you want more control, you should convert that <code>time_t</code> into a <code>struct tm</code>.</p>
<h3 data-number="38.3.1" id="converting-time_t-to-struct-tm"><span class="header-section-number">38.3.1</span> Converting <code>time_t</code> to <code>struct tm</code></h3>
<p></p>
<p>There are two amazing ways to do this conversion:</p>
<p></p>
<ul>
<li><code>localtime()</code>: this function converts a <code>time_t</code> to a <code>struct tm</code> in local time.</li>
</ul>
<p></p>
<ul>
<li><code>gmtime()</code>: this function converts a <code>time_t</code> to a <code>struct tm</code> in UTC. (See ye olde GMT creeping into that function name?)</li>
</ul>
<p></p>
<p>Let’s see what time it is now by printing out a <code>struct tm</code> with the <code>asctime()</code> function:</p>
<div class="sourceCode" id="cb707"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb707-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb707-1" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"Local: </span><span class="sc">%s</span><span class="st">"</span><span class="op">,</span> asctime<span class="op">(</span>localtime<span class="op">(&amp;</span>now<span class="op">)));</span></span>
<span id="cb707-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb707-2" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"  UTC: </span><span class="sc">%s</span><span class="st">"</span><span class="op">,</span> asctime<span class="op">(</span>gmtime<span class="op">(&amp;</span>now<span class="op">)));</span></span></code></pre></div>
<p> </p>
<p>Output (I’m in the Pacific Standard Time zone):</p>
<div class="sourceCode" id="cb708"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb708-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb708-1" aria-hidden="true" tabindex="-1"></a>Local: Sun Feb 28 20:15:27 2021</span>
<span id="cb708-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb708-2" aria-hidden="true" tabindex="-1"></a>  UTC: Mon Mar  1 04:15:27 2021</span></code></pre></div>
<p>Once you have your <code>time_t</code> in a <code>struct tm</code>, it opens all kinds of doors. You can print out the time in a variety of ways, figure out which day of the week a date is, and so on. Or convert it back into a <code>time_t</code>.</p>
<p>More on that soon!</p>
<p></p>
<h3 data-number="38.3.2" id="converting-struct-tm-to-time_t"><span class="header-section-number">38.3.2</span> Converting <code>struct tm</code> to <code>time_t</code></h3>
<p> </p>
<p>If you want to go the other way, you can use <code>mktime()</code> to get that information.</p>
<p><code>mktime()</code> sets the values of <code>tm_wday</code> and <code>tm_yday</code> for you, so don’t bother filling them out because they’ll just be overwritten.</p>
<p>Also, you can set <code>tm_isdst</code> to <code>-1</code> to have it make the determination for you. Or you can manually set it to true or false.</p>
<div class="sourceCode" id="cb709"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb709-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb709-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Don't be tempted to put leading zeros on these numbers (unless you</span></span>
<span id="cb709-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb709-2" aria-hidden="true" tabindex="-1"></a><span class="co">// mean for them to be in octal)!</span></span>
<span id="cb709-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb709-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb709-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb709-4" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> tm some_time <span class="op">=</span> <span class="op">{</span></span>
<span id="cb709-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb709-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span>tm_year<span class="op">=</span><span class="dv">82</span><span class="op">,</span>   <span class="co">// years since 1900</span></span>
<span id="cb709-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb709-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span>tm_mon<span class="op">=</span><span class="dv">3</span><span class="op">,</span>     <span class="co">// months since January -- [0, 11]</span></span>
<span id="cb709-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb709-7" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span>tm_mday<span class="op">=</span><span class="dv">12</span><span class="op">,</span>   <span class="co">// day of the month -- [1, 31]</span></span>
<span id="cb709-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb709-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span>tm_hour<span class="op">=</span><span class="dv">12</span><span class="op">,</span>   <span class="co">// hours since midnight -- [0, 23]</span></span>
<span id="cb709-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb709-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span>tm_min<span class="op">=</span><span class="dv">0</span><span class="op">,</span>     <span class="co">// minutes after the hour -- [0, 59]</span></span>
<span id="cb709-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb709-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span>tm_sec<span class="op">=</span><span class="dv">4</span><span class="op">,</span>     <span class="co">// seconds after the minute -- [0, 60]</span></span>
<span id="cb709-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb709-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span>tm_isdst<span class="op">=-</span><span class="dv">1</span><span class="op">,</span>  <span class="co">// Daylight Saving Time flag</span></span>
<span id="cb709-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb709-12" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span>
<span id="cb709-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb709-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb709-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb709-14" aria-hidden="true" tabindex="-1"></a><span class="dt">time_t</span> some_time_epoch<span class="op">;</span></span>
<span id="cb709-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb709-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb709-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb709-16" aria-hidden="true" tabindex="-1"></a>some_time_epoch <span class="op">=</span> mktime<span class="op">(&amp;</span>some_time<span class="op">);</span></span>
<span id="cb709-17"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb709-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb709-18"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb709-18" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">%s</span><span class="st">"</span><span class="op">,</span> ctime<span class="op">(&amp;</span>some_time_epoch<span class="op">));</span></span>
<span id="cb709-19"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb709-19" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"Is DST: </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> some_time<span class="op">.</span>tm_isdst<span class="op">);</span></span></code></pre></div>
<p>Output:</p>
<div class="sourceCode" id="cb710"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb710-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb710-1" aria-hidden="true" tabindex="-1"></a>Mon Apr 12 12:00:04 1982</span>
<span id="cb710-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb710-2" aria-hidden="true" tabindex="-1"></a>Is DST: 0</span></code></pre></div>
<p>When you manually load a <code>struct tm</code> like that, it should be in local time. <code>mktime()</code> will convert that local time into a <code>time_t</code> calendar time.</p>
<p></p>
<p>Weirdly, however, the standard doesn’t give us a way to load up a <code>struct tm</code> with a UTC time and convert that to a <code>time_t</code>. If you want to do that with Unix-likes, try the non-standard <code>timegm()</code>. On Windows, <code>_mkgmtime()</code>.</p>
<p></p>
<h2 data-number="38.4" id="formatted-date-output"><span class="header-section-number">38.4</span> Formatted Date Output</h2>
<p>We’ve already seen a couple ways to print formatted date output to the screen. With <code>time_t</code> we can use <code>ctime()</code>, and with <code>struct tm</code> we can use <code>asctime()</code>.</p>
<div class="sourceCode" id="cb711"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb711-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb711-1" aria-hidden="true" tabindex="-1"></a><span class="dt">time_t</span> now <span class="op">=</span> time<span class="op">(</span>NULL<span class="op">);</span></span>
<span id="cb711-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb711-2" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> tm <span class="op">*</span>local <span class="op">=</span> localtime<span class="op">(&amp;</span>now<span class="op">);</span></span>
<span id="cb711-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb711-3" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> tm <span class="op">*</span>utc <span class="op">=</span> gmtime<span class="op">(&amp;</span>now<span class="op">);</span></span>
<span id="cb711-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb711-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb711-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb711-5" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"Local time: </span><span class="sc">%s</span><span class="st">"</span><span class="op">,</span> ctime<span class="op">(&amp;</span>now<span class="op">));</span>     <span class="co">// Local time with time_t</span></span>
<span id="cb711-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb711-6" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"Local time: </span><span class="sc">%s</span><span class="st">"</span><span class="op">,</span> asctime<span class="op">(</span>local<span class="op">));</span>  <span class="co">// Local time with struct tm</span></span>
<span id="cb711-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb711-7" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"UTC       : </span><span class="sc">%s</span><span class="st">"</span><span class="op">,</span> asctime<span class="op">(</span>utc<span class="op">));</span>    <span class="co">// UTC with a struct tm</span></span></code></pre></div>
<p>But what if I told you, dear reader, that there’s a way to have much more control over how the date was printed?</p>
<p></p>
<p>Sure, we could fish individual fields out of the <code>struct tm</code>, but there’s a great function called <code>strftime()</code> that will do a lot of the hard work for you. It’s like <code>printf()</code>, except for dates!</p>
<p>Let’s see some examples. In each of these, we pass in a destination buffer, a maximum number of characters to write, and then a format string (in the style of—but not the same as—<code>printf()</code>) which tells <code>strftime()</code> which components of a <code>struct tm</code> to print and how.</p>
<p>You can add other constant characters to include in the output in the format string, as well, just like with <code>printf()</code>.</p>
<p>We get a <code>struct tm</code> in this case from <code>localtime()</code>, but any source works fine.</p>
<div class="sourceCode" id="cb712"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb712-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb712-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb712-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb712-2"></a><span class="pp">#include </span><span class="im">&lt;time.h&gt;</span></span>
<span id="cb712-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb712-3"></a></span>
<span id="cb712-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb712-4"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb712-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb712-5"></a><span class="op">{</span></span>
<span id="cb712-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb712-6"></a>    <span class="dt">char</span> s<span class="op">[</span><span class="dv">128</span><span class="op">];</span></span>
<span id="cb712-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb712-7"></a>    <span class="dt">time_t</span> now <span class="op">=</span> time<span class="op">(</span>NULL<span class="op">);</span></span>
<span id="cb712-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb712-8"></a></span>
<span id="cb712-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb712-9"></a>    <span class="co">// %c: print date as per current locale</span></span>
<span id="cb712-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb712-10"></a>    strftime<span class="op">(</span>s<span class="op">,</span> <span class="kw">sizeof</span> s<span class="op">,</span> <span class="st">"</span><span class="sc">%c</span><span class="st">"</span><span class="op">,</span> localtime<span class="op">(&amp;</span>now<span class="op">));</span></span>
<span id="cb712-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb712-11"></a>    puts<span class="op">(</span>s<span class="op">);</span>   <span class="co">// Sun Feb 28 22:29:00 2021</span></span>
<span id="cb712-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb712-12"></a></span>
<span id="cb712-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb712-13"></a>    <span class="co">// %A: full weekday name</span></span>
<span id="cb712-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb712-14"></a>    <span class="co">// %B: full month name</span></span>
<span id="cb712-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb712-15"></a>    <span class="co">// %d: day of the month</span></span>
<span id="cb712-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb712-16"></a>    strftime<span class="op">(</span>s<span class="op">,</span> <span class="kw">sizeof</span> s<span class="op">,</span> <span class="st">"</span><span class="sc">%A</span><span class="st">, %B </span><span class="sc">%d</span><span class="st">"</span><span class="op">,</span> localtime<span class="op">(&amp;</span>now<span class="op">));</span></span>
<span id="cb712-17"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb712-17"></a>    puts<span class="op">(</span>s<span class="op">);</span>   <span class="co">// Sunday, February 28</span></span>
<span id="cb712-18"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb712-18"></a></span>
<span id="cb712-19"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb712-19"></a>    <span class="co">// %I: hour (12 hour clock)</span></span>
<span id="cb712-20"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb712-20"></a>    <span class="co">// %M: minute</span></span>
<span id="cb712-21"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb712-21"></a>    <span class="co">// %S: second</span></span>
<span id="cb712-22"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb712-22"></a>    <span class="co">// %p: AM or PM</span></span>
<span id="cb712-23"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb712-23"></a>    strftime<span class="op">(</span>s<span class="op">,</span> <span class="kw">sizeof</span> s<span class="op">,</span> <span class="st">"It's %I:%M:%S </span><span class="sc">%p</span><span class="st">"</span><span class="op">,</span> localtime<span class="op">(&amp;</span>now<span class="op">));</span></span>
<span id="cb712-24"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb712-24"></a>    puts<span class="op">(</span>s<span class="op">);</span>   <span class="co">// It's 10:29:00 PM</span></span>
<span id="cb712-25"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb712-25"></a></span>
<span id="cb712-26"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb712-26"></a>    <span class="co">// %F: ISO 8601 yyyy-mm-dd</span></span>
<span id="cb712-27"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb712-27"></a>    <span class="co">// %T: ISO 8601 hh:mm:ss</span></span>
<span id="cb712-28"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb712-28"></a>    <span class="co">// %z: ISO 8601 time zone offset</span></span>
<span id="cb712-29"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb712-29"></a>    strftime<span class="op">(</span>s<span class="op">,</span> <span class="kw">sizeof</span> s<span class="op">,</span> <span class="st">"ISO 8601: </span><span class="sc">%F</span><span class="st">T%T%z"</span><span class="op">,</span> localtime<span class="op">(&amp;</span>now<span class="op">));</span></span>
<span id="cb712-30"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb712-30"></a>    puts<span class="op">(</span>s<span class="op">);</span>   <span class="co">// ISO 8601: 2021-02-28T22:29:00-0800</span></span>
<span id="cb712-31"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb712-31"></a><span class="op">}</span></span></code></pre></div>
<p>There are a <em>ton</em> of date printing format specifiers for <code>strftime()</code>, so be sure to check them out in the <a href="https://beej.us/guide/bgclr/html/split/time.html#man-strftime"><code>strftime()</code> reference page</a><a href="https://beej.us/guide/bgc/html/index-wide.html#fn193" class="footnote-ref" id="fnref193" role="doc-noteref"><sup>193</sup></a>.</p>
<p></p>
<h2 data-number="38.5" id="more-resolution-with-timespec_get"><span class="header-section-number">38.5</span> More Resolution with <code>timespec_get()</code></h2>
<p></p>
<p>You can get the number of seconds and nanoseconds since Epoch with <code>timespec_get()</code>.</p>
<p>Maybe.</p>
<p>Implementations might not have nanosecond resolution (that’s one billionth of a second) so who knows how many significant places you’ll get, but give it a shot and see.</p>
<p></p>
<p><code>timespec_get()</code> takes two arguments. One is a pointer to a <code>struct timespec</code> to hold the time information. And the other is the <code>base</code>, which the spec lets you set to <code>TIME_UTC</code> indicating that you’re interested in seconds since Epoch. (Other implementations might give you more options for the <code>base</code>.)</p>
<p>And the structure itself has two fields:</p>
<div class="sourceCode" id="cb713"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb713-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb713-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> timespec <span class="op">{</span></span>
<span id="cb713-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb713-2" aria-hidden="true" tabindex="-1"></a>    <span class="dt">time_t</span> tv_sec<span class="op">;</span>   <span class="co">// Seconds</span></span>
<span id="cb713-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb713-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">long</span>   tv_nsec<span class="op">;</span>  <span class="co">// Nanoseconds (billionths of a second)</span></span>
<span id="cb713-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb713-4" aria-hidden="true" tabindex="-1"></a><span class="op">};</span></span></code></pre></div>
<p>Here’s an example where we get the time and print it out both as integer values and also a floating value:</p>
<div class="sourceCode" id="cb714"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb714-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb714-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> timespec ts<span class="op">;</span></span>
<span id="cb714-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb714-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb714-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb714-3" aria-hidden="true" tabindex="-1"></a>timespec_get<span class="op">(&amp;</span>ts<span class="op">,</span> TIME_UTC<span class="op">);</span></span>
<span id="cb714-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb714-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb714-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb714-5" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">%ld</span><span class="st"> s, </span><span class="sc">%ld</span><span class="st"> ns</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> ts<span class="op">.</span>tv_sec<span class="op">,</span> ts<span class="op">.</span>tv_nsec<span class="op">);</span></span>
<span id="cb714-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb714-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb714-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb714-7" aria-hidden="true" tabindex="-1"></a><span class="dt">double</span> float_time <span class="op">=</span> ts<span class="op">.</span>tv_sec <span class="op">+</span> ts<span class="op">.</span>tv_nsec<span class="op">/</span><span class="fl">1000000000.0</span><span class="op">;</span></span>
<span id="cb714-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb714-8" aria-hidden="true" tabindex="-1"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">%f</span><span class="st"> seconds since epoch</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> float_time<span class="op">);</span></span></code></pre></div>
<p>Example output:</p>
<div class="sourceCode" id="cb715"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb715-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb715-1" aria-hidden="true" tabindex="-1"></a>1614581530 s, 806325800 ns</span>
<span id="cb715-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb715-2" aria-hidden="true" tabindex="-1"></a>1614581530.806326 seconds since epoch</span></code></pre></div>
<p><code>struct timespec</code> also makes an appearance in a number of the threading functions that need to be able to specify time with that resolution.</p>
<p> </p>
<h2 data-number="38.6" id="differences-between-times"><span class="header-section-number">38.6</span> Differences Between Times</h2>
<p></p>
<p>One quick note about getting the difference between two <code>time_t</code>s: since the spec doesn’t dictate how that type represents a time, you might not be able to simply subtract two <code>time_t</code>s and get anything sensible<a href="https://beej.us/guide/bgc/html/index-wide.html#fn194" class="footnote-ref" id="fnref194" role="doc-noteref"><sup>194</sup></a>.</p>
<p></p>
<p>Luckily you can use <code>difftime()</code> to compute the difference in seconds between two dates.</p>
<p>In the following example, we have two events that occur some time apart, and we use <code>difftime()</code> to compute the difference.</p>
<div class="sourceCode" id="cb716"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb716-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb716-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb716-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb716-2"></a><span class="pp">#include </span><span class="im">&lt;time.h&gt;</span></span>
<span id="cb716-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb716-3"></a></span>
<span id="cb716-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb716-4"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb716-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb716-5"></a><span class="op">{</span></span>
<span id="cb716-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb716-6"></a>    <span class="kw">struct</span> tm time_a <span class="op">=</span> <span class="op">{</span></span>
<span id="cb716-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb716-7"></a>        <span class="op">.</span>tm_year<span class="op">=</span><span class="dv">82</span><span class="op">,</span>   <span class="co">// years since 1900</span></span>
<span id="cb716-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb716-8"></a>        <span class="op">.</span>tm_mon<span class="op">=</span><span class="dv">3</span><span class="op">,</span>     <span class="co">// months since January -- [0, 11]</span></span>
<span id="cb716-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb716-9"></a>        <span class="op">.</span>tm_mday<span class="op">=</span><span class="dv">12</span><span class="op">,</span>   <span class="co">// day of the month -- [1, 31]</span></span>
<span id="cb716-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb716-10"></a>        <span class="op">.</span>tm_hour<span class="op">=</span><span class="dv">4</span><span class="op">,</span>    <span class="co">// hours since midnight -- [0, 23]</span></span>
<span id="cb716-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb716-11"></a>        <span class="op">.</span>tm_min<span class="op">=</span><span class="bn">00</span><span class="op">,</span>    <span class="co">// minutes after the hour -- [0, 59]</span></span>
<span id="cb716-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb716-12"></a>        <span class="op">.</span>tm_sec<span class="op">=</span><span class="bn">04</span><span class="op">,</span>    <span class="co">// seconds after the minute -- [0, 60]</span></span>
<span id="cb716-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb716-13"></a>        <span class="op">.</span>tm_isdst<span class="op">=-</span><span class="dv">1</span><span class="op">,</span>  <span class="co">// Daylight Saving Time flag</span></span>
<span id="cb716-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb716-14"></a>    <span class="op">};</span></span>
<span id="cb716-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb716-15"></a></span>
<span id="cb716-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb716-16"></a>    <span class="kw">struct</span> tm time_b <span class="op">=</span> <span class="op">{</span></span>
<span id="cb716-17"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb716-17"></a>        <span class="op">.</span>tm_year<span class="op">=</span><span class="dv">120</span><span class="op">,</span>  <span class="co">// years since 1900</span></span>
<span id="cb716-18"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb716-18"></a>        <span class="op">.</span>tm_mon<span class="op">=</span><span class="dv">10</span><span class="op">,</span>    <span class="co">// months since January -- [0, 11]</span></span>
<span id="cb716-19"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb716-19"></a>        <span class="op">.</span>tm_mday<span class="op">=</span><span class="dv">15</span><span class="op">,</span>   <span class="co">// day of the month -- [1, 31]</span></span>
<span id="cb716-20"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb716-20"></a>        <span class="op">.</span>tm_hour<span class="op">=</span><span class="dv">16</span><span class="op">,</span>   <span class="co">// hours since midnight -- [0, 23]</span></span>
<span id="cb716-21"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb716-21"></a>        <span class="op">.</span>tm_min<span class="op">=</span><span class="dv">27</span><span class="op">,</span>    <span class="co">// minutes after the hour -- [0, 59]</span></span>
<span id="cb716-22"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb716-22"></a>        <span class="op">.</span>tm_sec<span class="op">=</span><span class="bn">00</span><span class="op">,</span>    <span class="co">// seconds after the minute -- [0, 60]</span></span>
<span id="cb716-23"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb716-23"></a>        <span class="op">.</span>tm_isdst<span class="op">=-</span><span class="dv">1</span><span class="op">,</span>  <span class="co">// Daylight Saving Time flag</span></span>
<span id="cb716-24"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb716-24"></a>    <span class="op">};</span></span>
<span id="cb716-25"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb716-25"></a></span>
<span id="cb716-26"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb716-26"></a>    <span class="dt">time_t</span> cal_a <span class="op">=</span> mktime<span class="op">(&amp;</span>time_a<span class="op">);</span></span>
<span id="cb716-27"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb716-27"></a>    <span class="dt">time_t</span> cal_b <span class="op">=</span> mktime<span class="op">(&amp;</span>time_b<span class="op">);</span></span>
<span id="cb716-28"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb716-28"></a></span>
<span id="cb716-29"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb716-29"></a>    <span class="dt">double</span> diff <span class="op">=</span> difftime<span class="op">(</span>cal_b<span class="op">,</span> cal_a<span class="op">);</span></span>
<span id="cb716-30"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb716-30"></a></span>
<span id="cb716-31"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb716-31"></a>    <span class="dt">double</span> years <span class="op">=</span> diff <span class="op">/</span> <span class="dv">60</span> <span class="op">/</span> <span class="dv">60</span> <span class="op">/</span> <span class="dv">24</span> <span class="op">/</span> <span class="fl">365.2425</span><span class="op">;</span>  <span class="co">// close enough</span></span>
<span id="cb716-32"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb716-32"></a></span>
<span id="cb716-33"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb716-33"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%f</span><span class="st"> seconds (</span><span class="sc">%f</span><span class="st"> years) between events</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> diff<span class="op">,</span> years<span class="op">);</span></span>
<span id="cb716-34"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb716-34"></a><span class="op">}</span></span></code></pre></div>
<p>Output:</p>
<div class="sourceCode" id="cb717"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb717-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb717-1" aria-hidden="true" tabindex="-1"></a>1217996816.000000 seconds (38.596783 years) between events</span></code></pre></div>
<p>And there you have it! Remember to use <code>difftime()</code> to take the time difference. Even though you can just subtract on a POSIX system, might as well stay portable.</p>
<p> </p>
<!-- Beej's guide to C

# vim: ts=4:sw=4:nosi:et:tw=72
-->
<h1 data-number="39" id="multithreading"><span class="header-section-number">39</span> Multithreading</h1>
<p></p>
<p>C11 introduced, formally, multithreading to the C language. It’s very eerily similar to <a href="https://en.wikipedia.org/wiki/POSIX_Threads">POSIX threads</a><a href="https://beej.us/guide/bgc/html/index-wide.html#fn195" class="footnote-ref" id="fnref195" role="doc-noteref"><sup>195</sup></a>, if you’ve ever used those.</p>
<p>And if you’ve not, no worries. We’ll talk it through.</p>
<p>Do note, however, that I’m not intending this to be a full-blown classic multithreading how-to<a href="https://beej.us/guide/bgc/html/index-wide.html#fn196" class="footnote-ref" id="fnref196" role="doc-noteref"><sup>196</sup></a>; you’ll have to pick up a different very thick book for that, specifically. Sorry!</p>
<p></p>
<p>Threading is an optional feature. If a C11+ compiler defines <code>__STDC_NO_THREADS__</code>, threads will <strong>not</strong> be present in the library. Why they decided to go with a negative sense in that macro is beyond me, but there we are.</p>
<p>You can test for it like this:</p>
<div class="sourceCode" id="cb718"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb718-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb718-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#ifdef __STDC_NO_THREADS__</span></span>
<span id="cb718-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb718-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#error I need threads to build this program!</span></span>
<span id="cb718-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb718-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#endif</span></span></code></pre></div>
<p></p>
<p></p>
<p>Also, you might need to specify certain linker options when building. In the case of Unix-likes, try appending a <code>-lpthreads</code> to the end of the command line to link the <code>pthreads</code> library<a href="https://beej.us/guide/bgc/html/index-wide.html#fn197" class="footnote-ref" id="fnref197" role="doc-noteref"><sup>197</sup></a>:</p>
<div class="sourceCode" id="cb719"><pre class="sourceCode zsh"><code class="sourceCode zsh"><span id="cb719-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb719-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gcc</span> <span class="at">-std</span><span class="op">=</span>c11 <span class="at">-o</span> foo foo.c <span class="at">-lpthreads</span></span></code></pre></div>
<p></p>
<p>If you’re getting linker errors on your system, it could be because the appropriate library wasn’t included.</p>
<h2 data-number="39.1" id="background"><span class="header-section-number">39.1</span> Background</h2>
<p>Threads are a way to have all those shiny CPU cores you paid for do work for you in the same program.</p>
<p>Normally, a C program just runs on a single CPU core. But if you know how to split up the work, you can give pieces of it to a number of threads and have them do the work simultaneously.</p>
<p>Though the spec doesn’t say it, on your system it’s very likely that C (or the OS at its behest) will attempt to balance the threads over all your CPU cores.</p>
<p>And if you have more threads than cores, that’s OK. You just won’t realize all those gains if they’re all trying to compete for CPU time.</p>
<h2 data-number="39.2" id="things-you-can-do"><span class="header-section-number">39.2</span> Things You Can Do</h2>
<p>You can create a thread. It will begin running the function you specify. The parent thread that spawned it will also continue to run.</p>
<p>And you can wait for the thread to complete. This is called <em>joining</em>.</p>
<p>Or if you don’t care when the thread completes and don’t want to wait, you can <em>detach it</em>.</p>
<p>A thread can explicitly <em>exit</em>, or it can implicitly call it quits by returning from its main function.</p>
<p>A thread can also <em>sleep</em> for a period of time, doing nothing while other threads run.</p>
<p>The <code>main()</code> program is a thread, as well.</p>
<p>Additionally, we have thread local storage, mutexes, and conditional variables. But more on those later. Let’s just look at the basics for now.</p>
<h2 data-number="39.3" id="data-races-and-the-standard-library"><span class="header-section-number">39.3</span> Data Races and the Standard Library</h2>
<p></p>
<p>Some of the functions in the standard library (e.g.&nbsp;<code>asctime()</code> and <code>strtok()</code>) return or use <code>static</code> data elements that aren’t threadsafe. But in general unless it’s said otherwise, the standard library makes an effort to be so<a href="https://beej.us/guide/bgc/html/index-wide.html#fn198" class="footnote-ref" id="fnref198" role="doc-noteref"><sup>198</sup></a>.</p>
<p>But keep an eye out. If a standard library function is maintaining state between calls in a variable you don’t own, or if a function is returning a pointer to a thing that you didn’t pass in, it’s not threadsafe.</p>
<p></p>
<h2 data-number="39.4" id="creating-and-waiting-for-threads"><span class="header-section-number">39.4</span> Creating and Waiting for Threads</h2>
<p>Let’s hack something up!</p>
<p>We’ll make some threads (create) and wait for them to complete (join).</p>
<p>We have a tiny bit to understand first, though.</p>
<p>Every single thread is identified by an opaque variable of type <code>thrd_t</code>. It’s a unique identifier per thread in your program. When you create a thread, it’s given a new ID.</p>
<p>Also when you make the thread, you have to give it a pointer to a function to run, and a pointer to an argument to pass to it (or <code>NULL</code> if you don’t have anything to pass).</p>
<p>The thread will begin execution on the function you specify.</p>
<p>When you want to wait for a thread to complete, you have to specify its thread ID so C knows which one to wait for.</p>
<p>So the basic idea is:</p>
<ol type="1">
<li>Write a function to act as the thread’s “<code>main</code>”. It’s not <code>main()</code>-proper, but analogous to it. The thread will start running there.</li>
<li>From the main thread, launch a new thread with <code>thrd_create()</code>, and pass it a pointer to the function to run.</li>
<li>In that function, have the thread do whatever it has to do.</li>
<li>Meantimes, the main thread can continue doing whatever <em>it</em> has to do.</li>
<li>When the main thread decides to, it can wait for the child thread to complete by calling <code>thrd_join()</code>. Generally you <strong>must</strong> <code>thrd_join()</code> the thread to clean up after it or else you’ll leak memory<a href="https://beej.us/guide/bgc/html/index-wide.html#fn199" class="footnote-ref" id="fnref199" role="doc-noteref"><sup>199</sup></a></li>
</ol>
<p> </p>
<p><code>thrd_create()</code> takes a pointer to the function to run, and it’s of type <code>thrd_start_t</code>, which is <code>int (*)(void *)</code>. That’s Greek for “a pointer to a function that takes an <code>void*</code> as an argument, and returns an <code>int</code>.”</p>
<p></p>
<p>Let’s make a thread! We’ll launch it from the main thread with <code>thrd_create()</code> to run a function, do some other things, then wait for it to complete with <code>thrd_join()</code>. I’ve named the thread’s main function <code>run()</code>, but you can name it anything as long as the types match <code>thrd_start_t</code>.</p>
<div class="sourceCode" id="cb720"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb720-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb720-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb720-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb720-2"></a><span class="pp">#include </span><span class="im">&lt;threads.h&gt;</span></span>
<span id="cb720-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb720-3"></a></span>
<span id="cb720-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb720-4"></a><span class="co">// This is the function the thread will run. It can be called anything.</span></span>
<span id="cb720-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb720-5"></a><span class="co">//</span></span>
<span id="cb720-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb720-6"></a><span class="co">// arg is the argument pointer passed to `thrd_create()`.</span></span>
<span id="cb720-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb720-7"></a><span class="co">//</span></span>
<span id="cb720-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb720-8"></a><span class="co">// The parent thread will get the return value back from `thrd_join()`'</span></span>
<span id="cb720-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb720-9"></a><span class="co">// later.</span></span>
<span id="cb720-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb720-10"></a></span>
<span id="cb720-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb720-11"></a><span class="dt">int</span> run<span class="op">(</span><span class="dt">void</span> <span class="op">*</span>arg<span class="op">)</span></span>
<span id="cb720-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb720-12"></a><span class="op">{</span></span>
<span id="cb720-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb720-13"></a>    <span class="dt">int</span> <span class="op">*</span>a <span class="op">=</span> arg<span class="op">;</span>  <span class="co">// We'll pass in an int* from thrd_create()</span></span>
<span id="cb720-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb720-14"></a></span>
<span id="cb720-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb720-15"></a>    printf<span class="op">(</span><span class="st">"THREAD: Running thread with arg </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> <span class="op">*</span>a<span class="op">);</span></span>
<span id="cb720-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb720-16"></a></span>
<span id="cb720-17"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb720-17"></a>    <span class="cf">return</span> <span class="dv">12</span><span class="op">;</span>  <span class="co">// Value to be picked up by thrd_join() (chose 12 at random)</span></span>
<span id="cb720-18"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb720-18"></a><span class="op">}</span></span>
<span id="cb720-19"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb720-19"></a></span>
<span id="cb720-20"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb720-20"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb720-21"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb720-21"></a><span class="op">{</span></span>
<span id="cb720-22"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb720-22"></a>    thrd_t t<span class="op">;</span>  <span class="co">// t will hold the thread ID</span></span>
<span id="cb720-23"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb720-23"></a>    <span class="dt">int</span> arg <span class="op">=</span> <span class="dv">3490</span><span class="op">;</span></span>
<span id="cb720-24"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb720-24"></a></span>
<span id="cb720-25"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb720-25"></a>    printf<span class="op">(</span><span class="st">"Launching a thread</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb720-26"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb720-26"></a></span>
<span id="cb720-27"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb720-27"></a>    <span class="co">// Launch a thread to the run() function, passing a pointer to 3490</span></span>
<span id="cb720-28"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb720-28"></a>    <span class="co">// as an argument. Also stored the thread ID in t:</span></span>
<span id="cb720-29"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb720-29"></a></span>
<span id="cb720-30"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb720-30"></a>    thrd_create<span class="op">(&amp;</span>t<span class="op">,</span> run<span class="op">,</span> <span class="op">&amp;</span>arg<span class="op">);</span></span>
<span id="cb720-31"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb720-31"></a></span>
<span id="cb720-32"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb720-32"></a>    printf<span class="op">(</span><span class="st">"Doing other things while the thread runs</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb720-33"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb720-33"></a></span>
<span id="cb720-34"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb720-34"></a>    printf<span class="op">(</span><span class="st">"Waiting for thread to complete...</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb720-35"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb720-35"></a></span>
<span id="cb720-36"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb720-36"></a>    <span class="dt">int</span> res<span class="op">;</span>  <span class="co">// Holds return value from the thread exit</span></span>
<span id="cb720-37"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb720-37"></a></span>
<span id="cb720-38"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb720-38"></a>    <span class="co">// Wait here for the thread to complete; store the return value</span></span>
<span id="cb720-39"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb720-39"></a>    <span class="co">// in res:</span></span>
<span id="cb720-40"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb720-40"></a></span>
<span id="cb720-41"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb720-41"></a>    thrd_join<span class="op">(</span>t<span class="op">,</span> <span class="op">&amp;</span>res<span class="op">);</span></span>
<span id="cb720-42"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb720-42"></a></span>
<span id="cb720-43"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb720-43"></a>    printf<span class="op">(</span><span class="st">"Thread exited with return value </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> res<span class="op">);</span></span>
<span id="cb720-44"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb720-44"></a><span class="op">}</span></span></code></pre></div>
<p></p>
<p>See how we did the <code>thrd_create()</code> there to call the <code>run()</code> function? Then we did other things in <code>main()</code> and then stopped and waited for the thread to complete with <code>thrd_join()</code>.</p>
<p> </p>
<p>Sample output (yours might vary):</p>
<div class="sourceCode" id="cb721"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb721-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb721-1" aria-hidden="true" tabindex="-1"></a>Launching a thread</span>
<span id="cb721-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb721-2" aria-hidden="true" tabindex="-1"></a>Doing other things while the thread runs</span>
<span id="cb721-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb721-3" aria-hidden="true" tabindex="-1"></a>Waiting for thread to complete...</span>
<span id="cb721-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb721-4" aria-hidden="true" tabindex="-1"></a>THREAD: Running thread with arg 3490</span>
<span id="cb721-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb721-5" aria-hidden="true" tabindex="-1"></a>Thread exited with return value 12</span></code></pre></div>
<p>The <code>arg</code> that you pass to the function has to have a lifetime long enough so that the thread can pick it up before it goes away. Also, it needs to not be overwritten by the main thread before the new thread can use it.</p>
<p>Let’s look at an example that launches 5 threads. One thing to note here is how we use an array of <code>thrd_t</code>s to keep track of all the thread IDs.</p>
<p> </p>
<div class="sourceCode" id="cb722"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb722-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb722-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb722-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb722-2"></a><span class="pp">#include </span><span class="im">&lt;threads.h&gt;</span></span>
<span id="cb722-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb722-3"></a></span>
<span id="cb722-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb722-4"></a><span class="dt">int</span> run<span class="op">(</span><span class="dt">void</span> <span class="op">*</span>arg<span class="op">)</span></span>
<span id="cb722-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb722-5"></a><span class="op">{</span></span>
<span id="cb722-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb722-6"></a>    <span class="dt">int</span> i <span class="op">=</span> <span class="op">*(</span><span class="dt">int</span><span class="op">*)</span>arg<span class="op">;</span></span>
<span id="cb722-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb722-7"></a></span>
<span id="cb722-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb722-8"></a>    printf<span class="op">(</span><span class="st">"THREAD </span><span class="sc">%d</span><span class="st">: running!</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> i<span class="op">);</span></span>
<span id="cb722-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb722-9"></a></span>
<span id="cb722-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb722-10"></a>    <span class="cf">return</span> i<span class="op">;</span></span>
<span id="cb722-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb722-11"></a><span class="op">}</span></span>
<span id="cb722-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb722-12"></a></span>
<span id="cb722-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb722-13"></a><span class="pp">#define THREAD_COUNT </span><span class="dv">5</span></span>
<span id="cb722-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb722-14"></a></span>
<span id="cb722-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb722-15"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb722-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb722-16"></a><span class="op">{</span></span>
<span id="cb722-17"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb722-17"></a>    thrd_t t<span class="op">[</span>THREAD_COUNT<span class="op">];</span></span>
<span id="cb722-18"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb722-18"></a></span>
<span id="cb722-19"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb722-19"></a>    <span class="dt">int</span> i<span class="op">;</span></span>
<span id="cb722-20"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb722-20"></a></span>
<span id="cb722-21"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb722-21"></a>    printf<span class="op">(</span><span class="st">"Launching threads...</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb722-22"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb722-22"></a>    <span class="cf">for</span> <span class="op">(</span>i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> THREAD_COUNT<span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb722-23"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb722-23"></a></span>
<span id="cb722-24"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb722-24"></a>        <span class="co">// </span><span class="al">NOTE</span><span class="co">! In the following line, we pass a pointer to i, </span></span>
<span id="cb722-25"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb722-25"></a>        <span class="co">// but each thread sees the same pointer. So they'll</span></span>
<span id="cb722-26"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb722-26"></a>        <span class="co">// print out weird things as i changes value here in</span></span>
<span id="cb722-27"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb722-27"></a>        <span class="co">// the main thread! (More in the text, below.)</span></span>
<span id="cb722-28"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb722-28"></a></span>
<span id="cb722-29"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb722-29"></a>        thrd_create<span class="op">(</span>t <span class="op">+</span> i<span class="op">,</span> run<span class="op">,</span> <span class="op">&amp;</span>i<span class="op">);</span></span>
<span id="cb722-30"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb722-30"></a></span>
<span id="cb722-31"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb722-31"></a>    printf<span class="op">(</span><span class="st">"Doing other things while the thread runs...</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb722-32"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb722-32"></a>    printf<span class="op">(</span><span class="st">"Waiting for thread to complete...</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb722-33"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb722-33"></a></span>
<span id="cb722-34"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb722-34"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> THREAD_COUNT<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb722-35"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb722-35"></a>        <span class="dt">int</span> res<span class="op">;</span></span>
<span id="cb722-36"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb722-36"></a>        thrd_join<span class="op">(</span>t<span class="op">[</span>i<span class="op">],</span> <span class="op">&amp;</span>res<span class="op">);</span></span>
<span id="cb722-37"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb722-37"></a></span>
<span id="cb722-38"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb722-38"></a>        printf<span class="op">(</span><span class="st">"Thread </span><span class="sc">%d</span><span class="st"> complete!</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> res<span class="op">);</span></span>
<span id="cb722-39"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb722-39"></a>    <span class="op">}</span></span>
<span id="cb722-40"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb722-40"></a></span>
<span id="cb722-41"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb722-41"></a>    printf<span class="op">(</span><span class="st">"All threads complete!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb722-42"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb722-42"></a><span class="op">}</span></span></code></pre></div>
<p></p>
<p>When I run the threads, I count <code>i</code> up from 0 to 4. And pass a pointer to it to <code>thrd_create()</code>. This pointer ends up in the <code>run()</code> routine where we make a copy of it.</p>
<p></p>
<p>Simple enough? Here’s the output:</p>
<div class="sourceCode" id="cb723"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb723-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb723-1" aria-hidden="true" tabindex="-1"></a>Launching threads...</span>
<span id="cb723-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb723-2" aria-hidden="true" tabindex="-1"></a>THREAD 2: running!</span>
<span id="cb723-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb723-3" aria-hidden="true" tabindex="-1"></a>THREAD 3: running!</span>
<span id="cb723-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb723-4" aria-hidden="true" tabindex="-1"></a>THREAD 4: running!</span>
<span id="cb723-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb723-5" aria-hidden="true" tabindex="-1"></a>THREAD 2: running!</span>
<span id="cb723-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb723-6" aria-hidden="true" tabindex="-1"></a>Doing other things while the thread runs...</span>
<span id="cb723-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb723-7" aria-hidden="true" tabindex="-1"></a>Waiting for thread to complete...</span>
<span id="cb723-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb723-8" aria-hidden="true" tabindex="-1"></a>Thread 2 complete!</span>
<span id="cb723-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb723-9" aria-hidden="true" tabindex="-1"></a>Thread 2 complete!</span>
<span id="cb723-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb723-10" aria-hidden="true" tabindex="-1"></a>THREAD 5: running!</span>
<span id="cb723-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb723-11" aria-hidden="true" tabindex="-1"></a>Thread 3 complete!</span>
<span id="cb723-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb723-12" aria-hidden="true" tabindex="-1"></a>Thread 4 complete!</span>
<span id="cb723-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb723-13" aria-hidden="true" tabindex="-1"></a>Thread 5 complete!</span>
<span id="cb723-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb723-14" aria-hidden="true" tabindex="-1"></a>All threads complete!</span></code></pre></div>
<p>Whaaa—? Where’s <code>THREAD 0</code>? And why do we have a <code>THREAD 5</code> when clearly <code>i</code> is never more than <code>4</code> when we call <code>thrd_create()</code>? And two <code>THREAD 2</code>s? Madness!</p>
<p>This is getting into the fun land of <em>race conditions</em>. The main thread is modifying <code>i</code> before the thread has a chance to copy it. Indeed, <code>i</code> makes it all the way to <code>5</code> and ends the loop before the last thread gets a chance to copy it.</p>
<p>We’ve got to have a per-thread variable that we can refer to so we can pass it in as the <code>arg</code>.</p>
<p>We could have a big array of them. Or we could <code>malloc()</code> space (and free it somewhere—maybe in the thread itself.)</p>
<p>Let’s give that a shot:</p>
<div class="sourceCode" id="cb724"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb724-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb724-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb724-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb724-2"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb724-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb724-3"></a><span class="pp">#include </span><span class="im">&lt;threads.h&gt;</span></span>
<span id="cb724-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb724-4"></a></span>
<span id="cb724-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb724-5"></a><span class="dt">int</span> run<span class="op">(</span><span class="dt">void</span> <span class="op">*</span>arg<span class="op">)</span></span>
<span id="cb724-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb724-6"></a><span class="op">{</span></span>
<span id="cb724-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb724-7"></a>    <span class="dt">int</span> i <span class="op">=</span> <span class="op">*(</span><span class="dt">int</span><span class="op">*)</span>arg<span class="op">;</span>  <span class="co">// Copy the arg</span></span>
<span id="cb724-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb724-8"></a></span>
<span id="cb724-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb724-9"></a>    free<span class="op">(</span>arg<span class="op">);</span>  <span class="co">// Done with this</span></span>
<span id="cb724-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb724-10"></a></span>
<span id="cb724-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb724-11"></a>    printf<span class="op">(</span><span class="st">"THREAD </span><span class="sc">%d</span><span class="st">: running!</span><span class="sc">\n</span><span class="st">"</span><span class="op">,</span> i<span class="op">);</span></span>
<span id="cb724-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb724-12"></a></span>
<span id="cb724-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb724-13"></a>    <span class="cf">return</span> i<span class="op">;</span></span>
<span id="cb724-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb724-14"></a><span class="op">}</span></span>
<span id="cb724-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb724-15"></a></span>
<span id="cb724-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb724-16"></a><span class="pp">#define THREAD_COUNT </span><span class="dv">5</span></span>
<span id="cb724-17"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb724-17"></a></span>
<span id="cb724-18"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb724-18"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb724-19"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb724-19"></a><span class="op">{</span></span>
<span id="cb724-20"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb724-20"></a>    thrd_t t<span class="op">[</span>THREAD_COUNT<span class="op">];</span></span>
<span id="cb724-21"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb724-21"></a></span>
<span id="cb724-22"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb724-22"></a>    <span class="dt">int</span> i<span class="op">;</span></span>
<span id="cb724-23"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb724-23"></a></span>
<span id="cb724-24"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb724-24"></a>    printf<span class="op">(</span><span class="st">"Launching threads...</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb724-25"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb724-25"></a>    <span class="cf">for</span> <span class="op">(</span>i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> THREAD_COUNT<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb724-26"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb724-26"></a></span>
<span id="cb724-27"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb724-27"></a>        <span class="co">// Get some space for a per-thread argument:</span></span>
<span id="cb724-28"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb724-28"></a></span>
<span id="cb724-29"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb724-29"></a>        <span class="dt">int</span> <span class="op">*</span>arg <span class="op">=</span> malloc<span class="op">(</span><span class="kw">sizeof</span> <span class="op">*</span>arg<span class="op">);</span></span>
<span id="cb724-30"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb724-30"></a>        <span class="op">*</span>arg <span class="op">=</span> i<span class="op">;</span></span>
<span id="cb724-31"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb724-31"></a></span>
<span id="cb724-32"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb724-32"></a>        thrd_create<span class="op">(</span>t <span class="op">+</span> i<span class="op">,</span> run<span class="op">,</span> arg<span class="op">);</span></span>
<span id="cb724-33"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb724-33"></a>    <span class="op">}</span></span>
<span id="cb724-34"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb724-34"></a></span>
<span id="cb724-35"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb724-35"></a>    <span class="co">// ...</span></span></code></pre></div>
<p>Notice on lines 27-30 we <code>malloc()</code> space for an <code>int</code> and copy the value of <code>i</code> into it. Each new thread gets its own freshly-<code>malloc()</code>d variable and we pass a pointer to that to the <code>run()</code> function.</p>
<p>Once <code>run()</code> makes its own copy of the <code>arg</code> on line 7, it <code>free()</code>s the <code>malloc()</code>d <code>int</code>. And now that it has its own copy, it can do with it what it pleases.</p>
<p>And a run shows the result:</p>
<div class="sourceCode" id="cb725"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb725-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb725-1" aria-hidden="true" tabindex="-1"></a>Launching threads...</span>
<span id="cb725-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb725-2" aria-hidden="true" tabindex="-1"></a>THREAD 0: running!</span>
<span id="cb725-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb725-3" aria-hidden="true" tabindex="-1"></a>THREAD 1: running!</span>
<span id="cb725-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb725-4" aria-hidden="true" tabindex="-1"></a>THREAD 2: running!</span>
<span id="cb725-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb725-5" aria-hidden="true" tabindex="-1"></a>THREAD 3: running!</span>
<span id="cb725-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb725-6" aria-hidden="true" tabindex="-1"></a>Doing other things while the thread runs...</span>
<span id="cb725-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb725-7" aria-hidden="true" tabindex="-1"></a>Waiting for thread to complete...</span>
<span id="cb725-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb725-8" aria-hidden="true" tabindex="-1"></a>Thread 0 complete!</span>
<span id="cb725-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb725-9" aria-hidden="true" tabindex="-1"></a>Thread 1 complete!</span>
<span id="cb725-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb725-10" aria-hidden="true" tabindex="-1"></a>Thread 2 complete!</span>
<span id="cb725-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb725-11" aria-hidden="true" tabindex="-1"></a>Thread 3 complete!</span>
<span id="cb725-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb725-12" aria-hidden="true" tabindex="-1"></a>THREAD 4: running!</span>
<span id="cb725-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb725-13" aria-hidden="true" tabindex="-1"></a>Thread 4 complete!</span>
<span id="cb725-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb725-14" aria-hidden="true" tabindex="-1"></a>All threads complete!</span></code></pre></div>
<p>There we go! Threads 0-4 all in effect!</p>
<p>Your run might vary—how the threads get scheduled to run is beyond the C spec. We see in the above example that thread 4 didn’t even begin until threads 0-1 had completed. Indeed, if I run this again, I likely get different output. We cannot guarantee a thread execution order.</p>
<h2 data-number="39.5" id="detaching-threads"><span class="header-section-number">39.5</span> Detaching Threads</h2>
<p>If you want to fire-and-forget a thread (i.e.&nbsp;so you don’t have to <code>thrd_join()</code> it later), you can do that with <code>thrd_detach()</code>.</p>
<p>This removes the parent thread’s ability to get the return value from the child thread, but if you don’t care about that and just want threads to clean up nicely on their own, this is the way to go.</p>
<p>Basically we’re going to do this:</p>
<p></p>
<div class="sourceCode" id="cb726"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb726-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb726-1" aria-hidden="true" tabindex="-1"></a>thrd_create<span class="op">(&amp;</span>t<span class="op">,</span> run<span class="op">,</span> NULL<span class="op">);</span></span>
<span id="cb726-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb726-2" aria-hidden="true" tabindex="-1"></a>thrd_detach<span class="op">(</span>t<span class="op">);</span></span></code></pre></div>
<p>where the <code>thrd_detach()</code> call is the parent thread saying, “Hey, I’m not going to wait for this child thread to complete with <code>thrd_join()</code>. So go ahead and clean it up on your own when it completes.”</p>
<div class="sourceCode" id="cb727"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb727-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb727-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb727-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb727-2"></a><span class="pp">#include </span><span class="im">&lt;threads.h&gt;</span></span>
<span id="cb727-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb727-3"></a></span>
<span id="cb727-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb727-4"></a><span class="dt">int</span> run<span class="op">(</span><span class="dt">void</span> <span class="op">*</span>arg<span class="op">)</span></span>
<span id="cb727-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb727-5"></a><span class="op">{</span></span>
<span id="cb727-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb727-6"></a>    <span class="op">(</span><span class="dt">void</span><span class="op">)</span>arg<span class="op">;</span></span>
<span id="cb727-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb727-7"></a></span>
<span id="cb727-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb727-8"></a>    <span class="co">//printf("Thread running! %lu\n", thrd_current()); // non-portable!</span></span>
<span id="cb727-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb727-9"></a>    printf<span class="op">(</span><span class="st">"Thread running!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb727-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb727-10"></a></span>
<span id="cb727-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb727-11"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb727-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb727-12"></a><span class="op">}</span></span>
<span id="cb727-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb727-13"></a></span>
<span id="cb727-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb727-14"></a><span class="pp">#define THREAD_COUNT </span><span class="dv">10</span></span>
<span id="cb727-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb727-15"></a></span>
<span id="cb727-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb727-16"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb727-17"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb727-17"></a><span class="op">{</span></span>
<span id="cb727-18"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb727-18"></a>    thrd_t t<span class="op">;</span></span>
<span id="cb727-19"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb727-19"></a></span>
<span id="cb727-20"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb727-20"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> THREAD_COUNT<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb727-21"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb727-21"></a>        thrd_create<span class="op">(&amp;</span>t<span class="op">,</span> run<span class="op">,</span> NULL<span class="op">);</span></span>
<span id="cb727-22"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb727-22"></a>        thrd_detach<span class="op">(</span>t<span class="op">);</span>               <span class="co">// &lt;-- DETACH!</span></span>
<span id="cb727-23"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb727-23"></a>    <span class="op">}</span></span>
<span id="cb727-24"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb727-24"></a></span>
<span id="cb727-25"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb727-25"></a>    <span class="co">// Sleep for a second to let all the threads finish</span></span>
<span id="cb727-26"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb727-26"></a>    thrd_sleep<span class="op">(&amp;(</span><span class="kw">struct</span> timespec<span class="op">){.</span>tv_sec<span class="op">=</span><span class="dv">1</span><span class="op">},</span> NULL<span class="op">);</span></span>
<span id="cb727-27"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb727-27"></a><span class="op">}</span></span></code></pre></div>
<p></p>
<p>Note that in this code, we put the main thread to sleep for 1 second with <code>thrd_sleep()</code>—more on that later.</p>
<p>Also in the <code>run()</code> function, I have a commented-out line in there that prints out the thread ID as an <code>unsigned long</code>. This is non-portable, because the spec doesn’t say what type a <code>thrd_t</code> is under the hood—it could be a <code>struct</code> for all we know. But that line works on my system.</p>
<p>Something interesting I saw when I ran the code, above, and printed out the thread IDs was that some threads had duplicate IDs! This seems like it should be impossible, but C is allowed to <em>reuse</em> thread IDs after the corresponding thread has exited. So what I was seeing was that some threads completed their run before other threads were launched.</p>
<h2 data-number="39.6" id="thread-local-data"><span class="header-section-number">39.6</span> Thread Local Data</h2>
<p></p>
<p>Threads are interesting because they don’t have their own memory beyond local variables. If you want a <code>static</code> variable or file scope variable, all threads will see that same variable.</p>
<p>This can lead to race conditions, where you get <em>Weird Things</em>™ happening.</p>
<p>Check out this example. We have a <code>static</code> variable <code>foo</code> in block scope in <code>run()</code>. This variable will be visible to all threads that pass through the <code>run()</code> function. And the various threads can effectively step on each others toes.</p>
<p>Each thread copies <code>foo</code> into a local variable <code>x</code> (which is not shared between threads—all the threads have their own call stacks). So they <em>should</em> be the same, right?</p>
<p>And the first time we print them, they are<a href="https://beej.us/guide/bgc/html/index-wide.html#fn200" class="footnote-ref" id="fnref200" role="doc-noteref"><sup>200</sup></a>. But then right after that, we check to make sure they’re still the same.</p>
<p>And they <em>usually</em> are. But not always!</p>
<div class="sourceCode" id="cb728"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb728-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb728-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb728-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb728-2"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb728-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb728-3"></a><span class="pp">#include </span><span class="im">&lt;threads.h&gt;</span></span>
<span id="cb728-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb728-4"></a></span>
<span id="cb728-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb728-5"></a><span class="dt">int</span> run<span class="op">(</span><span class="dt">void</span> <span class="op">*</span>arg<span class="op">)</span></span>
<span id="cb728-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb728-6"></a><span class="op">{</span></span>
<span id="cb728-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb728-7"></a>    <span class="dt">int</span> n <span class="op">=</span> <span class="op">*(</span><span class="dt">int</span><span class="op">*)</span>arg<span class="op">;</span>  <span class="co">// Thread number for humans to differentiate</span></span>
<span id="cb728-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb728-8"></a></span>
<span id="cb728-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb728-9"></a>    free<span class="op">(</span>arg<span class="op">);</span></span>
<span id="cb728-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb728-10"></a></span>
<span id="cb728-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb728-11"></a>    <span class="dt">static</span> <span class="dt">int</span> foo <span class="op">=</span> <span class="dv">10</span><span class="op">;</span>  <span class="co">// Static value shared between threads</span></span>
<span id="cb728-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb728-12"></a></span>
<span id="cb728-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb728-13"></a>    <span class="dt">int</span> x <span class="op">=</span> foo<span class="op">;</span>  <span class="co">// Automatic local variable--each thread has its own</span></span>
<span id="cb728-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb728-14"></a></span>
<span id="cb728-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb728-15"></a>    <span class="co">// We just assigned x from foo, so they'd better be equal here.</span></span>
<span id="cb728-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb728-16"></a>    <span class="co">// (In all my test runs, they were, but even this isn't guaranteed!)</span></span>
<span id="cb728-17"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb728-17"></a></span>
<span id="cb728-18"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb728-18"></a>    printf<span class="op">(</span><span class="st">"Thread </span><span class="sc">%d</span><span class="st">: x = </span><span class="sc">%d</span><span class="st">, foo = </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> n<span class="op">,</span> x<span class="op">,</span> foo<span class="op">);</span></span>
<span id="cb728-19"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb728-19"></a></span>
<span id="cb728-20"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb728-20"></a>    <span class="co">// And they should be equal here, but they're not always!</span></span>
<span id="cb728-21"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb728-21"></a>    <span class="co">// (Sometimes they were, sometimes they weren't!)</span></span>
<span id="cb728-22"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb728-22"></a></span>
<span id="cb728-23"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb728-23"></a>    <span class="co">// What happens is another thread gets in and increments foo</span></span>
<span id="cb728-24"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb728-24"></a>    <span class="co">// right now, but this thread's x remains what it was before!</span></span>
<span id="cb728-25"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb728-25"></a></span>
<span id="cb728-26"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb728-26"></a>    <span class="cf">if</span> <span class="op">(</span>x <span class="op">!=</span> foo<span class="op">)</span> <span class="op">{</span></span>
<span id="cb728-27"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb728-27"></a>        printf<span class="op">(</span><span class="st">"Thread </span><span class="sc">%d</span><span class="st">: Craziness! x != foo! </span><span class="sc">%d</span><span class="st"> != </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> n<span class="op">,</span> x<span class="op">,</span> foo<span class="op">);</span></span>
<span id="cb728-28"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb728-28"></a>    <span class="op">}</span></span>
<span id="cb728-29"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb728-29"></a></span>
<span id="cb728-30"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb728-30"></a>    foo<span class="op">++;</span>  <span class="co">// Increment shared value</span></span>
<span id="cb728-31"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb728-31"></a></span>
<span id="cb728-32"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb728-32"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb728-33"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb728-33"></a><span class="op">}</span></span>
<span id="cb728-34"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb728-34"></a></span>
<span id="cb728-35"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb728-35"></a><span class="pp">#define THREAD_COUNT </span><span class="dv">5</span></span>
<span id="cb728-36"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb728-36"></a></span>
<span id="cb728-37"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb728-37"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb728-38"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb728-38"></a><span class="op">{</span></span>
<span id="cb728-39"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb728-39"></a>    thrd_t t<span class="op">[</span>THREAD_COUNT<span class="op">];</span></span>
<span id="cb728-40"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb728-40"></a></span>
<span id="cb728-41"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb728-41"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> THREAD_COUNT<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb728-42"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb728-42"></a>        <span class="dt">int</span> <span class="op">*</span>n <span class="op">=</span> malloc<span class="op">(</span><span class="kw">sizeof</span> <span class="op">*</span>n<span class="op">);</span>  <span class="co">// Holds a thread serial number</span></span>
<span id="cb728-43"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb728-43"></a>        <span class="op">*</span>n <span class="op">=</span> i<span class="op">;</span></span>
<span id="cb728-44"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb728-44"></a>        thrd_create<span class="op">(</span>t <span class="op">+</span> i<span class="op">,</span> run<span class="op">,</span> n<span class="op">);</span></span>
<span id="cb728-45"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb728-45"></a>    <span class="op">}</span></span>
<span id="cb728-46"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb728-46"></a></span>
<span id="cb728-47"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb728-47"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> THREAD_COUNT<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb728-48"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb728-48"></a>        thrd_join<span class="op">(</span>t<span class="op">[</span>i<span class="op">],</span> NULL<span class="op">);</span></span>
<span id="cb728-49"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb728-49"></a>    <span class="op">}</span></span>
<span id="cb728-50"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb728-50"></a><span class="op">}</span></span></code></pre></div>
<p>Here’s an example output (though this varies from run to run):</p>
<div class="sourceCode" id="cb729"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb729-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb729-1" aria-hidden="true" tabindex="-1"></a>Thread 0: x = 10, foo = 10</span>
<span id="cb729-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb729-2" aria-hidden="true" tabindex="-1"></a>Thread 1: x = 10, foo = 10</span>
<span id="cb729-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb729-3" aria-hidden="true" tabindex="-1"></a>Thread 1: Craziness! x != foo! 10 != 11</span>
<span id="cb729-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb729-4" aria-hidden="true" tabindex="-1"></a>Thread 2: x = 12, foo = 12</span>
<span id="cb729-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb729-5" aria-hidden="true" tabindex="-1"></a>Thread 4: x = 13, foo = 13</span>
<span id="cb729-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb729-6" aria-hidden="true" tabindex="-1"></a>Thread 3: x = 14, foo = 14</span></code></pre></div>
<p>In thread 1, between the two <code>printf()</code>s, the value of <code>foo</code> somehow changed from <code>10</code> to <code>11</code>, even though clearly there’s no increment between the <code>printf()</code>s!</p>
<p>It was another thread that got in there (probably thread 0, from the look of it) and incremented the value of <code>foo</code> behind thread 1’s back!</p>
<p>Let’s solve this problem two different ways. (If you want all the threads to share the variable <em>and</em> not step on each other’s toes, you’ll have to read on to the <a href="https://beej.us/guide/bgc/html/index-wide.html#mutex">mutex</a> section.)</p>
<h3 data-number="39.6.1" id="thread-local"><span class="header-section-number">39.6.1</span> <code>_Thread_local</code> Storage-Class</h3>
<p></p>
<p>First things first, let’s just look at the easy way around this: the <code>_Thread_local</code> storage-class.</p>
<p>Basically we’re just going to slap this on the front of our block scope <code>static</code> variable and things will work! It tells C that every thread should have its own version of this variable, so none of them step on each other’s toes.</p>
<p></p>
<p>The <code>&lt;threads.h&gt;</code> header defines <code>thread_local</code> as an alias to <code>_Thread_local</code> so your code doesn’t have to look so ugly.</p>
<p>Let’s take the previous example and make <code>foo</code> into a <code>thread_local</code> variable so that we don’t share that data.</p>
<div class="sourceCode" id="cb730" data-startfrom="5"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c" style="counter-reset: source-line 4;"><span id="cb730-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb730-5"></a><span class="dt">int</span> run<span class="op">(</span><span class="dt">void</span> <span class="op">*</span>arg<span class="op">)</span></span>
<span id="cb730-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb730-6"></a><span class="op">{</span></span>
<span id="cb730-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb730-7"></a>    <span class="dt">int</span> n <span class="op">=</span> <span class="op">*(</span><span class="dt">int</span><span class="op">*)</span>arg<span class="op">;</span>  <span class="co">// Thread number for humans to differentiate</span></span>
<span id="cb730-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb730-8"></a></span>
<span id="cb730-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb730-9"></a>    free<span class="op">(</span>arg<span class="op">);</span></span>
<span id="cb730-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb730-10"></a></span>
<span id="cb730-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb730-11"></a>    thread_local <span class="dt">static</span> <span class="dt">int</span> foo <span class="op">=</span> <span class="dv">10</span><span class="op">;</span>  <span class="co">// &lt;-- No longer shared!!</span></span></code></pre></div>
<p>And running we get:</p>
<div class="sourceCode" id="cb731"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb731-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb731-1" aria-hidden="true" tabindex="-1"></a>Thread 0: x = 10, foo = 10</span>
<span id="cb731-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb731-2" aria-hidden="true" tabindex="-1"></a>Thread 1: x = 10, foo = 10</span>
<span id="cb731-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb731-3" aria-hidden="true" tabindex="-1"></a>Thread 2: x = 10, foo = 10</span>
<span id="cb731-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb731-4" aria-hidden="true" tabindex="-1"></a>Thread 4: x = 10, foo = 10</span>
<span id="cb731-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb731-5" aria-hidden="true" tabindex="-1"></a>Thread 3: x = 10, foo = 10</span></code></pre></div>
<p>No more weird problems!</p>
<p>One thing: if a <code>thread_local</code> variable is block scope, it <strong>must</strong> be <code>static</code>. Them’s the rules. (But this is OK because non-<code>static</code> variables are per-thread already since each thread has it’s own non-<code>static</code> variables.)</p>
<p>A bit of a lie there: block scope <code>thread_local</code> variables can also be <code>extern</code>.</p>
<p> </p>
<h3 data-number="39.6.2" id="another-option-thread-specific-storage"><span class="header-section-number">39.6.2</span> Another Option: Thread-Specific Storage</h3>
<p></p>
<p>Thread-specific storage (TSS) is another way of getting per-thread data.</p>
<p>One additional feature is that these functions allow you to specify a destructor that will be called on the data when the TSS variable is deleted. Commonly this destructor is <code>free()</code> to automatically clean up <code>malloc()</code>d per-thread data. Or <code>NULL</code> if you don’t need to destroy anything.</p>
<p>The destructor is type <code>tss_dtor_t</code> which is a pointer to a function that returns <code>void</code> and takes a <code>void*</code> as an argument (the <code>void*</code> points to the data stored in the variable). In other words, it’s a <code>void (*)(void*)</code>, if that clears it up. Which I admit it probably doesn’t. Check out the example, below.</p>
<p>Generally, <code>thread_local</code> is probably your go-to, but if you like the destructor idea, then you can make use of that.</p>
<p>The usage is a bit weird in that we need a variable of type <code>tss_t</code> to be alive to represent the value on a per thread basis. Then we initialize it with <code>tss_create()</code>. Eventually we get rid of it with <code>tss_delete()</code>. Note that calling <code>tss_delete()</code> doesn’t run all the destructors—it’s <code>thrd_exit()</code> (or returning from the run function) that does that. <code>tss_delete()</code> just releases any memory allocated by <code>tss_create()</code>. </p>
<p>In the middle, threads can call <code>tss_set()</code> and <code>tss_get()</code> to set and get the value.</p>
<p>In the following code, we set up the TSS variable before creating the threads, then clean up after the threads.</p>
<p>In the <code>run()</code> function, the threads <code>malloc()</code> some space for a string and store that pointer in the TSS variable.</p>
<p>When the thread exits, the destructor function (<code>free()</code> in this case) is called for <em>all</em> the threads.</p>
<p> </p>
<div class="sourceCode" id="cb732"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb732-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb732-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb732-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb732-2"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb732-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb732-3"></a><span class="pp">#include </span><span class="im">&lt;threads.h&gt;</span></span>
<span id="cb732-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb732-4"></a></span>
<span id="cb732-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb732-5"></a>tss_t str<span class="op">;</span></span>
<span id="cb732-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb732-6"></a></span>
<span id="cb732-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb732-7"></a><span class="dt">void</span> some_function<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb732-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb732-8"></a><span class="op">{</span></span>
<span id="cb732-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb732-9"></a>    <span class="co">// Retrieve the per-thread value of this string</span></span>
<span id="cb732-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb732-10"></a>    <span class="dt">char</span> <span class="op">*</span>tss_string <span class="op">=</span> tss_get<span class="op">(</span>str<span class="op">);</span></span>
<span id="cb732-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb732-11"></a></span>
<span id="cb732-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb732-12"></a>    <span class="co">// And print it</span></span>
<span id="cb732-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb732-13"></a>    printf<span class="op">(</span><span class="st">"TSS string: </span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> tss_string<span class="op">);</span></span>
<span id="cb732-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb732-14"></a><span class="op">}</span></span>
<span id="cb732-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb732-15"></a></span>
<span id="cb732-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb732-16"></a><span class="dt">int</span> run<span class="op">(</span><span class="dt">void</span> <span class="op">*</span>arg<span class="op">)</span></span>
<span id="cb732-17"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb732-17"></a><span class="op">{</span></span>
<span id="cb732-18"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb732-18"></a>    <span class="dt">int</span> serial <span class="op">=</span> <span class="op">*(</span><span class="dt">int</span><span class="op">*)</span>arg<span class="op">;</span>  <span class="co">// Get this thread's serial number</span></span>
<span id="cb732-19"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb732-19"></a>    free<span class="op">(</span>arg<span class="op">);</span></span>
<span id="cb732-20"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb732-20"></a></span>
<span id="cb732-21"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb732-21"></a>    <span class="co">// malloc() space to hold the data for this thread</span></span>
<span id="cb732-22"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb732-22"></a>    <span class="dt">char</span> <span class="op">*</span>s <span class="op">=</span> malloc<span class="op">(</span><span class="dv">64</span><span class="op">);</span></span>
<span id="cb732-23"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb732-23"></a>    sprintf<span class="op">(</span>s<span class="op">,</span> <span class="st">"thread </span><span class="sc">%d</span><span class="st">! :)"</span><span class="op">,</span> serial<span class="op">);</span>  <span class="co">// Happy little string</span></span>
<span id="cb732-24"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb732-24"></a></span>
<span id="cb732-25"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb732-25"></a>    <span class="co">// Set this TSS variable to point at the string</span></span>
<span id="cb732-26"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb732-26"></a>    tss_set<span class="op">(</span>str<span class="op">,</span> s<span class="op">);</span></span>
<span id="cb732-27"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb732-27"></a></span>
<span id="cb732-28"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb732-28"></a>    <span class="co">// Call a function that will get the variable</span></span>
<span id="cb732-29"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb732-29"></a>    some_function<span class="op">();</span></span>
<span id="cb732-30"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb732-30"></a></span>
<span id="cb732-31"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb732-31"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span>   <span class="co">// Equivalent to thrd_exit(0)</span></span>
<span id="cb732-32"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb732-32"></a><span class="op">}</span></span>
<span id="cb732-33"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb732-33"></a></span>
<span id="cb732-34"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb732-34"></a><span class="pp">#define THREAD_COUNT </span><span class="dv">15</span></span>
<span id="cb732-35"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb732-35"></a></span>
<span id="cb732-36"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb732-36"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb732-37"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb732-37"></a><span class="op">{</span></span>
<span id="cb732-38"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb732-38"></a>    thrd_t t<span class="op">[</span>THREAD_COUNT<span class="op">];</span></span>
<span id="cb732-39"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb732-39"></a></span>
<span id="cb732-40"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb732-40"></a>    <span class="co">// Make a new TSS variable, the free() function is the destructor</span></span>
<span id="cb732-41"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb732-41"></a>    tss_create<span class="op">(&amp;</span>str<span class="op">,</span> free<span class="op">);</span></span>
<span id="cb732-42"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb732-42"></a></span>
<span id="cb732-43"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb732-43"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> THREAD_COUNT<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb732-44"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb732-44"></a>        <span class="dt">int</span> <span class="op">*</span>n <span class="op">=</span> malloc<span class="op">(</span><span class="kw">sizeof</span> <span class="op">*</span>n<span class="op">);</span>  <span class="co">// Holds a thread serial number</span></span>
<span id="cb732-45"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb732-45"></a>        <span class="op">*</span>n <span class="op">=</span> i<span class="op">;</span></span>
<span id="cb732-46"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb732-46"></a>        thrd_create<span class="op">(</span>t <span class="op">+</span> i<span class="op">,</span> run<span class="op">,</span> n<span class="op">);</span></span>
<span id="cb732-47"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb732-47"></a>    <span class="op">}</span></span>
<span id="cb732-48"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb732-48"></a></span>
<span id="cb732-49"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb732-49"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> THREAD_COUNT<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb732-50"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb732-50"></a>        thrd_join<span class="op">(</span>t<span class="op">[</span>i<span class="op">],</span> NULL<span class="op">);</span></span>
<span id="cb732-51"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb732-51"></a>    <span class="op">}</span></span>
<span id="cb732-52"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb732-52"></a></span>
<span id="cb732-53"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb732-53"></a>    <span class="co">// All threads are done, so we're done with this</span></span>
<span id="cb732-54"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb732-54"></a>    tss_delete<span class="op">(</span>str<span class="op">);</span></span>
<span id="cb732-55"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb732-55"></a><span class="op">}</span></span></code></pre></div>
<p> </p>
<p>Again, this is kind of a painful way of doing things compared to <code>thread_local</code>, so unless you really need that destructor functionality, I’d use that instead.</p>
<p></p>
<h2 data-number="39.7" id="mutex"><span class="header-section-number">39.7</span> Mutexes</h2>
<p></p>
<p>If you want to only allow a single thread into a critical section of code at a time, you can protect that section with a mutex<a href="https://beej.us/guide/bgc/html/index-wide.html#fn201" class="footnote-ref" id="fnref201" role="doc-noteref"><sup>201</sup></a>.</p>
<p>For example, if we had a <code>static</code> variable and we wanted to be able to get and set it in two operations without another thread jumping in the middle and corrupting it, we could use a mutex for that.</p>
<p>You can acquire a mutex or release it. If you attempt to acquire the mutex and succeed, you may continue execution. If you attempt and fail (because someone else holds it), you will <em>block</em><a href="https://beej.us/guide/bgc/html/index-wide.html#fn202" class="footnote-ref" id="fnref202" role="doc-noteref"><sup>202</sup></a> until the mutex is released.</p>
<p>If multiple threads are blocked waiting for a mutex to be released, one of them will be chosen to run (at random, from our perspective), and the others will continue to sleep.</p>
<p>The gameplan is that first we’ll initialize a mutex variable to make it ready to use with <code>mtx_init()</code>.</p>
<p>Then subsequent threads can call <code>mtx_lock()</code> and <code>mtx_unlock()</code> to get and release the mutex.</p>
<p>When we’re completely done with the mutex, we can destroy it with <code>mtx_destroy()</code>, the logical opposite of <code>mtx_init()</code>.</p>
<p></p>
<p>First, let’s look at some code that does <em>not</em> use a mutex, and endeavors to print out a shared (<code>static</code>) serial number and then increment it. Because we’re not using a mutex over the getting of the value (to print it) and the setting (to increment it), threads might get in each other’s way in that critical section.</p>
<div class="sourceCode" id="cb733"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb733-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb733-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb733-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb733-2"></a><span class="pp">#include </span><span class="im">&lt;threads.h&gt;</span></span>
<span id="cb733-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb733-3"></a></span>
<span id="cb733-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb733-4"></a><span class="dt">int</span> run<span class="op">(</span><span class="dt">void</span> <span class="op">*</span>arg<span class="op">)</span></span>
<span id="cb733-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb733-5"></a><span class="op">{</span></span>
<span id="cb733-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb733-6"></a>    <span class="op">(</span><span class="dt">void</span><span class="op">)</span>arg<span class="op">;</span></span>
<span id="cb733-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb733-7"></a></span>
<span id="cb733-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb733-8"></a>    <span class="dt">static</span> <span class="dt">int</span> serial <span class="op">=</span> <span class="dv">0</span><span class="op">;</span>   <span class="co">// Shared static variable!</span></span>
<span id="cb733-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb733-9"></a></span>
<span id="cb733-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb733-10"></a>    printf<span class="op">(</span><span class="st">"Thread running! </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> serial<span class="op">);</span></span>
<span id="cb733-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb733-11"></a></span>
<span id="cb733-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb733-12"></a>    serial<span class="op">++;</span></span>
<span id="cb733-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb733-13"></a></span>
<span id="cb733-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb733-14"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb733-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb733-15"></a><span class="op">}</span></span>
<span id="cb733-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb733-16"></a></span>
<span id="cb733-17"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb733-17"></a><span class="pp">#define THREAD_COUNT </span><span class="dv">10</span></span>
<span id="cb733-18"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb733-18"></a></span>
<span id="cb733-19"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb733-19"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb733-20"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb733-20"></a><span class="op">{</span></span>
<span id="cb733-21"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb733-21"></a>    thrd_t t<span class="op">[</span>THREAD_COUNT<span class="op">];</span></span>
<span id="cb733-22"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb733-22"></a></span>
<span id="cb733-23"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb733-23"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> THREAD_COUNT<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb733-24"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb733-24"></a>        thrd_create<span class="op">(</span>t <span class="op">+</span> i<span class="op">,</span> run<span class="op">,</span> NULL<span class="op">);</span></span>
<span id="cb733-25"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb733-25"></a>    <span class="op">}</span></span>
<span id="cb733-26"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb733-26"></a></span>
<span id="cb733-27"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb733-27"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> THREAD_COUNT<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb733-28"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb733-28"></a>        thrd_join<span class="op">(</span>t<span class="op">[</span>i<span class="op">],</span> NULL<span class="op">);</span></span>
<span id="cb733-29"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb733-29"></a>    <span class="op">}</span></span>
<span id="cb733-30"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb733-30"></a><span class="op">}</span></span></code></pre></div>
<p>When I run this, I get something that looks like this:</p>
<div class="sourceCode" id="cb734"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb734-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb734-1" aria-hidden="true" tabindex="-1"></a>Thread running! 0</span>
<span id="cb734-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb734-2" aria-hidden="true" tabindex="-1"></a>Thread running! 0</span>
<span id="cb734-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb734-3" aria-hidden="true" tabindex="-1"></a>Thread running! 0</span>
<span id="cb734-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb734-4" aria-hidden="true" tabindex="-1"></a>Thread running! 3</span>
<span id="cb734-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb734-5" aria-hidden="true" tabindex="-1"></a>Thread running! 4</span>
<span id="cb734-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb734-6" aria-hidden="true" tabindex="-1"></a>Thread running! 5</span>
<span id="cb734-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb734-7" aria-hidden="true" tabindex="-1"></a>Thread running! 6</span>
<span id="cb734-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb734-8" aria-hidden="true" tabindex="-1"></a>Thread running! 7</span>
<span id="cb734-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb734-9" aria-hidden="true" tabindex="-1"></a>Thread running! 8</span>
<span id="cb734-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb734-10" aria-hidden="true" tabindex="-1"></a>Thread running! 9</span></code></pre></div>
<p>Clearly multiple threads are getting in there and running the <code>printf()</code> before anyone gets a change to update the <code>serial</code> variable.</p>
<p></p>
<p>What we want to do is wrap the getting of the variable and setting of it into a single mutex-protected stretch of code.</p>
<p>We’ll add a new variable to represent the mutex of type <code>mtx_t</code> in file scope, initialize it, and then the threads can lock and unlock it in the <code>run()</code> function.</p>
<p> </p>
<div class="sourceCode" id="cb735"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb735-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb735-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb735-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb735-2"></a><span class="pp">#include </span><span class="im">&lt;threads.h&gt;</span></span>
<span id="cb735-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb735-3"></a></span>
<span id="cb735-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb735-4"></a>mtx_t serial_mtx<span class="op">;</span>     <span class="co">// &lt;-- MUTEX VARIABLE</span></span>
<span id="cb735-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb735-5"></a></span>
<span id="cb735-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb735-6"></a><span class="dt">int</span> run<span class="op">(</span><span class="dt">void</span> <span class="op">*</span>arg<span class="op">)</span></span>
<span id="cb735-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb735-7"></a><span class="op">{</span></span>
<span id="cb735-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb735-8"></a>    <span class="op">(</span><span class="dt">void</span><span class="op">)</span>arg<span class="op">;</span></span>
<span id="cb735-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb735-9"></a></span>
<span id="cb735-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb735-10"></a>    <span class="dt">static</span> <span class="dt">int</span> serial <span class="op">=</span> <span class="dv">0</span><span class="op">;</span>   <span class="co">// Shared static variable!</span></span>
<span id="cb735-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb735-11"></a></span>
<span id="cb735-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb735-12"></a>    <span class="co">// Acquire the mutex--all threads will block on this call until</span></span>
<span id="cb735-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb735-13"></a>    <span class="co">// they get the lock:</span></span>
<span id="cb735-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb735-14"></a></span>
<span id="cb735-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb735-15"></a>    mtx_lock<span class="op">(&amp;</span>serial_mtx<span class="op">);</span>           <span class="co">// &lt;-- ACQUIRE MUTEX</span></span>
<span id="cb735-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb735-16"></a></span>
<span id="cb735-17"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb735-17"></a>    printf<span class="op">(</span><span class="st">"Thread running! </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> serial<span class="op">);</span></span>
<span id="cb735-18"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb735-18"></a></span>
<span id="cb735-19"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb735-19"></a>    serial<span class="op">++;</span></span>
<span id="cb735-20"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb735-20"></a></span>
<span id="cb735-21"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb735-21"></a>    <span class="co">// Done getting and setting the data, so free the lock. This will</span></span>
<span id="cb735-22"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb735-22"></a>    <span class="co">// unblock threads on the mtx_lock() call:</span></span>
<span id="cb735-23"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb735-23"></a></span>
<span id="cb735-24"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb735-24"></a>    mtx_unlock<span class="op">(&amp;</span>serial_mtx<span class="op">);</span>         <span class="co">// &lt;-- RELEASE MUTEX</span></span>
<span id="cb735-25"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb735-25"></a></span>
<span id="cb735-26"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb735-26"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb735-27"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb735-27"></a><span class="op">}</span></span>
<span id="cb735-28"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb735-28"></a></span>
<span id="cb735-29"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb735-29"></a><span class="pp">#define THREAD_COUNT </span><span class="dv">10</span></span>
<span id="cb735-30"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb735-30"></a></span>
<span id="cb735-31"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb735-31"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb735-32"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb735-32"></a><span class="op">{</span></span>
<span id="cb735-33"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb735-33"></a>    thrd_t t<span class="op">[</span>THREAD_COUNT<span class="op">];</span></span>
<span id="cb735-34"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb735-34"></a></span>
<span id="cb735-35"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb735-35"></a>    <span class="co">// Initialize the mutex variable, indicating this is a normal</span></span>
<span id="cb735-36"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb735-36"></a>    <span class="co">// no-frills, mutex:</span></span>
<span id="cb735-37"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb735-37"></a></span>
<span id="cb735-38"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb735-38"></a>    mtx_init<span class="op">(&amp;</span>serial_mtx<span class="op">,</span> mtx_plain<span class="op">);</span>        <span class="co">// &lt;-- CREATE MUTEX</span></span>
<span id="cb735-39"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb735-39"></a></span>
<span id="cb735-40"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb735-40"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> THREAD_COUNT<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb735-41"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb735-41"></a>        thrd_create<span class="op">(</span>t <span class="op">+</span> i<span class="op">,</span> run<span class="op">,</span> NULL<span class="op">);</span></span>
<span id="cb735-42"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb735-42"></a>    <span class="op">}</span></span>
<span id="cb735-43"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb735-43"></a></span>
<span id="cb735-44"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb735-44"></a>    <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> THREAD_COUNT<span class="op">;</span> i<span class="op">++)</span> <span class="op">{</span></span>
<span id="cb735-45"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb735-45"></a>        thrd_join<span class="op">(</span>t<span class="op">[</span>i<span class="op">],</span> NULL<span class="op">);</span></span>
<span id="cb735-46"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb735-46"></a>    <span class="op">}</span></span>
<span id="cb735-47"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb735-47"></a></span>
<span id="cb735-48"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb735-48"></a>    <span class="co">// Done with the mutex, destroy it:</span></span>
<span id="cb735-49"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb735-49"></a></span>
<span id="cb735-50"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb735-50"></a>    mtx_destroy<span class="op">(&amp;</span>serial_mtx<span class="op">);</span>                <span class="co">// &lt;-- DESTROY MUTEX</span></span>
<span id="cb735-51"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb735-51"></a><span class="op">}</span></span></code></pre></div>
<p>See how on lines 38 and 50 of <code>main()</code> we initialize and destroy the mutex.</p>
<p> </p>
<p>But each individual thread acquires the mutex on line 15 and releases it on line 24.</p>
<p>In between the <code>mtx_lock()</code> and <code>mtx_unlock()</code> is the <em>critical section</em>, the area of code where we don’t want multiple threads mucking about at the same time.</p>
<p> </p>
<p>And now we get proper output!</p>
<div class="sourceCode" id="cb736"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb736-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb736-1" aria-hidden="true" tabindex="-1"></a>Thread running! 0</span>
<span id="cb736-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb736-2" aria-hidden="true" tabindex="-1"></a>Thread running! 1</span>
<span id="cb736-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb736-3" aria-hidden="true" tabindex="-1"></a>Thread running! 2</span>
<span id="cb736-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb736-4" aria-hidden="true" tabindex="-1"></a>Thread running! 3</span>
<span id="cb736-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb736-5" aria-hidden="true" tabindex="-1"></a>Thread running! 4</span>
<span id="cb736-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb736-6" aria-hidden="true" tabindex="-1"></a>Thread running! 5</span>
<span id="cb736-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb736-7" aria-hidden="true" tabindex="-1"></a>Thread running! 6</span>
<span id="cb736-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb736-8" aria-hidden="true" tabindex="-1"></a>Thread running! 7</span>
<span id="cb736-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb736-9" aria-hidden="true" tabindex="-1"></a>Thread running! 8</span>
<span id="cb736-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb736-10" aria-hidden="true" tabindex="-1"></a>Thread running! 9</span></code></pre></div>
<p>If you need multiple mutexes, no problem: just have multiple mutex variables.</p>
<p>And always remember the Number One Rule of Multiple Mutexes: <em>Unlock mutexes in the opposite order in which you lock them!</em></p>
<h3 data-number="39.7.1" id="different-mutex-types"><span class="header-section-number">39.7.1</span> Different Mutex Types</h3>
<p></p>
<p>As hinted earlier, we have a few mutex types that you can create with <code>mtx_init()</code>. (Some of these types are the result of a bitwise-OR operation, as noted in the table.)</p>
<p></p>
<table>
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>mtx_plain</code></td>
<td>Regular ol’ mutex</td>
</tr>
<tr class="even">
<td><code>mtx_timed</code></td>
<td>Mutex that supports timeouts</td>
</tr>
<tr class="odd">
<td><code>mtx_plain|mtx_recursive</code></td>
<td>Recursive mutex</td>
</tr>
<tr class="even">
<td><code>mtx_timed|mtx_recursive</code></td>
<td>Recursive mutex that supports timeouts</td>
</tr>
</tbody>
</table>
<p>“Recursive” means that the holder of a lock can call <code>mtx_lock()</code> multiple times on the same lock. (They have to unlock it an equal number of times before anyone else can take the mutex.) This might ease coding from time to time, especially if you call a function that needs to lock the mutex when you already hold the mutex.</p>
<p>And the timeout gives a thread a chance to <em>try</em> to get the lock for a while, but then bail out if it can’t get it in that timeframe.</p>
<p></p>
<p>For a timeout mutex, be sure to create it with <code>mtx_timed</code>:</p>
<div class="sourceCode" id="cb737"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb737-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb737-1" aria-hidden="true" tabindex="-1"></a>mtx_init<span class="op">(&amp;</span>serial_mtx<span class="op">,</span> mtx_timed<span class="op">);</span></span></code></pre></div>
<p></p>
<p>And then when you wait for it, you have to specify a time in UTC when it will unlock<a href="https://beej.us/guide/bgc/html/index-wide.html#fn203" class="footnote-ref" id="fnref203" role="doc-noteref"><sup>203</sup></a>.</p>
<p></p>
<p>The function <code>timespec_get()</code> from <code>&lt;time.h&gt;</code> can be of assistance here. It’ll get you the current time in UTC in a <code>struct timespec</code> which is just what we need. In fact, it seems to exist merely for this purpose.</p>
<p>It has two fields: <code>tv_sec</code> has the current time in seconds since epoch, and <code>tv_nsec</code> has the nanoseconds (billionths of a second) as the “fractional” part.</p>
<p>So you can load that up with the current time, and then add to it to get a specific timeout.</p>
<p></p>
<p>Then call <code>mtx_timedlock()</code> instead of <code>mtx_lock()</code>. If it returns the value <code>thrd_timedout</code>, it timed out.</p>
<div class="sourceCode" id="cb738"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb738-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb738-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> timespec timeout<span class="op">;</span></span>
<span id="cb738-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb738-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb738-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb738-3" aria-hidden="true" tabindex="-1"></a>timespec_get<span class="op">(&amp;</span>timeout<span class="op">,</span> TIME_UTC<span class="op">);</span>  <span class="co">// Get current time</span></span>
<span id="cb738-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb738-4" aria-hidden="true" tabindex="-1"></a>timeout<span class="op">.</span>tv_sec <span class="op">+=</span> <span class="dv">1</span><span class="op">;</span>               <span class="co">// Timeout 1 second after now</span></span>
<span id="cb738-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb738-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb738-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb738-6" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> result <span class="op">=</span> mtx_timedlock<span class="op">(&amp;</span>serial_mtx<span class="op">,</span> <span class="op">&amp;</span>timeout<span class="op">));</span></span>
<span id="cb738-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb738-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb738-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb738-8" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>result <span class="op">==</span> thrd_timedout<span class="op">)</span> <span class="op">{</span></span>
<span id="cb738-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb738-9" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Mutex lock timed out!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb738-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb738-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p> </p>
<p>Other than that, timed locks are the same as regular locks.</p>
<p> </p>
<h2 data-number="39.8" id="condition-variables"><span class="header-section-number">39.8</span> Condition Variables</h2>
<p></p>
<p>Condition Variables are the last piece of the puzzle we need to make performant multithreaded applications and to compose more complex multithreaded structures.</p>
<p>A condition variable provides a way for threads to go to sleep until some event on another thread occurs.</p>
<p>In other words, we might have a number of threads that are rearing to go, but they have to wait until some event is true before they continue. Basically they’re being told “wait for it!” until they get notified.</p>
<p>And this works hand-in-hand with mutexes since what we’re going to wait on generally depends on the value of some data, and that data generally needs to be protected by a mutex.</p>
<p>It’s important to note that the condition variable itself isn’t the holder of any particular data from our perspective. It’s merely the variable by which C keeps track of the waiting/not-waiting status of a particular thread or group of threads.</p>
<p>Let’s write a contrived program that reads in groups of 5 numbers from the main thread one at a time. Then, when 5 numbers have been entered, the child thread wakes up, sums up those 5 numbers, and prints the result.</p>
<p>The numbers will be stored in a global, shared array, as will the index into the array of the about-to-be-entered number.</p>
<p>Since these are shared values, we at least have to hide them behind a mutex for both the main and child threads. (The main will be writing data to them and the child will be reading data from them.)</p>
<p>But that’s not enough. The child thread needs to block (“sleep”) until 5 numbers have been read into the array. And then the parent thread needs to wake up the child thread so it can do its work.</p>
<p>And when it wakes up, it needs to be holding that mutex. And it will! When a thread waits on a condition variable, it also acquires a mutex when it wakes up.</p>
<p>All this takes place around an additional variable of type <code>cnd_t</code> that is the <em>condition variable</em>. We create this variable with the <code>cnd_init()</code> function and destroy it when we’re done with it with the <code>cnd_destroy()</code> function.</p>
<p>But how’s this all work? Let’s look at the outline of what the child thread will do:</p>
<p> </p>
<ol type="1">
<li>Lock the mutex with <code>mtx_lock()</code></li>
<li>If we haven’t entered all the numbers, wait on the condition variable with <code>cnd_wait()</code></li>
<li>Do the work that needs doing</li>
<li>Unlock the mutex with <code>mtx_unlock()</code></li>
</ol>
<p>Meanwhile the main thread will be doing this:</p>
<ol type="1">
<li>Lock the mutex with <code>mtx_lock()</code></li>
<li>Store the recently-read number into the array</li>
<li>If the array is full, signal the child to wake up with <code>cnd_signal()</code></li>
<li>Unlock the mutex with <code>mtx_unlock()</code></li>
</ol>
<p> </p>
<p>If you didn’t skim that too hard (it’s OK—I’m not offended), you might notice something weird: how can the main thread hold the mutex lock and signal the child, if the child has to hold the mutex lock to wait for the signal? They can’t both hold the lock!</p>
<p>And indeed they don’t! There’s some behind-the-scenes magic with condition variables: when you <code>cnd_wait()</code>, it releases the mutex that you specify and the thread goes to sleep. And when someone signals that thread to wake up, it reacquires the lock as if nothing had happened.</p>
<p>It’s a little different on the <code>cnd_signal()</code> side of things. This doesn’t do anything with the mutex. The signaling thread still must manually release the mutex before the waiting threads can wake up.</p>
<p></p>
<p>One more thing on the <code>cnd_wait()</code>. You’ll probably be calling <code>cnd_wait()</code> if some condition<a href="https://beej.us/guide/bgc/html/index-wide.html#fn204" class="footnote-ref" id="fnref204" role="doc-noteref"><sup>204</sup></a> is not yet met (e.g.&nbsp;in this case, if not all the numbers have yet been entered). Here’s the deal: this condition should be in a <code>while</code> loop, not an <code>if</code> statement. Why?</p>
<p>It’s because of a mysterious phenomenon called a <em>spurious wakeup</em>. Sometimes, in some implementations, a thread can be woken up out of a <code>cnd_wait()</code> sleep for seemingly <em>no reason</em>. <em>[X-Files music]</em><a href="https://beej.us/guide/bgc/html/index-wide.html#fn205" class="footnote-ref" id="fnref205" role="doc-noteref"><sup>205</sup></a>. And so we have to check to see that the condition we need is still actually met when we wake up. And if it’s not, back to sleep with us!</p>
<p></p>
<p>So let’s do this thing! Starting with the main thread:</p>
<ul>
<li><p>The main thread will set up the mutex and condition variable, and will launch the child thread.</p></li>
<li><p>Then it will, in an infinite loop, get numbers as input from the console.</p></li>
<li><p>It will also acquire the mutex to store the inputted number into a global array.</p></li>
<li><p>When the array has 5 numbers in it, the main thread will signal the child thread that it’s time to wake up and do its work.</p></li>
<li><p>Then the main thread will unlock the mutex and go back to reading the next number from the console.</p></li>
</ul>
<p>Meanwhile, the child thread has been up to its own shenanigans:</p>
<ul>
<li><p>The child thread grabs the mutex</p></li>
<li><p>While the condition is not met (i.e.&nbsp;while the shared array doesn’t yet have 5 numbers in it), the child thread sleeps by waiting on the condition variable. When it waits, it implicitly unlocks the mutex.</p></li>
<li><p>Once the main thread signals the child thread to wake up, it wakes up to do the work and gets the mutex lock back.</p></li>
<li><p>The child thread sums the numbers and resets the variable that is the index into the array.</p></li>
<li><p>It then releases the mutex and runs again in an infinite loop.</p></li>
</ul>
<p>And here’s the code! Give it some study so you can see where all the above pieces are being handled:</p>
<p> </p>
<div class="sourceCode" id="cb739"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb739-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb739-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb739-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb739-2"></a><span class="pp">#include </span><span class="im">&lt;threads.h&gt;</span></span>
<span id="cb739-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb739-3"></a></span>
<span id="cb739-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb739-4"></a><span class="pp">#define VALUE_COUNT_MAX </span><span class="dv">5</span></span>
<span id="cb739-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb739-5"></a></span>
<span id="cb739-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb739-6"></a><span class="dt">int</span> value<span class="op">[</span>VALUE_COUNT_MAX<span class="op">];</span>  <span class="co">// Shared global</span></span>
<span id="cb739-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb739-7"></a><span class="dt">int</span> value_count <span class="op">=</span> <span class="dv">0</span><span class="op">;</span>   <span class="co">// Shared global, too</span></span>
<span id="cb739-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb739-8"></a></span>
<span id="cb739-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb739-9"></a>mtx_t value_mtx<span class="op">;</span>   <span class="co">// Mutex around value</span></span>
<span id="cb739-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb739-10"></a>cnd_t value_cnd<span class="op">;</span>   <span class="co">// Condition variable on value</span></span>
<span id="cb739-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb739-11"></a></span>
<span id="cb739-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb739-12"></a><span class="dt">int</span> run<span class="op">(</span><span class="dt">void</span> <span class="op">*</span>arg<span class="op">)</span></span>
<span id="cb739-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb739-13"></a><span class="op">{</span></span>
<span id="cb739-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb739-14"></a>    <span class="op">(</span><span class="dt">void</span><span class="op">)</span>arg<span class="op">;</span></span>
<span id="cb739-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb739-15"></a></span>
<span id="cb739-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb739-16"></a>    <span class="cf">for</span> <span class="op">(;;)</span> <span class="op">{</span></span>
<span id="cb739-17"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb739-17"></a>        mtx_lock<span class="op">(&amp;</span>value_mtx<span class="op">);</span>      <span class="co">// &lt;-- GRAB THE MUTEX</span></span>
<span id="cb739-18"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb739-18"></a></span>
<span id="cb739-19"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb739-19"></a>        <span class="cf">while</span> <span class="op">(</span>value_count <span class="op">&lt;</span> VALUE_COUNT_MAX<span class="op">)</span> <span class="op">{</span></span>
<span id="cb739-20"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb739-20"></a>            printf<span class="op">(</span><span class="st">"Thread: is waiting</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb739-21"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb739-21"></a>            cnd_wait<span class="op">(&amp;</span>value_cnd<span class="op">,</span> <span class="op">&amp;</span>value_mtx<span class="op">);</span>  <span class="co">// &lt;-- CONDITION WAIT</span></span>
<span id="cb739-22"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb739-22"></a>        <span class="op">}</span></span>
<span id="cb739-23"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb739-23"></a></span>
<span id="cb739-24"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb739-24"></a>        printf<span class="op">(</span><span class="st">"Thread: is awake!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb739-25"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb739-25"></a></span>
<span id="cb739-26"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb739-26"></a>        <span class="dt">int</span> t <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb739-27"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb739-27"></a></span>
<span id="cb739-28"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb739-28"></a>        <span class="co">// Add everything up</span></span>
<span id="cb739-29"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb739-29"></a>        <span class="cf">for</span> <span class="op">(</span><span class="dt">int</span> i <span class="op">=</span> <span class="dv">0</span><span class="op">;</span> i <span class="op">&lt;</span> VALUE_COUNT_MAX<span class="op">;</span> i<span class="op">++)</span></span>
<span id="cb739-30"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb739-30"></a>            t <span class="op">+=</span> value<span class="op">[</span>i<span class="op">];</span></span>
<span id="cb739-31"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb739-31"></a></span>
<span id="cb739-32"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb739-32"></a>        printf<span class="op">(</span><span class="st">"Thread: total is </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> t<span class="op">);</span></span>
<span id="cb739-33"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb739-33"></a></span>
<span id="cb739-34"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb739-34"></a>        <span class="co">// Reset input index for main thread</span></span>
<span id="cb739-35"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb739-35"></a>        value_count <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb739-36"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb739-36"></a></span>
<span id="cb739-37"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb739-37"></a>        mtx_unlock<span class="op">(&amp;</span>value_mtx<span class="op">);</span>   <span class="co">// &lt;-- MUTEX UNLOCK</span></span>
<span id="cb739-38"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb739-38"></a>    <span class="op">}</span></span>
<span id="cb739-39"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb739-39"></a></span>
<span id="cb739-40"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb739-40"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb739-41"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb739-41"></a><span class="op">}</span></span>
<span id="cb739-42"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb739-42"></a></span>
<span id="cb739-43"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb739-43"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb739-44"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb739-44"></a><span class="op">{</span></span>
<span id="cb739-45"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb739-45"></a>    thrd_t t<span class="op">;</span></span>
<span id="cb739-46"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb739-46"></a></span>
<span id="cb739-47"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb739-47"></a>    <span class="co">// Spawn a new thread</span></span>
<span id="cb739-48"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb739-48"></a></span>
<span id="cb739-49"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb739-49"></a>    thrd_create<span class="op">(&amp;</span>t<span class="op">,</span> run<span class="op">,</span> NULL<span class="op">);</span></span>
<span id="cb739-50"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb739-50"></a>    thrd_detach<span class="op">(</span>t<span class="op">);</span></span>
<span id="cb739-51"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb739-51"></a></span>
<span id="cb739-52"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb739-52"></a>    <span class="co">// Set up the mutex and condition variable</span></span>
<span id="cb739-53"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb739-53"></a></span>
<span id="cb739-54"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb739-54"></a>    mtx_init<span class="op">(&amp;</span>value_mtx<span class="op">,</span> mtx_plain<span class="op">);</span></span>
<span id="cb739-55"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb739-55"></a>    cnd_init<span class="op">(&amp;</span>value_cnd<span class="op">);</span></span>
<span id="cb739-56"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb739-56"></a></span>
<span id="cb739-57"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb739-57"></a>    <span class="cf">for</span> <span class="op">(;;)</span> <span class="op">{</span></span>
<span id="cb739-58"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb739-58"></a>        <span class="dt">int</span> n<span class="op">;</span></span>
<span id="cb739-59"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb739-59"></a></span>
<span id="cb739-60"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb739-60"></a>        scanf<span class="op">(</span><span class="st">"</span><span class="sc">%d</span><span class="st">"</span><span class="op">,</span> <span class="op">&amp;</span>n<span class="op">);</span></span>
<span id="cb739-61"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb739-61"></a></span>
<span id="cb739-62"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb739-62"></a>        mtx_lock<span class="op">(&amp;</span>value_mtx<span class="op">);</span>    <span class="co">// &lt;-- LOCK MUTEX</span></span>
<span id="cb739-63"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb739-63"></a></span>
<span id="cb739-64"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb739-64"></a>        value<span class="op">[</span>value_count<span class="op">++]</span> <span class="op">=</span> n<span class="op">;</span></span>
<span id="cb739-65"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb739-65"></a></span>
<span id="cb739-66"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb739-66"></a>        <span class="cf">if</span> <span class="op">(</span>value_count <span class="op">==</span> VALUE_COUNT_MAX<span class="op">)</span> <span class="op">{</span></span>
<span id="cb739-67"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb739-67"></a>            printf<span class="op">(</span><span class="st">"Main: signaling thread</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb739-68"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb739-68"></a>            cnd_signal<span class="op">(&amp;</span>value_cnd<span class="op">);</span>  <span class="co">// &lt;-- SIGNAL CONDITION</span></span>
<span id="cb739-69"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb739-69"></a>        <span class="op">}</span></span>
<span id="cb739-70"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb739-70"></a></span>
<span id="cb739-71"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb739-71"></a>        mtx_unlock<span class="op">(&amp;</span>value_mtx<span class="op">);</span>  <span class="co">// &lt;-- UNLOCK MUTEX</span></span>
<span id="cb739-72"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb739-72"></a>    <span class="op">}</span></span>
<span id="cb739-73"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb739-73"></a></span>
<span id="cb739-74"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb739-74"></a>    <span class="co">// Clean up (I know that's an infinite loop above here, but I</span></span>
<span id="cb739-75"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb739-75"></a>    <span class="co">// want to at least pretend to be proper):</span></span>
<span id="cb739-76"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb739-76"></a></span>
<span id="cb739-77"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb739-77"></a>    mtx_destroy<span class="op">(&amp;</span>value_mtx<span class="op">);</span></span>
<span id="cb739-78"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb739-78"></a>    cnd_destroy<span class="op">(&amp;</span>value_cnd<span class="op">);</span></span>
<span id="cb739-79"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb739-79"></a><span class="op">}</span></span></code></pre></div>
<p> </p>
<p>And here’s some sample output (individual numbers on lines are my input):</p>
<div class="sourceCode" id="cb740"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb740-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb740-1" aria-hidden="true" tabindex="-1"></a>Thread: is waiting</span>
<span id="cb740-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb740-2" aria-hidden="true" tabindex="-1"></a>1</span>
<span id="cb740-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb740-3" aria-hidden="true" tabindex="-1"></a>1</span>
<span id="cb740-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb740-4" aria-hidden="true" tabindex="-1"></a>1</span>
<span id="cb740-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb740-5" aria-hidden="true" tabindex="-1"></a>1</span>
<span id="cb740-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb740-6" aria-hidden="true" tabindex="-1"></a>1</span>
<span id="cb740-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb740-7" aria-hidden="true" tabindex="-1"></a>Main: signaling thread</span>
<span id="cb740-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb740-8" aria-hidden="true" tabindex="-1"></a>Thread: is awake!</span>
<span id="cb740-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb740-9" aria-hidden="true" tabindex="-1"></a>Thread: total is 5</span>
<span id="cb740-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb740-10" aria-hidden="true" tabindex="-1"></a>Thread: is waiting</span>
<span id="cb740-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb740-11" aria-hidden="true" tabindex="-1"></a>2</span>
<span id="cb740-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb740-12" aria-hidden="true" tabindex="-1"></a>8</span>
<span id="cb740-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb740-13" aria-hidden="true" tabindex="-1"></a>5</span>
<span id="cb740-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb740-14" aria-hidden="true" tabindex="-1"></a>9</span>
<span id="cb740-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb740-15" aria-hidden="true" tabindex="-1"></a>0</span>
<span id="cb740-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb740-16" aria-hidden="true" tabindex="-1"></a>Main: signaling thread</span>
<span id="cb740-17"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb740-17" aria-hidden="true" tabindex="-1"></a>Thread: is awake!</span>
<span id="cb740-18"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb740-18" aria-hidden="true" tabindex="-1"></a>Thread: total is 24</span>
<span id="cb740-19"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb740-19" aria-hidden="true" tabindex="-1"></a>Thread: is waiting</span></code></pre></div>
<p>It’s a common use of condition variables in producer-consumer situations like this. If we didn’t have a way to put the child thread to sleep while it waited for some condition to be met, it would be force to poll which is a big waste of CPU.</p>
<h3 data-number="39.8.1" id="timed-condition-wait"><span class="header-section-number">39.8.1</span> Timed Condition Wait</h3>
<p></p>
<p>There’s a variant of <code>cnd_wait()</code> that allows you to specify a timeout so you can stop waiting.</p>
<p>Since the child thread must relock the mutex, this doesn’t necessarily mean that you’ll be popping back to life the instant the timeout occurs; you still must wait for any other threads to release the mutex.</p>
<p>But it does mean that you won’t be waiting until the <code>cnd_signal()</code> happens.</p>
<p>To make this work, call <code>cnd_timedwait()</code> instead of <code>cnd_wait()</code>. If it returns the value <code>thrd_timedout</code>, it timed out.</p>
<p>The timestamp is an absolute time in UTC, not a time-from-now. Thankfully the <code>timespec_get()</code> function in <code>&lt;time.h&gt;</code> seems custom-made for exactly this case.</p>
<p> </p>
<div class="sourceCode" id="cb741"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb741-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb741-1" aria-hidden="true" tabindex="-1"></a><span class="kw">struct</span> timespec timeout<span class="op">;</span></span>
<span id="cb741-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb741-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb741-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb741-3" aria-hidden="true" tabindex="-1"></a>timespec_get<span class="op">(&amp;</span>timeout<span class="op">,</span> TIME_UTC<span class="op">);</span>  <span class="co">// Get current time</span></span>
<span id="cb741-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb741-4" aria-hidden="true" tabindex="-1"></a>timeout<span class="op">.</span>tv_sec <span class="op">+=</span> <span class="dv">1</span><span class="op">;</span>               <span class="co">// Timeout 1 second after now</span></span>
<span id="cb741-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb741-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb741-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb741-6" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> result <span class="op">=</span> cnd_timedwait<span class="op">(&amp;</span>condition<span class="op">,</span> <span class="op">&amp;</span>mutex<span class="op">,</span> <span class="op">&amp;</span>timeout<span class="op">));</span></span>
<span id="cb741-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb741-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb741-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb741-8" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> <span class="op">(</span>result <span class="op">==</span> thrd_timedout<span class="op">)</span> <span class="op">{</span></span>
<span id="cb741-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb741-9" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Condition variable timed out!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb741-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb741-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p> </p>
<h3 data-number="39.8.2" id="broadcast-wake-up-all-waiting-threads"><span class="header-section-number">39.8.2</span> Broadcast: Wake Up All Waiting Threads</h3>
<p></p>
<p><code>cnd_signal()</code> function]] <code>cnd_signal()</code> only wakes up one thread to continue working. Depending on how you have your logic done, it might make sense to wake up more than one thread to continue once the condition is met.</p>
<p>Of course only one of them can grab the mutex, but if you have a situation where:</p>
<ul>
<li><p>The newly-awoken thread is responsible for waking up the next one, and—</p></li>
<li><p>There’s a chance the spurious-wakeup loop condition will prevent it from doing so, then—</p></li>
</ul>
<p>you’ll want to broadcast the wake up so that you’re sure to get at least one of the threads out of that loop to launch the next one.</p>
<p>How, you ask?</p>
<p></p>
<p>Simply use <code>cnd_broadcast()</code> instead of <code>cnd_signal()</code>. Exact same usage, except <code>cnd_broadcast()</code> wakes up <strong>all</strong> the sleeping threads that were waiting on that condition variable.</p>
<p> </p>
<h2 data-number="39.9" id="running-a-function-one-time"><span class="header-section-number">39.9</span> Running a Function One Time</h2>
<p></p>
<p>Let’s say you have a function that <em>could</em> be run by many threads, but you don’t know when, and it’s not work trying to write all that logic.</p>
<p>There’s a way around it: use <code>call_once()</code>. Tons of threads could try to run the function, but only the first one counts<a href="https://beej.us/guide/bgc/html/index-wide.html#fn206" class="footnote-ref" id="fnref206" role="doc-noteref"><sup>206</sup></a></p>
<p>To work with this, you need a special flag variable you declare to keep track of whether or not the thing’s been run. And you need a function to run, which takes no parameters and returns no value.</p>
<p> </p>
<div class="sourceCode" id="cb742"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb742-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb742-1" aria-hidden="true" tabindex="-1"></a>once_flag of <span class="op">=</span> ONCE_FLAG_INIT<span class="op">;</span>  <span class="co">// Initialize it like this</span></span>
<span id="cb742-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb742-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb742-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb742-3" aria-hidden="true" tabindex="-1"></a><span class="dt">void</span> run_once_function<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb742-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb742-4" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb742-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb742-5" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"I'll only run once!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb742-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb742-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span>
<span id="cb742-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb742-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb742-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb742-8" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> run<span class="op">(</span><span class="dt">void</span> <span class="op">*</span>arg<span class="op">)</span></span>
<span id="cb742-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb742-9" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb742-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb742-10" aria-hidden="true" tabindex="-1"></a>    <span class="op">(</span><span class="dt">void</span><span class="op">)</span>arg<span class="op">;</span></span>
<span id="cb742-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb742-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb742-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb742-12" aria-hidden="true" tabindex="-1"></a>    call_once<span class="op">(&amp;</span>of<span class="op">,</span> run_once_function<span class="op">);</span></span>
<span id="cb742-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb742-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb742-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb742-14" aria-hidden="true" tabindex="-1"></a>    <span class="co">// ...</span></span></code></pre></div>
<p> </p>
<p>In this example, no matter how many threads get to the <code>run()</code> function, the <code>run_once_function()</code> will only be called a single time.</p>
<p> </p>
<!-- Beej's guide to C

# vim: ts=4:sw=4:nosi:et:tw=72
-->
<h1 data-number="40" id="chapter-atomics"><span class="header-section-number">40</span> Atomics</h1>
<blockquote>
<p><em>“They tried and failed, all of them?”</em><br>
<em>“Oh, no.” She shook her head. “They tried and died.”</em></p>
<p>—Paul Atreides and The Reverend Mother Gaius Helen Mohiam, <em>Dune</em></p>
</blockquote>
<p></p>
<p>This is one of the more challenging aspects of multithreading with C. But we’ll try to take it easy.</p>
<p>Basically, I’ll talk about the more straightforward uses of atomic variables, what they are, and how they work, etc. And I’ll mention some of the more insanely-complex paths that are available to you.</p>
<p>But I won’t go down those paths. Not only am I barely qualified to even write about them, but I figure if you know you need them, you already know more than I do.</p>
<p>But there are some weird things out here even in the basics. So buckle your seatbelts, everyone, ‘cause Kansas is goin’ bye-bye.</p>
<h2 data-number="40.1" id="testing-for-atomic-support"><span class="header-section-number">40.1</span> Testing for Atomic Support</h2>
<p></p>
<p>Atomics are an optional feature. There’s a macro <code>__STDC_NO_ATOMICS__</code> that’s <code>1</code> if you <em>don’t</em> have atomics.</p>
<p>That macro might not exist pre-C11, so we should test the language version with <code>__STDC_VERSION__</code><a href="https://beej.us/guide/bgc/html/index-wide.html#fn207" class="footnote-ref" id="fnref207" role="doc-noteref"><sup>207</sup></a>.</p>
<div class="sourceCode" id="cb743"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb743-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb743-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#if __STDC_VERSION__ &lt; 201112L || __STDC_NO_ATOMICS__ == 1</span></span>
<span id="cb743-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb743-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#define HAS_ATOMICS </span><span class="dv">0</span></span>
<span id="cb743-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb743-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#else</span></span>
<span id="cb743-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb743-4" aria-hidden="true" tabindex="-1"></a><span class="pp">#define HAS_ATOMICS </span><span class="dv">1</span></span>
<span id="cb743-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb743-5" aria-hidden="true" tabindex="-1"></a><span class="pp">#endif</span></span></code></pre></div>
<p></p>
<p></p>
<p>If those tests pass, then you can safely include <code>&lt;stdatomic.h&gt;</code>, the header on which the rest of this chapter is based. But if there is no atomic support, that header might not even exist.</p>
<p>On some systems, you might need to add <code>-latomic</code> to the end of your compilation command line to use any functions in the header file.</p>
<p></p>
<h2 data-number="40.2" id="atomic-variables"><span class="header-section-number">40.2</span> Atomic Variables</h2>
<p>Here’s <em>part</em> of how atomic variables work:</p>
<p>If you have a shared atomic variable and you write to it from one thread, that write will be <em>all-or-nothing</em> in a different thread.</p>
<p>That is, the other thread will see the entire write of, say, a 32-bit value. Not half of it. There’s no way for one thread to interrupt another that is in the <em>middle</em> of an atomic multi-byte write.</p>
<p>It’s almost like there’s a little lock around the getting and setting of that one variable. (And there <em>might</em> be! See <a href="https://beej.us/guide/bgc/html/index-wide.html#lock-free-atomic">Lock-Free Atomic Variables</a>, below.)</p>
<p>And on that note, you can get away with never using atomics if you use mutexes to lock your critical sections. It’s just that there are a class of <em>lock-free data structures</em> that always allow other threads to make progress instead of being blocked by a mutex… but these are tough to create correctly from scratch, and are one of the things that are beyond the scope of the guide, sadly.</p>
<p>That’s only part of the story. But it’s the part we’ll start with.</p>
<p>Before we go further, how do you declare a variable to be atomic?</p>
<p>First, include <code>&lt;stdatomic.h&gt;</code>.</p>
<p></p>
<p>This gives us types such as <code>atomic_int</code>.</p>
<p>And then we can simply declare variables to be of that type.</p>
<p>But let’s do a demo where we have two threads. The first runs for a while and then sets a variable to a specific value, then exits. The other runs until it sees that value get set, and then it exits.</p>
<div class="sourceCode" id="cb744"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb744-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb744-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb744-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb744-2"></a><span class="pp">#include </span><span class="im">&lt;threads.h&gt;</span></span>
<span id="cb744-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb744-3"></a><span class="pp">#include </span><span class="im">&lt;stdatomic.h&gt;</span></span>
<span id="cb744-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb744-4"></a></span>
<span id="cb744-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb744-5"></a>atomic_int x<span class="op">;</span>   <span class="co">// THE POWER OF ATOMICS! BWHAHAHA!</span></span>
<span id="cb744-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb744-6"></a></span>
<span id="cb744-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb744-7"></a><span class="dt">int</span> thread1<span class="op">(</span><span class="dt">void</span> <span class="op">*</span>arg<span class="op">)</span></span>
<span id="cb744-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb744-8"></a><span class="op">{</span></span>
<span id="cb744-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb744-9"></a>    <span class="op">(</span><span class="dt">void</span><span class="op">)</span>arg<span class="op">;</span></span>
<span id="cb744-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb744-10"></a></span>
<span id="cb744-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb744-11"></a>    printf<span class="op">(</span><span class="st">"Thread 1: Sleeping for 1.5 seconds</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb744-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb744-12"></a>    thrd_sleep<span class="op">(&amp;(</span><span class="kw">struct</span> timespec<span class="op">){.</span>tv_sec<span class="op">=</span><span class="dv">1</span><span class="op">,</span> <span class="op">.</span>tv_nsec<span class="op">=</span><span class="dv">500000000</span><span class="op">},</span> NULL<span class="op">);</span></span>
<span id="cb744-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb744-13"></a></span>
<span id="cb744-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb744-14"></a>    printf<span class="op">(</span><span class="st">"Thread 1: Setting x to 3490</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb744-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb744-15"></a>    x <span class="op">=</span> <span class="dv">3490</span><span class="op">;</span></span>
<span id="cb744-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb744-16"></a></span>
<span id="cb744-17"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb744-17"></a>    printf<span class="op">(</span><span class="st">"Thread 1: Exiting</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb744-18"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb744-18"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb744-19"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb744-19"></a><span class="op">}</span></span>
<span id="cb744-20"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb744-20"></a></span>
<span id="cb744-21"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb744-21"></a><span class="dt">int</span> thread2<span class="op">(</span><span class="dt">void</span> <span class="op">*</span>arg<span class="op">)</span></span>
<span id="cb744-22"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb744-22"></a><span class="op">{</span></span>
<span id="cb744-23"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb744-23"></a>    <span class="op">(</span><span class="dt">void</span><span class="op">)</span>arg<span class="op">;</span></span>
<span id="cb744-24"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb744-24"></a></span>
<span id="cb744-25"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb744-25"></a>    printf<span class="op">(</span><span class="st">"Thread 2: Waiting for 3490</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb744-26"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb744-26"></a>    <span class="cf">while</span> <span class="op">(</span>x <span class="op">!=</span> <span class="dv">3490</span><span class="op">)</span> <span class="op">{}</span>  <span class="co">// spin here</span></span>
<span id="cb744-27"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb744-27"></a></span>
<span id="cb744-28"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb744-28"></a>    printf<span class="op">(</span><span class="st">"Thread 2: Got 3490--exiting!</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb744-29"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb744-29"></a>    <span class="cf">return</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb744-30"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb744-30"></a><span class="op">}</span></span>
<span id="cb744-31"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb744-31"></a></span>
<span id="cb744-32"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb744-32"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb744-33"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb744-33"></a><span class="op">{</span></span>
<span id="cb744-34"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb744-34"></a>    x <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb744-35"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb744-35"></a></span>
<span id="cb744-36"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb744-36"></a>    thrd_t t1<span class="op">,</span> t2<span class="op">;</span></span>
<span id="cb744-37"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb744-37"></a></span>
<span id="cb744-38"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb744-38"></a>    thrd_create<span class="op">(&amp;</span>t1<span class="op">,</span> thread1<span class="op">,</span> NULL<span class="op">);</span></span>
<span id="cb744-39"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb744-39"></a>    thrd_create<span class="op">(&amp;</span>t2<span class="op">,</span> thread2<span class="op">,</span> NULL<span class="op">);</span></span>
<span id="cb744-40"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb744-40"></a></span>
<span id="cb744-41"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb744-41"></a>    thrd_join<span class="op">(</span>t1<span class="op">,</span> NULL<span class="op">);</span></span>
<span id="cb744-42"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb744-42"></a>    thrd_join<span class="op">(</span>t2<span class="op">,</span> NULL<span class="op">);</span></span>
<span id="cb744-43"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb744-43"></a></span>
<span id="cb744-44"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb744-44"></a>    printf<span class="op">(</span><span class="st">"Main    : Threads are done, so x better be 3490</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb744-45"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb744-45"></a>    printf<span class="op">(</span><span class="st">"Main    : And indeed, x == </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> x<span class="op">);</span></span>
<span id="cb744-46"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb744-46"></a><span class="op">}</span></span></code></pre></div>
<p></p>
<p>The second thread spins in place, looking at the flag and waiting for it to get set to the value <code>3490</code>. And the first one does that.</p>
<p>And I get this output:</p>
<div class="sourceCode" id="cb745"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb745-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb745-1" aria-hidden="true" tabindex="-1"></a>Thread 1: Sleeping for 1.5 seconds</span>
<span id="cb745-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb745-2" aria-hidden="true" tabindex="-1"></a>Thread 2: Waiting for 3490</span>
<span id="cb745-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb745-3" aria-hidden="true" tabindex="-1"></a>Thread 1: Setting x to 3490</span>
<span id="cb745-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb745-4" aria-hidden="true" tabindex="-1"></a>Thread 1: Exiting</span>
<span id="cb745-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb745-5" aria-hidden="true" tabindex="-1"></a>Thread 2: Got 3490--exiting!</span>
<span id="cb745-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb745-6" aria-hidden="true" tabindex="-1"></a>Main    : Threads are done, so x better be 3490</span>
<span id="cb745-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb745-7" aria-hidden="true" tabindex="-1"></a>Main    : And indeed, x == 3490</span></code></pre></div>
<p>Look, ma! We’re accessing a variable from different threads and not using a mutex! And that’ll work every time thanks to the atomic nature of atomic variables.</p>
<p>You might be wondering what happens if that’s a regular non-atomic <code>int</code>, instead. Well, on my system it still works… unless I do an optimized build in which case it hangs on thread 2 waiting to see the 3490 to get set<a href="https://beej.us/guide/bgc/html/index-wide.html#fn208" class="footnote-ref" id="fnref208" role="doc-noteref"><sup>208</sup></a>.</p>
<p>But that’s just the beginning of the story. The next part is going to require more brain power and has to do with something called <em>synchronization</em>.</p>
<h2 data-number="40.3" id="synchronization"><span class="header-section-number">40.3</span> Synchronization</h2>
<p></p>
<p>The next part of our story is all about when certain memory writes in one thread become visible to those in another thread.</p>
<p>You might think, it’s right away, right? But it’s not. A number of things can go wrong. Weirdly wrong.</p>
<p>The compiler might have rearranged memory accesses so that when you think you set a value relative to another might not be true. And even if the compiler didn’t, your CPU might have done it on the fly. Or maybe there’s something else about this architecture that causes writes on one CPU to be delayed before they’re visible on another.</p>
<p>The good news is that we can condense all these potential troubles into one: unsynchronized memory accesses can appear out of order depending on which thread is doing the observing, as if the lines of code themselves had been rearranged.</p>
<p>By way of example, which happens first in the following code, the write to <code>x</code> or the write to <code>y</code>?</p>
<div class="sourceCode" id="cb746"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb746-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb746-1"></a><span class="dt">int</span> x<span class="op">,</span> y<span class="op">;</span>  <span class="co">// global</span></span>
<span id="cb746-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb746-2"></a></span>
<span id="cb746-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb746-3"></a><span class="co">// ...</span></span>
<span id="cb746-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb746-4"></a></span>
<span id="cb746-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb746-5"></a>x <span class="op">=</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb746-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb746-6"></a>y <span class="op">=</span> <span class="dv">3</span><span class="op">;</span></span>
<span id="cb746-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb746-7"></a></span>
<span id="cb746-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb746-8"></a>printf<span class="op">(</span><span class="st">"</span><span class="sc">%d</span><span class="st"> </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> x<span class="op">,</span> y<span class="op">);</span></span></code></pre></div>
<p>Answer: we don’t know. The compiler or CPU could silently reverse lines 5 and 6 and we’d be none-the-wiser. The code would run single-threaded <em>as-if</em> it were executed in code order.</p>
<p>In a multithreaded scenario, we might have something like this pseudocode:</p>
<div class="sourceCode" id="cb747"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb747-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb747-1"></a><span class="dt">int</span> x <span class="op">=</span> <span class="dv">0</span><span class="op">,</span> y <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb747-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb747-2"></a></span>
<span id="cb747-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb747-3"></a>thread1<span class="op">()</span> <span class="op">{</span></span>
<span id="cb747-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb747-4"></a>    x <span class="op">=</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb747-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb747-5"></a>    y <span class="op">=</span> <span class="dv">3</span><span class="op">;</span></span>
<span id="cb747-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb747-6"></a><span class="op">}</span></span>
<span id="cb747-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb747-7"></a></span>
<span id="cb747-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb747-8"></a>thread2<span class="op">()</span> <span class="op">{</span></span>
<span id="cb747-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb747-9"></a>    <span class="cf">while</span> <span class="op">(</span>y <span class="op">!=</span> <span class="dv">3</span><span class="op">)</span> <span class="op">{}</span>  <span class="co">// spin</span></span>
<span id="cb747-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb747-10"></a>    printf<span class="op">(</span><span class="st">"x is now </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> x<span class="op">);</span>  <span class="co">// 2? ...or 0?</span></span>
<span id="cb747-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb747-11"></a><span class="op">}</span></span></code></pre></div>
<p>What is the output from thread 2?</p>
<p>Well, if <code>x</code> gets assigned <code>2</code> <em>before</em> <code>y</code> is assigned <code>3</code>, then I’d expect the output to be the very sensible:</p>
<div class="sourceCode" id="cb748"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb748-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb748-1" aria-hidden="true" tabindex="-1"></a>x is now 2 </span></code></pre></div>
<p>But something sneaky could rearrange lines 4 and 5 causing us to see the value of <code>0</code> for <code>x</code> when we print it.</p>
<p>In other words, all bets are off unless we can somehow say, “As of this point, I expect all previous writes in another thread to be visible in this thread.”</p>
<p>Two threads <em>synchronize</em> when they agree on the state of shared memory. As we’ve seen, they’re not always in agreement with the code. So how do they agree?</p>
<p>Using atomic variables can force the agreement<a href="https://beej.us/guide/bgc/html/index-wide.html#fn209" class="footnote-ref" id="fnref209" role="doc-noteref"><sup>209</sup></a>. If a thread writes to an atomic variable, it’s saying “anyone who reads this atomic variable in the future will also see all the changes I made to memory (atomic or not) up to and including the atomic variable”.</p>
<p>Or, in more human terms, let’s sit around the conference table and make sure we’re on the same page as to which pieces of shared memory hold what values. You agree that the memory changes that you’d made up-to-and-including the atomic store will be visible to me after I do a load of the same atomic variable.</p>
<p>So we can easily fix our example:</p>
<div class="sourceCode" id="cb749"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb749-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb749-1"></a><span class="dt">int</span> x <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb749-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb749-2"></a>atomic <span class="dt">int</span> y <span class="op">=</span> <span class="dv">0</span><span class="op">;</span>  <span class="co">// Make y atomic</span></span>
<span id="cb749-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb749-3"></a></span>
<span id="cb749-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb749-4"></a>thread1<span class="op">()</span> <span class="op">{</span></span>
<span id="cb749-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb749-5"></a>    x <span class="op">=</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb749-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb749-6"></a>    y <span class="op">=</span> <span class="dv">3</span><span class="op">;</span>             <span class="co">// Synchronize on write</span></span>
<span id="cb749-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb749-7"></a><span class="op">}</span></span>
<span id="cb749-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb749-8"></a></span>
<span id="cb749-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb749-9"></a>thread2<span class="op">()</span> <span class="op">{</span></span>
<span id="cb749-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb749-10"></a>    <span class="cf">while</span> <span class="op">(</span>y <span class="op">!=</span> <span class="dv">3</span><span class="op">)</span> <span class="op">{}</span>  <span class="co">// Synchronize on read</span></span>
<span id="cb749-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb749-11"></a>    printf<span class="op">(</span><span class="st">"x is now </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> x<span class="op">);</span>  <span class="co">// 2, period.</span></span>
<span id="cb749-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb749-12"></a><span class="op">}</span></span></code></pre></div>
<p>Because the threads synchronize across <code>y</code>, all writes in thread 1 that happened <em>before</em> the write to <code>y</code> are visible in thread 2 <em>after</em> the read from <code>y</code> (in the <code>while</code> loop).</p>
<p>It’s important to note a couple things here:</p>
<ol type="1">
<li><p>Nothing sleeps. The synchronization is not a blocking operation. Both threads are running full bore until they exit. Even the one stuck in the spin loop isn’t blocking anyone else from running.</p></li>
<li><p>The synchronization happens when one thread reads an atomic variable another thread wrote. So when thread 2 reads <code>y</code>, all previous memory writes in thread 1 (namely setting <code>x</code>) will be visible in thread 2.</p></li>
<li><p>Notice that <code>x</code> isn’t atomic. That’s OK because we’re not synchronizing over <code>x</code>, and the synchronization over <code>y</code> when we write it in thread 1 means that all previous writes—including <code>x</code>—in thread 1 will become visible to other threads… if those other threads read <code>y</code> to synchronize.</p></li>
</ol>
<p>Forcing this synchronization is inefficient and can be a lot slower than just using a regular variable. This is why we don’t use atomics unless we have to for a particular application.</p>
<p>So that’s the basics. Let’s look deeper.</p>
<p></p>
<h2 data-number="40.4" id="acquire-and-release"><span class="header-section-number">40.4</span> Acquire and Release</h2>
<p> </p>
<p>More terminology! It’ll pay off to learn this now.</p>
<p>When a thread reads an atomic variable, it is said to be an <em>acquire</em> operation.</p>
<p>When a thread writes an atomic variable, it is said to be a <em>release</em> operation.</p>
<p>What are these? Let’s line them up with terms you already know when it comes to atomic variables:</p>
<p><strong>Read = Load = Acquire</strong>. Like when you compare an atomic variable or read it to copy it to another value.</p>
<p><strong>Write = Store = Release</strong>. Like when you assign a value into an atomic variable.</p>
<p>When using atomic variables with these acquire/release semantics, C spells out what can happen when.</p>
<p>Acquire/release form the basis for the synchronization we just talked about.</p>
<p>When a thread acquires an atomic variable, it can see values set in another thread that released that same variable.</p>
<p>In other words:</p>
<p>When a thread reads an atomic variable, it can see values set in another thread that wrote to that same variable.</p>
<p>The synchronization happens across the acquire/release pair.</p>
<p>More details:</p>
<p>With read/load/acquire of a particular atomic variable:</p>
<ul>
<li><p>All writes (atomic or non-atomic) in another thread that happened before that other thread wrote/stored/released this atomic variable are now visible in this thread.</p></li>
<li><p>The new value of the atomic variable set by the other thread is also visible in this thread.</p></li>
<li><p>No reads or writes of any variables/memory in the current thread can be reordered to happen before this acquire.</p></li>
<li><p>The acquire acts as a one-way barrier when it comes to code reordering; reads and writes in the current thread can be moved down from <em>before</em> the acquire to <em>after</em> it. But, more importantly for synchronization, nothing can move up from <em>after</em> the acquire to <em>before</em> it.</p></li>
</ul>
<p>With write/store/release of a particular atomic variable:</p>
<ul>
<li><p>All writes (atomic or non-atomic) in the current thread that happened before this release become visible to other threads that have read/loaded/acquired the same atomic variable.</p></li>
<li><p>The value written to this atomic variable by this thread is also visible to other threads.</p></li>
<li><p>No reads or writes of any variables/memory in the current thread can be reordered to happen after this release.</p></li>
<li><p>The release acts as a one-way barrier when it comes to code reordering: reads and writes in the current thread can be moved up from <em>after</em> the release to <em>before</em> it. But, more importantly for synchronization, nothing can move down from <em>before</em> the release to <em>after</em> it.</p></li>
</ul>
<p>Again, the upshot is synchronization of memory from one thread to another. The second thread can be sure that variables and memory are written in the order the programmer intended.</p>
<pre><code>int x, y, z = 0;
atomic_int a = 0;

thread1() {
    x = 10;
    y = 20;
    a = 999;  // Release
    z = 30;
}

thread2()
{
    while (a != 999) { } // Acquire

    assert(x == 10);  // never asserts, x is always 10
    assert(y == 20);  // never asserts, y is always 20

    assert(z == 0);  // might assert!!
}</code></pre>
<p>In the above example, <code>thread2</code> can be sure of the values in <code>x</code> and <code>y</code> after it acquires <code>a</code> because they were set before <code>thread1</code> released the atomic <code>a</code>.</p>
<p>But <code>thread2</code> can’t be sure of <code>z</code>’s value because it happened after the release. Maybe the assignment to <code>z</code> got moved before the assignment to <code>a</code>.</p>
<p>An important note: releasing one atomic variable has no effect on acquires of different atomic variables. Each variable is isolated from the others.</p>
<p> </p>
<h2 data-number="40.5" id="sequential-consistency"><span class="header-section-number">40.5</span> Sequential Consistency</h2>
<p></p>
<p>You hanging in there? We’re through the meat of the simpler usage of atomics. And since we’re not even going to talk about the more complex uses here, you can relax a bit.</p>
<p><em>Sequential consistency</em> is what’s called a <em>memory ordering</em>. There are many memory orderings, but sequential consistency is the sanest<a href="https://beej.us/guide/bgc/html/index-wide.html#fn210" class="footnote-ref" id="fnref210" role="doc-noteref"><sup>210</sup></a> C has to offer. It is also the default. You have to go out of your way to use other memory orderings.</p>
<p>All the stuff we’ve been talking about so far has happened within the realm of sequential consistency.</p>
<p>We’ve talked about how the compiler or CPU can rearrange memory reads and writes in a single thread as long as it follows the <em>as-if</em> rule.</p>
<p>And we’ve seen how we can put the brakes on this behavior by synchronizing over atomic variables.</p>
<p>Let’s formalize just a little more.</p>
<p>If operations are <em>sequentially consistent</em>, it means at the end of the day, when all is said and done, all the threads can kick up their feet, open their beverage of choice, and all agree on the order in which memory changes occurred during the run. And that order is the one specified by the code.</p>
<p>One won’t say, “But didn’t <em>B</em> happen before <em>A</em>?” if the rest of them say, “<em>A</em> definitely happened before <em>B</em>”. They’re all friends, here.</p>
<p>In particular, within a thread, none of the acquires and releases can be reordered with respect to one another. This is in addition to the rules about what other memory accesses can be reordered around them.</p>
<p>This rule gives an additional level of sanity to the progression of atomic loads/acquires and stores/releases.</p>
<p>Every other memory order in C involves a relaxation of the reordering rules, either for acquires/releases or other memory accesses, atomic or otherwise. You’d do that if you <em>really</em> knew what you were doing and needed the speed boost. <em>Here be armies of dragons…</em></p>
<p>More on that later, but for now, let’s stick to the safe and practical.</p>
<p></p>
<h2 data-number="40.6" id="atomic-assignments-and-operators"><span class="header-section-number">40.6</span> Atomic Assignments and Operators</h2>
<p></p>
<p>Certain operators on atomic variables are atomic. And others aren’t.</p>
<p>Let’s start with a counter-example:</p>
<div class="sourceCode" id="cb751"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb751-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb751-1" aria-hidden="true" tabindex="-1"></a>atomic_int x <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb751-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb751-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb751-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb751-3" aria-hidden="true" tabindex="-1"></a>thread1<span class="op">()</span> <span class="op">{</span></span>
<span id="cb751-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb751-4" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> x <span class="op">+</span> <span class="dv">3</span><span class="op">;</span>  <span class="co">// NOT atomic!</span></span>
<span id="cb751-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb751-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Since there’s a read of <code>x</code> on the right hand side of the assignment and a write effectively on the left, these are two operations. Another thread could sneak in the middle and make you unhappy.</p>
<p>But you <em>can</em> use the shorthand <code>+=</code> to get an atomic operation:</p>
<div class="sourceCode" id="cb752"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb752-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb752-1" aria-hidden="true" tabindex="-1"></a>atomic_int x <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb752-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb752-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb752-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb752-3" aria-hidden="true" tabindex="-1"></a>thread1<span class="op">()</span> <span class="op">{</span></span>
<span id="cb752-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb752-4" aria-hidden="true" tabindex="-1"></a>    x <span class="op">+=</span> <span class="dv">3</span><span class="op">;</span>   <span class="co">// ATOMIC!</span></span>
<span id="cb752-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb752-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>In that case, <code>x</code> will be atomically incremented by <code>3</code>—no other thread can jump in the middle.</p>
<p>In particular, the following operators are atomic read-modify-write operations with sequential consistency, so use them with gleeful abandon. (In the example, <code>a</code> is atomic.)</p>
<div class="sourceCode" id="cb753"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb753-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb753-1" aria-hidden="true" tabindex="-1"></a>a<span class="op">++</span>       a<span class="op">--</span>       <span class="op">--</span>a       <span class="op">++</span>a</span>
<span id="cb753-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb753-2" aria-hidden="true" tabindex="-1"></a>a <span class="op">+=</span> b    a <span class="op">-=</span> b    a <span class="op">*=</span> b    a <span class="op">/=</span> b    a <span class="op">%=</span> b</span>
<span id="cb753-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb753-3" aria-hidden="true" tabindex="-1"></a>a <span class="op">&amp;=</span> b    a <span class="op">|=</span> b    a <span class="op">^=</span> b    a <span class="op">&gt;&gt;=</span> b   a <span class="op">&lt;&lt;=</span> b</span></code></pre></div>
<p></p>
<h2 data-number="40.7" id="library-functions-that-automatically-synchronize"><span class="header-section-number">40.7</span> Library Functions that Automatically Synchronize</h2>
<p></p>
<p>So far we’ve talked about how you can synchronize with atomic variables, but it turns out there are a few library functions that do some limited behind-the-scenes synchronization, themselves.</p>
<div class="sourceCode" id="cb754"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb754-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb754-1" aria-hidden="true" tabindex="-1"></a>call_once<span class="op">()</span>      thrd_create<span class="op">()</span>       thrd_join<span class="op">()</span></span>
<span id="cb754-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb754-2" aria-hidden="true" tabindex="-1"></a>mtx_lock<span class="op">()</span>       mtx_timedlock<span class="op">()</span>     mtx_trylock<span class="op">()</span></span>
<span id="cb754-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb754-3" aria-hidden="true" tabindex="-1"></a>malloc<span class="op">()</span>         calloc<span class="op">()</span>            realloc<span class="op">()</span></span>
<span id="cb754-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb754-4" aria-hidden="true" tabindex="-1"></a>aligned_alloc<span class="op">()</span></span></code></pre></div>
<p><strong><code>call_once()</code></strong>—Synchronizes with all subsequent calls to <code>call_once()</code> for a particular flag. This way subsequent calls can rest assured that if another thread sets the flag, they will see it.</p>
<p><strong><code>thrd_create()</code></strong>—Synchronizes with the beginning of the new thread. The new thread can be sure it will see all shared memory writes from the parent thread from before the <code>thrd_create()</code> call.</p>
<p><strong><code>thrd_join()</code></strong>—When a thread dies, it synchronizes with this function. The thread that has called <code>thrd_join()</code> can be assured that it can see all the late thread’s shared writes.</p>
<p><strong><code>mtx_lock()</code></strong>—Earlier calls to <code>mtx_unlock()</code> on the same mutex synchronize on this call. This is the case that most mirrors the acquire/release process we’ve already talked about. <code>mtx_unlock()</code> performs a release on the mutex variable, assuring any subsequent thread that makes an acquire with <code>mtx_lock()</code> can see all the shared memory changes in the critical section.</p>
<p><strong><code>mtx_timedlock()</code></strong> and <strong><code>mtx_trylock()</code></strong>—Similar to the situation with <code>mtx_lock()</code>, if this call succeeds, earlier calls to <code>mtx_unlock()</code> synchronize with this one.</p>
<p><strong>Dynamic Memory Functions</strong>: if you allocate memory, it synchronizes with the previous deallocation of that same memory. And allocations and deallocations of that particular memory region happen in a single total order that all threads can agree upon. I <em>think</em> the idea here is that the deallocation can wipe the region if it chooses, and we want to be sure that a subsequent allocation doesn’t see the non-wiped data. Someone let me know if there’s more to it.</p>
<p></p>
<h2 data-number="40.8" id="atomic-type-specifier-qualifier"><span class="header-section-number">40.8</span> Atomic Type Specifier, Qualifier</h2>
<p>Let’s take it down a notch and see what types we have available, and how we can even make new atomic types.</p>
<p></p>
<p>First things first, let’s look at the built-in atomic types and what they are <code>typedef</code>’d to. (Spoiler: <code>_Atomic</code> is a type qualifier!)</p>
<table>
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th>Atomic type</th>
<th>Longhand equivalent</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>atomic_bool</code></td>
<td><code>_Atomic _Bool</code></td>
</tr>
<tr class="even">
<td><code>atomic_char</code></td>
<td><code>_Atomic char</code></td>
</tr>
<tr class="odd">
<td><code>atomic_schar</code></td>
<td><code>_Atomic signed char</code></td>
</tr>
<tr class="even">
<td><code>atomic_uchar</code></td>
<td><code>_Atomic unsigned char</code></td>
</tr>
<tr class="odd">
<td><code>atomic_short</code></td>
<td><code>_Atomic short</code></td>
</tr>
<tr class="even">
<td><code>atomic_ushort</code></td>
<td><code>_Atomic unsigned short</code></td>
</tr>
<tr class="odd">
<td><code>atomic_int</code></td>
<td><code>_Atomic int</code></td>
</tr>
<tr class="even">
<td><code>atomic_uint</code></td>
<td><code>_Atomic unsigned int</code></td>
</tr>
<tr class="odd">
<td><code>atomic_long</code></td>
<td><code>_Atomic long</code></td>
</tr>
<tr class="even">
<td><code>atomic_ulong</code></td>
<td><code>_Atomic unsigned long</code></td>
</tr>
<tr class="odd">
<td><code>atomic_llong</code></td>
<td><code>_Atomic long long</code></td>
</tr>
<tr class="even">
<td><code>atomic_ullong</code></td>
<td><code>_Atomic unsigned long long</code></td>
</tr>
<tr class="odd">
<td><code>atomic_char16_t</code></td>
<td><code>_Atomic char16_t</code></td>
</tr>
<tr class="even">
<td><code>atomic_char32_t</code></td>
<td><code>_Atomic char32_t</code></td>
</tr>
<tr class="odd">
<td><code>atomic_wchar_t</code></td>
<td><code>_Atomic wchar_t</code></td>
</tr>
<tr class="even">
<td><code>atomic_int_least8_t</code></td>
<td><code>_Atomic int_least8_t</code></td>
</tr>
<tr class="odd">
<td><code>atomic_uint_least8_t</code></td>
<td><code>_Atomic uint_least8_t</code></td>
</tr>
<tr class="even">
<td><code>atomic_int_least16_t</code></td>
<td><code>_Atomic int_least16_t</code></td>
</tr>
<tr class="odd">
<td><code>atomic_uint_least16_t</code></td>
<td><code>_Atomic uint_least16_t</code></td>
</tr>
<tr class="even">
<td><code>atomic_int_least32_t</code></td>
<td><code>_Atomic int_least32_t</code></td>
</tr>
<tr class="odd">
<td><code>atomic_uint_least32_t</code></td>
<td><code>_Atomic uint_least32_t</code></td>
</tr>
<tr class="even">
<td><code>atomic_int_least64_t</code></td>
<td><code>_Atomic int_least64_t</code></td>
</tr>
<tr class="odd">
<td><code>atomic_uint_least64_t</code></td>
<td><code>_Atomic uint_least64_t</code></td>
</tr>
<tr class="even">
<td><code>atomic_int_fast8_t</code></td>
<td><code>_Atomic int_fast8_t</code></td>
</tr>
<tr class="odd">
<td><code>atomic_uint_fast8_t</code></td>
<td><code>_Atomic uint_fast8_t</code></td>
</tr>
<tr class="even">
<td><code>atomic_int_fast16_t</code></td>
<td><code>_Atomic int_fast16_t</code></td>
</tr>
<tr class="odd">
<td><code>atomic_uint_fast16_t</code></td>
<td><code>_Atomic uint_fast16_t</code></td>
</tr>
<tr class="even">
<td><code>atomic_int_fast32_t</code></td>
<td><code>_Atomic int_fast32_t</code></td>
</tr>
<tr class="odd">
<td><code>atomic_uint_fast32_t</code></td>
<td><code>_Atomic uint_fast32_t</code></td>
</tr>
<tr class="even">
<td><code>atomic_int_fast64_t</code></td>
<td><code>_Atomic int_fast64_t</code></td>
</tr>
<tr class="odd">
<td><code>atomic_uint_fast64_t</code></td>
<td><code>_Atomic uint_fast64_t</code></td>
</tr>
<tr class="even">
<td><code>atomic_intptr_t</code></td>
<td><code>_Atomic intptr_t</code></td>
</tr>
<tr class="odd">
<td><code>atomic_uintptr_t</code></td>
<td><code>_Atomic uintptr_t</code></td>
</tr>
<tr class="even">
<td><code>atomic_size_t</code></td>
<td><code>_Atomic size_t</code></td>
</tr>
<tr class="odd">
<td><code>atomic_ptrdiff_t</code></td>
<td><code>_Atomic ptrdiff_t</code></td>
</tr>
<tr class="even">
<td><code>atomic_intmax_t</code></td>
<td><code>_Atomic intmax_t</code></td>
</tr>
<tr class="odd">
<td><code>atomic_uintmax_t</code></td>
<td><code>_Atomic uintmax_t</code></td>
</tr>
</tbody>
</table>
<p></p>
<p>Use those at will! They’re consistent with the atomic aliases found in C++, if that helps.</p>
<p>But what if you want more?</p>
<p>You can do it either with a type qualifier or type specifier.</p>
<p></p>
<p>First, specifier! It’s the keyword <code>_Atomic</code> with a type in parens after<a href="https://beej.us/guide/bgc/html/index-wide.html#fn211" class="footnote-ref" id="fnref211" role="doc-noteref"><sup>211</sup></a>—suitable for use with <code>typedef</code>:</p>
<div class="sourceCode" id="cb755"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb755-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb755-1" aria-hidden="true" tabindex="-1"></a><span class="kw">typedef</span> <span class="kw">_Atomic</span><span class="op">(</span><span class="dt">double</span><span class="op">)</span> atomic_double<span class="op">;</span></span>
<span id="cb755-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb755-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb755-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb755-3" aria-hidden="true" tabindex="-1"></a>atomic_double f<span class="op">;</span></span></code></pre></div>
<p>Restrictions on the specifier: the type you’re making atomic can’t be of type array or function, nor can it be atomic or otherwise qualified.</p>
<p> </p>
<p>Next, qualifier! It’s the keyword <code>_Atomic</code> <em>without</em> a type in parens.</p>
<p>So these do similar things<a href="https://beej.us/guide/bgc/html/index-wide.html#fn212" class="footnote-ref" id="fnref212" role="doc-noteref"><sup>212</sup></a>:</p>
<div class="sourceCode" id="cb756"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb756-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb756-1" aria-hidden="true" tabindex="-1"></a><span class="kw">_Atomic</span><span class="op">(</span><span class="dt">int</span><span class="op">)</span> i<span class="op">;</span>   <span class="co">// type specifier</span></span>
<span id="cb756-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb756-2" aria-hidden="true" tabindex="-1"></a><span class="kw">_Atomic</span> <span class="dt">int</span>  j<span class="op">;</span>   <span class="co">// type qualifier</span></span></code></pre></div>
<p>The thing is, you can include other type qualifiers with the latter:</p>
<div class="sourceCode" id="cb757"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb757-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb757-1" aria-hidden="true" tabindex="-1"></a><span class="kw">_Atomic</span> <span class="dt">volatile</span> <span class="dt">int</span> k<span class="op">;</span>   <span class="co">// qualified atomic variable</span></span></code></pre></div>
<p>Restrictions on the qualifier: the type you’re making atomic can’t be of type array or function.</p>
<p></p>
<h2 data-number="40.9" id="lock-free-atomic"><span class="header-section-number">40.9</span> Lock-Free Atomic Variables</h2>
<p></p>
<p>Hardware architectures are limited in the amount of data they can atomically read and write. It depends on how it’s wired together. And it varies.</p>
<p>If you use an atomic type, you can be assured that accesses to that type will be atomic… but there’s a catch: if the hardware can’t do it, it’s done with a lock, instead.</p>
<p>So the atomic access becomes lock-access-unlock, which is rather slower and has some implications for signal handlers.</p>
<p><a href="https://beej.us/guide/bgc/html/index-wide.html#atomic-flags">Atomic flags</a>, below, is the only atomic type that is guaranteed to be lock-free in all conforming implementations. In typical desktop/laptop computer world, other larger types are likely lock-free.</p>
<p>Luckily, we have a couple ways to determine if a particular type is a lock-free atomic or not.</p>
<p>First of all, some macros—you can use these at compile time with <code>#if</code>. They apply to both signed and unsigned types.</p>
<table>
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th>Atomic Type</th>
<th>Lock Free Macro</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>atomic_bool</code></td>
<td><code>ATOMIC_BOOL_LOCK_FREE</code></td>
</tr>
<tr class="even">
<td><code>atomic_char</code></td>
<td><code>ATOMIC_CHAR_LOCK_FREE</code></td>
</tr>
<tr class="odd">
<td><code>atomic_char16_t</code></td>
<td><code>ATOMIC_CHAR16_T_LOCK_FREE</code></td>
</tr>
<tr class="even">
<td><code>atomic_char32_t</code></td>
<td><code>ATOMIC_CHAR32_T_LOCK_FREE</code></td>
</tr>
<tr class="odd">
<td><code>atomic_wchar_t</code></td>
<td><code>ATOMIC_WCHAR_T_LOCK_FREE</code></td>
</tr>
<tr class="even">
<td><code>atomic_short</code></td>
<td><code>ATOMIC_SHORT_LOCK_FREE</code></td>
</tr>
<tr class="odd">
<td><code>atomic_int</code></td>
<td><code>ATOMIC_INT_LOCK_FREE</code></td>
</tr>
<tr class="even">
<td><code>atomic_long</code></td>
<td><code>ATOMIC_LONG_LOCK_FREE</code></td>
</tr>
<tr class="odd">
<td><code>atomic_llong</code></td>
<td><code>ATOMIC_LLONG_LOCK_FREE</code></td>
</tr>
<tr class="even">
<td><code>atomic_intptr_t</code></td>
<td><code>ATOMIC_POINTER_LOCK_FREE</code></td>
</tr>
</tbody>
</table>
<p>These macros can interestingly have <em>three</em> different values:</p>
<table>
<thead>
<tr class="header">
<th>Value</th>
<th>Meaning</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>0</code></td>
<td>Never lock-free.</td>
</tr>
<tr class="even">
<td><code>1</code></td>
<td><em>Sometimes</em> lock-free.</td>
</tr>
<tr class="odd">
<td><code>2</code></td>
<td>Always lock-free.</td>
</tr>
</tbody>
</table>
<p>Wait—how can something be <em>sometimes</em> lock-free? This just means the answer isn’t known at compile-time, but could later be known at runtime. Maybe the answer varies depending on whether or not you’re running this code on Genuine Intel or AMD, or something like that<a href="https://beej.us/guide/bgc/html/index-wide.html#fn213" class="footnote-ref" id="fnref213" role="doc-noteref"><sup>213</sup></a>.</p>
<p>But you can always test at runtime with the <code>atomic_is_lock_free()</code> function. This function returns true or false if the particular type is atomic right now.</p>
<p>So why do we care?</p>
<p>Lock-free is faster, so maybe there’s a speed concern that you’d code around another way. Or maybe you need to use an atomic variable in a signal handler.</p>
<p></p>
<h3 data-number="40.9.1" id="signal-handlers-and-lock-free-atomics"><span class="header-section-number">40.9.1</span> Signal Handlers and Lock-Free Atomics</h3>
<p> </p>
<p>If you read or write a shared variable (static storage duration or <code>_Thread_Local</code>) in a signal handler, it’s undefined behavior [gasp!]… Unless you do one of the following:</p>
<ol type="1">
<li><p>Write to a variable of type <code>volatile sig_atomic_t</code>.</p></li>
<li><p>Read or write a lock-free atomic variable.</p></li>
</ol>
<p>As far as I can tell, lock-free atomic variables are one of the few ways you get portably get information out of a signal handler.</p>
<p>The spec is a bit vague, in my read, about the memory order when it comes to acquiring or releasing atomic variables in the signal handler. C++ says, and it makes sense, that such accesses are unsequenced with respect to the rest of the program<a href="https://beej.us/guide/bgc/html/index-wide.html#fn214" class="footnote-ref" id="fnref214" role="doc-noteref"><sup>214</sup></a>. The signal can be raised, after all, at any time. So I’m assuming C’s behavior is similar.</p>
<p> </p>
<h2 data-number="40.10" id="atomic-flags"><span class="header-section-number">40.10</span> Atomic Flags</h2>
<p> </p>
<p>There’s only one type the standard guarantees will be a lock-free atomic: <code>atomic_flag</code>. This is an opaque type for <a href="https://en.wikipedia.org/wiki/Test-and-set">test-and-set</a><a href="https://beej.us/guide/bgc/html/index-wide.html#fn215" class="footnote-ref" id="fnref215" role="doc-noteref"><sup>215</sup></a> operations.</p>
<p>It can be either <em>set</em> or <em>clear</em>. You can initialize it to clear with:</p>
<p></p>
<div class="sourceCode" id="cb758"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb758-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb758-1" aria-hidden="true" tabindex="-1"></a>atomic_flag f <span class="op">=</span> ATOMIC_FLAG_INIT<span class="op">;</span></span></code></pre></div>
<p></p>
<p></p>
<p>You can set the flag atomically with <code>atomic_flag_test_and_set()</code>, which will set the flag and return its previous status as a <code>_Bool</code> (true for set).</p>
<p></p>
<p>You can clear the flag atomically with <code>atomic_flag_clear()</code>.</p>
<p>Here’s an example where we init the flag to clear, set it twice, then clear it again.</p>
<div class="sourceCode" id="cb759"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb759-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb759-1" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb759-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb759-2" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdbool.h&gt;</span></span>
<span id="cb759-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb759-3" aria-hidden="true" tabindex="-1"></a><span class="pp">#include </span><span class="im">&lt;stdatomic.h&gt;</span></span>
<span id="cb759-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb759-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb759-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb759-5" aria-hidden="true" tabindex="-1"></a>atomic_flag f <span class="op">=</span> ATOMIC_FLAG_INIT<span class="op">;</span></span>
<span id="cb759-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb759-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb759-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb759-7" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb759-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb759-8" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb759-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb759-9" aria-hidden="true" tabindex="-1"></a>    <span class="dt">bool</span> r <span class="op">=</span> atomic_flag_test_and_set<span class="op">(&amp;</span>f<span class="op">);</span></span>
<span id="cb759-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb759-10" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Value was: </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> r<span class="op">);</span>           <span class="co">// 0</span></span>
<span id="cb759-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb759-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb759-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb759-12" aria-hidden="true" tabindex="-1"></a>    r <span class="op">=</span> atomic_flag_test_and_set<span class="op">(&amp;</span>f<span class="op">);</span></span>
<span id="cb759-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb759-13" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Value was: </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> r<span class="op">);</span>           <span class="co">// 1</span></span>
<span id="cb759-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb759-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb759-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb759-15" aria-hidden="true" tabindex="-1"></a>    atomic_flag_clear<span class="op">(&amp;</span>f<span class="op">);</span></span>
<span id="cb759-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb759-16" aria-hidden="true" tabindex="-1"></a>    r <span class="op">=</span> atomic_flag_test_and_set<span class="op">(&amp;</span>f<span class="op">);</span></span>
<span id="cb759-17"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb759-17" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Value was: </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> r<span class="op">);</span>           <span class="co">// 0</span></span>
<span id="cb759-18"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb759-18" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p> </p>
<h2 data-number="40.11" id="atomic-structs-and-unions"><span class="header-section-number">40.11</span> Atomic <code>struct</code>s and <code>union</code>s</h2>
<p></p>
<p>Using the <code>_Atomic</code> qualifier or specifier, you can make atomic <code>struct</code>s or <code>union</code>s! Pretty astounding.</p>
<p>If there’s not a lot of data in there (i.e.&nbsp;a handful of bytes), the resulting atomic type might be lock-free. Test it with <code>atomic_is_lock_free()</code>.</p>
<div class="sourceCode" id="cb760"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb760-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb760-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb760-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb760-2"></a><span class="pp">#include </span><span class="im">&lt;stdatomic.h&gt;</span></span>
<span id="cb760-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb760-3"></a></span>
<span id="cb760-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb760-4"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb760-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb760-5"></a><span class="op">{</span></span>
<span id="cb760-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb760-6"></a>    <span class="kw">struct</span> point <span class="op">{</span></span>
<span id="cb760-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb760-7"></a>        <span class="dt">float</span> x<span class="op">,</span> y<span class="op">;</span></span>
<span id="cb760-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb760-8"></a>    <span class="op">};</span></span>
<span id="cb760-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb760-9"></a></span>
<span id="cb760-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb760-10"></a>    <span class="kw">_Atomic</span><span class="op">(</span><span class="kw">struct</span> point<span class="op">)</span> p<span class="op">;</span></span>
<span id="cb760-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb760-11"></a></span>
<span id="cb760-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb760-12"></a>    printf<span class="op">(</span><span class="st">"Is lock free: </span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> atomic_is_lock_free<span class="op">(&amp;</span>p<span class="op">));</span></span>
<span id="cb760-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb760-13"></a><span class="op">}</span></span></code></pre></div>
<p>Here’s the catch: you can’t access fields of an atomic <code>struct</code> or <code>union</code>… so what’s the point? Well, you can atomically <em>copy</em> the entire <code>struct</code> into a non-atomic variable and then use it. You can atomically copy the other way, too.</p>
<div class="sourceCode" id="cb761"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb761-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb761-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb761-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb761-2"></a><span class="pp">#include </span><span class="im">&lt;stdatomic.h&gt;</span></span>
<span id="cb761-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb761-3"></a></span>
<span id="cb761-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb761-4"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb761-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb761-5"></a><span class="op">{</span></span>
<span id="cb761-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb761-6"></a>    <span class="kw">struct</span> point <span class="op">{</span></span>
<span id="cb761-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb761-7"></a>        <span class="dt">float</span> x<span class="op">,</span> y<span class="op">;</span></span>
<span id="cb761-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb761-8"></a>    <span class="op">};</span></span>
<span id="cb761-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb761-9"></a></span>
<span id="cb761-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb761-10"></a>    <span class="kw">_Atomic</span><span class="op">(</span><span class="kw">struct</span> point<span class="op">)</span> p<span class="op">;</span></span>
<span id="cb761-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb761-11"></a>    <span class="kw">struct</span> point t<span class="op">;</span></span>
<span id="cb761-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb761-12"></a></span>
<span id="cb761-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb761-13"></a>    p <span class="op">=</span> <span class="op">(</span><span class="kw">struct</span> point<span class="op">){</span><span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">};</span>  <span class="co">// Atomic copy</span></span>
<span id="cb761-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb761-14"></a></span>
<span id="cb761-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb761-15"></a>    <span class="co">//printf("%f\n", p.x);  // Error</span></span>
<span id="cb761-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb761-16"></a></span>
<span id="cb761-17"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb761-17"></a>    t <span class="op">=</span> p<span class="op">;</span>   <span class="co">// Atomic copy</span></span>
<span id="cb761-18"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb761-18"></a></span>
<span id="cb761-19"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb761-19"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%f\n</span><span class="st">"</span><span class="op">,</span> t<span class="op">.</span>x<span class="op">);</span>  <span class="co">// OK!</span></span>
<span id="cb761-20"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb761-20"></a><span class="op">}</span></span></code></pre></div>
<p>You can also declare a <code>struct</code> where individual fields are atomic. It is implementation defined if atomic types are allowed on bitfields.</p>
<p></p>
<h2 data-number="40.12" id="atomic-pointers"><span class="header-section-number">40.12</span> Atomic Pointers</h2>
<p></p>
<p>Just a note here about placement of <code>_Atomic</code> when it comes to pointers.</p>
<p>First, pointers to atomics (i.e.&nbsp;the pointer value is not atomic, but the thing it points to is):</p>
<div class="sourceCode" id="cb762"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb762-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb762-1" aria-hidden="true" tabindex="-1"></a><span class="kw">_Atomic</span> <span class="dt">int</span> x<span class="op">;</span></span>
<span id="cb762-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb762-2" aria-hidden="true" tabindex="-1"></a><span class="kw">_Atomic</span> <span class="dt">int</span> <span class="op">*</span>p<span class="op">;</span>  <span class="co">// p is a pointer to an atomic int</span></span>
<span id="cb762-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb762-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb762-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb762-4" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> <span class="op">&amp;</span>x<span class="op">;</span>  <span class="co">// OK!</span></span></code></pre></div>
<p>Second, atomic pointers to non-atomic values (i.e.&nbsp;the pointer value itself is atomic, but the thing it points to is not):</p>
<div class="sourceCode" id="cb763"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb763-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb763-1" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> x<span class="op">;</span></span>
<span id="cb763-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb763-2" aria-hidden="true" tabindex="-1"></a><span class="dt">int</span> <span class="op">*</span> <span class="kw">_Atomic</span> p<span class="op">;</span>  <span class="co">// p is an atomic pointer to an int</span></span>
<span id="cb763-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb763-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb763-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb763-4" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> <span class="op">&amp;</span>x<span class="op">;</span>  <span class="co">// OK!</span></span></code></pre></div>
<p>Lastly, atomic pointers to atomic values (i.e.&nbsp;the pointer and the thing it points to are both atomic):</p>
<div class="sourceCode" id="cb764"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb764-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb764-1" aria-hidden="true" tabindex="-1"></a><span class="kw">_Atomic</span> <span class="dt">int</span> x<span class="op">;</span></span>
<span id="cb764-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb764-2" aria-hidden="true" tabindex="-1"></a><span class="kw">_Atomic</span> <span class="dt">int</span> <span class="op">*</span> <span class="kw">_Atomic</span> p<span class="op">;</span>  <span class="co">// p is an atomic pointer to an atomic int</span></span>
<span id="cb764-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb764-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb764-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb764-4" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> <span class="op">&amp;</span>x<span class="op">;</span>  <span class="co">// OK!</span></span></code></pre></div>
<p></p>
<h2 data-number="40.13" id="memory-order"><span class="header-section-number">40.13</span> Memory Order</h2>
<p> </p>
<p>We’ve already talked about sequential consistency, which is the sensible one of the bunch. But there are a number of other ones:</p>
<table>
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th><code>memory_order</code></th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>memory_order_seq_cst</code></td>
<td>Sequential Consistency</td>
</tr>
<tr class="even">
<td><code>memory_order_acq_rel</code></td>
<td>Acquire/Release</td>
</tr>
<tr class="odd">
<td><code>memory_order_release</code></td>
<td>Release</td>
</tr>
<tr class="even">
<td><code>memory_order_acquire</code></td>
<td>Acquire</td>
</tr>
<tr class="odd">
<td><code>memory_order_consume</code></td>
<td>Consume</td>
</tr>
<tr class="even">
<td><code>memory_order_relaxed</code></td>
<td>Relaxed</td>
</tr>
</tbody>
</table>
<p>You can specify other ones with certain library functions. For example, you can add a value to an atomic variable like this:</p>
<div class="sourceCode" id="cb765"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb765-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb765-1" aria-hidden="true" tabindex="-1"></a>atomic_int x <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb765-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb765-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb765-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb765-3" aria-hidden="true" tabindex="-1"></a>x <span class="op">+=</span> <span class="dv">5</span><span class="op">;</span>  <span class="co">// Sequential consistency, the default</span></span></code></pre></div>
<p>Or you can do the same with this library function:</p>
<p></p>
<div class="sourceCode" id="cb766"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb766-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb766-1" aria-hidden="true" tabindex="-1"></a>atomic_int x <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb766-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb766-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb766-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb766-3" aria-hidden="true" tabindex="-1"></a>atomic_fetch_add<span class="op">(&amp;</span>x<span class="op">,</span> <span class="dv">5</span><span class="op">);</span>  <span class="co">// Sequential consistency, the default</span></span></code></pre></div>
<p></p>
<p>Or you can do the same thing with an explicit memory ordering:</p>
<p></p>
<div class="sourceCode" id="cb767"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb767-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb767-1" aria-hidden="true" tabindex="-1"></a>atomic_int x <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb767-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb767-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb767-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb767-3" aria-hidden="true" tabindex="-1"></a>atomic_fetch_add_explicit<span class="op">(&amp;</span>x<span class="op">,</span> <span class="dv">5</span><span class="op">,</span> memory_order_seq_cst<span class="op">);</span></span></code></pre></div>
<p>But what if we didn’t want sequential consistency? And you wanted acquire/release instead for whatever reason? Just name it:</p>
<div class="sourceCode" id="cb768"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb768-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb768-1" aria-hidden="true" tabindex="-1"></a>atomic_int x <span class="op">=</span> <span class="dv">0</span><span class="op">;</span></span>
<span id="cb768-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb768-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb768-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb768-3" aria-hidden="true" tabindex="-1"></a>atomic_fetch_add_explicit<span class="op">(&amp;</span>x<span class="op">,</span> <span class="dv">5</span><span class="op">,</span> memory_order_acq_rel<span class="op">);</span></span></code></pre></div>
<p></p>
<p>We’ll do a breakdown of the different memory orders, below. Don’t mess with anything other than sequential consistency unless you know what you’re doing. It’s really easy to make mistakes that will cause rare, hard-to-repro failures.</p>
<h3 data-number="40.13.1" id="sequential-consistency-1"><span class="header-section-number">40.13.1</span> Sequential Consistency</h3>
<p> </p>
<ul>
<li>Load operations acquire (see below).</li>
<li>Store operations release (see below).</li>
<li>Read-modify-write operations acquire then release.</li>
</ul>
<p>Also, in order to maintain the total order of acquires and releases, no acquires or releases will be reordered with respect to each other. (The acquire/release rules do not forbid reordering a release followed by an acquire. But the sequentially consistent rules do.)</p>
<p> </p>
<h3 data-number="40.13.2" id="acquire"><span class="header-section-number">40.13.2</span> Acquire</h3>
<p> </p>
<p>This is what happens on a load/read operation on an atomic variable.</p>
<ul>
<li><p>If another thread released this atomic variable, all the writes that thread did are now visible in this thread.</p></li>
<li><p>Memory accesses in this thread that happen after this load can’t be reordered before it.</p></li>
</ul>
<p> </p>
<h3 data-number="40.13.3" id="release"><span class="header-section-number">40.13.3</span> Release</h3>
<p> </p>
<p>This is what happens on a store/write of an atomic variable.</p>
<ul>
<li><p>If another thread later acquires this atomic variable, all memory writes in this thread before its atomic write become visible to that other thread.</p></li>
<li><p>Memory accesses in this thread that happen before the release can’t be reordered after it.</p></li>
</ul>
<p> </p>
<h3 data-number="40.13.4" id="consume"><span class="header-section-number">40.13.4</span> Consume</h3>
<p> </p>
<p>This is an odd one, similar to a less-strict version of acquire. It affects memory accesses that are <em>data dependent</em> on the atomic variable.</p>
<p>Being “data dependent” vaguely means that the atomic variable is used in a calculation.</p>
<p>That is, if a thread consumes an atomic variable then all the operations in that thread that go on to use that atomic variable will be able to see the memory writes in the releasing thread.</p>
<p>Compare to acquire where memory writes in the releasing thread will be visible to <em>all</em> operations in the current thread, not just the data-dependent ones.</p>
<p>Also like acquire, there is a restriction on which operations can be reordered <em>before</em> the consume. With acquire, you couldn’t reorder anything before it. With consume, you can’t reorder anything that depends on the loaded atomic value before it.</p>
<p> </p>
<h3 data-number="40.13.5" id="acquirerelease"><span class="header-section-number">40.13.5</span> Acquire/Release</h3>
<p> </p>
<p>This only applies to read-modify-write operations. It’s an acquire and release bundled into one.</p>
<ul>
<li>An acquire happens for the read.</li>
<li>A release happens for the write.</li>
</ul>
<p> </p>
<h3 data-number="40.13.6" id="relaxed"><span class="header-section-number">40.13.6</span> Relaxed</h3>
<p> </p>
<p>No rules; it’s anarchy! Everyone can reorder everything everywhere! Dogs and cats living together—mass hysteria!</p>
<p>Actually, there is a rule. Atomic reads and writes are still all-or-nothing. But the operations can be reordered whimsically and there is zero synchronization between threads.</p>
<p>There are a few use cases for this memory order, which you can find with a tiny bit of searching, e.g.&nbsp;simple counters.</p>
<p>And you can use a fence to force synchronization after a bunch of relaxed writes.</p>
<p> </p>
<h2 data-number="40.14" id="fences"><span class="header-section-number">40.14</span> Fences</h2>
<p></p>
<p>You know how the releases and acquires of atomic variables occur as you read and write them?</p>
<p>Well, it’s possible to do a release or acquire <em>without</em> an atomic variable, as well.</p>
<p>This is called a <em>fence</em>. So if you want all the writes in a thread to be visible elsewhere, you can put up a release fence in one thread and an acquire fence in another, just like with how atomic variables work.</p>
<p>Since a consume operation doesn’t really make sense on a fence<a href="https://beej.us/guide/bgc/html/index-wide.html#fn216" class="footnote-ref" id="fnref216" role="doc-noteref"><sup>216</sup></a>, <code>memory_order_consume</code> is treated as an acquire.</p>
<p>You can put up a fence with any specified order:</p>
<p></p>
<div class="sourceCode" id="cb769"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb769-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb769-1" aria-hidden="true" tabindex="-1"></a>atomic_thread_fence<span class="op">(</span>memory_order_release<span class="op">);</span></span></code></pre></div>
<p> </p>
<p>There’s also a light version of a fence for use with signal handlers, called <code>atomic_signal_fence()</code>.</p>
<p>It works just the same way as <code>atomic_thread_fence()</code>, except:</p>
<ul>
<li><p>It only deals with visibility of values within the same thread; there is no synchronization with other threads.</p></li>
<li><p>No hardware fence instructions are emitted.</p></li>
</ul>
<p>If you want to be sure the side effects of non-atomic operations (and relaxed atomic operations) are visible in the signal handler, you can use this fence.</p>
<p>The idea is that the signal handler is executing in <em>this</em> thread, not another, so this is a lighter-weight way of making sure changes outside the signal handler are visible within it (i.e.&nbsp;they haven’t been reordered).</p>
<p> </p>
<h2 data-number="40.15" id="references"><span class="header-section-number">40.15</span> References</h2>
<p>If you want to learn more about this stuff, here are some of the things that helped me plow through it:</p>
<ul>
<li><p>Herb Sutter’s <em><code>atomic&lt;&gt;</code> Weapons</em> talk:</p>
<ul>
<li><a href="https://www.youtube.com/watch?v=A8eCGOqgvH4">Part 1</a><a href="https://beej.us/guide/bgc/html/index-wide.html#fn217" class="footnote-ref" id="fnref217" role="doc-noteref"><sup>217</sup></a></li>
<li><a href="https://www.youtube.com/watch?v=KeLBd2EJLOU">part 2</a><a href="https://beej.us/guide/bgc/html/index-wide.html#fn218" class="footnote-ref" id="fnref218" role="doc-noteref"><sup>218</sup></a></li>
</ul></li>
<li><p><a href="https://preshing.com/archives/">Jeff Preshing’s materials</a><a href="https://beej.us/guide/bgc/html/index-wide.html#fn219" class="footnote-ref" id="fnref219" role="doc-noteref"><sup>219</sup></a>, in particular:</p>
<ul>
<li><a href="https://preshing.com/20120612/an-introduction-to-lock-free-programming/">An Introduction to Lock-Free Programming</a><a href="https://beej.us/guide/bgc/html/index-wide.html#fn220" class="footnote-ref" id="fnref220" role="doc-noteref"><sup>220</sup></a></li>
<li><a href="https://preshing.com/20120913/acquire-and-release-semantics/">Acquire and Release Semantics</a><a href="https://beej.us/guide/bgc/html/index-wide.html#fn221" class="footnote-ref" id="fnref221" role="doc-noteref"><sup>221</sup></a></li>
<li><a href="https://preshing.com/20130702/the-happens-before-relation/">The <em>Happens-Before</em> Relation</a><a href="https://beej.us/guide/bgc/html/index-wide.html#fn222" class="footnote-ref" id="fnref222" role="doc-noteref"><sup>222</sup></a></li>
<li><a href="https://preshing.com/20130823/the-synchronizes-with-relation/">The <em>Synchronizes-With</em> Relation</a><a href="https://beej.us/guide/bgc/html/index-wide.html#fn223" class="footnote-ref" id="fnref223" role="doc-noteref"><sup>223</sup></a></li>
<li><a href="https://preshing.com/20140709/the-purpose-of-memory_order_consume-in-cpp11/">The Purpose of <code>memory_order_consume</code> in C++11</a><a href="https://beej.us/guide/bgc/html/index-wide.html#fn224" class="footnote-ref" id="fnref224" role="doc-noteref"><sup>224</sup></a></li>
<li><a href="https://preshing.com/20150402/you-can-do-any-kind-of-atomic-read-modify-write-operation/">You Can Do Any Kind of Atomic Read-Modify-Write Operation</a><a href="https://beej.us/guide/bgc/html/index-wide.html#fn225" class="footnote-ref" id="fnref225" role="doc-noteref"><sup>225</sup></a></li>
</ul></li>
<li><p>CPPReference:</p>
<ul>
<li><a href="https://en.cppreference.com/w/c/atomic/memory_order">Memory Order</a><a href="https://beej.us/guide/bgc/html/index-wide.html#fn226" class="footnote-ref" id="fnref226" role="doc-noteref"><sup>226</sup></a></li>
<li><a href="https://en.cppreference.com/w/c/language/atomic">Atomic Types</a><a href="https://beej.us/guide/bgc/html/index-wide.html#fn227" class="footnote-ref" id="fnref227" role="doc-noteref"><sup>227</sup></a></li>
</ul></li>
<li><p>Bruce Dawson’s <a href="https://docs.microsoft.com/en-us/windows/win32/dxtecharts/lockless-programming">Lockless Programming Considerations</a><a href="https://beej.us/guide/bgc/html/index-wide.html#fn228" class="footnote-ref" id="fnref228" role="doc-noteref"><sup>228</sup></a></p></li>
<li><p>The helpful and knowledgeable folks on <a href="https://www.reddit.com/r/C_Programming/">r/C_Programming</a><a href="https://beej.us/guide/bgc/html/index-wide.html#fn229" class="footnote-ref" id="fnref229" role="doc-noteref"><sup>229</sup></a></p></li>
</ul>
<p></p>
<!-- Beej's guide to C

# vim: ts=4:sw=4:nosi:et:tw=72
-->
<h1 data-number="41" id="function-specifiers-alignment-specifiersoperators"><span class="header-section-number">41</span> Function Specifiers, Alignment Specifiers/Operators</h1>
<p>These don’t see a heck of a lot of use in my experience, but we’ll cover them here for the sake of completeness.</p>
<h2 data-number="41.1" id="function-specifiers"><span class="header-section-number">41.1</span> Function Specifiers</h2>
<p></p>
<p>When you declare a function, you can give the compiler a couple tips about how the functions could or will be used. This enables or encourages the compiler to make certain optimizations.</p>
<h3 data-number="41.1.1" id="inline-for-speedmaybe"><span class="header-section-number">41.1.1</span> <code>inline</code> for Speed—Maybe</h3>
<p></p>
<p>You can declare a function to be inline like this:</p>
<div class="sourceCode" id="cb770"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb770-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb770-1" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> <span class="kw">inline</span> <span class="dt">int</span> add<span class="op">(</span><span class="dt">int</span> x<span class="op">,</span> <span class="dt">int</span> y<span class="op">)</span> <span class="op">{</span></span>
<span id="cb770-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb770-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x <span class="op">+</span> y<span class="op">;</span></span>
<span id="cb770-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb770-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>This is meant to encourage the compiler to make this function call as fast as possible. And, historically, one way to do this was <em>inlining</em>, which means that the body of the function would be embedded in its entirety where the call was made. This would avoid all the overhead of setting up the function call and tearing it down at the expense of larger code size as the function was copied all over the place instead of being reused.</p>
<p>That would seem to be the end of the story, but it’s not. <code>inline</code> comes with a whole pile of rules that make for <em>interesting times</em>. I’m not sure I even understand them all, and behavior seems to vary from compiler to compiler.</p>
<p>The short answer is define the <code>inline</code> function as <code>static</code> in the file that you need it. And then use it in that one file. And you never have to worry about the rest of it.</p>
<p>But if you’re wondering, here are more fun times.</p>
<p>Let’s try leaving the <code>static</code> off.</p>
<div class="sourceCode" id="cb771"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb771-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb771-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb771-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb771-2"></a></span>
<span id="cb771-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb771-3"></a><span class="kw">inline</span> <span class="dt">int</span> add<span class="op">(</span><span class="dt">int</span> x<span class="op">,</span> <span class="dt">int</span> y<span class="op">)</span></span>
<span id="cb771-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb771-4"></a><span class="op">{</span></span>
<span id="cb771-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb771-5"></a>    <span class="cf">return</span> x <span class="op">+</span> y<span class="op">;</span></span>
<span id="cb771-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb771-6"></a><span class="op">}</span></span>
<span id="cb771-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb771-7"></a></span>
<span id="cb771-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb771-8"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb771-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb771-9"></a><span class="op">{</span></span>
<span id="cb771-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb771-10"></a>    printf<span class="op">(</span><span class="st">"</span><span class="sc">%d\n</span><span class="st">"</span><span class="op">,</span> add<span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">));</span></span>
<span id="cb771-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb771-11"></a><span class="op">}</span></span></code></pre></div>
<p><code>gcc</code> gives a linker error on <code>add()</code>… unless you compile with optimizations on (probably)!</p>
<p>See, a compiler can choose to inline or not, but if it chooses not to, you’re left with no function at all. <code>gcc</code> doesn’t inline unless you’re doing an optimized build.</p>
<p>One way around this is to define a non-<code>inline</code> external linkage version of the function elsewhere, and that one will be used when the <code>inline</code> one isn’t. But you as the programmer can’t determine which, portably. If both are available, it’s unspecified which one the compiler chooses. With <code>gcc</code> the inline function will be used if you’re compiling with optimizations, and the non-inline one will be used otherwise. Even if the bodies of these functions are completely different. Zany!</p>
<p>Another way is to declare the function as <code>extern inline</code>. This will attempt to inline in this file, but will also create a version with external linkage. And so <code>gcc</code> will use one or the other depending on optimizations, but at least they’re the same function.</p>
<p>Unless, of course, you have another source file with an <code>inline</code> function of the same name; it will use its <code>inline</code> function or the one with external linkage depending on optimizations.</p>
<p>But let’s say you’re doing a build where the compiler <em>is</em> inlining the function. In that case, you can just use a plain <code>inline</code> in the definition. However, there are now additional restrictions.</p>
<p>You can’t refer to any <code>static</code> globals:</p>
<div class="sourceCode" id="cb772"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb772-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb772-1" aria-hidden="true" tabindex="-1"></a><span class="dt">static</span> <span class="dt">int</span> b <span class="op">=</span> <span class="dv">13</span><span class="op">;</span></span>
<span id="cb772-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb772-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb772-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb772-3" aria-hidden="true" tabindex="-1"></a><span class="kw">inline</span> <span class="dt">int</span> add<span class="op">(</span><span class="dt">int</span> x<span class="op">,</span> <span class="dt">int</span> y<span class="op">)</span></span>
<span id="cb772-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb772-4" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb772-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb772-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x <span class="op">+</span> y <span class="op">+</span> b<span class="op">;</span>  <span class="co">// BAD -- can't refer to b</span></span>
<span id="cb772-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb772-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>And you can’t define any non-<code>const</code> <code>static</code> local variables:</p>
<div class="sourceCode" id="cb773"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb773-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb773-1" aria-hidden="true" tabindex="-1"></a><span class="kw">inline</span> <span class="dt">int</span> add<span class="op">(</span><span class="dt">int</span> x<span class="op">,</span> <span class="dt">int</span> y<span class="op">)</span></span>
<span id="cb773-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb773-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb773-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb773-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">static</span> <span class="dt">int</span> b <span class="op">=</span> <span class="dv">13</span><span class="op">;</span>  <span class="co">// BAD -- can't define static</span></span>
<span id="cb773-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb773-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb773-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb773-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x <span class="op">+</span> y <span class="op">+</span> b<span class="op">;</span></span>
<span id="cb773-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb773-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>But making it <code>const</code> is OK:</p>
<div class="sourceCode" id="cb774"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb774-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb774-1" aria-hidden="true" tabindex="-1"></a><span class="kw">inline</span> <span class="dt">int</span> add<span class="op">(</span><span class="dt">int</span> x<span class="op">,</span> <span class="dt">int</span> y<span class="op">)</span></span>
<span id="cb774-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb774-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb774-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb774-3" aria-hidden="true" tabindex="-1"></a>    <span class="dt">static</span> <span class="dt">const</span> <span class="dt">int</span> b <span class="op">=</span> <span class="dv">13</span><span class="op">;</span>  <span class="co">// OK -- static const</span></span>
<span id="cb774-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb774-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb774-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb774-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> x <span class="op">+</span> y <span class="op">+</span> b<span class="op">;</span></span>
<span id="cb774-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb774-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>Now, you know the functions are <code>extern</code> by default, so we should be able to call <code>add()</code> from another file. You’d like to think that, wouldn’t you!</p>
<p>But you can’t! If it’s just a plain <code>inline</code>, it’s similar to <code>static</code>: it’s only visible in that file.</p>
<p>Okay, so what if you throw an <code>extern</code> on there? Now we’re coming full circle to when we discussed having <code>inline</code> mixed with functions with external linkage.</p>
<p>If both are visible, the compiler can choose which to use.</p>
<p>Let’s do a demo of this behavior. We’ll have two files, <code>foo.c</code> and <code>bar.c</code>. They’ll both call <code>func()</code> which is <code>inline</code> in <code>foo.c</code> and external linkage in <code>bar.c</code>.</p>
<p>Here’s <code>foo.c</code> with the <code>inline</code>.</p>
<div class="sourceCode" id="cb775"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb775-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb775-1"></a><span class="co">// foo.c</span></span>
<span id="cb775-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb775-2"></a></span>
<span id="cb775-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb775-3"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb775-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb775-4"></a></span>
<span id="cb775-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb775-5"></a><span class="kw">inline</span> <span class="dt">char</span> <span class="op">*</span>func<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb775-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb775-6"></a><span class="op">{</span></span>
<span id="cb775-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb775-7"></a>    <span class="cf">return</span> <span class="st">"foo's function"</span><span class="op">;</span></span>
<span id="cb775-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb775-8"></a><span class="op">}</span></span>
<span id="cb775-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb775-9"></a></span>
<span id="cb775-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb775-10"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb775-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb775-11"></a><span class="op">{</span></span>
<span id="cb775-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb775-12"></a>    printf<span class="op">(</span><span class="st">"foo.c: </span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> func<span class="op">());</span></span>
<span id="cb775-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb775-13"></a></span>
<span id="cb775-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb775-14"></a>    <span class="dt">void</span> bar<span class="op">(</span><span class="dt">void</span><span class="op">);</span></span>
<span id="cb775-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb775-15"></a>    bar<span class="op">();</span></span>
<span id="cb775-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb775-16"></a><span class="op">}</span></span></code></pre></div>
<p>Recall that unless we’re doing an optimized build with <code>gcc</code>. <code>func()</code> will vanish and we’ll get a linker error. Unless, or course, we have a version with external linkage defined elsewhere.</p>
<p>And we do. In <code>bar.c</code>.</p>
<div class="sourceCode" id="cb776"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb776-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb776-1"></a><span class="co">// bar.c</span></span>
<span id="cb776-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb776-2"></a></span>
<span id="cb776-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb776-3"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb776-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb776-4"></a></span>
<span id="cb776-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb776-5"></a><span class="dt">char</span> <span class="op">*</span>func<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb776-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb776-6"></a><span class="op">{</span></span>
<span id="cb776-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb776-7"></a>    <span class="cf">return</span> <span class="st">"bar's function"</span><span class="op">;</span></span>
<span id="cb776-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb776-8"></a><span class="op">}</span></span>
<span id="cb776-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb776-9"></a></span>
<span id="cb776-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb776-10"></a><span class="dt">void</span> bar<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb776-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb776-11"></a><span class="op">{</span></span>
<span id="cb776-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb776-12"></a>    printf<span class="op">(</span><span class="st">"bar.c: </span><span class="sc">%s\n</span><span class="st">"</span><span class="op">,</span> func<span class="op">());</span></span>
<span id="cb776-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb776-13"></a><span class="op">}</span></span></code></pre></div>
<p>So the question is, what is the output?</p>
<p>Seems like when we call <code>func()</code> from <code>foo.c</code>, it should print “<code>foo's function</code>”. And from <code>bar.c</code>, that <code>func()</code> should print “<code>bar's function</code>”.</p>
<p>And if I compile with <code>gcc</code> with optimizations<a href="https://beej.us/guide/bgc/html/index-wide.html#fn230" class="footnote-ref" id="fnref230" role="doc-noteref"><sup>230</sup></a> it will use inline functions, and we’ll get the expected:</p>
<div class="sourceCode" id="cb777"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb777-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb777-1" aria-hidden="true" tabindex="-1"></a>foo.c: foo's function</span>
<span id="cb777-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb777-2" aria-hidden="true" tabindex="-1"></a>bar.c: bar's function</span></code></pre></div>
<p>Great!</p>
<p>But if we compile in <code>gcc</code> without optimizations, it ignores the inline function and uses the external linkage <code>func()</code> from <code>bar.c</code>! And we get this:</p>
<div class="sourceCode" id="cb778"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb778-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb778-1" aria-hidden="true" tabindex="-1"></a>foo.c: bar's function</span>
<span id="cb778-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb778-2" aria-hidden="true" tabindex="-1"></a>bar.c: bar's function</span></code></pre></div>
<p>In short, the rules are surprisingly complex. I give myself a good 30% chance of having described them correctly.</p>
<p></p>
<h3 data-number="41.1.2" id="noreturn"><span class="header-section-number">41.1.2</span> <code>noreturn</code> and <code>_Noreturn</code></h3>
<p> </p>
<p>This indicates to the compiler that a particular function will not ever return to its caller, i.e.&nbsp;the program will exit by some mechanism before the function returns.</p>
<p>It allows the compiler to perhaps perform some optimizations around the function call.</p>
<p>It also allows you to indicate to other devs that some program logic depends on a function <em>not</em> returning.</p>
<p>You’ll likely never need to use this, but you’ll see it on some library calls like <a href="https://beej.us/guide/bgclr/html/split/stdlib.html#man-exit"><code>exit()</code></a><a href="https://beej.us/guide/bgc/html/index-wide.html#fn231" class="footnote-ref" id="fnref231" role="doc-noteref"><sup>231</sup></a> and <a href="https://beej.us/guide/bgclr/html/split/stdlib.html#man-abort"><code>abort()</code></a><a href="https://beej.us/guide/bgc/html/index-wide.html#fn232" class="footnote-ref" id="fnref232" role="doc-noteref"><sup>232</sup></a>.</p>
<p>The built-in keyword is <code>_Noreturn</code>, but if it doesn’t break your existing code, everyone would recommend including <code>&lt;stdnoreturn.h&gt;</code> and using the easier-to-read <code>noreturn</code> instead.</p>
<p>It’s undefined behavior if a function specified as <code>noreturn</code> actually does return. It’s computationally dishonest, see.</p>
<p>Here’s an example of using <code>noreturn</code> correctly:</p>
<div class="sourceCode" id="cb779"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb779-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb779-1"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span></span>
<span id="cb779-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb779-2"></a><span class="pp">#include </span><span class="im">&lt;stdlib.h&gt;</span></span>
<span id="cb779-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb779-3"></a><span class="pp">#include </span><span class="im">&lt;stdnoreturn.h&gt;</span></span>
<span id="cb779-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb779-4"></a></span>
<span id="cb779-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb779-5"></a>noreturn <span class="dt">void</span> foo<span class="op">(</span><span class="dt">void</span><span class="op">)</span> <span class="co">// This function should never return!</span></span>
<span id="cb779-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb779-6"></a><span class="op">{</span></span>
<span id="cb779-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb779-7"></a>    printf<span class="op">(</span><span class="st">"Happy days</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb779-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb779-8"></a></span>
<span id="cb779-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb779-9"></a>    exit<span class="op">(</span><span class="dv">1</span><span class="op">);</span>            <span class="co">// And it doesn't return--it exits here!</span></span>
<span id="cb779-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb779-10"></a><span class="op">}</span></span>
<span id="cb779-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb779-11"></a></span>
<span id="cb779-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb779-12"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb779-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb779-13"></a><span class="op">{</span></span>
<span id="cb779-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb779-14"></a>    foo<span class="op">();</span></span>
<span id="cb779-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb779-15"></a><span class="op">}</span></span></code></pre></div>
<p>If the compiler detects that a <code>noreturn</code> function could return, it might warn you, helpfully.</p>
<p>Replacing the <code>foo()</code> function with this:</p>
<div class="sourceCode" id="cb780"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb780-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb780-1" aria-hidden="true" tabindex="-1"></a>noreturn <span class="dt">void</span> foo<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb780-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb780-2" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb780-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb780-3" aria-hidden="true" tabindex="-1"></a>    printf<span class="op">(</span><span class="st">"Breakin' the law</span><span class="sc">\n</span><span class="st">"</span><span class="op">);</span></span>
<span id="cb780-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb780-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<p>gets me a warning:</p>
<div class="sourceCode" id="cb781"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb781-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb781-1" aria-hidden="true" tabindex="-1"></a>foo.c:7:1: warning: function declared 'noreturn' should not return</span></code></pre></div>
<p> </p>
<h2 data-number="41.2" id="alignment-specifiers-and-operators"><span class="header-section-number">41.2</span> Alignment Specifiers and Operators</h2>
<p></p>
<p><a href="https://en.wikipedia.org/wiki/Data_structure_alignment"><em>Alignment</em></a><a href="https://beej.us/guide/bgc/html/index-wide.html#fn233" class="footnote-ref" id="fnref233" role="doc-noteref"><sup>233</sup></a> is all about multiples of addresses on which objects can be stored. Can you store this at any address? Or must it be a starting address that’s divisible by 2? Or 8? Or 16?</p>
<p>If you’re coding up something low-level like a memory allocator that interfaces with your OS, you might need to consider this. Most devs go their careers without using this functionality in C.</p>
<h3 data-number="41.2.1" id="alignas-and-_alignas"><span class="header-section-number">41.2.1</span> <code>alignas</code> and <code>_Alignas</code></h3>
<p> </p>
<p>This isn’t a function. Rather, it’s an <em>alignment specifier</em> that you can use with a variable declaration.</p>
<p>The built-in specifier is <code>_Alignas</code>, but the header <code>&lt;stdalign.h&gt;</code> defines it as <code>alignas</code> for something better looking.</p>
<p>If you need your <code>char</code> to be aligned like an <code>int</code>, you can force it like this when you declare it:</p>
<div class="sourceCode" id="cb782"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb782-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb782-1" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span> alignas<span class="op">(</span><span class="dt">int</span><span class="op">)</span> c<span class="op">;</span></span></code></pre></div>
<p>You can also pass a constant value or expression in for the alignment. This has to be something supported by the system, but the spec stops short of dictating what values you can put in there. Small powers of 2 (1, 2, 4, 8, and 16) are generally safe bets.</p>
<div class="sourceCode" id="cb783"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb783-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb783-1" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span> alignas<span class="op">(</span><span class="dv">8</span><span class="op">)</span> c<span class="op">;</span>   <span class="co">// align on 8-byte boundaries</span></span></code></pre></div>
<p>If you want to align at the maximum used alignment by your system, include <code>&lt;stddef.h&gt;</code> and use the type <code>max_align_t</code>, like so:</p>
<div class="sourceCode" id="cb784"><pre class="sourceCode c"><code class="sourceCode c"><span id="cb784-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb784-1" aria-hidden="true" tabindex="-1"></a><span class="dt">char</span> alignas<span class="op">(</span><span class="dt">max_align_t</span><span class="op">)</span> c<span class="op">;</span></span></code></pre></div>
<p>You could potentially <em>over-align</em> by specifying an alignment more than that of <code>max_align_t</code>, but whether or not such things are allowed is system dependent.</p>
<p> </p>
<h3 data-number="41.2.2" id="alignof-and-_alignof"><span class="header-section-number">41.2.2</span> <code>alignof</code> and <code>_Alignof</code></h3>
<p> </p>
<p>This operator will return the address multiple a particular type uses for alignment on this system. For example, maybe <code>char</code>s are aligned every 1 address, and <code>int</code>s are aligned every 4 addresses.</p>
<p>The built-in operator is <code>_Alignof</code>, but the header <code>&lt;stdalign.h&gt;</code> defines it as <code>alignof</code> if you want to look cooler.</p>
<p>Here’s a program that will print out the alignments of a variety of different types. Again, these will vary from system to system. Note that the type <code>max_align_t</code> will give you the maximum alignment used by the system.</p>
<div class="sourceCode" id="cb785"><pre class="sourceCode numberSource c numberLines"><code class="sourceCode c"><span id="cb785-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb785-1"></a><span class="pp">#include </span><span class="im">&lt;stdalign.h&gt;</span></span>
<span id="cb785-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb785-2"></a><span class="pp">#include </span><span class="im">&lt;stdio.h&gt;</span><span class="pp">     </span><span class="co">// for printf()</span></span>
<span id="cb785-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb785-3"></a><span class="pp">#include </span><span class="im">&lt;stddef.h&gt;</span><span class="pp">    </span><span class="co">// for max_align_t</span></span>
<span id="cb785-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb785-4"></a></span>
<span id="cb785-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb785-5"></a><span class="kw">struct</span> t <span class="op">{</span></span>
<span id="cb785-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb785-6"></a>    <span class="dt">int</span> a<span class="op">;</span></span>
<span id="cb785-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb785-7"></a>    <span class="dt">char</span> b<span class="op">;</span></span>
<span id="cb785-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb785-8"></a>    <span class="dt">float</span> c<span class="op">;</span></span>
<span id="cb785-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb785-9"></a><span class="op">};</span></span>
<span id="cb785-10"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb785-10"></a></span>
<span id="cb785-11"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb785-11"></a><span class="dt">int</span> main<span class="op">(</span><span class="dt">void</span><span class="op">)</span></span>
<span id="cb785-12"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb785-12"></a><span class="op">{</span></span>
<span id="cb785-13"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb785-13"></a>    printf<span class="op">(</span><span class="st">"char       : </span><span class="sc">%zu\n</span><span class="st">"</span><span class="op">,</span> alignof<span class="op">(</span><span class="dt">char</span><span class="op">));</span></span>
<span id="cb785-14"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb785-14"></a>    printf<span class="op">(</span><span class="st">"short      : </span><span class="sc">%zu\n</span><span class="st">"</span><span class="op">,</span> alignof<span class="op">(</span><span class="dt">short</span><span class="op">));</span></span>
<span id="cb785-15"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb785-15"></a>    printf<span class="op">(</span><span class="st">"int        : </span><span class="sc">%zu\n</span><span class="st">"</span><span class="op">,</span> alignof<span class="op">(</span><span class="dt">int</span><span class="op">));</span></span>
<span id="cb785-16"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb785-16"></a>    printf<span class="op">(</span><span class="st">"long       : </span><span class="sc">%zu\n</span><span class="st">"</span><span class="op">,</span> alignof<span class="op">(</span><span class="dt">long</span><span class="op">));</span></span>
<span id="cb785-17"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb785-17"></a>    printf<span class="op">(</span><span class="st">"long long  : </span><span class="sc">%zu\n</span><span class="st">"</span><span class="op">,</span> alignof<span class="op">(</span><span class="dt">long</span> <span class="dt">long</span><span class="op">));</span></span>
<span id="cb785-18"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb785-18"></a>    printf<span class="op">(</span><span class="st">"double     : </span><span class="sc">%zu\n</span><span class="st">"</span><span class="op">,</span> alignof<span class="op">(</span><span class="dt">double</span><span class="op">));</span></span>
<span id="cb785-19"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb785-19"></a>    printf<span class="op">(</span><span class="st">"long double: </span><span class="sc">%zu\n</span><span class="st">"</span><span class="op">,</span> alignof<span class="op">(</span><span class="dt">long</span> <span class="dt">double</span><span class="op">));</span></span>
<span id="cb785-20"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb785-20"></a>    printf<span class="op">(</span><span class="st">"struct t   : </span><span class="sc">%zu\n</span><span class="st">"</span><span class="op">,</span> alignof<span class="op">(</span><span class="kw">struct</span> t<span class="op">));</span></span>
<span id="cb785-21"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb785-21"></a>    printf<span class="op">(</span><span class="st">"max_align_t: </span><span class="sc">%zu\n</span><span class="st">"</span><span class="op">,</span> alignof<span class="op">(</span><span class="dt">max_align_t</span><span class="op">));</span></span>
<span id="cb785-22"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb785-22"></a><span class="op">}</span></span></code></pre></div>
<p>Output on my system:</p>
<div class="sourceCode" id="cb786"><pre class="sourceCode default"><code class="sourceCode default"><span id="cb786-1"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb786-1" aria-hidden="true" tabindex="-1"></a>char       : 1</span>
<span id="cb786-2"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb786-2" aria-hidden="true" tabindex="-1"></a>short      : 2</span>
<span id="cb786-3"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb786-3" aria-hidden="true" tabindex="-1"></a>int        : 4</span>
<span id="cb786-4"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb786-4" aria-hidden="true" tabindex="-1"></a>long       : 8</span>
<span id="cb786-5"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb786-5" aria-hidden="true" tabindex="-1"></a>long long  : 8</span>
<span id="cb786-6"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb786-6" aria-hidden="true" tabindex="-1"></a>double     : 8</span>
<span id="cb786-7"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb786-7" aria-hidden="true" tabindex="-1"></a>long double: 16</span>
<span id="cb786-8"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb786-8" aria-hidden="true" tabindex="-1"></a>struct t   : 16</span>
<span id="cb786-9"><a href="https://beej.us/guide/bgc/html/index-wide.html#cb786-9" aria-hidden="true" tabindex="-1"></a>max_align_t: 16</span></code></pre></div>
<p>And there you have it. Alignment!</p>
<p> </p>
<section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes">
<hr>
<ol>
<li id="fn1"><p>https://www.ioccc.org/<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>https://en.wikipedia.org/wiki/Python_(programming_language)<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>https://en.wikipedia.org/wiki/JavaScript<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>https://en.wikipedia.org/wiki/Java_(programming_language)<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p>https://en.wikipedia.org/wiki/Rust_(programming_language)<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn6"><p>https://en.wikipedia.org/wiki/Go_(programming_language)<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref6" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn7"><p>https://en.wikipedia.org/wiki/Swift_(programming_language)<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref7" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn8"><p>https://en.wikipedia.org/wiki/Objective-C<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref8" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn9"><p>https://beej.us/guide/bgclr/<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref9" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn10"><p>https://en.wikipedia.org/wiki/ANSI_C<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref10" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn11"><p>https://en.wikipedia.org/wiki/POSIX<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref11" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn12"><p>https://visualstudio.microsoft.com/vs/community/<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref12" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn13"><p>https://docs.microsoft.com/en-us/windows/wsl/install-win10<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref13" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn14"><p>https://developer.apple.com/xcode/<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref14" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn15"><p>https://beej.us/guide/bgc/<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref15" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn16"><p>https://en.cppreference.com/<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref16" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn17"><p>https://groups.google.com/g/comp.lang.c<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref17" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn18"><p>https://www.reddit.com/r/C_Programming/<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref18" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn19"><p>https://en.wikipedia.org/wiki/Assembly_language<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref19" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn20"><p>https://en.wikipedia.org/wiki/Bare_machine<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref20" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn21"><p>https://en.wikipedia.org/wiki/Operating_system<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref21" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn22"><p>https://en.wikipedia.org/wiki/Embedded_system<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref22" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn23"><p>https://en.wikipedia.org/wiki/Rust_(programming_language)<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref23" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn24"><p>https://en.wikipedia.org/wiki/Grok<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref24" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn25"><p>I know someone will fight me on that, but it’s gotta be at least in the top three, right?<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref25" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn26"><p>Well, technically there are more than two, but hey, let’s pretend there are two—ignorance is bliss, right?<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref26" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn27"><p>https://en.wikipedia.org/wiki/Assembly_language<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref27" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn28"><p>https://en.wikipedia.org/wiki/Machine_code<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref28" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn29"><p>Technically, it contains preprocessor directives and function prototypes (more on that later) for common input and output needs.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref29" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn30"><p>https://en.wikipedia.org/wiki/Unix<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref30" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn31"><p>If you don’t give it an output filename, it will export to a file called <code>a.out</code> by default—this filename has its roots deep in Unix history.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref31" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn32"><p>https://formulae.brew.sh/formula/gcc<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref32" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn33"><p>A “byte” is typically an 8-bit binary number. Think of it as an integer that can only hold the values from 0 to 255, inclusive. Technically, C allows bytes to be any number of bits and if you want to unambiguously refer to an 8-bit number, you should use the term <em>octet</em>. But programmers are going assume you mean 8-bits when you say “byte” unless you specify otherwise.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref33" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn34"><p>I’m seriously oversimplifying how modern memory works, here. But the mental model works, so please forgive me.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref34" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn35"><p>I’m lying here a little. Technically <code>3.14159</code> is of type <code>double</code>, but we’re not there yet and I want you to associate <code>float</code> with “Floating Point”, and C will happily coerce that type into a <code>float</code>. In short, don’t worry about it until later.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref35" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn36"><p>Read this as “pointer to a char” or “char pointer”. “Char” for character. Though I can’t find a study, it seems anecdotally most people pronounce this as “char”, a minority say “car”, and a handful say “care”. We’ll talk more about pointers later.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref36" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn37"><p>Colloquially, we say they have “random” values, but they aren’t truly—or even pseudo-truly—random numbers.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref37" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn38"><p>This isn’t strictly 100% true. When we get to learning about static storage duration, you’ll find the some variables are initialized to zero automatically. But the safe thing to do is always initialize them.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref38" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn39"><p>The <code>_t</code> is short for <code>type</code>.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref39" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn40"><p>Except for with variable length arrays—but that’s a story for another time.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref40" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn41"><p>https://beej.us/guide/bgclr/html/split/stdlib.html#man-srand<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref41" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn42"><p>This was considered such a hazard that the designers of the Go Programming Language made <code>break</code> the default; you have to explicitly use Go’s <code>fallthrough</code> statement if you want to fall into the next case.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref42" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn43"><p>Never say “never”.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref43" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn44"><p>Typically. I’m sure there are exceptions out there in the dark corridors of computing history.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref44" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn45"><p>A byte is a number made up of no more than 8 binary digits, or <em>bits</em> for short. This means in decimal digits just like grandma used to use, it can hold an unsigned number between 0 and 255, inclusive.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref45" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn46"><p>The order that bytes come in is referred to as the <em>endianness</em> of the number. The usual suspects are <em>big-endian</em> (with the most significant byte first) and <em>little-endian</em> (with the most-significant byte last), or, uncommonly now, <em>mixed-endian</em> (with the most-significant bytes somewhere else).<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref46" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn47"><p>That is, base 16 with digits 0, 1, 2, 3, 4, 5, 6, 7, 8, 9, A, B, C, D, E, and F.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref47" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn48"><p>That’s not all! It’s used in <code>/*comments*/</code> and multiplication and in function prototypes with variable length arrays! It’s all the same <code>*</code>, but the context gives it different meaning.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref48" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn49"><p>https://en.wikipedia.org/wiki/Null_pointer#History<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref49" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn50"><p>https://en.wikipedia.org/wiki/Sentinel_value<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref50" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn51"><p>The pointer type variables are <code>a</code>, <code>d</code>, <code>f</code>, and <code>i</code>, because those are the ones with <code>*</code> in front of them.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref51" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn52"><p>These days, anyway.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref52" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn53"><p>Again, not really, but variable-length arrays—of which I’m not really a fan—are a story for another time.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref53" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn54"><p>Since arrays are just pointers to the first element of the array under the hood, there’s no additional information recording the length.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref54" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn55"><p>Because when you pass an array to a function, you’re actually just passing a pointer to the first element of that array, not the “entire” array.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref55" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn56"><p>In the good old MS-DOS days before memory protection was a thing, I was writing some particularly abusive C code that deliberately engaged in all kinds of undefined behavior. But I knew what I was doing, and things were working pretty well. Until I made a misstep that caused a lockup and, as I found upon reboot, nuked all my BIOS settings. That was fun. (Shout-out to <span class="citation" data-cites="man">@man</span> for those fun times.)<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref56" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn57"><p>There are a lot of things that cause undefined behavior, not just out-of-bounds array accesses. This is what makes the C language so <em>exciting</em>.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref57" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn58"><p>https://en.wikipedia.org/wiki/Row-_and_column-major_order<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref58" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn59"><p>This is technically incorrect, as a pointer to an array and a pointer to the first element of an array have different types. But we can burn that bridge when we get to it.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref59" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn60"><p>C11 §6.7.6.2¶1 requires it be greater than zero. But you might see code out there with arrays declared of zero length at the end of <code>struct</code>s and GCC is particularly lenient about it unless you compile with <code>-pedantic</code>. This zero-length array was a hackish mechanism for making variable-length structures. Unfortunately, it’s technically undefined behavior to access such an array even though it basically worked everywhere. C99 codified a well-defined replacement for it called <em>flexible array members</em>, which we’ll chat about later.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref60" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn61"><p>This is also equivalent: <code>void print_2D_array(int (*a)[3])</code>, but that’s more than I want to get into right now.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref61" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn62"><p>Though it is true that C doesn’t track the length of strings.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref62" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn63"><p>If you’re using the basic character set or an 8-bit character set, you’re used to one character being one byte. This isn’t true in all character encodings, though.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref63" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn64"><p>This is different than the <code>NULL</code> pointer, and I’ll abbreviate it <code>NUL</code> when talking about the character versus <code>NULL</code> for the pointer.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref64" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn65"><p>Later we’ll learn a neater way to do it with pointer arithmetic.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref65" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn66"><p>There’s a safer function called <code>strncpy()</code> that you should probably use instead, but we’ll get to that later.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref66" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn67"><p>Although in C individual items in memory like <code>int</code>s are referred to as “objects”, they’re not objects in an object-oriented programming sense.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref67" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn68"><p>The Saturn was a popular brand of economy car in the United States until it was put out of business by the 2008 crash, sadly so to us fans.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref68" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn69"><p>A pointer is likely 8 bytes on a 64-bit system.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref69" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn70"><p>A <em>deep copy</em> follows pointer in the <code>struct</code> and copies the data they point to, as well. A <em>shallow copy</em> just copies the pointers, but not the things they point to. C doesn’t come with any built-in deep copy functionality.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref70" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn71"><p>https://beej.us/guide/bgclr/html/split/stringref.html#man-strcmp<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref71" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn72"><p>https://beej.us/guide/bgclr/html/split/stringref.html#man-memset<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref72" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn73"><p>https://stackoverflow.com/questions/141720/how-do-you-compare-structs-for-equality-in-c<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref73" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn74"><p>We used to have three different newlines in broad effect: Carriage Return (CR, used on old Macs), Linefeed (LF, used on Unix systems), and Carriage Return/Linefeed (CRLF, used on Windows systems). Thankfully the introduction of OS X, being Unix-based, reduced this number to two.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref74" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn75"><p>If the buffer’s not big enough to read in an entire line, it’ll just stop reading mid-line, and the next call to <code>fgets()</code> will continue reading the rest of the line.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref75" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn76"><p>Normally the second program would read all the bytes at once, and <em>then</em> print them out in a loop. That would be more efficient. But we’re going for demo value, here.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref76" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn77"><p>https://en.wikipedia.org/wiki/Hex_dump<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref77" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn78"><p>https://en.wikipedia.org/wiki/Endianess<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref78" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn79"><p>And this is why I used individual bytes in my <code>fwrite()</code> and <code>fread()</code> examples, above, shrewdly.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref79" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn80"><p>https://en.wikipedia.org/wiki/Protocol_buffers<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref80" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn81"><p>We’ll talk more about these later.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref81" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn82"><p>Recall that the <code>sizeof</code> operator tells you the size in bytes of an object in memory.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref82" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn83"><p>Or string, which is really an array of <code>char</code>s. Somewhat peculiarly, you can also have a pointer that references <em>one past</em> the end of the array without a problem and still do math on it. You just can’t dereference it when it’s out there.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref83" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn84"><p>https://beej.us/guide/bgclr/html/split/stdlib.html#man-qsort<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref84" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn85"><p>https://beej.us/guide/bgclr/html/split/stdlib.html#man-bsearch<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref85" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn86"><p>Because remember that array notation is just a dereference and some pointer math, and you can’t dereference a <code>void*</code>!<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref86" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn87"><p>You can also <em>cast</em> the <code>void*</code> to another type, but we haven’t gotten to casts yet.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref87" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn88"><p>Or until the program exits, in which case all the memory allocated by it is freed. Asterisk: some systems allow you to allocate memory that persists after a program exits, but it’s system dependent, out of scope for this guide, and you’ll certainly never do it on accident.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref88" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn89"><p>http://www.open-std.org/jtc1/sc22/wg14/www/docs/summary.htm#dr_460<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref89" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn90"><p>https://en.wikipedia.org/wiki/Bit_bucket<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref90" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn91"><p>“Bit” is short for <em>binary digit</em>. Binary is just another way of representing numbers. Instead of digits 0-9 like we’re used to, it’s digits 0-1.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref91" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn92"><p>https://en.wikipedia.org/wiki/Two%27s_complement<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref92" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn93"><p>The industry term for a sequence of exactly, indisputably 8 bits is an <em>octet</em>.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref93" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn94"><p>In general, f you have an <span class="math inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="61" style="font-size: 101.6%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45B TEX-I"></mjx-c></mjx-mi></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>n</mi></math></mjx-assistive-mml></mjx-container></span> bit two’s complement number, the signed range is <span class="math inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="62" style="font-size: 101.6%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mo class="mjx-n"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-msup><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn><mjx-script style="vertical-align: 0.363em;"><mjx-texatom size="s" texclass="ORD"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45B TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-texatom></mjx-script></mjx-msup></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>−</mo><msup><mn>2</mn><mrow data-mjx-texclass="ORD"><mi>n</mi><mo>−</mo><mn>1</mn></mrow></msup></math></mjx-assistive-mml></mjx-container></span> to <span class="math inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="63" style="font-size: 101.6%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-msup><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn><mjx-script style="vertical-align: 0.363em;"><mjx-texatom size="s" texclass="ORD"><mjx-mi class="mjx-i"><mjx-c class="mjx-c1D45B TEX-I"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-texatom></mjx-script></mjx-msup><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="3"><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mn>2</mn><mrow data-mjx-texclass="ORD"><mi>n</mi><mo>−</mo><mn>1</mn></mrow></msup><mo>−</mo><mn>1</mn></math></mjx-assistive-mml></mjx-container></span>. And the unsigned range is <span class="math inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="64" style="font-size: 101.6%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-mn class="mjx-n"><mjx-c class="mjx-c30"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>0</mn></math></mjx-assistive-mml></mjx-container></span> to <span class="math inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="65" style="font-size: 101.6%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-msup><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn><mjx-script style="vertical-align: 0.363em;"><mjx-mi class="mjx-i" size="s"><mjx-c class="mjx-c1D45B TEX-I"></mjx-c></mjx-mi></mjx-script></mjx-msup><mjx-mo class="mjx-n" space="3"><mjx-c class="mjx-c2212"></mjx-c></mjx-mo><mjx-mn class="mjx-n" space="3"><mjx-c class="mjx-c31"></mjx-c></mjx-mn></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mn>2</mn><mi>n</mi></msup><mo>−</mo><mn>1</mn></math></mjx-assistive-mml></mjx-container></span>.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref94" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn95"><p>https://en.wikipedia.org/wiki/ASCII<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref95" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn96"><p>https://en.wikipedia.org/wiki/List_of_information_system_character_sets<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref96" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn97"><p>https://en.wikipedia.org/wiki/Unicode<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref97" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn98"><p>Depends on if a <code>char</code> defaults to <code>signed char</code> or <code>unsigned char</code><a href="https://beej.us/guide/bgc/html/index-wide.html#fnref98" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn99"><p>https://en.wikipedia.org/wiki/Signed_number_representations#Signed_magnitude_representation<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref99" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn100"><p>My <code>char</code> is signed.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref100" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn101"><p>https://en.wikipedia.org/wiki/IEEE_754<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref101" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn102"><p>This program runs as its comments indicate on a system with <code>FLT_DIG</code> of <code>6</code> that uses IEEE-754 base-2 floating point numbers. Otherwise, you might get different output.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref102" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn103"><p>It’s really surprising to me that C doesn’t have this in the spec yet. In the C99 Rationale document, they write, “A proposal to add binary constants was rejected due to lack of precedent and insufficient utility.” Which seems kind of silly in light of some of the other features they kitchen-sinked in there! I’ll bet one of the next releases has it.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref103" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn104"><p>https://en.wikipedia.org/wiki/Scientific_notation<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref104" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn105"><p>They’re the same except <code>snprintf()</code> allows you to specify a maximum number of bytes to output, preventing the overrunning of the end of your string. So it’s safer.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref105" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn106"><p>https://en.wikipedia.org/wiki/ASCII<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref106" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn107"><p>We have to pass a pointer to <code>badchar</code> to <code>strtoul()</code> or it won’t be able to modify it in any way we can see, analogous to why you have to pass a pointer to an <code>int</code> to a function if you want that function to be able to change that value of that <code>int</code>.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref107" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn108"><p>Each character has a value associated with it for any given character encoding scheme.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref108" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn109"><p>In practice, what’s probably happening on your implementation is that the high-order bits are just being dropped from the result, so a 16-bit number <code>0x1234</code> being converted to an 8-bit number ends up as <code>0x0034</code>, or just <code>0x34</code>.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref109" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn110"><p>Again, in practice, what will likely happen on your system is that the bit pattern for the original will be truncated and then just used to represent the signed number, two’s complement. For example, my system takes an <code>unsigned char</code> of <code>192</code> and converts it to <code>signed char</code> <code>-64</code>. In two’s complement, the bit pattern for both these numbers is binary <code>11000000</code>.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref110" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn111"><p>Not really—it’s just discarded regularly.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref111" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn112"><p>Functions with a variable number of arguments.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref112" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn113"><p>This is rarely done because the compiler will complain and having a prototype is the <em>Right Thing</em> to do. I think this still works for historic reasons, before prototypes were a thing.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref113" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn114"><p>https://beej.us/guide/bgclr/html/split/ctype.html<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref114" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn115"><p>https://gustedt.wordpress.com/2010/08/17/a-common-misconsception-the-register-keyword/<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref115" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn116"><p>https://en.wikipedia.org/wiki/Processor_register<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref116" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn117"><p>https://en.wikipedia.org/wiki/Boids<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref117" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn118"><p>Historially, MS-DOS and Windows programs would do this differently than Unix. In Unix, the shell would <em>expand</em> the wildcard into all matching files before your program saw it, whereas the Microsoft variants would pass the wildcard expression into the program to deal with. In any case, there are arguments that get passed into the program.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref118" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn119"><p>Since they’re just regular parameter names, you don’t actually have to call them <code>argc</code> and <code>argv</code>. But it’s so very idiomatic to use those names, if you get creative, other C programmers will look at you with a suspicious eye, indeed!<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref119" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn120"><p><code>ps</code>, Process Status, is a Unix command to see what processes are running at the moment.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref120" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn121"><p>https://en.wikipedia.org/wiki/Inception<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref121" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn122"><p>https://en.wikipedia.org/wiki/Shell_(computing)<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref122" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn123"><p>In Windows <code>cmd.exe</code>, type <code>echo %errorlevel%</code>. In PowerShell, type <code>$LastExitCode</code>.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref123" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn124"><p>If you need a numeric value, convert the string with something like <code>atoi()</code> or <code>strtol()</code>.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref124" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn125"><p>In Windows CMD.EXE, use <code>set FROTZ=value</code>. In PowerShell, use <code>$Env:FROTZ=value</code>.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref125" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn126"><p>https://pubs.opengroup.org/onlinepubs/9699919799/functions/exec.html<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref126" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn127"><p>You can’t always just wrap the code in <code>/*</code> <code>*/</code> comments because those won’t nest.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref127" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn128"><p>This isn’t really a macro—it’s technically an identifier. But it’s the only predefined identifier and it feels very macro-like, so I’m including it here. Like a rebel.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref128" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn129"><p>A hosted implementation basically means you’re running the full C standard, probably on an operating system of some kind. Which you probably are. If you’re running on bare metal in some kind of embedded system, you’re probably on a <em>standalone implementation</em>.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref129" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn130"><p>OK, I know that was a cop-out answer. Basically there’s an optional extension compilers can implement wherein they agree to limit certain types of undefined behavior so that the C code is more amenable to static code analysis. It is unlikely you’ll need to use this.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref130" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn131"><p><em>Breakin’ the law… breakin’ the law…</em><a href="https://beej.us/guide/bgc/html/index-wide.html#fnref131" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn132"><p>https://www.openmp.org/<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref132" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn133"><p>Technically we say that it has an <em>incomplete type</em>.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref133" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn134"><p>Though some compilers have options to force this to occur—search for <code>__attribute__((packed))</code> to see how to do this with GCC.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref134" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn135"><p><code>super</code> isn’t a keyword, incidentally. I’m just stealing some OOP terminology.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref135" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn136"><p>Assuming 8-bit <code>char</code>s, i.e.&nbsp;<code>CHAR_BIT == 8</code>.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref136" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn137"><p>https://en.wikipedia.org/wiki/Type_punning<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref137" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn138"><p>I just made up that number, but it’s probably not far off<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref138" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn139"><p>There’s some devil in the details with values that are stored in registers only, but we can safely ignore that for our purposes here. Also the C spec makes no stance on these “register” things beyond the <code>register</code> keyword, the description for which doesn’t mention registers.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref139" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn140"><p>You’re very likely to get different numbers on yours.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref140" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn141"><p>There is absolutely nothing in the spec that says this will always work this way, but it happens to work this way on my system.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref141" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn142"><p>Even if <code>E</code> is <code>NULL</code>, it turns out, weirdly.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref142" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn143"><p>https://beej.us/guide/bgclr/html/split/stringref.html#man-memcpy<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref143" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn144"><p>Your C compiler is not required to add padding bytes, and the values of any padding bytes that are added are indeterminate.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref144" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn145"><p>This will vary depending on the architecture, but my system is <em>little endian</em>, which means the least-significant byte of the number is stored first. <em>Big endian</em> systems will have the <code>12</code> first and the <code>78</code> last. But the spec doesn’t dictate anything about this representation.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref145" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn146"><p>It’s an optional feature, so it might not be there—but it probably is.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref146" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn147"><p>I’m printing out the 16-bit values reversed since I’m on a little-endian machine and it makes it easier to read here.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref147" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn148"><p>Assuming they point to the same array object.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref148" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn149"><p>The Go Programming Language drew its type declaration syntax inspiration from the opposite of what C does.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref149" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn150"><p>Not that other languages don’t do this—they do. It is interesting how many modern languages use the same operators for bitwise that C does.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref150" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn151"><p>https://en.wikipedia.org/wiki/Bitwise_operation<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref151" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn152"><p>That is, us lowly developers aren’t supposed to know what’s in there or what it means. The spec doesn’t dictate what it is in detail.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref152" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn153"><p>Honestly, it would be possible to remove that limitation from the language, but the idea is that the macros <code>va_start()</code>, <code>va_arg()</code>, and <code>va_end()</code> should be able to be written in C. And to make that happen, we need some way to initialize a pointer to the location of the first parameter. And to do that, we need the <em>name</em> of the first parameter. It would require a language extension to make this possible, and so far the committee hasn’t found a rationale for doing so.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref153" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn154"><p>“This planet has—or rather had—a problem, which was this: most of the people living on it were unhappy for pretty much of the time. Many solutions were suggested for this problem, but most of these were largely concerned with the movement of small green pieces of paper, which was odd because on the whole it wasn’t the small green pieces of paper that were unhappy.” —The Hitchhiker’s Guide to the Galaxy, Douglas Adams<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref154" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn155"><p>Remember that <code>char</code> is just a byte-sized integer.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref155" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn156"><p>Except for <code>isdigit()</code> and <code>isxdigit()</code>.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref156" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn157"><p>For example, we could store the code point in a big-endian 32-bit integer. Straightforward! We just invented an encoding! Actually not; that’s what UTF-32BE encoding is. Oh well—back to the grind!<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref157" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn158"><p>Ish. Technically, it’s variable width—there’s a way to represent code points higher than <span class="math inline"><mjx-container class="MathJax CtxtMenu_Attached_0" jax="CHTML" tabindex="0" ctxtmenu_counter="66" style="font-size: 101.6%; position: relative;"><mjx-math class="MJX-TEX" aria-hidden="true"><mjx-msup><mjx-mn class="mjx-n"><mjx-c class="mjx-c32"></mjx-c></mjx-mn><mjx-script style="vertical-align: 0.363em;"><mjx-texatom size="s" texclass="ORD"><mjx-mn class="mjx-n"><mjx-c class="mjx-c31"></mjx-c><mjx-c class="mjx-c36"></mjx-c></mjx-mn></mjx-texatom></mjx-script></mjx-msup></mjx-math><mjx-assistive-mml unselectable="on" display="inline"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mn>2</mn><mrow data-mjx-texclass="ORD"><mn>16</mn></mrow></msup></math></mjx-assistive-mml></mjx-container></span> by putting two UTF-16 characters together.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref158" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn159"><p>There’s a special character called the <em>Byte Order Mark</em> (BOM), code point 0xFEFF, that can optionally precede the data stream and indicate the endianess. It is not required, however.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref159" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn160"><p>Again, this is only true in UTF-16 for characters that fit in two bytes.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref160" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn161"><p>https://en.wikipedia.org/wiki/UTF-8<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref161" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn162"><p>https://www.youtube.com/watch?v=MijmeoH9LT4<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref162" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn163"><p>Presumably the compiler makes the best effort to translate the code point to whatever the output encoding is, but I can’t find any guarantees in the spec.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref163" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn164"><p>With a format specifier like <code>"%.12s"</code>, for example.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref164" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn165"><p><code>wcscoll()</code> is the same as <code>wcsxfrm()</code> followed by <code>wcscmp()</code>.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref165" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn166"><p>Ish—things get funky with multi-<code>char16_t</code> UTF-16 encodings.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref166" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn167"><p>https://en.wikipedia.org/wiki/Iconv<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref167" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn168"><p>http://site.icu-project.org/<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref168" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn169"><p>https://en.wikipedia.org/wiki/Core_dump<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref169" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn170"><p>Apparently it doesn’t do Unix-style signals at all deep down, and they’re simulated for console apps.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref170" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn171"><p>Confusingly, <code>sig_atomic_t</code> predates the lock-free atomics and is not the same thing.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref171" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn172"><p>If <code>sig_action_t</code> is signed, the range will be at least <code>-127</code> to <code>127</code>. If unsigned, at least <code>0</code> to <code>255</code>.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref172" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn173"><p>This is due to how VLAs are typically allocated on the stack, whereas <code>static</code> variables are on the heap. And the whole idea with VLAs is they’ll be automatically dellocated when the stack frame is popped at the end of the function.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref173" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn174"><p>https://en.wikipedia.org/wiki/Goto#Criticism<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref174" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn175"><p>I’d like to point out that using <code>goto</code> in all these cases is avoidable. You can use variables and loops instead. It’s just that some people think <code>goto</code> produces the <em>best</em> code in those circumstances.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref175" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn176"><p>https://en.wikipedia.org/wiki/Tail_call<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref176" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn177"><p>Which isn’t quite the same, since it’s an array, not a pointer to an <code>int</code>.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref177" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn178"><p>A variable used here <em>is</em> an expression.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref178" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn179"><p>Both “stack pointer” and “program counter” are related to the underlying architecture and C implementation, and are not part of the spec.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref179" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn180"><p>The rationale here is that the program might store a value temporarily in a <em>CPU register</em> while it’s doing work on it. In that timeframe, the register holds the correct value, and the value on the stack might be out of date. Then later the register values would get overwritten and the changes to the variable lost.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref180" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn181"><p>That is, remain allocated until the program ends with no way to free it.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref181" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn182"><p>This works because in C, pointers are the same size regardless of the type of data they point to. So the compiler doesn’t need to know the size of the <code>struct node</code> at this point; it just needs to know the size of a pointer.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref182" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn183"><p>https://en.wikipedia.org/wiki/Complex_number<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref183" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn184"><p>This was a harder one to research, and I’ll take any more information anyone can give me. <code>I</code> could be defined as <code>_Complex_I</code> or <code>_Imaginary_I</code>, if the latter exists. <code>_Imaginary_I</code> will handle signed zeros, but <code>_Complex_I</code> <em>might</em> not. This has implications with branch cuts and other complex-numbery-mathy things. Maybe. Can you tell I’m really getting out of my element here? In any case, the <code>CMPLX()</code> macros behave as if <code>I</code> were defined as <code>_Imaginary_I</code>, with signed zeros, even if <code>_Imaginary_I</code> doesn’t exist on the system.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref184" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn185"><p>The simplicity of this statement doesn’t do justice to the incredible amount of work that goes into simply understanding how floating point actually functions. https://randomascii.wordpress.com/2012/02/25/comparing-floating-point-numbers-2012-edition/<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref185" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn186"><p>This is the only one that doesn’t begin with an extra leading <code>c</code>, strangely.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref186" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn187"><p>Some architectures have different sized data that the CPU and RAM can operate with at a faster rate than others. In those cases, if you need the fastest 8-bit number, it might give you have a 16- or 32-bit type instead because that’s just faster. So with this, you won’t know how big the type is, but it will be least as big as you say.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref187" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn188"><p>Namely, the system has 8, 16, 32, or 64 bit integers with no padding that use two’s complement representation, in which case the <code>intN_t</code> variant for that particular number of bits <em>must</em> be defined.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref188" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn189"><p>On Earth, anyway. Who know what crazy systems they use <em>out there</em>…<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref189" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn190"><p>OK, don’t murder me! GMT is technically a time zone while UTC is a global time system. Also some countries might adjust GMT for daylight saving time, whereas UTC is never adjusted for daylight saving time.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref190" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn191"><p>Admittedly, there are more than two.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref191" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn192"><p>https://en.wikipedia.org/wiki/Unix_time<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref192" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn193"><p>https://beej.us/guide/bgclr/html/split/time.html#man-strftime<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref193" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn194"><p>You will on POSIX, where <code>time_t</code> is definitely an integer. Unfortunately the entire world isn’t POSIX, so there we are.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref194" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn195"><p>https://en.wikipedia.org/wiki/POSIX_Threads<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref195" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn196"><p>I’m more a fan of shared-nothing, myself, and my skills with classic multithreading constructs are rusty, to say the least.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref196" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn197"><p>Yes, <code>pthreads</code> with a “<code>p</code>”. It’s short for POSIX threads, a library that C11 borrowed liberally from for its threads implementation.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref197" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn198"><p>Per §7.1.4¶5.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref198" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn199"><p>Unless you <code>thrd_detach()</code>. More on this later.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref199" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn200"><p>Though I don’t think they have to be. It’s just that the threads don’t seem to get rescheduled until some system call like might happen with a <code>printf()</code>… which is why I have the <code>printf()</code> in there.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref200" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn201"><p>Short for “mutual exclusion”, AKA a “lock” on a section of code that only one thread is permitted to execute.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref201" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn202"><p>That is, your process will go to sleep.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref202" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn203"><p>You might have expected it to be “time from now”, but you’d just like to think that, wouldn’t you!<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref203" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn204"><p>And that’s why they’re called <em>condition variables</em>!<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref204" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn205"><p>I’m not saying it’s aliens… but it’s aliens. OK, really more likely another thread might have been woken up and gotten to the work first.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref205" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn206"><p>Survival of the fittest! Right? I admit it’s actually nothing like that.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref206" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn207"><p>The <code>__STDC_VERSION__</code> macro didn’t exist in early C89, so if you’re worried about that, check it with <code>#ifdef</code>.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref207" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn208"><p>The reason for this is when optimized, my compiler has put the value of <code>x</code> in a register to make the <code>while</code> loop fast. But the register has no way of knowing that the variable was updated in another thread, so it never sees the <code>3490</code>. This isn’t really related to the <em>all-or-nothing</em> part of atomicity, but is more related to the synchronization aspects in the next section.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref208" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn209"><p>Until I say otherwise, I’m speaking generally about <em>sequentially consistent</em> operations. More on what that means soon.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref209" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn210"><p>Sanest from a programmer perspective.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref210" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn211"><p>Apparently C++23 is adding this as a macro.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref211" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn212"><p>The spec notes that they might differ in size, representation, and alignment.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref212" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn213"><p>I just pulled that example out of nowhere. Maybe it doesn’t matter on Intel/AMD, but it could matter somewhere, dangit!<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref213" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn214"><p>C++ elaborates that if the signal is the result of a call to <code>raise()</code>, it is sequenced <em>after</em> the <code>raise()</code>.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref214" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn215"><p>https://en.wikipedia.org/wiki/Test-and-set<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref215" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn216"><p>Because consume is all about the operations that are dependent on the value of the acquired atomic variable, and there is no atomic variable with a fence.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref216" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn217"><p>https://www.youtube.com/watch?v=A8eCGOqgvH4<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref217" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn218"><p>https://www.youtube.com/watch?v=KeLBd2EJLOU<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref218" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn219"><p>https://preshing.com/archives/<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref219" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn220"><p>https://preshing.com/20120612/an-introduction-to-lock-free-programming/<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref220" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn221"><p>https://preshing.com/20120913/acquire-and-release-semantics/<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref221" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn222"><p>https://preshing.com/20130702/the-happens-before-relation/<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref222" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn223"><p>https://preshing.com/20130823/the-synchronizes-with-relation/<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref223" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn224"><p>https://preshing.com/20140709/the-purpose-of-memory_order_consume-in-cpp11/<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref224" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn225"><p>https://preshing.com/20150402/you-can-do-any-kind-of-atomic-read-modify-write-operation/<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref225" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn226"><p>https://en.cppreference.com/w/c/atomic/memory_order<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref226" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn227"><p>https://en.cppreference.com/w/c/language/atomic<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref227" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn228"><p>https://docs.microsoft.com/en-us/windows/win32/dxtecharts/lockless-programming<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref228" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn229"><p>https://www.reddit.com/r/C_Programming/<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref229" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn230"><p>You can do this with <code>-O</code> on the command line.<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref230" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn231"><p>https://beej.us/guide/bgclr/html/split/stdlib.html#man-exit<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref231" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn232"><p>https://beej.us/guide/bgclr/html/split/stdlib.html#man-abort<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref232" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn233"><p>https://en.wikipedia.org/wiki/Data_structure_alignment<a href="https://beej.us/guide/bgc/html/index-wide.html#fnref233" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>


</body></html>